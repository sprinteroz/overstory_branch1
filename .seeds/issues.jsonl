{"id":"overstory-036f","title":"Coordinator session stuck in booting state","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T14:42:35.949443-08:00","updatedAt":"2026-02-13T06:45:22.676038-08:00","assignee":"jayminwest@gmail.com","description":"The coordinator agent's session state never transitions from 'booting' to 'working'. The booting->working transition in log.ts:68-71 depends on updateLastActivity being called via the overstory log hook, but for the coordinator running at project root the hook doesn't seem to fire or doesn't pass the correct agent name. The lastActivity timestamp stays at the initial startedAt value, confirming no log events were processed. Investigate whether the coordinator's hooks are correctly configured to call overstory log with --agent coordinator.","closeReason":"Fixed coordinator stuck in booting: moved session recording before beacon send in both coordinator.ts and sling.ts so updateLastActivity can find the session entry when hooks fire","closedAt":"2026-02-13T06:45:22.676038-08:00"}
{"id":"overstory-03z1","title":"Write agent identity tests (identity.test.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:21:13.546232-08:00","updatedAt":"2026-02-13T08:41:51.800521-08:00","assignee":"jayminwest@gmail.com","closeReason":"Agent identity tests written: 24 tests covering createIdentity, loadIdentity, updateIdentity with round-trip YAML serialization","closedAt":"2026-02-13T08:41:51.800521-08:00"}
{"id":"overstory-05o","title":"[Epic] Layer 1: Core Infrastructure","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T07:11:20.538883-08:00","updatedAt":"2026-02-12T07:28:35.03906-08:00","assignee":"jayminwest@gmail.com","description":"All core infrastructure modules. 8 parallel tasks. Depends on Layer 0 completion.","closeReason":"All 8 L1 subtasks completed","closedAt":"2026-02-12T07:28:35.03906-08:00"}
{"id":"overstory-06l7","title":"Make init deploy agent definition .md files to target project","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T12:57:48.2158-08:00","updatedAt":"2026-02-12T13:27:26.758772-08:00","assignee":"jayminwest@gmail.com","description":"overstory init doesn't copy agent definition files (scout.md, builder.md, etc.) from overstory's install dir to the target project. Sling fails in external projects because manifest.load() resolves agent files relative to config.project.root. Fix: copy agents/*.md to .overstory/agent-defs/ during init, update default config agents.baseDir accordingly. Agent defs should be git-tracked (not gitignored) so the project is self-contained.","closeReason":"init now copies agents/*.md from overstory install dir to .overstory/agent-defs/ via readdir + Bun.write. 3 tests added.","closedAt":"2026-02-12T13:27:26.758772-08:00"}
{"id":"overstory-07iy","title":"Dynamic task redistribution: builder work pool","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-16T08:05:58.26639-08:00","updatedAt":"2026-02-16T19:08:50.027443-08:00","assignee":"jayminwest@gmail.com","description":"Instead of builders closing after completing their task, they should check bd ready for unassigned work and pick up the next task. Requires: a work pool concept where supervisor/lead has a queue of decomposed tasks, builders that check for more work after closing current task, and a new available_for_work mail type. This enables true swarm parallelism.","closeReason":"Contradicts core architecture: agents are disposable (spawn, run, kill). Reusing builders across tasks means context accumulation, potential compaction, stale state. Leads already handle task queuing and spawn fresh builders per task. Spawn overhead is not worth sacrificing the clean-context guarantee.","closedAt":"2026-02-16T19:08:50.027443-08:00"}
{"id":"overstory-07jl","title":"Fix sling to use resolveModel() for config-level model overrides","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T07:26:14.396637-08:00","updatedAt":"2026-02-18T07:27:51.595069-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed sling to use resolveModel() instead of agentDef.model directly, so config.models overrides in config.yaml apply to sling-spawned agents. Two lines changed in src/commands/sling.ts: import and usage.","closedAt":"2026-02-18T07:27:51.595069-08:00"}
{"id":"overstory-08ox","title":"Doctor: worktree/tmux/session three-way consistency","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:35.604636-08:00","updatedAt":"2026-02-15T12:49:18.832688-08:00","assignee":"jayminwest@gmail.com","description":"Verify consistency between git worktrees, tmux sessions, and the sessions database. This is the most complex check — follows the ZFC principle from watchdog/health.ts: observable state (tmux, process) > recorded state (sessions.db).\n\nChecks:\n- List all git worktrees via 'git worktree list --porcelain'\n- List all tmux sessions matching 'overstory-*' pattern\n- Query sessions.db for all non-completed sessions\n- Cross-reference all three sources:\n\nOrphaned worktrees:\n- Worktree directory exists in .overstory/worktrees/ but NOT in 'git worktree list' output\n- Worktree in git but directory missing on disk (ghost worktree)\n\nTmux/worktree misalignment:\n- Tmux session exists but no corresponding worktree\n- Worktree exists but no corresponding tmux session (process died)\n\nSession/reality misalignment:\n- Session state is 'working' or 'booting' but tmux session is dead\n- Session state is 'working' but PID is dead (kill -0 check)\n- Session exists but worktree doesn't\n\nDangling branches:\n- Branches matching 'overstory/*' pattern with no worktree or session\n\nSource references:\n- src/worktree/manager.ts — worktree list parsing, naming convention\n- src/worktree/tmux.ts — tmux session naming (overstory-{project}-{agent}), liveness check\n- src/sessions/store.ts — session state, agent_name uniqueness\n- src/watchdog/health.ts — ZFC principle, evaluateHealth(), signal priority\n\nOutput: pass/warn/fail. Reuse evaluateHealth() logic where possible. Report each inconsistency with specific remediation (e.g. 'run overstory worktree clean' or 'kill tmux session X').","closeReason":"Implemented worktree/tmux/session three-way consistency check with comprehensive tests and path normalization","closedAt":"2026-02-15T12:49:18.832688-08:00"}
{"id":"overstory-0fuu","title":"Auto-detect mulch domains from file scope in sling","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-20T13:09:39.138161-08:00","updatedAt":"2026-02-20T13:21:04.632964-08:00","assignee":"jayminwest@gmail.com","description":"sling.ts passes config.mulch.domains to the overlay but those are project-level defaults, usually empty. The overlay shows 'No specific expertise domains configured' for most agents, giving them nothing useful to prime. Use inferDomain() logic from src/insights/analyzer.ts to auto-detect domains from file paths at spawn time. E.g. .ts files → typescript domain, src/commands/ → cli domain. Agents get actionable prime commands instead of empty placeholder.","closeReason":"Added inferDomainsFromFiles() to sling.ts: auto-detects mulch domains from file scope using inferDomain() from analyzer.ts, deduplicates and sorts results, falls back to config defaults. 13 tests added.","closedAt":"2026-02-20T13:21:04.632964-08:00"}
{"id":"overstory-0kf","title":"L1-1: Implement logging system (src/logging/*)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:25.178092-08:00","updatedAt":"2026-02-12T07:25:12.811655-08:00","assignee":"jayminwest@gmail.com","description":"Multi-format logger (human-readable + NDJSON), secret sanitizer with redaction patterns (API keys, tokens, Bearer), ANSI console reporter. Files: src/logging/logger.ts, src/logging/sanitizer.ts, src/logging/reporter.ts","closeReason":"Implemented logging system: logger.ts (multi-format writer), sanitizer.ts (secret redaction), reporter.ts (ANSI console output)","closedAt":"2026-02-12T07:25:12.811655-08:00"}
{"id":"overstory-0kwf","title":"Enforce coordinator -> lead -> builder delegation hierarchy","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T11:50:10.286601-08:00","updatedAt":"2026-02-13T12:35:10.76989-08:00","assignee":"jayminwest@gmail.com","description":"During e2e testing, the coordinator delegated directly to builders, bypassing team leads. While this works functionally, the intended architecture is coordinator -> lead -> builder. The hierarchy enforcement via validateHierarchy in sling.ts exists but the coordinator's behavioral prompting doesn't strongly enough discourage direct builder spawning. Steps: (1) Review current hierarchy validation logic, (2) Strengthen coordinator overlay to prefer spawning leads over builders, (3) Consider a soft warning when coordinator spawns builders directly, (4) Ensure leads have clear instructions on how to manage their builder sub-teams.","closeReason":"Coordinator beacon now includes explicit HIERARCHY instruction reinforcing lead-only spawning. Combined with existing validateHierarchy code enforcement in sling.ts and base definition injection via --append-system-prompt.","closedAt":"2026-02-13T12:35:10.76989-08:00"}
{"id":"overstory-0l52","title":"Add merge_ready reviewer validation in mail.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:01:21.922474-08:00","updatedAt":"2026-02-17T08:05:35.510968-08:00","assignee":"jayminwest@gmail.com","description":"Add structural enforcement to mail send: warn when merge_ready sent without reviewer evidence","closeReason":"Added merge_ready reviewer validation: checks SessionStore for reviewers when --type merge_ready is sent, emits warnings to stderr if coverage is missing. All tests pass.","closedAt":"2026-02-17T08:05:35.510968-08:00"}
{"id":"overstory-0mt9","title":"Agent reputation tracking system","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:50.328058-08:00","updatedAt":"2026-02-16T19:07:29.74272-08:00","assignee":"jayminwest@gmail.com","description":"Track success/failure rates per agent type per task category. Store in mulch as project-agnostic records (e.g., 'builder agent completed typescript-refactoring in 12min, all tests passed'). Use for intelligent task routing in sling command. Query before spawning to find best-fit agent.","closeReason":"Invalid: agents are disposable (spawned once, run to completion, killed). No persistent identity to track reputation against. And with only ~5 agent types (builder/scout/reviewer/lead/merger), per-capability tracking isn't justified either.","closedAt":"2026-02-16T19:07:29.74272-08:00"}
{"id":"overstory-0puy","title":"Wire tier2Enabled into monitor.ts and update stale comments in types.ts/config.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T17:00:33.350483-08:00","updatedAt":"2026-02-18T17:05:30.389082-08:00","assignee":"jayminwest@gmail.com","closeReason":"Wired tier2Enabled into startMonitor() as AgentError gate; updated stale 'not yet implemented' comments in types.ts and config.ts; added 2 tests verifying the disabled guard; fixed import ordering in monitor.ts and monitor.test.ts","closedAt":"2026-02-18T17:05:30.389082-08:00"}
{"id":"overstory-0rav","title":"Mulch-powered code review enhancement","status":"open","type":"task","priority":3,"createdAt":"2026-02-15T17:04:57.056672-08:00","updatedAt":"2026-02-15T17:04:57.056672-08:00","assignee":"jayminwest@gmail.com","description":"Reviewer agents query mulch for known patterns, past bugs, and conventions before reviewing. Instead of generic review, they check for project-specific issues. Requires overlay.ts to inject relevant mulch context into reviewer agents."}
{"id":"overstory-0sw","title":"sling'd agents may not have 'overstory' on PATH in tmux","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:20:22.02265-08:00","updatedAt":"2026-02-12T08:32:31.447904-08:00","assignee":"jayminwest@gmail.com","description":"Agent tmux sessions launched by 'overstory sling' rely on hooks that call 'overstory prime', 'overstory mail check', and 'overstory log'. However, if overstory is installed via 'bun link' (which adds it to ~/.bun/bin/), the tmux session may not inherit the PATH that includes ~/.bun/bin/. This would cause all hooks to silently fail. The sling command should either: 1) Verify overstory is globally accessible, 2) Use an absolute path to the overstory binary in hooks, or 3) Ensure the tmux session inherits the necessary PATH.","closeReason":"tmux createSession now detects overstory binary path and prepends it to PATH in spawned sessions","closedAt":"2026-02-12T08:32:31.447904-08:00"}
{"id":"overstory-0wfq","title":"Phase 1: Harden for Open Source","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-15T17:04:17.727289-08:00","updatedAt":"2026-02-16T14:00:07.296979-08:00","assignee":"jayminwest@gmail.com","description":"Foundation hardening before pushing new features. Fix documentation gaps, concurrency bugs, and CLI ergonomics for open-source readiness.","closeReason":"Phase 1 hardening complete. All 9 sub-issues resolved across 7 leads, 35 total sessions. Merged: mandatory review loop (lead.md), scout-first workflow (lead.md), mulch completion gate (all agent defs + overlay), overstory logs command, real-time token tracking (costs --live), unified feed command, mulch learn hook fix, coordinator --monitor flag, mulch enhancements scoped as external.","closedAt":"2026-02-16T14:00:07.296979-08:00"}
{"id":"overstory-0ze","title":"mail send --agent flag undocumented in help (works as alias for --from)","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T09:41:00.130316-08:00","updatedAt":"2026-02-12T09:47:20.593863-08:00","assignee":"jayminwest@gmail.com","description":"The mail send command accepts an --agent flag as an alias for --from, but the help text only documents --from. The overlay CLAUDE.md template shows examples using --agent for all mail commands. The help should document --agent or the overlay examples should use --from for consistency.","closeReason":"Documented --agent as alias for --from in mail send and reply help text","closedAt":"2026-02-12T09:47:20.593863-08:00"}
{"id":"overstory-166","title":"Strengthen agent prompts with named failure modes and propulsion principle","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T12:13:06.430871-08:00","updatedAt":"2026-02-12T12:25:40.483006-08:00","assignee":"jayminwest@gmail.com","description":"Add Propulsion Principle to all agent definitions: Read your assignment, execute immediately, no confirmation. Add named failure modes per role: Builder FILE_SCOPE_VIOLATION (editing outside assigned scope), Builder CANONICAL_BRANCH_WRITE (committing to canonical branch), Scout READ_ONLY_VIOLATION (using Write/Edit/destructive bash), Lead UNNECESSARY_SPAWN (spawning for tasks small enough to do directly), Lead OVERLAPPING_FILE_SCOPE (assigning same file to multiple builders), All SILENT_FAILURE (not reporting errors via mail), All INCOMPLETE_CLOSE (bd close without passing quality gates or sending result mail). Add cost-awareness: every mail costs tokens. Add explicit completion protocol per role.","closeReason":"Added propulsion principle, named failure modes, cost awareness, and completion protocol to all agent definitions (scout, builder, reviewer, lead, merger)","closedAt":"2026-02-12T12:25:40.483006-08:00"}
{"id":"overstory-16g","title":"Epic: Adopt 'never mock what you can use for real' testing philosophy","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T08:55:47.248182-08:00","updatedAt":"2026-02-12T09:14:41.040434-08:00","assignee":"jayminwest@gmail.com","description":"Overhaul the test suite to follow the principle: never mock what you can use for real. Currently 4 of 12 test files use Bun.spawn mocks for external tools (worktree, beads-client, resolver, tmux). Most of these can be replaced with real implementations using temp directories, real git repos, real SQLite, and real bd. Only tmux and external AI services truly need mocking. This epic also covers relocating tests from __tests__/ to colocated with source files.","closeReason":"All tasks complete: tests colocated, test harness created, CLAUDE.md updated, tmux mock documented, worktree/resolver/beads-client tests rewritten with real implementations. Found and fixed real bd CLI parsing bugs.","closedAt":"2026-02-12T09:14:41.040434-08:00"}
{"id":"overstory-16o7","title":"Make reviewers optional/conditional in lead.md","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-21T06:26:38.057259-08:00","updatedAt":"2026-02-21T06:46:58.947422-08:00","assignee":"jayminwest@gmail.com","description":"Replace mandatory 1:1 reviewer-per-builder with cost-aware guidance. For simple, well-scoped tasks with passing quality gates, the lead MAY verify by reading the diff and checking quality gates itself instead of spawning a reviewer. Spawn reviewers for complex changes, multi-file modifications, or when independent verification is needed. Key lines to change: lead.md lines 136, 148, 192, 231, 242. Remove/soften REVIEW_SKIP failure mode. This is the biggest agent multiplier — N builders = N reviewers = 2N depth-2 agents.","closeReason":"Merged via overstory/agent-def-builder/overstory-r9x0. Lead.md now has Task Complexity Assessment (simple/moderate/complex), optional scouts, conditional reviewers, and INSIGHT protocol removed.","closedAt":"2026-02-21T06:46:58.947422-08:00"}
{"id":"overstory-18zt","title":"Scout-first workflow: leads spawn scouts before builders","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-16T08:05:54.20244-08:00","updatedAt":"2026-02-16T13:33:59.130124-08:00","assignee":"jayminwest@gmail.com","description":"Update lead.md to spawn 1-2 scouts first (in parallel for different aspects) before planning builder work. Currently leads do their own scouting, which blocks them from managing concurrent builders and produces lower quality specs than a specialized scout would.","closeReason":"Updated lead.md Phase 1 to scout-first workflow: scouts are now the default exploration mechanism (1-2 in parallel), leads plan decomposition while scouts work, self-scouting restricted to trivial tasks meeting 3 explicit criteria. Builder implemented, reviewer verified PASS on all 8 acceptance criteria.","closedAt":"2026-02-16T13:33:59.130124-08:00"}
{"id":"overstory-19e","title":"Mail messages may be lost during concurrent agent/orchestrator access","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:54:16.59917-08:00","updatedAt":"2026-02-12T11:51:05.992165-08:00","assignee":"jayminwest@gmail.com","description":"During E2E testing, messages sent to 'status-builder' via 'mail send' returned success (with message IDs), but the messages were not found in mail.db afterward. This occurred while an agent was running in a worktree that shares the same .git directory and potentially the same mail.db. Possible causes: (1) WAL file contention between agent and orchestrator SQLite connections, (2) WAL checkpoint race condition, (3) the merge process somehow affecting SQLite state. Need investigation with concurrent access stress testing.","closeReason":"Root cause was mail.ts using raw cwd instead of resolved project root, causing agents in worktrees to open separate mail.db files. Fixed by resolving project root in mailCommand. Also added PRAGMA synchronous=NORMAL and WAL checkpoint on close for better concurrent access.","closedAt":"2026-02-12T11:51:05.992165-08:00"}
{"id":"overstory-19p","title":"[Epic] Layer 3: Merge + Orchestration","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T07:11:49.943203-08:00","updatedAt":"2026-02-12T07:36:35.111621-08:00","assignee":"jayminwest@gmail.com","description":"Merge system and orchestration commands. 6 parallel tasks. Depends on Layer 2 completion.","closeReason":"All 6 L3 subtasks completed","closedAt":"2026-02-12T07:36:35.111621-08:00"}
{"id":"overstory-1bwo","title":"Add pre-scouted exception to lead workflow","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:09:31.403886-08:00","updatedAt":"2026-02-21T06:20:25.71228-08:00","assignee":"jayminwest@gmail.com","description":"Add a second exception to the lead three-phase workflow in agents/lead.md. When the coordinator dispatch mail references existing scout spec files in .overstory/specs/, the lead should skip Phase 1 (Scout) and go directly to Phase 2 (Build) using those specs. This prevents context exhaustion when scouts have already run.","closeReason":"Added pre-scouted exception to lead.md — leads can now skip scouting when dispatch references existing spec files","closedAt":"2026-02-21T06:20:25.71228-08:00"}
{"id":"overstory-1d3y","title":"Cherry-pick mulch decomposition commit onto main","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:33:10.047116-08:00","updatedAt":"2026-02-13T22:41:03.844815-08:00","assignee":"jayminwest@gmail.com","description":"The builder branch overstory/builder-mulch-decomp/overstory-dp9p has a spurious commit (e6b4689) alongside the real implementation commit (1a271f0). overstory merge failed due to .beads/issues.jsonl conflict from the spurious commit. Cherry-pick only commit 1a271f0 onto main. Run quality gates after.","closeReason":"Cherry-pick completed, merged to main","closedAt":"2026-02-13T22:41:03.844815-08:00"}
{"id":"overstory-1f9g","title":"Implement overstory doctor command","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:59:00.740809-08:00","updatedAt":"2026-02-15T12:55:22.54026-08:00","assignee":"jayminwest@gmail.com","description":"Add a comprehensive health-check command (overstory doctor) that validates all overstory subsystems and reports actionable diagnostics. Modeled after mulch doctor. Should be non-destructive, comprehensive, and produce clear remediation steps. Categories: external deps, directory structure, config, databases, worktree/tmux alignment, session state, agent manifest, merge queue, log disk usage, version check. Future: --fix flag for auto-remediation, --json for structured output.","closeReason":"Doctor command fully implemented: scaffold with CLI registration, check runner, ANSI output formatter, JSON output, --verbose/--category flags. 9 check categories implemented: dependencies, version, config, structure, logs, agents, databases, merge-queue, consistency. Plus 3 bonus tasks: --watchdog flag for coordinator, lead self-termination fix, inspect command.","closedAt":"2026-02-15T12:55:22.54026-08:00"}
{"id":"overstory-1ilu","title":"Track orchestrator session cost in overstory costs","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-19T12:08:31.158763-08:00","updatedAt":"2026-02-19T13:06:18.715633-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\n`overstory costs` only shows costs for spawned agents (workers, leads, coordinator). The user's own Claude Code session (the orchestrator) is completely invisible to cost tracking. This means you cannot answer 'how much did this entire swarm session cost?' because the orchestrator's token usage is excluded.\n\n## Current Behavior\n\nAll hooks use an ENV guard that skips execution when OVERSTORY_AGENT_NAME is unset:\n```bash\n[ -z \"\\$OVERSTORY_AGENT_NAME\" ] && exit 0\n```\n\nThe orchestrator session (the user's Claude Code) does not have this env var set, so:\n- No session-end event fires → no transcript parsing → no metrics recorded\n- No token snapshots recorded → invisible to `overstory costs --live`\n- Not registered in sessions.db → no session lifecycle tracking\n\nThe coordinator agent (spawned via `overstory coordinator start`) IS tracked because it gets OVERSTORY_AGENT_NAME=coordinator. But the user's direct session is not.\n\n## Desired Behavior\n\n`overstory costs` should be able to show the orchestrator's own session cost, either:\n\n**Option A: Self-scan mode** — Add `overstory costs --self` that finds and parses the current session's transcript JSONL directly from `~/.claude/projects/{project-key}/{session-id}.jsonl`. No hooks needed, just filesystem discovery. Lightweight, no architectural changes.\n\n**Option B: Hook integration** — Modify the ENV guard to allow cost-specific logging for the orchestrator. Add a separate hook path that records token snapshots and session metrics for the orchestrator without requiring OVERSTORY_AGENT_NAME. More invasive, but gives real-time --live visibility.\n\n**Option C: Run-level aggregate** — When displaying costs for a run, also parse the coordinator's transcript (discoverable via runs.coordinator_session_id) and include it as a separate line item. Pairs well with the --run fix (separate issue).\n\n## Context\n\nThe transcript parser (`src/metrics/transcript.ts`) already handles any Claude Code JSONL file — it's agent-agnostic. The `src/commands/log.ts` transcript discovery logic (lines 183-226) also works for any project path. The plumbing exists; it just needs to be wired to the orchestrator.\n\n### Transcript location pattern:\n```\n~/.claude/projects/-Users-jayminwest-Projects-overstory/{session-id}.jsonl       # orchestrator\n~/.claude/projects/-Users-jayminwest-Projects-overstory--overstory-worktrees-{agent}/{session-id}.jsonl  # agents\n```\n\n## Files likely involved\n\n- `src/commands/costs.ts` — Add --self flag or orchestrator inclusion logic\n- `src/metrics/transcript.ts` — Already works, may need session discovery helper\n- `src/commands/log.ts` — Transcript path resolution logic to reuse\n- `templates/hooks.json.tmpl` — If going with Option B, modify ENV guard for cost hooks","closeReason":"Added --self flag to overstory costs. Discovers and parses the orchestrator session transcript from ~/.claude/projects/. 1916 tests pass.","closedAt":"2026-02-19T13:06:18.715633-08:00"}
{"id":"overstory-1iw5","title":"Fix YAML parser: arrays after key: parsed as empty objects","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T13:38:30.428253-08:00","updatedAt":"2026-02-16T07:02:03.087461-08:00","assignee":"jayminwest@gmail.com","description":"2 E2E tests in src/e2e/init-sling-lifecycle.test.ts fail because parseYaml in src/config.ts mishandles arrays. When YAML has 'key:\\n  - item1\\n  - item2', the parser creates {} for the key (empty value after colon) then fails to convert it to [] when array items appear. The Array.isArray check at line ~123 fails because existing is {} not []. sandbox.allowedDomains and sandbox.denyReadPaths are parsed as {} instead of arrays, causing ValidationError. Fix: when a '- ' array item is encountered and parent's last key is {}, convert it to [] before pushing.","closeReason":"Already fixed in prior session (commits f841427, 420d8b7)","closedAt":"2026-02-16T07:02:03.087461-08:00"}
{"id":"overstory-1l3","title":"L3-5: Implement status command (src/commands/status.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:12:09.461311-08:00","updatedAt":"2026-02-12T07:36:21.716923-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory status [--json] [--watch]. Shows: active agents (name, state, task, duration), worktree status, beads summary, mail queue depth, merge queue state. --watch mode uses polling for live updates.","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.716923-08:00"}
{"id":"overstory-1uaz","title":"Write supervisor.test.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:05:27.660237-08:00","updatedAt":"2026-02-13T09:32:05.328919-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.328919-08:00"}
{"id":"overstory-1wj","title":"Add PreToolUse guards to block dangerous operations","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T12:13:02.529044-08:00","updatedAt":"2026-02-12T12:34:19.46856-08:00","assignee":"jayminwest@gmail.com","description":"Add hook entries that intercept: git push to canonical branch, git checkout -b with wrong naming, git reset --hard. Implement 'overstory guard <operation>' CLI command called by the hook. Validates branch naming conventions, prevents pushes to canonical branch. Different guard sets per capability (read-only agents get stricter guards blocking Write/Edit tools).","closeReason":"Added getDangerGuards() to hooks-deployer.ts: Bash PreToolUse guard that blocks git push to main/master, git reset --hard, and git checkout -b with wrong naming convention. Guards applied to all agent capabilities. 10 new tests added.","closedAt":"2026-02-12T12:34:19.46856-08:00"}
{"id":"overstory-26j","title":"L3-2: Implement tiered conflict resolver (src/merge/resolver.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:11:58.395385-08:00","updatedAt":"2026-02-12T07:36:21.651943-08:00","assignee":"jayminwest@gmail.com","description":"4-tier conflict resolution: 1) Clean merge (git merge --no-edit), 2) Auto-resolve (parse conflict markers), 3) AI-resolve (spawn claude --print with both versions), 4) Re-imagine (spawn claude --print on fresh checkout to reimplement). Tiers escalate automatically. Each tier configurable (enable/disable).","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.651943-08:00"}
{"id":"overstory-27jf","title":"Add reviewer-ratio doctor check in consistency.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:01:23.5072-08:00","updatedAt":"2026-02-17T08:07:02.46679-08:00","assignee":"jayminwest@gmail.com","description":"Add doctor consistency check for reviewer-to-builder ratio per lead","closeReason":"Added reviewer-coverage consistency check in src/doctor/consistency.ts with 5 comprehensive tests. Check validates reviewer-to-builder ratio per lead agent to enforce review-before-merge workflow.","closedAt":"2026-02-17T08:07:02.46679-08:00"}
{"id":"overstory-2bix","title":"Wire up tier2Enabled config flag or remove dead code","status":"closed","type":"task","priority":4,"createdAt":"2026-02-15T17:04:34.505552-08:00","updatedAt":"2026-02-18T17:07:00.89658-08:00","assignee":"jayminwest@gmail.com","description":"The tier2Enabled key exists in watchdog config defaults (set to false) but no code path reads it. Either wire it into monitor.ts to gate Tier 2 startup, or remove it to avoid confusion.","closeReason":"Wired tier2Enabled config flag into monitor.ts (throws AgentError when disabled) and coordinator.ts (skips --monitor auto-start when disabled). Updated stale 'not yet implemented' comments in types.ts and config.ts. Two builder branches with non-overlapping file scopes ready to merge.","closedAt":"2026-02-18T17:07:00.89658-08:00"}
{"id":"overstory-2ed","title":"L2-3: Implement agent identity (src/agents/identity.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:11:50.235583-08:00","updatedAt":"2026-02-12T07:33:09.560065-08:00","assignee":"jayminwest@gmail.com","description":"Persistent agent identity management. Create/load/update AgentIdentity YAML files at .overstory/agents/{name}/identity.yaml. Track sessions completed, expertise domains, recent tasks. Functions: createIdentity, loadIdentity, updateIdentity.","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.560065-08:00"}
{"id":"overstory-2evj","title":"Add bead-level locking to prevent concurrent leads on same issue","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-21T06:32:16.86806-08:00","updatedAt":"2026-02-21T07:09:12.706476-08:00","assignee":"jayminwest@gmail.com","description":"Prevent multiple leads from working the same bead ID concurrently. When a lead is slung against a bead, mark it as locked (e.g., via bd update --assignee or a dedicated lock field). Before slinging, check if the bead is already being worked by an active agent. This prevents the duplication seen in the audit run where Phase 1 and Phase 2 leads operated on the same bead IDs simultaneously, producing duplicate work and ~50 duplicate issues.","closeReason":"Implemented checkBeadLock: prevents concurrent agents on same bead ID. Pure function + enforcement in slingCommand step 5d.","closedAt":"2026-02-21T07:09:12.706476-08:00"}
{"id":"overstory-2gu1","title":"Orchestrator sessions skip mulch learn hooks","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T17:28:59.084061-08:00","updatedAt":"2026-02-16T13:18:54.839187-08:00","assignee":"jayminwest@gmail.com","description":"All hooks in settings.local.json gate on OVERSTORY_AGENT_NAME being set. Regular Claude Code sessions (no swarm) never trigger the Stop hook, so mulch learn never runs and learning suggestions are never generated. Need a parallel hook path or remove the env guard for the Stop hook so direct orchestrator sessions also get post-session mulch analysis.","closeReason":"All 3 assigned issues completed: (1) overstory-2gu1: Added mulch learn to Stop hooks for orchestrator and agent sessions, (2) overstory-l13t: Added --monitor flag to coordinator start/stop/status, (3) overstory-f0kl: Scoped as external mulch-cli work - overstory client already wraps all available features.","closedAt":"2026-02-16T13:18:54.839187-08:00"}
{"id":"overstory-2hk3","title":"Implement ResolvedModel return type for resolveModel()","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T07:37:15.650909-08:00","updatedAt":"2026-02-20T07:43:07.179725-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added ResolvedModel interface, relaxed AgentDefinition.model to ModelRef, implemented resolveProviderEnv() helper, updated resolveModel() to return ResolvedModel with gateway env vars, updated 4 callers to destructure .model, added comprehensive tests","closedAt":"2026-02-20T07:43:07.179725-08:00"}
{"id":"overstory-2ki1","title":"overstory init should add .overstory/README.md","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-13T22:33:26.367216-08:00","updatedAt":"2026-02-18T16:35:42.65089-08:00","assignee":"jayminwest@gmail.com","description":"When running 'overstory init', generate a .overstory/README.md explaining the directory's purpose, similar to what .beads/ and .mulch/ do. This helps contributors understand what .overstory/ is without needing to read the main project docs.","closeReason":"Implemented .overstory/README.md generation in overstory init via builder init-readme-builder. Branch overstory/init-readme-builder/overstory-4dtk ready for merge.","closedAt":"2026-02-18T16:35:42.65089-08:00"}
{"id":"overstory-2kn","title":"L4-5: Implement log command (src/commands/log.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:28.215057-08:00","updatedAt":"2026-02-12T07:39:41.975202-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory log <event> --agent <name>. Called by Pre/PostToolUse and Stop hooks. Events: tool-start, tool-end, session-end. Writes to .overstory/logs/{agent-name}/{session-timestamp}/ in multi-format (session.log human-readable + events.ndjson machine-parseable).","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.975202-08:00"}
{"id":"overstory-2mi","title":"Test task for sling","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T09:36:06.136009-08:00","updatedAt":"2026-02-12T10:57:10.074886-08:00","assignee":"jayminwest@gmail.com","closeReason":"Stale test issue from earlier sling testing. Superseded by E2E exercise (overstory-aqf).","closedAt":"2026-02-12T10:57:10.074886-08:00"}
{"id":"overstory-2ml","title":"L0-7: Write agents/builder.md base definition","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:28.100512-08:00","updatedAt":"2026-02-12T07:20:05.122603-08:00","assignee":"jayminwest@gmail.com","description":"Builder agent: implementation agent. Can read/write/edit files, run bash (git, tests, lint), send mail. Must only modify files in FILE_SCOPE. Commits to worktree branch only.","closeReason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)","closedAt":"2026-02-12T07:20:05.122603-08:00"}
{"id":"overstory-2ni","title":"capabilityIndex was empty in original agent-manifest.json","status":"closed","type":"bug","priority":4,"createdAt":"2026-02-12T10:09:48.845497-08:00","updatedAt":"2026-02-12T10:14:41.526858-08:00","assignee":"jayminwest@gmail.com","description":"The agent-manifest.json generated by the initial 'overstory init' had capabilityIndex: {} (empty). Running 'init --force' correctly regenerated it with all capabilities. This suggests the manifest was created before the capabilityIndex generation code was added and never re-generated. Not a code bug per se (init.ts code is correct), but existing deployments may have stale manifests. Consider adding a migration or validation check that warns when capabilityIndex is empty.","closeReason":"capabilityIndex already correctly populated in .overstory/agent-manifest.json -- matches buildAgentManifest() output","closedAt":"2026-02-12T10:14:41.526858-08:00"}
{"id":"overstory-2sz3","title":"Implement configurable quality gates in types, config, overlay, and sling","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T11:10:17.133388-08:00","updatedAt":"2026-02-23T11:31:04.714014-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented configurable quality gates: QualityGate type, optional qualityGates on config/overlay, YAML parser for object arrays, validation, init serialization fix, 12 new tests. 2037 tests pass.","closedAt":"2026-02-23T11:31:04.714014-08:00"}
{"id":"overstory-2zg1","title":"Migrate session lifecycle writers to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:53:46.841285-08:00","updatedAt":"2026-02-13T19:16:13.148674-08:00","assignee":"jayminwest@gmail.com","description":"Replace sessions.json read/write in agent spawning and state-transition files with the SQLite-backed SessionStore (via openSessionStore from sessions/compat.ts).\n\nFiles to migrate: src/commands/sling.ts, src/commands/coordinator.ts, src/commands/supervisor.ts, src/commands/monitor.ts, src/commands/log.ts.\n\nEach file has duplicated loadSessions/saveSessions helpers that read/write sessions.json. Replace with:\n- store.upsert() for session registration after spawning\n- store.updateState() for state transitions (booting->working, working->completed)\n- store.getByName() for single-session lookups\n- store.updateLastActivity() for heartbeat updates\n- store.getActive() where needed\n\nThe SessionStore API is in src/sessions/store.ts, and openSessionStore() in src/sessions/compat.ts handles JSON-to-SQLite migration automatically.\n\nUpdate all associated test files (.test.ts) to create sessions via SessionStore instead of writing sessions.json fixtures.\n\nAcceptance criteria:\n- All 5 source files use SessionStore exclusively (no sessions.json read/write)\n- All tests pass (bun test)\n- Type checking passes (tsc --noEmit)\n- Lint passes (biome check .)","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.148674-08:00"}
{"id":"overstory-33p8","title":"Create STEELMAN.md and add README disclaimer","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T12:55:15.850378-08:00","updatedAt":"2026-02-13T13:04:37.911616-08:00","assignee":"jayminwest@gmail.com","closeReason":"First builder attempt - wrote files to wrong directory (main repo instead of worktree). Content was good but location was wrong. Superseded by overstory-ngz7.","closedAt":"2026-02-13T13:04:37.911616-08:00"}
{"id":"overstory-34rb","title":"Migrate sling.ts and monitor.ts to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:56:44.005121-08:00","updatedAt":"2026-02-13T19:16:13.15506-08:00","assignee":"jayminwest@gmail.com","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.15506-08:00"}
{"id":"overstory-378","title":"status --watch: no validation for --interval value","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:09:33.105487-08:00","updatedAt":"2026-02-12T10:14:02.596158-08:00","assignee":"jayminwest@gmail.com","description":"overstory status --watch --interval accepts invalid values: negative numbers cause infinite busy-wait, zero causes 100% CPU spin, NaN (from non-numeric input like 'abc') causes undefined Bun.sleep behavior. Unlike sling.ts which validates --depth with Number.isNaN(), status.ts line 230 skips NaN check entirely. Fix: add NaN check and minimum interval validation (e.g. >= 500ms).","closeReason":"Fixed: --interval now validates for NaN and minimum 500ms, following sling.ts --depth validation pattern","closedAt":"2026-02-12T10:14:02.596158-08:00"}
{"id":"overstory-37e","title":"Switch agents from headless (claude -p) to interactive mode with beacon injection","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T12:12:59.036867-08:00","updatedAt":"2026-02-12T12:23:49.315286-08:00","assignee":"jayminwest@gmail.com","description":"Change sling.ts to launch 'claude <beacon>' instead of 'claude -p <prompt>'. Beacon message tells agent its identity and task. Wait for Claude to be ready before considering agent 'working'. This unblocks hooks (SessionStart, UserPromptSubmit) which are currently dead in -p mode. Unblocks mail injection, multi-turn reasoning, and mid-flight communication. Currently at sling.ts:312 the command is 'claude -p' which runs headless one-shot mode where no hooks fire.","closeReason":"Switched sling.ts from claude -p (headless) to claude (interactive). Agents now launch in interactive mode via tmux with beacon prompt sent via sendKeys. Initial state is booting; hooks handle transition to working.","closedAt":"2026-02-12T12:23:49.315286-08:00"}
{"id":"overstory-38d","title":"L5-7: Write mail-client.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:32.422933-08:00","updatedAt":"2026-02-12T07:54:20.436677-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/mail/client.ts. Cover: send() returns ID, check() returns unread for agent, checkInject() formats for hook injection, list() with filters (from/to/unread), markRead(), reply() creates threaded message.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.436677-08:00"}
{"id":"overstory-39u","title":"AI-resolve tier corrupts files: claude --print outputs prose instead of code","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T10:34:32.651697-08:00","updatedAt":"2026-02-12T10:41:39.077233-08:00","assignee":"jayminwest@gmail.com","description":"When tier 3 (AI-resolve) triggers, the resolver calls 'claude --print -p <prompt>' to resolve conflicts. But claude --print can return conversational prose (e.g., 'I need permission to edit the file...') instead of the actual resolved code. This output gets written directly to the file, corrupting it. The commit succeeds silently, leaving corrupted files on the canonical branch. Fix must include: (1) validate that resolved output is valid code (e.g., check it parses/compiles), (2) fall back to tier 4 if output looks like prose, (3) possibly use a more structured prompt that constrains output format.","closeReason":"Closed","closedAt":"2026-02-12T10:41:39.077233-08:00"}
{"id":"overstory-3dq","title":"init doesn't deploy agent definition .md files to target project","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T12:47:12.104934-08:00","updatedAt":"2026-02-12T12:58:36.429522-08:00","assignee":"jayminwest@gmail.com","description":"overstory init creates .overstory/ and agent-manifest.json, but does NOT copy agent definition files (scout.md, builder.md, etc.) from overstory's agents/ dir to the target project. sling then fails because manifest.load() resolves agent files relative to config.project.root + config.agents.baseDir, and those files don't exist in the target project. Either init needs to copy them, or sling needs to resolve paths from the overstory installation directory.","closeReason":"Superseded by overstory-06l7 which has a more complete description and is part of the phased plan","closedAt":"2026-02-12T12:58:36.429522-08:00"}
{"id":"overstory-3ds8","title":"Write molecules integration tests (molecules.test.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:21:14.465989-08:00","updatedAt":"2026-02-13T08:41:52.924331-08:00","assignee":"jayminwest@gmail.com","closeReason":"Molecules unit tests written: 16 tests with mocked Bun.spawn (bd mol API not yet implemented)","closedAt":"2026-02-13T08:41:52.924331-08:00"}
{"id":"overstory-3e3s","title":"sling should use resolveModel() for config-level model overrides","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-17T07:53:54.63905-08:00","updatedAt":"2026-02-18T07:29:30.79223-08:00","assignee":"jayminwest@gmail.com","description":"sling.ts:426 reads agentDef.model directly from the manifest instead of going through resolveModel(). This means config.models overrides in config.yaml have no effect on sling-spawned agents (scout, builder, reviewer, merger, lead). Only persistent agents (coordinator, supervisor, monitor) respect config overrides because they call resolveModel(). Fix: replace agentDef.model with resolveModel(config, manifest, capability, agentDef.model) in sling.ts.","closeReason":"sling now uses resolveModel() for config-level model overrides. Merged from overstory/sling-model-builder/overstory-07jl.","closedAt":"2026-02-18T07:29:30.79223-08:00"}
{"id":"overstory-3n0","title":"L4-4: Implement watch command (src/commands/watch.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:22.651404-08:00","updatedAt":"2026-02-12T07:39:41.953007-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory watch [--interval <ms>] [--background]. Starts watchdog daemon. Foreground mode shows real-time status. Background mode daemonizes. Interval configurable, default 30000ms.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.953007-08:00"}
{"id":"overstory-3up","title":"mail send accepts invalid --type and --priority values","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:11:19.801105-08:00","updatedAt":"2026-02-12T08:43:49.101828-08:00","assignee":"jayminwest@gmail.com","description":"'overstory mail send' accepts arbitrary values for --type and --priority without validation. The CLI docs specify type should be one of: status|question|result|error, and priority should be one of: low|normal|high|urgent. Currently any string is accepted (e.g., --type invalid_type, --priority invalid_prio both succeed). Should validate against allowed values.","closeReason":"Added validation for --type and --priority in handleSend — rejects invalid values with ValidationError listing allowed options","closedAt":"2026-02-12T08:43:49.101828-08:00"}
{"id":"overstory-3vk","title":"mail reply sends to self instead of original sender","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:49:43.965408-08:00","updatedAt":"2026-02-12T11:51:47.316783-08:00","assignee":"jayminwest@gmail.com","description":"'overstory mail reply <id> --body ...' routes the reply back to the replier (orchestrator → orchestrator) instead of to the original sender. Expected: reply should go to the 'from' field of the original message. In this case, orchestrator sent to status-builder, then replied to that message, and the reply went to orchestrator instead of status-builder.","closeReason":"Fixed reply routing: when replier is the original sender (from === original.from), reply now goes to original.to instead of original.from. Added tests for reply-to-own-message and third-party reply scenarios.","closedAt":"2026-02-12T11:51:47.316783-08:00"}
{"id":"overstory-3vt","title":"L3-1: Implement merge queue (src/merge/queue.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:11:54.295042-08:00","updatedAt":"2026-02-12T07:36:21.628694-08:00","assignee":"jayminwest@gmail.com","description":"FIFO merge queue for agent branches. Tracks: branchName, beadId, agentName, filesModified, enqueuedAt, status (pending/merging/merged/conflict/failed), resolvedTier. Functions: enqueue, dequeue, peek, list, updateStatus.","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.628694-08:00"}
{"id":"overstory-3wa","title":"L5-3: Write worktree.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:28.851869-08:00","updatedAt":"2026-02-12T07:54:20.463578-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/worktree/manager.ts. Cover: create worktree (uses temp dirs), list worktrees, remove worktree, branch naming convention (overstory/{agentName}/{beadId}), error handling for missing repo.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.463578-08:00"}
{"id":"overstory-3yvt","title":"Phase 2: Real-time Observability","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:24.529132-08:00","updatedAt":"2026-02-16T17:47:53.12094-08:00","assignee":"jayminwest@gmail.com","description":"Enable real-time visibility into what agents are doing. Currently metrics are only recorded at session end and logs require manual file parsing.","closeReason":"Phase 2 substantially complete. Real-time observability delivered: dashboard TUI, feed --follow, inspect --follow, costs --live, logs --follow, trace, replay, errors commands. Real-time event recording via PostToolUse hooks. Real-time token snapshots via recordSnapshot(). Remaining gap (health state in dashboard) tracked as overstory-gqlo.","closedAt":"2026-02-16T17:47:53.12094-08:00"}
{"id":"overstory-4029","title":"Write logging subsystem tests (sanitizer, reporter, logger)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:21:12.720001-08:00","updatedAt":"2026-02-13T08:41:50.474976-08:00","assignee":"jayminwest@gmail.com","closeReason":"Logging subsystem tests written: sanitizer.test.ts (18 tests), reporter.test.ts (17 tests), logger.test.ts (23 tests - flaky version, replaced by overstory-6034)","closedAt":"2026-02-13T08:41:50.474976-08:00"}
{"id":"overstory-41f","title":"L1-7: Implement metrics storage (src/metrics/*)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:50.245509-08:00","updatedAt":"2026-02-12T07:26:01.472187-08:00","assignee":"jayminwest@gmail.com","description":"SQLite metrics store via bun:sqlite. Schema for SessionMetrics (agent name, bead ID, capability, duration, exit code, merge result). Summary reporting with aggregations. Files: src/metrics/store.ts, src/metrics/summary.ts","closeReason":"Implemented metrics storage (SQLite store + summary reporter) and mail SQLite store (schema, CRUD, WAL mode, prepared statements)","closedAt":"2026-02-12T07:26:01.472187-08:00"}
{"id":"overstory-4200","title":"Add PreToolUse path-boundary guard for builder/merger Write/Edit operations","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-13T13:03:01.94768-08:00","updatedAt":"2026-02-13T14:23:42.623711-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nIn the latest coordinator run, builder agents (builder-steelman, builder-steelman-2) and the lead agent wrote STEELMAN.md and modified README.md directly in the canonical repo root instead of their assigned worktrees. All three agent worktrees have zero commits — the work landed entirely in root.\n\n## Root Cause\n\nhooks-deployer.ts blocks Write/Edit tools for non-implementation agents (scout, reviewer, lead) but has NO path validation for implementation agents (builder, merger). A builder agent can call Write or Edit with any absolute path — including paths outside its worktree — and nothing stops it.\n\n## Evidence\n\n- STEELMAN.md exists at /Users/jayminwest/Projects/overstory/STEELMAN.md (root, untracked)\n- README.md modified at root (git diff shows steelman warning added)\n- .overstory/worktrees/builder-steelman/ has no commits beyond main\n- .overstory/worktrees/builder-steelman-2/ has no commits beyond main\n- .overstory/worktrees/lead-steelman/ has no commits beyond main\n\n## Solution\n\nAdd a PreToolUse hook for Write, Edit, and NotebookEdit that:\n\n1. Reads the tool_input from stdin JSON\n2. Extracts the file_path / file parameter\n3. Resolves it to an absolute path\n4. Checks that it starts with the agent's worktree path (passed via OVERSTORY_WORKTREE_PATH env var)\n5. Blocks with decision=block if the path is outside the worktree boundary\n\nImplementation in hooks-deployer.ts:\n- New function buildPathBoundaryGuardScript(worktreePath) that generates the validation script\n- Apply to ALL agent capabilities (not just builders — even scouts shouldn't read outside scope)\n- Pass OVERSTORY_WORKTREE_PATH as an env var alongside OVERSTORY_AGENT_NAME in sling.ts tmux creation\n- Guard must handle both absolute paths and relative paths (resolve relative to cwd)\n\n## Files to modify\n\n- src/agents/hooks-deployer.ts — add path boundary guard generation\n- src/commands/sling.ts — pass OVERSTORY_WORKTREE_PATH env var to tmux session\n- src/agents/hooks-deployer.test.ts — test the new guard\n- templates/hooks.json.tmpl — may need worktree path placeholder","closeReason":"Added PreToolUse path boundary guard for Write/Edit/NotebookEdit using OVERSTORY_WORKTREE_PATH env var. Guards apply to all agent capabilities as defense-in-depth. Updated sling.ts to pass env var to tmux session.","closedAt":"2026-02-13T14:23:42.623711-08:00"}
{"id":"overstory-442z","title":"Post-swarm summary via mulch diff","status":"open","type":"feature","priority":3,"createdAt":"2026-02-13T21:42:23.997138-08:00","updatedAt":"2026-02-13T21:42:23.997138-08:00","assignee":"jayminwest@gmail.com","description":"After a swarm run completes, the coordinator runs mulch diff --since <swarm-start-ref> to see what expertise the swarm produced. Surface this in the run summary so the coordinator has visibility into organizational learning from the swarm. Could also be part of overstory status --verbose output. Depends on expanded MulchClient (overstory-j53z) for the diff wrapper."}
{"id":"overstory-44m6","title":"Fix doctor tests: stale assertions assume check modules are stubs","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T13:38:25.937901-08:00","updatedAt":"2026-02-16T07:02:03.113493-08:00","assignee":"jayminwest@gmail.com","description":"9 doctor tests in src/commands/doctor.test.ts fail because they were written when all check modules returned empty arrays (stubs). The modules (dependencies, config, structure, databases, consistency, agents, merge-queue, logs, version) are now fully implemented and return real results. Failing tests: empty stubs produce zero counts, shows summary line with zero counts, summary uses singular form, default mode does not show empty categories, shows No checks for empty categories, runs only specified category, exit code is undefined when all pass, exit code 0 on success, handles multiple flags together. Fix: update test setup to create a valid .overstory/ directory so checks pass, or update assertions to expect real check results.","closeReason":"Already fixed in prior session (commits f841427, 420d8b7)","closedAt":"2026-02-16T07:02:03.113493-08:00"}
{"id":"overstory-4ab0","title":"File-scoped priming in sling.ts via mulch prime --files","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:42:17.992316-08:00","updatedAt":"2026-02-13T22:28:26.772807-08:00","assignee":"jayminwest@gmail.com","description":"In sling.ts, when --files is provided and mulch is enabled, call mulch prime --files <file1,file2,...> instead of generic mulch prime <domains>. This gives agents only the expertise relevant to their file scope, dramatically reducing noise. Falls back to domain-scoped priming if files not specified. Extend MulchClient.prime() signature to accept files parameter. Depends on expanded MulchClient (overstory-j53z).","closeReason":"Implemented as part of overstory-95za: sling.ts auto-fetches mulch prime --files when files scoped (4ab0), overlay embeds mulchExpertise with Pre-loaded Expertise section (wzaq).","closedAt":"2026-02-13T22:28:26.772807-08:00"}
{"id":"overstory-4cm","title":"Sling does not pass --model flag from agent manifest to claude CLI","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:10:30.410602-08:00","updatedAt":"2026-02-12T12:15:39.514059-08:00","assignee":"jayminwest@gmail.com","description":"The agent manifest specifies model per capability (haiku for scout, sonnet for builder, opus for lead) but sling.ts line 312 constructs the claude command as 'claude -p ... --dangerously-skip-permissions' without --model. All agents use the default model regardless of capability. This defeats the cost optimization (scouts should use haiku) and capability matching (leads should use opus). Fix: read model from manifest entry and add '--model <model>' to claudeCmd.","closeReason":"Added --model flag from manifest to claude CLI command in sling","closedAt":"2026-02-12T12:15:39.514059-08:00"}
{"id":"overstory-4cto","title":"Allow git add/commit in coordinator hooks (keep git push blocked)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T14:56:43.515738-08:00","updatedAt":"2026-02-13T06:45:08.583691-08:00","assignee":"jayminwest@gmail.com","description":"Coordinator hooks in hooks-deployer.ts block git add and git commit via DANGEROUS_BASH_PATTERNS. This prevents the coordinator from committing beads/mulch sync files and test fixes. The coordinator needs git add/commit to finalize work (commit beads sync, mulch records, test updates). git push should remain blocked — merges and pushes are handled by merger agents or the human. Fix: either (1) add git add/git commit to SAFE_BASH_PREFIXES for coordinator capability, or (2) remove git add/git commit from DANGEROUS_BASH_PATTERNS for non-implementation agents and rely on Write/Edit blocks to prevent source file modification.","closeReason":"Added COORDINATION_CAPABILITIES set and COORDINATION_SAFE_PREFIXES. buildBashFileGuardScript now accepts extraSafePrefixes param. Coordinator/supervisor get git add/commit whitelisted while git push remains blocked.","closedAt":"2026-02-13T06:45:08.583691-08:00"}
{"id":"overstory-4dtk","title":"Implement .overstory/README.md generation in init command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-18T16:32:19.481561-08:00","updatedAt":"2026-02-18T16:35:41.328723-08:00","assignee":"jayminwest@gmail.com","description":"Add README.md to overstory init. Whitelist !README.md in OVERSTORY_GITIGNORE, create OVERSTORY_README constant, write it during init, add tests.","closeReason":"Added OVERSTORY_README constant, writeOverstoryReadme(), whitelisted !README.md in gitignore, 4 new tests. All quality gates pass.","closedAt":"2026-02-18T16:35:41.328723-08:00"}
{"id":"overstory-4h93","title":"Add real-time token tracking during active sessions","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:33.461126-08:00","updatedAt":"2026-02-16T13:41:49.393672-08:00","assignee":"jayminwest@gmail.com","description":"Currently metrics are only recorded at session end. Add periodic token snapshots during active sessions via EventStore tool-end events. Enable 'overstory costs --live' to show current burn rate across all active agents.","closeReason":"Real-time token tracking implemented. Builder token-tracking-builder created: TokenSnapshot type, token_snapshots table with 4 methods (recordSnapshot, getLatestSnapshots, getLatestSnapshotTime, purgeSnapshots), throttled snapshot recording in log.ts tool-end handler (30s interval), costs --live flag for live burn rate display. All 1717 tests pass, lint clean, typecheck clean.","closedAt":"2026-02-16T13:41:49.393672-08:00"}
{"id":"overstory-4jca","title":"Add --file filter to MulchClient.search()","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-20T12:49:43.648478-08:00","updatedAt":"2026-02-20T13:23:12.41754-08:00","assignee":"jayminwest@gmail.com","description":"Add file option to MulchClient.search() in src/mulch/client.ts to pass mulch 0.4.3's --file flag for file-scoped expertise lookup. Update lead/supervisor agent definitions to suggest file-scoped search before decomposing work (e.g. mulch search 'error handling' --file src/commands/init.ts). Supplements existing --files support in prime().","closeReason":"File filter added to search() in client.ts (mulch-client-builder). File-scoped search added to lead.md and supervisor.md (overlay-defs-builder).","closedAt":"2026-02-20T13:23:12.41754-08:00"}
{"id":"overstory-4ku","title":"merge fails: cannot checkout main when orchestrator worktree has it checked out","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T10:24:48.379419-08:00","updatedAt":"2026-02-12T10:41:39.053575-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory merge --branch <agent-branch>' sometimes fails with 'fatal: main is already checked out'. Observed during e2e testing: first merge attempt failed, second attempt succeeded immediately after. Possibly related to: (1) git state corruption from previous dry-run, (2) uncommitted .beads/issues.jsonl confusing checkout, or (3) race condition in config.project.root resolution. Needs investigation to determine if this is reliably reproducible.","closeReason":"Closed","closedAt":"2026-02-12T10:41:39.053575-08:00"}
{"id":"overstory-4l1e","title":"Validate mail round-trip between orchestrator and agent","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T12:57:41.546072-08:00","updatedAt":"2026-02-12T13:19:58.226975-08:00","assignee":"jayminwest@gmail.com","description":"While a slung agent is running, send it mail via overstory mail send. Verify the agent receives it via UserPromptSubmit hook injection. Check if the agent sends mail back to orchestrator. Validates the communication layer works in practice.","closeReason":"Validated full mail round-trip: send, check, reply, inject format all working. Agent-to-orchestrator and orchestrator-to-agent flows confirmed.","closedAt":"2026-02-12T13:19:58.226975-08:00"}
{"id":"overstory-4lqu","title":"Review: lead.md coordinator-not-doer rewrite","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T16:36:35.219022-08:00","updatedAt":"2026-02-18T16:41:28.715799-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review PASS: all 6 edits verified against spec, quality gates clean (1872 tests, lint, typecheck)","closedAt":"2026-02-18T16:41:28.715799-08:00"}
{"id":"overstory-4nw","title":"watch --background: exit code 0 when watchdog already running","status":"closed","type":"bug","priority":4,"createdAt":"2026-02-12T10:09:51.035346-08:00","updatedAt":"2026-02-12T10:14:43.202686-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory watch --background' when a watchdog is already running outputs a warning message but exits with code 0 (success). Should exit with code 1 to indicate the operation didn't succeed, or provide a way to check if the watchdog is running (e.g. 'overstory watch --status').","closeReason":"watch --background now exits with code 1 and writes to stderr when watchdog is already running","closedAt":"2026-02-12T10:14:43.202686-08:00"}
{"id":"overstory-4p77","title":"Tests for multi-provider model support","status":"open","type":"task","priority":2,"createdAt":"2026-02-19T12:14:05.803356-08:00","updatedAt":"2026-02-19T12:14:05.803356-08:00","assignee":"jayminwest@gmail.com","description":"Write tests for all multi-provider components. Tests colocated with source files per project convention.\n\nFILES: src/config.test.ts, src/agents/manifest.test.ts, src/commands/sling.test.ts (or new test files as needed)\n\nTest cases:\n1. Config parsing: providers section parsed correctly, merged across config layers\n2. Config validation: rejects invalid provider types, missing baseUrl on gateways, references to nonexistent providers\n3. Backward compat: simple model strings still work, empty providers section = current behavior\n4. resolveModel(): simple alias returns { model: 'sonnet' } with no env; provider-prefixed returns correct env dict with ANTHROPIC_BASE_URL, ANTHROPIC_AUTH_TOKEN, ANTHROPIC_API_KEY=''\n5. Provider env resolution: correctly reads authTokenEnv from process.env\n6. Edge cases: unknown provider reference, missing env var for auth token, deeply nested model IDs (openrouter/openai/gpt-5.3 where model ID itself contains slashes)\n\nUse real temp dirs and SQLite per project test conventions. Only mock tmux (real tmux interferes with dev sessions)."}
{"id":"overstory-4pk6","title":"Add tests to catch SQL column name vs code mismatches (bead_id/task_id regression)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-23T17:39:01.985265-08:00","updatedAt":"2026-02-24T14:57:25.054Z","assignee":"jayminwest@gmail.com","description":"The bead_id → task_id rename caused runtime crashes in 3 files (queue.ts, sessions/store.ts, metrics/store.ts) because the DB columns were migrated to task_id but the TypeScript SQL strings still referenced bead_id. No test caught this because tests create fresh DBs with the code's CREATE TABLE DDL (which matched itself). Add tests that: (1) verify SQL column names in prepared statements match actual DB schema, (2) round-trip a record through insert+select after migration to catch column mismatches, (3) optionally lint SQL strings against a known schema definition. This class of bug — renaming a DB column in the migration but not in the code's SQL strings — should be caught automatically.","closedAt":"2026-02-24T14:57:25.054Z","closeReason":"SQL schema consistency tests added in src/schema-consistency.test.ts"}
{"id":"overstory-4ra","title":"merge --branch shows raw git error for nonexistent branches","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:11:49.921127-08:00","updatedAt":"2026-02-12T08:43:20.020735-08:00","assignee":"jayminwest@gmail.com","description":"'overstory merge --branch nonexistent-branch' leaks a raw git error message: 'fatal: ambiguous argument main...nonexistent-branch'. Should first validate that the branch exists and provide a user-friendly error like 'Branch nonexistent-branch not found'.","closeReason":"Added branch existence validation in merge --branch. Uses git rev-parse --verify refs/heads/<branch> before attempting git diff, throwing a user-friendly ValidationError instead of leaking raw git errors.","closedAt":"2026-02-12T08:43:20.020735-08:00"}
{"id":"overstory-4szs","title":"Watchdog nudge is phase-unaware: reports 'Ready for merge/cleanup' after scout phase","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-19T06:31:07.559564-08:00","updatedAt":"2026-02-19T12:27:32.515101-08:00","assignee":"jayminwest@gmail.com","description":"When a scout phase completes (all scouts finish), the watchdog sends a nudge to the coordinator saying: '[WATCHDOG] All 6 worker(s) in run run-... have completed. Ready for merge/cleanup.' This is incorrect — a scout phase completing doesn't mean work is ready for merge/cleanup. Scouts are just doing exploration; the real build work hasn't started yet. The watchdog needs to be phase-aware so it can send contextually appropriate messages. For example, after a scout phase it should say something like 'All scouts have completed. Ready for next phase.' instead of implying the entire run is done.","closeReason":"Fixed watchdog nudge to be phase-aware. Added buildCompletionMessage() helper to daemon.ts that generates contextually appropriate nudge messages based on worker capabilities (scouts→'Ready for next phase', builders→'Ready for merge/cleanup', reviewers→'Reviews done', mixed→breakdown). Updated event data to include capabilities array and phase field. 50/50 tests pass, typecheck clean.","closedAt":"2026-02-19T12:27:32.515101-08:00"}
{"id":"overstory-4uu","title":"staggerDelayMs is never enforced between agent spawns","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:22:59.362789-08:00","updatedAt":"2026-02-12T08:53:44.789454-08:00","assignee":"jayminwest@gmail.com","description":"The config has agents.staggerDelayMs=2000 intended as a delay between spawning agents to avoid resource contention, but sling never reads or enforces this delay. Multiple agents can be spawned instantly back-to-back.","closeReason":"Extracted calculateStaggerDelay pure function and wired it into slingCommand step 4b. 12 unit tests added.","closedAt":"2026-02-12T08:53:44.789454-08:00"}
{"id":"overstory-4xb","title":"Agent state stays 'booting' forever in -p headless mode","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:51:34.589129-08:00","updatedAt":"2026-02-12T11:47:26.643495-08:00","assignee":"jayminwest@gmail.com","description":"When running claude -p (headless mode), the SessionStart/UserPromptSubmit hooks that normally transition agent state from 'booting' to 'working' via 'overstory log tool-start' may not fire. Agents appear stuck in 'booting' state in overstory status even though they are actively working (modifying files in their worktree). Need to either: (1) fire hooks in -p mode, (2) set initial state to 'working' in sling, or (3) have status reconcile by checking for worktree activity.","closeReason":"Fixed agent state stuck in booting forever when using headless mode (claude -p). Since hooks do not fire in headless mode, the booting->working transition in log.ts never occurs. Changed sling.ts to set initial state to working instead of booting at spawn time.","closedAt":"2026-02-12T11:47:26.643495-08:00"}
{"id":"overstory-4yad","title":"Lead 3: Agent and logging subsystems test coverage (identity, molecules, logging)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T07:58:40.880134-08:00","updatedAt":"2026-02-13T08:55:07.562407-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.562407-08:00"}
{"id":"overstory-4ygi","title":"Sling safety & flexibility enhancements (3 features)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-21T06:51:48.001869-08:00","updatedAt":"2026-02-21T07:10:03.646672-08:00","assignee":"jayminwest@gmail.com","description":"Parent work stream for three sling-related features that all modify src/commands/sling.ts: (1) overstory-b3ks: maxSessionsPerRun config cap, (2) overstory-ewco: --skip-scout/--phase flag for leads, (3) overstory-2evj: bead-level locking to prevent concurrent leads on same issue. These must be handled by a single lead to avoid sling.ts merge conflicts.","closeReason":"All 3 sling guard features implemented: (1) bead-level locking via checkBeadLock, (2) maxSessionsPerRun config cap via checkRunSessionLimit, (3) --skip-scout flag for leads. Branch overstory/sling-guard-builder/overstory-afr9 ready for merge. 2009 tests pass, typecheck clean.","closedAt":"2026-02-21T07:10:03.646672-08:00"}
{"id":"overstory-4zcj","title":"Dashboard zombie reconciliation uses O(n*m) linear scan","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-19T13:28:15.264081-08:00","updatedAt":"2026-02-20T08:03:32.640732-08:00","assignee":"jayminwest@gmail.com","description":"status.ts:108-124 iterates all sessions and calls tmuxSessions.some() (linear scan) for each. At 40 agents x 40 tmux sessions = 1600 comparisons per tick. Fix: pre-build a Set<string> of tmux session names before the loop, replace .some() with .has().","closeReason":"Replaced O(n*m) tmuxSessions.some() with Set.has() lookup in gatherStatus() and printStatus(). Pre-builds Set<string> before loop.","closedAt":"2026-02-20T08:03:32.640732-08:00"}
{"id":"overstory-50l","title":"L1-2: Implement agent manifest loader (src/agents/manifest.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:29.294856-08:00","updatedAt":"2026-02-12T07:25:14.359612-08:00","assignee":"jayminwest@gmail.com","description":"Load agent-manifest.json, capability routing (find agents by capability), validation of agent definitions. Returns typed AgentManifest. Queries: getByCapability(cap) -> AgentDefinition[]","closeReason":"Implemented manifest loader (load, capability routing, validation) and worktree manager (create/list/remove via git CLI)","closedAt":"2026-02-12T07:25:14.359612-08:00"}
{"id":"overstory-51op","title":"Implement overstory stop command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:54:31.905134-08:00","updatedAt":"2026-02-21T07:05:05.472482-08:00","assignee":"jayminwest@gmail.com","description":"Create src/commands/stop.ts with stopCommand(), update src/index.ts to route the command, update src/commands/completions.ts to add stop to COMMANDS. Also create src/commands/stop.test.ts with full test coverage using the DI pattern from coordinator.test.ts.","closeReason":"Implemented overstory stop command: src/commands/stop.ts (151 lines), stop.test.ts (427 lines, 17 tests), index.ts and completions.ts updated. All quality gates pass.","closedAt":"2026-02-21T07:05:05.472482-08:00"}
{"id":"overstory-51t","title":"Agent state stuck at 'booting' — evaluateHealth() never transitions to 'working'","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T09:40:56.790025-08:00","updatedAt":"2026-02-12T09:47:49.402863-08:00","assignee":"jayminwest@gmail.com","description":"In src/watchdog/health.ts, evaluateHealth() has a code path where session.state === 'booting' unconditionally returns state: 'booting' without checking lastActivity freshness. This means an agent NEVER transitions from booting to working, even when the watchdog is running. The fix: when booting and lastActivity is recent (within staleThresholdMs), transition to 'working'. Additionally, without the watchdog running, log events (tool-start, tool-end) only update lastActivity but never touch the state field in sessions.json, so agents are permanently stuck at booting.","closeReason":"Fixed evaluateHealth() to transition booting→working when activity is recent. Also fixed updateLastActivity() in log.ts to transition state from booting to working on first tool event.","closedAt":"2026-02-12T09:47:49.402863-08:00"}
{"id":"overstory-52z","title":"Headless agents cannot receive mail during execution","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:04:42.917314-08:00","updatedAt":"2026-02-12T12:23:51.456728-08:00","assignee":"jayminwest@gmail.com","description":"Agents spawn via 'claude -p' (headless mode), so UserPromptSubmit hooks never fire. This means overstory mail check --inject never runs, and agents cannot see messages sent to them during execution. The overlay CLAUDE.md instructs agents to 'Check your inbox (do this regularly)' which is impossible in headless mode. Either: (a) the overlay should not include mail-check instructions for headless agents, (b) agents should be given a way to poll mail, or (c) consider alternative spawn modes.","closeReason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work.","closedAt":"2026-02-12T12:23:51.456728-08:00"}
{"id":"overstory-5bic","title":"Progressive nudging before kill (warn → nudge → escalate → terminate)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T06:51:21.419174-08:00","updatedAt":"2026-02-13T07:01:12.846125-08:00","assignee":"jayminwest@gmail.com","description":"Replace the current binary stalled→terminate behavior with a progressive sequence: (1) warn: log warning, no action (2) nudge: send tmux nudge via existing nudge command (3) escalate: invoke Tier 1 triage (4) terminate: kill tmux session. Requires adding nudgeCount/escalationLevel to AgentSession in types.ts, modifying daemon.ts tick logic to progress through stages on each tick where agent remains stalled, configurable thresholds for each stage transition in WatchdogConfig. Must integrate with existing nudgeAgent() from nudge.ts.","closeReason":"Implemented progressive nudging (warn->nudge->escalate->terminate) with escalationLevel/stalledSince on AgentSession, nudgeIntervalMs config, and full daemon.ts rewrite","closedAt":"2026-02-13T07:01:12.846125-08:00"}
{"id":"overstory-5imc","title":"Design Tier 3 watchdog: supervisor monitors per-project","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-15T17:04:36.233805-08:00","updatedAt":"2026-02-16T19:10:41.739842-08:00","assignee":"jayminwest@gmail.com","description":"Tier 3 of the watchdog hierarchy (supervisor that monitors across projects) has no design or implementation. Create a design doc/spec if this tier is still desired, or formally descope it.","closeReason":"Premature. No current need for cross-project supervisor tier. Can revisit if multi-project orchestration becomes a real use case.","closedAt":"2026-02-16T19:10:41.739842-08:00"}
{"id":"overstory-5rq","title":".overstory/.gitignore missing merge-queue.json","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T09:44:25.410111-08:00","updatedAt":"2026-02-12T09:55:56.446377-08:00","assignee":"jayminwest@gmail.com","description":"The .overstory/.gitignore generated by init does not include merge-queue.json. When overstory merge is run, it creates merge-queue.json which shows up as an untracked file in git status. This is a runtime state file that should be gitignored alongside sessions.json and the SQLite databases.","closeReason":"Added merge-queue.json to .overstory/.gitignore generated by init","closedAt":"2026-02-12T09:55:56.446377-08:00"}
{"id":"overstory-5s0","title":"mail list --unread shows no results despite unread messages existing","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:49:23.64334-08:00","updatedAt":"2026-02-12T11:51:53.379696-08:00","assignee":"jayminwest@gmail.com","description":"'overstory mail list --unread' returns 'No messages found' even when there is an unread message (sent from orchestrator to status-builder, confirmed visible via 'mail check --agent status-builder'). The --unread filter may not be checking from the right perspective or may be broken.","closeReason":"Added --agent flag to mail list as alias for --to, enabling agent-scoped perspective (mail list --agent X --unread) without marking messages as read (unlike mail check). The root cause was that mail check marks messages read as a side effect, so running check before list showed no unread.","closedAt":"2026-02-12T11:51:53.379696-08:00"}
{"id":"overstory-5u8","title":"worktree.test.ts: Replace Bun.spawn mocks with real git operations","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:12.984224-08:00","updatedAt":"2026-02-12T09:05:22.457262-08:00","assignee":"jayminwest@gmail.com","description":"worktree.test.ts currently mocks all Bun.spawn calls for git worktree add/list/remove. Replace with real git operations in temp directories. Use the shared test harness to create a real git repo, then test createWorktree/listWorktrees/removeWorktree against actual git. This catches real parsing issues with git porcelain output and validates command construction end-to-end. Ref mulch failure mx-56558b: mock.module() leaks across test files.","closeReason":"Replaced all Bun.spawn mocks with real git operations using test-helpers.ts","closedAt":"2026-02-12T09:05:22.457262-08:00"}
{"id":"overstory-5y26","title":"Write store.test.ts for src/metrics/store.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:20:19.808279-08:00","updatedAt":"2026-02-13T08:26:50.86271-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created store.test.ts with 20 tests using real SQLite","closedAt":"2026-02-13T08:26:50.86271-08:00"}
{"id":"overstory-5y5","title":"L1-5: Implement beads CLI client (src/beads/client.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:41.494802-08:00","updatedAt":"2026-02-12T07:25:38.321618-08:00","assignee":"jayminwest@gmail.com","description":"Wrapper around bd CLI with --json output parsing. Interface: ready(), show(id), create(title, opts), claim(id), close(id, reason), status(), molPour(protoId, vars). All via Bun.spawn.","closeReason":"Implemented beads CLI client — ready, show, create, claim, close, list via Bun.spawn with --json parsing","closedAt":"2026-02-12T07:25:38.321618-08:00"}
{"id":"overstory-5zhq","title":"Add sandbox tests","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T22:22:34.678269-08:00","updatedAt":"2026-02-15T12:32:07.47736-08:00","assignee":"jayminwest@gmail.com","description":"Test the sandbox integration: (1) Config parsing — verify sandbox defaults applied when section omitted from YAML, verify explicit sandbox.enabled=false disables it, verify allowedDomains and denyReadPaths parsed correctly. (2) Hooks deployment — verify settings.local.json includes sandbox block when enabled, verify sandbox block absent when disabled, verify allowedDomains propagated correctly, verify allowUnsandboxedCommands=false when sandbox enabled. (3) Integration — verify sling still uses --dangerously-skip-permissions regardless of sandbox setting.","closeReason":"Sandbox integration complete - all code + tests implemented and passing","closedAt":"2026-02-15T12:32:07.47736-08:00"}
{"id":"overstory-6034","title":"Fix flaky logger test: tool event ordering race condition","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T08:30:10.28397-08:00","updatedAt":"2026-02-13T08:41:54.151253-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed logger.test.ts race condition: replaced flaky version with robust polling-based approach (15 tests, all passing)","closedAt":"2026-02-13T08:41:54.151253-08:00"}
{"id":"overstory-63wq","title":"Research better message polling mechanism for coordinator","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T11:50:00.740171-08:00","updatedAt":"2026-02-13T12:36:11.253381-08:00","assignee":"jayminwest@gmail.com","description":"Currently the coordinator polls for new messages by running repeated 'sleep 60 && overstory mail check' commands, which is clunky and wastes context window turns. Research alternatives: (1) filesystem watches (inotify/FSEvents) on mail.db WAL changes, (2) SQLite NOTIFY/trigger-based approach, (3) a lightweight daemon that watches mail.db and injects messages via hook stdin, (4) using Claude Code hooks more effectively (e.g. a PreToolUse hook that checks mail before each tool call), (5) Unix signals or named pipes. Goal: coordinator should receive messages without burning turns on sleep loops.","closeReason":"Research concluded: existing UserPromptSubmit hook already runs overstory mail check --inject on every prompt, making manual sleep-based polling unnecessary. The hook is the optimal mechanism -- zero latency overhead, no false positives, atomic delivery. No code changes needed.","closedAt":"2026-02-13T12:36:11.253381-08:00"}
{"id":"overstory-640","title":"L1-3: Implement worktree manager (src/worktree/manager.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:33.763095-08:00","updatedAt":"2026-02-12T07:25:14.382011-08:00","assignee":"jayminwest@gmail.com","description":"Git worktree create/list/cleanup via Bun.spawn(['git', 'worktree', ...]). Branch naming: overstory/{agentName}/{beadId}. Functions: createWorktree, listWorktrees, removeWorktree.","closeReason":"Implemented manifest loader (load, capability routing, validation) and worktree manager (create/list/remove via git CLI)","closedAt":"2026-02-12T07:25:14.382011-08:00"}
{"id":"overstory-67rb","title":"Write tests for trace command (src/commands/trace.test.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:21:24.427051-08:00","updatedAt":"2026-02-13T20:38:31.763799-08:00","assignee":"jayminwest@gmail.com","closeReason":"Registered trace in CLI router, wrote comprehensive tests","closedAt":"2026-02-13T20:38:31.763799-08:00"}
{"id":"overstory-68p","title":"[Epic] Layer 0: Project Scaffolding","status":"closed","type":"feature","priority":0,"createdAt":"2026-02-12T07:10:30.37382-08:00","updatedAt":"2026-02-12T07:21:28.211742-08:00","assignee":"jayminwest@gmail.com","closeReason":"All 13 L0 tasks completed: scaffolding (package.json, tsconfig, biome), core types (types.ts, errors.ts, config.ts), CLAUDE.md conventions, 5 agent definitions, 3 templates","closedAt":"2026-02-12T07:21:28.211742-08:00"}
{"id":"overstory-697d","title":"merge-queue.db and metrics.db have task_id vs bead_id schema mismatch","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-23T11:32:21.641578-08:00","updatedAt":"2026-02-23T17:39:07.982226-08:00","assignee":"jayminwest@gmail.com","description":"The merge-queue.db and metrics.db sessions tables were created with task_id columns but the source code references bead_id. This causes overstory merge and overstory inspect to fail. Workaround: ALTER TABLE RENAME COLUMN. Root cause: partial beads-to-seeds rename.","closeReason":"Fixed bead_id → task_id in all 3 affected files: merge/queue.ts, sessions/store.ts, metrics/store.ts. Added migration functions for existing DBs.","closedAt":"2026-02-23T17:39:07.982226-08:00"}
{"id":"overstory-6asp","title":"Update hooks to capture tool args, tokens, and exit codes","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T13:08:48.304708-08:00","updatedAt":"2026-02-13T14:37:18.841969-08:00","assignee":"jayminwest@gmail.com","description":"Update hook templates and the log command to capture the full data available from Claude Code hooks.\n\n## Current State\n- PreToolUse/PostToolUse hooks only extract tool_name via sed, discard tool_input and tool_response\n- Stop hook doesn't pass --transcript, so token/cost data is never captured\n- Tool duration is always logged as 0ms (no correlation between start/end)\n- Exit codes are never captured\n\n## What Claude Code Hooks Provide (via stdin JSON)\n- PreToolUse: { session_id, tool_name, tool_input }\n- PostToolUse: { session_id, tool_name, tool_input, tool_response }\n- Stop: { session_id, transcript_path, stop_hook_active }\n\n## Changes to templates/hooks.json.tmpl\nReplace the current sed-based tool_name extraction with piping full stdin to overstory log:\n\nPreToolUse:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log tool-start --agent {{AGENT_NAME}} --stdin\n```\n\nPostToolUse:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent {{AGENT_NAME}} --stdin\n```\n\nStop:\n```\nread -r INPUT; echo \"$INPUT\" | overstory log session-end --agent {{AGENT_NAME}} --stdin\n```\n\n## Changes to src/commands/log.ts\nAdd --stdin flag. When present:\n1. Read one line from stdin, parse as JSON\n2. For tool-start: extract tool_name + tool_input, run through filterToolArgs(), insert into EventStore\n3. For tool-end: extract tool_name, insert into EventStore, call correlateToolEnd() to compute duration\n4. For session-end: extract transcript_path, auto-call parseTranscriptUsage() to get tokens, record metrics with real token data\n5. Continue writing to existing per-agent log files for backward compatibility\n\n## Changes to src/agents/hooks-deployer.ts\nUpdate template rendering to match new hook command format. Ensure the --stdin flag is included. Update any tests that validate hook output.\n\n## Backward Compatibility\n- If --stdin is not passed, existing behavior is preserved (old agents still work)\n- Existing per-agent log files continue to be written\n- The EventStore write is additional, not replacing\n\n## Tests\n- log.test.ts: tool-start with stdin parsing, tool-end with duration correlation, session-end with transcript auto-parse\n- hooks-deployer.test.ts: validate new hook command format in generated settings.local.json","closeReason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","closedAt":"2026-02-13T14:37:18.841969-08:00"}
{"id":"overstory-6dyr","title":"Structural tool enforcement for non-implementation agents","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T13:51:16.681998-08:00","updatedAt":"2026-02-12T14:01:09.469324-08:00","assignee":"jayminwest@gmail.com","description":"Implement structural enforcement of tool restrictions for coordinator and supervisor agents. Currently, agent constraints are prompt-based (.md files say 'you cannot edit files') which agents can violate under pressure. Need: (1) Deploy hooks config per capability that blocks file-modifying tools (Write, Edit, NotebookEdit) via PreToolUse hook returning exit code 2, (2) Allow Bash but guard against file-modifying commands (sed -i, echo >, cat >, vim, nano) via command pattern matching in PreToolUse, (3) Whitelist read-only commands and coordination CLIs (overstory, bd, git status/log/diff, mulch). This makes the 'cannot implement' constraint mechanical rather than instructional - the agent literally cannot edit files regardless of prompt pressure.","closeReason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix","closedAt":"2026-02-12T14:01:09.469324-08:00"}
{"id":"overstory-6eyw","title":"Make parentHasScouts warning suppressible in sling.ts","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T06:26:44.997314-08:00","updatedAt":"2026-02-21T06:26:44.997314-08:00","assignee":"jayminwest@gmail.com","description":"The parentHasScouts() check in sling.ts:367-377 emits a stderr warning when a lead spawns a builder without prior scouts. This reinforces mandatory scout behavior. Add a --no-scout-check flag or config option to suppress the warning. Also consider making it respect dispatch-level overrides. File: src/commands/sling.ts lines 367-377."}
{"id":"overstory-6fjn","title":"Bug: merge-queue SQLite migration incomplete — 5 consumers still read/write JSON","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-16T07:26:02.334603-08:00","updatedAt":"2026-02-16T07:27:59.460423-08:00","assignee":"jayminwest@gmail.com","description":"The queue.ts was migrated to SQLite (commit 7c6b208) but 5 other consumers still treat merge-queue.json as JSON, causing silent failures:\n\n1. dashboard.ts:157-166 — reads file with Bun.file().text() + JSON.parse, breaks on SQLite binary\n2. status.ts:127-132 — same JSON.parse pattern, breaks on SQLite binary  \n3. clean.ts:518 — calls resetJsonFile() which overwrites SQLite DB with '[]', corrupts it\n4. doctor/merge-queue.ts — entire file (199 lines) validates JSON format, all checks produce wrong results against SQLite\n5. init.ts:417 — may create empty file that SQLite then fails to open\n\nAdditionally, the .json extension is misleading since the file is now SQLite.\n\nFix approach (option 3 from report): Rename to merge-queue.db AND update all consumers to use SQLite via createMergeQueue() from queue.ts.\n\nFiles to modify:\n- src/commands/merge.ts:173 — change path to merge-queue.db\n- src/commands/dashboard.ts:157-166 — use createMergeQueue() instead of JSON.parse\n- src/commands/status.ts:127-132 — use createMergeQueue() instead of JSON.parse\n- src/commands/clean.ts:518 — use wipeSqliteDb() instead of resetJsonFile()\n- src/doctor/merge-queue.ts — rewrite to validate SQLite format\n- src/commands/init.ts:417 — update filename in .gitignore template\n- src/doctor/structure.ts:110 — update expected filename\n- .gitignore and .overstory/.gitignore — update entry\n- CLAUDE.md — update docs reference\n- All corresponding test files\n\nReported by agent in another project. Reproduction: run overstory merge after an agent branch (created before SQLite migration) merges its old JSON merge-queue.json back to main.","closeReason":"Duplicate — already being handled by the current coordinator run. sqlite-migration lead (overstory-bkvc) spawned queue-consumers-builder (overstory-ez8j) which completed updating all 11 consumer files. Branch overstory/queue-consumers-builder/overstory-ez8j is pending merge to main.","closedAt":"2026-02-16T07:27:59.460423-08:00"}
{"id":"overstory-6ib5","title":"Resolve agents-cmd merge conflict","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:04:00.439495-08:00","updatedAt":"2026-02-16T18:15:21.922375-08:00","assignee":"jayminwest@gmail.com","description":"Branch overstory/builder-agents-cmd/overstory-n9s2 failed to merge due to .mulch/expertise/cli.jsonl conflict. The code files (src/commands/agents.ts, src/commands/agents.test.ts, src/commands/completions.ts, src/commands/completions.test.ts, src/index.ts) are correct. Resolution: create a fresh branch from main, read the 5 code files from the failed branch, apply them to the new branch, run quality gates, and signal merge_ready.","closeReason":"Merge conflict resolved. Fresh branch applied cleanly.","closedAt":"2026-02-16T18:15:21.922375-08:00"}
{"id":"overstory-6il","title":"Update CLAUDE.md testing section to codify 'never mock what you can use for real'","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:26.984204-08:00","updatedAt":"2026-02-12T08:59:53.905017-08:00","assignee":"jayminwest@gmail.com","description":"Update the Testing section in CLAUDE.md to codify the new philosophy: (1) Use real filesystem via temp dirs (already done), (2) Use real SQLite via temp files (already done), (3) Use real git repos for worktree/merge tests, (4) Use real bd CLI for beads-client tests, (5) Only mock external services that have side effects (tmux, AI APIs) or aren't available in CI. Reference mulch failure mx-56558b about mock.module() leaking. Remove the line 'Tests should mock subprocess calls (Bun.spawn)' and replace with the new guidance.","closeReason":"Updated CLAUDE.md testing section: replaced mock-first guidance with 'never mock what you can use for real' philosophy, updated test locations to reflect colocated tests, added test helpers reference, updated directory structure and file organization sections","closedAt":"2026-02-12T08:59:53.905017-08:00"}
{"id":"overstory-6j2o","title":"Coordinator: warn before worktree clean that branches will be deleted","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-18T10:50:50.168158-08:00","updatedAt":"2026-02-18T16:41:38.148194-08:00","assignee":"jayminwest@gmail.com","description":"overstory worktree clean deletes branches, not just directories. A coordinator cleaned worktrees before merging and lost builder branches (archive-builder, gmail-builder, stripe-impl). The coordinator needs to: (1) understand that worktree clean is destructive to branches, (2) always follow the sequence: wait for merge_ready → merge → THEN clean, (3) ideally overstory worktree clean should warn or refuse if unmerged branches exist. Possible fixes: add a --force flag requirement if unmerged work exists, print a warning listing branches that will be deleted, or add a pre-clean check in the coordinator agent definition.","closeReason":"Added unmerged branch safety to worktree clean: isBranchMerged() helper in manager.ts, --force flag in worktree clean command, skip/warn for unmerged branches, JSON skipped array. 4 new tests for safety behavior + 3 tests for isBranchMerged. All quality gates pass.","closedAt":"2026-02-18T16:41:38.148194-08:00"}
{"id":"overstory-6jos","title":"Review: lead.md scout-first enforcement changes","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:46:08.953597-08:00","updatedAt":"2026-02-17T07:51:34.619264-08:00","assignee":"jayminwest@gmail.com","closeReason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning.","closedAt":"2026-02-17T07:51:34.619264-08:00"}
{"id":"overstory-6jpc","title":"Add run auto-completion to coordinator stop","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:38:50.321381-08:00","updatedAt":"2026-02-17T07:43:49.703384-08:00","assignee":"jayminwest@gmail.com","description":"When coordinator stop is called, auto-complete the current run: read current-run.txt, call runStore.completeRun(), delete current-run.txt. Add tests.","closeReason":"Added run auto-completion to coordinator stop command. When stopCoordinator() is called, it now auto-completes the active run (if current-run.txt exists) and deletes the file. Added runCompleted field to JSON/text output. All tests pass.","closedAt":"2026-02-17T07:43:49.703384-08:00"}
{"id":"overstory-6ka","title":"L5-2: Write manifest.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:28.152081-08:00","updatedAt":"2026-02-12T07:54:20.487305-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/agents/manifest.ts. Cover: loading valid manifest, capability routing (find agents by capability), validation of agent definitions, missing manifest handling, invalid entries.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.487305-08:00"}
{"id":"overstory-6md","title":"L0-13: Write templates/hooks.json.tmpl","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:51.895329-08:00","updatedAt":"2026-02-12T07:18:45.129572-08:00","assignee":"jayminwest@gmail.com","description":"Template for .claude/settings.local.json deployed to each worktree. Includes SessionStart (prime), UserPromptSubmit (mail check), Pre/PostToolUse (logging), Stop (session end), PreCompact hooks.","closeReason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)","closedAt":"2026-02-12T07:18:45.129572-08:00"}
{"id":"overstory-6nq","title":"mail reply: positional ID extraction picks up flag values","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:09:02.738629-08:00","updatedAt":"2026-02-12T12:16:33.918249-08:00","assignee":"jayminwest@gmail.com","description":"In handleReply() at src/commands/mail.ts:203, the message ID is extracted via args.find((a) => \\!a.startsWith('--')). This matches the first non-flag argument, which could be a flag VALUE. Example: 'overstory mail reply --agent scout msg-123 --body hi' treats 'scout' as the message ID instead of 'msg-123'. Confirmed: 'mail reply --agent my-agent msg-dd33zwsq06e7 --body test' produces 'Message not found: my-agent'. handleRead at line 183 has the same pattern but currently no flags with values - still fragile. Fix: skip known flag values when extracting positional args, or use a proper arg parser.","closeReason":"Fixed positional ID extraction to skip flag values in handleReply and handleRead","closedAt":"2026-02-12T12:16:33.918249-08:00"}
{"id":"overstory-6oae","title":"overstory clean --all kills agents without logging session-end events","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T15:33:23.128765-08:00","updatedAt":"2026-02-13T19:07:43.505083-08:00","assignee":"jayminwest@gmail.com","description":"When overstory clean --all runs killAllTmuxSessions(), it SIGTERM/SIGKILL's all agent processes. The Stop hook never fires because the process is killed externally, so no session_end event is logged. This leaves agents in zombie state in sessions.json (before it gets reset). Fix: before killing tmux sessions, iterate through known agents and log synthetic session-end events with reason='clean' so the event history is complete.","closeReason":"clean.ts already had synthetic session-end logging (loadActiveSessions + EventStore). Migrated to use SessionStore instead of sessions.json for active session lookup.","closedAt":"2026-02-13T19:07:43.505083-08:00"}
{"id":"overstory-6p2c","title":"Real-time agent inspection from dashboard (status, output, state)","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-13T11:50:05.661407-08:00","updatedAt":"2026-02-16T07:02:09.356313-08:00","assignee":"jayminwest@gmail.com","description":"Stretch goal: Add the ability to inspect individual agent status, outputs, and state in real-time from the overstory dashboard. Currently there's no way to see what an agent is actively doing without manually attaching to its tmux session. Desired capabilities: (1) live view of agent's current activity/tool calls, (2) recent output/logs streaming, (3) current file being edited, (4) token usage so far, (5) time since last activity. Could leverage the existing logging/metrics infrastructure (log.ts events, metrics.db) and tmux capture-pane for live output.","closeReason":"Inspect command implemented (commit db84991 v0.4.0)","closedAt":"2026-02-16T07:02:09.356313-08:00"}
{"id":"overstory-6qqt","title":"Write prime.test.ts for overstory prime command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:22:12.652788-08:00","updatedAt":"2026-02-13T08:34:59.555689-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files created and merged to main","closedAt":"2026-02-13T08:34:59.555689-08:00"}
{"id":"overstory-6qya","title":"Write reporter.test.ts for src/logging/reporter.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:57.977155-08:00","updatedAt":"2026-02-13T09:17:40.908882-08:00","assignee":"jayminwest@gmail.com","closeReason":"wrote reporter.test.ts with coverage for formatLogLine and printToConsole","closedAt":"2026-02-13T09:17:40.908882-08:00"}
{"id":"overstory-6r7j","title":"Fix dashboard mail query full table scan","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T07:46:31.590784-08:00","updatedAt":"2026-02-20T07:50:41.977784-08:00","assignee":"jayminwest@gmail.com","description":"Add limit option to MailStore.getAll() and use it in dashboard.ts to avoid full table scans","closeReason":"Added limit option to MailStore.getAll() filters (SQL LIMIT clause). Dashboard now uses limit:5/50 instead of full table scan + .slice(). All quality gates pass.","closedAt":"2026-02-20T07:50:41.977784-08:00"}
{"id":"overstory-6s79","title":"Build: update all merge-queue consumers from JSON to SQLite","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:19:06.398784-08:00","updatedAt":"2026-02-16T07:20:07.207978-08:00","assignee":"jayminwest@gmail.com","closeReason":"Duplicate work - queue-consumers-builder already handling this","closedAt":"2026-02-16T07:20:07.207978-08:00"}
{"id":"overstory-6sc8","title":"Watchdog: nudge coordinator when all agents complete","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-17T07:41:44.488689-08:00","updatedAt":"2026-02-18T07:26:09.205664-08:00","assignee":"jayminwest@gmail.com","description":"The watchdog daemon (overstory watch) monitors for agent failures (stalls, zombies, dead tmux sessions) but has no logic to detect when all agents in a run have completed and notify the coordinator. This means the coordinator sits idle after all workers finish unless manually prompted or continuously polling.\n\nAll infrastructure exists:\n- nudgeAgent('coordinator') resolves via SessionStore or orchestrator-tmux.json\n- writePendingNudge() can queue a banner for coordinator's next prompt\n- store.getByRun(runId) can fetch all sessions for a run\n\nMissing piece: run-level completion detection in the daemon tick. After iterating sessions, the watchdog should check if all non-coordinator/non-monitor sessions for the active run are in state 'completed', and if so, send a tmux nudge or write a pending nudge marker for the coordinator. Must track that notification was already sent to avoid repeated nudges per tick.\n\nFiles likely affected: src/watchdog/daemon.ts (primary), possibly src/watchdog/health.ts","closeReason":"Watchdog run-completion detection implemented and merged. After iterating sessions, watchdog detects when all non-coordinator/non-monitor workers have completed and nudges the coordinator. Uses dedup marker file to avoid repeated nudges.","closedAt":"2026-02-18T07:26:09.205664-08:00"}
{"id":"overstory-6smk","title":"Implement broadcast fan-out in mail client and CLI","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:05:06.741851-08:00","updatedAt":"2026-02-16T07:14:30.558452-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented broadcast messaging with group addresses (@all, @builders, @scouts, etc.). New file src/mail/broadcast.ts with pure resolution logic, src/mail/broadcast.test.ts with 26 tests, and updated src/commands/mail.ts handleSend with fan-out logic. All 1640 tests pass, biome + tsc clean.","closedAt":"2026-02-16T07:14:30.558452-08:00"}
{"id":"overstory-6ueu","title":"Verify template resolution works from agent worktrees","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T12:57:39.042126-08:00","updatedAt":"2026-02-12T13:01:20.595239-08:00","assignee":"jayminwest@gmail.com","description":"overlay.ts and hooks-deployer.ts read from templates/. Need to confirm they resolve paths relative to the overstory installation (via import.meta.dir or similar), not relative to cwd. If they use cwd, they'll break when running inside an agent's worktree. Quick code read - fix if broken.","closeReason":"Verified: overlay.ts and hooks-deployer.ts both use import.meta.dir to resolve template paths, which resolves from overstory installation directory, not cwd. Works correctly from agent worktrees.","closedAt":"2026-02-12T13:01:20.595239-08:00"}
{"id":"overstory-6we","title":"L0-11: Write templates/CLAUDE.md.tmpl","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:44.200052-08:00","updatedAt":"2026-02-12T07:18:45.087061-08:00","assignee":"jayminwest@gmail.com","description":"Template for orchestrator's CLAUDE.md. Documents overstory CLI commands, conventions, hook behavior. Template variables for project name, config paths.","closeReason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)","closedAt":"2026-02-12T07:18:45.087061-08:00"}
{"id":"overstory-6zv","title":"CLI commands outside git repo show raw git error instead of user-friendly message","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:09:39.300831-08:00","updatedAt":"2026-02-12T10:15:24.929202-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory status' from a non-overstory directory (e.g. /tmp) produces: Error [WORKTREE_ERROR]: git worktree list --porcelain failed (exit 128): fatal: not a git repository. Should instead show a user-friendly message like 'Not in an overstory project. Run overstory init first.' The error leaks the internal git command failure rather than wrapping it.","closeReason":"Catch WorktreeError with 'not a git repository' in CLI entry point, show friendly message","closedAt":"2026-02-12T10:15:24.929202-08:00"}
{"id":"overstory-6zw","title":"resolver.test.ts: Replace file and git mocks with real implementations","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:16.015347-08:00","updatedAt":"2026-02-12T09:12:32.205535-08:00","assignee":"jayminwest@gmail.com","description":"resolver.test.ts mocks Bun.spawn (git + claude CLI), Bun.file, and Bun.write. Replace file mocks with real temp files and git mocks with real git repos that have actual merge conflicts. Only keep mocks for the claude CLI (external AI service). This is the most mock-heavy test file and benefits most from real implementations. Use shared test harness for git repo setup with divergent branches that create real conflicts.","closeReason":"Replaced file and git mocks with real implementations in resolver.test.ts. Only claude CLI remains mocked (for Tier 3/4).","closedAt":"2026-02-12T09:12:32.205535-08:00"}
{"id":"overstory-71o","title":"sling --json outputs both human-readable AND JSON (should be JSON only)","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T09:44:00.763541-08:00","updatedAt":"2026-02-12T09:56:08.541979-08:00","assignee":"jayminwest@gmail.com","description":"When running 'overstory sling <id> --name <name> --json', the output includes both the human-readable launch message (rocket emoji, bullet points) AND the JSON object. With --json flag, only JSON should be output. The human-readable output should be suppressed when --json is specified. This affects downstream tooling that expects to parse pure JSON from stdout.","closeReason":"Suppressed human-readable output when --json flag is specified in sling command","closedAt":"2026-02-12T09:56:08.541979-08:00"}
{"id":"overstory-72ak","title":"Implement overstory errors CLI command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T20:44:43.602329-08:00","updatedAt":"2026-02-13T20:58:11.20001-08:00","assignee":"jayminwest@gmail.com","description":"Aggregated error view across all agents. Query events.db for level='error' events. Support --agent, --run, --since, --until, --limit, --json flags. Group errors by agent with counts. Follow trace.ts patterns (same arg parsing, ANSI colors, test structure).","closeReason":"Implemented and tested in commit 35531bc","closedAt":"2026-02-13T20:58:11.20001-08:00"}
{"id":"overstory-749","title":"status.ts: race condition in session state mutation during gatherStatus","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:09:41.767926-08:00","updatedAt":"2026-02-12T10:14:40.523333-08:00","assignee":"jayminwest@gmail.com","description":"gatherStatus() in status.ts reads sessions.json, filters dead tmux sessions, updates state, and writes back. Between reading and writing, another agent process could modify sessions.json, causing a lost-write conflict. This is especially relevant when multiple agents are active and the watchdog is running. Consider using file locking or atomic compare-and-swap for session state updates.","closeReason":"Fixed race condition in gatherStatus: sessions.json now uses write-to-tmp + atomic rename instead of direct Bun.write","closedAt":"2026-02-12T10:14:40.523333-08:00"}
{"id":"overstory-79fh","title":"Tests fail in Claude Code sandbox mode due to write restrictions","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T13:43:04.546369-08:00","updatedAt":"2026-02-15T13:57:35.343385-08:00","assignee":"jayminwest@gmail.com","description":"Running bun test inside Claude Code sandbox shows 271 failures because sandbox restricts file writes to specific directories. Most tests need temp dirs for SQLite, git repos, etc. Need to either: (a) document that tests must run outside sandbox, or (b) make tests respect TMPDIR=/tmp/claude/ so they work in sandbox.","closeReason":"Sandbox config removed from overstory; test sandbox failures no longer relevant since agents don't deploy Seatbelt settings. Pre-existing GPG test failures remain (unrelated).","closedAt":"2026-02-15T13:57:35.343385-08:00"}
{"id":"overstory-7a2","title":"session-end log event does not transition agent state to completed","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:29:34.989686-08:00","updatedAt":"2026-02-12T10:41:33.130445-08:00","assignee":"jayminwest@gmail.com","description":"In log.ts, the session-end event updates identity and clears the session marker, but never transitions the agent state in sessions.json from 'working' to 'completed'. The updateLastActivity() function only handles booting->working. This means agents stay in 'working' state forever after their session ends, which breaks worktree clean --completed (it never finds completed agents to clean).","closeReason":"Added 'completed' to AgentState type, added transitionToCompleted() in log.ts session-end handler, updated worktree clean to recognize completed state, excluded completed agents from concurrency limits and watchdog checks","closedAt":"2026-02-12T10:41:33.130445-08:00"}
{"id":"overstory-7ah4","title":"Lead 1: CLI complex commands test coverage (dashboard, supervisor, monitor, merge)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T07:58:38.596003-08:00","updatedAt":"2026-02-13T08:55:07.558048-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.558048-08:00"}
{"id":"overstory-7ana","title":"Add run auto-completion to session-end hook for coordinator","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:38:52.213767-08:00","updatedAt":"2026-02-17T07:49:23.094594-08:00","assignee":"jayminwest@gmail.com","description":"In log.ts session-end handler, when the agent is a coordinator, auto-complete the current run. This handles the tmux exit case. Add tests.","closeReason":"Added coordinator run auto-completion to session-end hook. When coordinator exits, current run is auto-completed and current-run.txt is deleted. Includes 4 comprehensive tests. All quality gates passed.","closedAt":"2026-02-17T07:49:23.094594-08:00"}
{"id":"overstory-7cx","title":"Optimize test harness: 30s+ runtime after no-mock migration","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T09:11:15.885004-08:00","updatedAt":"2026-02-12T09:30:22.806622-08:00","assignee":"jayminwest@gmail.com","description":"After switching to real git repos/bd CLI instead of mocks, the test suite takes 30-40s. Three files account for ~97% of runtime:\n\n## Profiling Results (per-file, bun test)\n\n| File | Tests | Time | % of total |\n|---|---|---|---|\n| beads/client.test.ts | 16 | 22.76s | 58% |\n| merge/resolver.test.ts | 14 | 10.34s | 26% |\n| worktree/manager.test.ts | 16 | 4.18s | 11% |\n| test-helpers.test.ts | 8 | 2.12s | 5% |\n| All other 9 files (205 tests) | 205 | <0.3s | <1% |\n\n## Root Causes\n\n### beads/client.test.ts (22.76s) — Worst offender\n- Each of 16 tests runs `beforeEach` that creates a fresh temp git repo (5 subprocess spawns: init, config x2, add, commit) + `bd init` (another subprocess)\n- Then each test spawns 2-5 more `bd` CLI calls (create, show, claim, close, list, ready)\n- Total: ~100+ subprocess spawns for 16 tests\n- The bd CLI itself has startup overhead (Python? Node?) on each invocation\n\n### merge/resolver.test.ts (10.34s)\n- Each of 14 tests creates a fresh git repo via `beforeEach`\n- Tests then do 4-8 git operations each (commit, branch, checkout, merge, rm, status)\n- Some tests set up identical conflict scenarios (setupContentConflict, setupDeleteModifyConflict, setupReimagineScenario called multiple times)\n\n### worktree/manager.test.ts (4.18s)\n- Three separate `describe` blocks each with their own `beforeEach` creating fresh repos\n- 16 tests × (git init + config + add + commit + mkdir) = ~80 subprocess spawns\n\n## Optimization Ideas (investigate, pick best ROI)\n\n1. **Share repos within describe blocks** — Use `beforeAll` instead of `beforeEach` where tests don't mutate shared state, or create a base repo once and clone/branch per test\n2. **Batch git config** — Combine the 2 git config calls into 1 subprocess (or use GIT_AUTHOR_NAME/GIT_COMMITTER_NAME env vars instead)\n3. **beads/client: reduce bd CLI spawns** — The bd CLI startup cost dominates. Options:\n   - Share one initialized repo across tests that don't conflict (list/ready tests need isolation, but create/show don't)\n   - Create multiple issues in beforeAll, then test against them\n4. **resolver: share conflict setups** — setupContentConflict and setupDeleteModifyConflict are called by multiple tests. Create the conflict once, then run assertions against it\n5. **Parallelize independent subprocess calls** — git config user.email and git config user.name are independent and can run concurrently via Promise.all\n6. **Consider git template dir** — Pre-configure a template with user.email/user.name so git init picks them up automatically, eliminating 2 spawns per repo\n\n## Target\nGet the suite under 10s while keeping the no-mock philosophy (real git repos, real bd CLI).","closeReason":"Reduced test suite from 38.1s to 11.7s (-69%). Template clone pattern in test-helpers, beforeAll shared repos in beads and resolver tests. All quality gates pass.","closedAt":"2026-02-12T09:30:22.806622-08:00"}
{"id":"overstory-7d33","title":"Implement post-session mulch learn extraction in log.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T12:18:28.781396-08:00","updatedAt":"2026-02-15T12:41:56.420581-08:00","assignee":"jayminwest@gmail.com","closeReason":"Superseded by overstory-hcia (log-fix-builder). Original implementation had 4 issues corrected in the fix.","closedAt":"2026-02-15T12:41:56.420581-08:00"}
{"id":"overstory-7di0","title":"Coordinator status set to 'completed' when awaiting user input","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T19:43:32.183147-08:00","updatedAt":"2026-02-13T20:22:49.757988-08:00","assignee":"jayminwest@gmail.com","description":"When the coordinator is waiting for user input (either via nudge or direct user prompt), its status is being incorrectly set to 'completed'. The suspected cause is the 'session.end' hook firing when the coordinator pauses for input — this is correct behavior (the Claude Code turn ends), but something downstream is interpreting that event as the session having fully ended and updating the coordinator's state to 'completed'. Investigation needed: 1) Confirm which hook emits 'session-end' when awaiting input, 2) Trace how that event propagates to status updates, 3) Determine the correct fix — likely distinguishing between 'turn ended, awaiting input' vs 'session truly finished'.","closeReason":"Fixed in this session","closedAt":"2026-02-13T20:22:49.757988-08:00"}
{"id":"overstory-7go2","title":"Update overlay quality gates and agent defs for outcome flags + file-scoped search","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T13:19:17.420762-08:00","updatedAt":"2026-02-20T13:22:27.990109-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added --outcome-status and --outcome-agent flags to overlay.ts formatQualityGates() step 5; added file-scoped search bullets to lead.md and supervisor.md Expertise sections; updated builder.md Completion Protocol step 5 with outcome flags and 'with outcome data' text.","closedAt":"2026-02-20T13:22:27.990109-08:00"}
{"id":"overstory-7jdl","title":"Lead: multi-provider verification and test coverage","status":"in_progress","type":"task","priority":1,"createdAt":"2026-02-21T05:55:36.131123-08:00","updatedAt":"2026-02-21T06:20:30.963349-08:00","assignee":"jayminwest@gmail.com","description":"Lead work stream for multi-provider model support. Objective: (1) Verify all multi-provider implementation is integrated correctly on main. (2) Write comprehensive tests per overstory-4p77 spec. (3) Close overstory-4p77 and overstory-89kt. File area: src/config.test.ts, src/agents/manifest.test.ts, src/commands/sling.test.ts, plus read access to src/config.ts, src/agents/manifest.ts, src/commands/sling.ts, src/types.ts for context."}
{"id":"overstory-7jlf","title":"coordinator.test.ts: startCoordinator test spawns real tmux session","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T09:02:08.612151-08:00","updatedAt":"2026-02-13T09:21:21.576793-08:00","assignee":"jayminwest@gmail.com","description":"The startCoordinator test opens a real tmux session despite mock.module for tmux.ts being registered. Test times out at 5000ms, sessions.json never written (length 0). Likely a mock.module leak (mx-56558b) — another test file importing tmux.ts first could prevent the mock from taking effect. The Bun.sleep override (line 209) works because it's a direct property assignment, but mock.module is fragile across test files in bun:test's single-process model. May need to restructure to avoid mock.module entirely, or ensure import ordering.","closeReason":"Fixed coordinator.test.ts mock.module leak: replaced mock.module() with DI pattern (CoordinatorDeps interface) matching daemon.ts _tmux/_triage/_nudge pattern. Tests now pass fake tmux/deployHooks via coordinatorCommand's deps parameter instead of process-global mock.module().","closedAt":"2026-02-13T09:21:21.576793-08:00"}
{"id":"overstory-7jr8","title":"Update parent agents to record insights from read-only workers","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T08:07:59.989385-08:00","updatedAt":"2026-02-16T17:39:38.369374-08:00","assignee":"jayminwest@gmail.com","description":"Scout and reviewer agents are read-only — they cannot write files or commit. When they discover insights worth preserving in mulch, those insights must flow through mail to their parent (lead or supervisor) who records them.\n\nChanges needed:\n- agents/supervisor.md: Add to Expertise section (~line 82): 'Record worker insights: When worker result mails contain INSIGHT: items, record them via mulch record <domain> --type <type> --description <insight>'\n- agents/lead.md: Add to Expertise section: 'Record worker insights: When scout or reviewer result mails contain INSIGHT: items, record them via mulch record <domain> --type <type> --description <insight>'\n\nThis depends on overstory-b1ac (leaf agents tagging insights with INSIGHT: prefix in their result mails).","closeReason":"Added INSIGHT recording guidance to supervisor.md and lead.md Expertise sections.","closedAt":"2026-02-16T17:39:38.369374-08:00"}
{"id":"overstory-7kc","title":"E2E scout test: explore status.ts implementation","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T10:55:48.793334-08:00","updatedAt":"2026-02-12T10:57:00.621289-08:00","assignee":"jayminwest@gmail.com","closeReason":"E2E scout test completed. Used to validate sling with --capability scout. Identified overlay template bug (overstory-m4w).","closedAt":"2026-02-12T10:57:00.621289-08:00"}
{"id":"overstory-7kn2","title":"Replace mulch_learn mail with actual mulch record in session-end handler","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T08:08:13.172871-08:00","updatedAt":"2026-02-16T17:38:11.477379-08:00","assignee":"jayminwest@gmail.com","description":"The session-end handler in src/commands/log.ts (lines 404-437) currently runs mulch learn --since HEAD~1 to detect domains with changes worth recording, but only sends a suggestion mail to the parent agent. Nobody consumes these mulch_learn messages — they accumulate as unread low-priority noise.\n\nFix: Replace the mail-only approach with actual mulch record calls at the canonical root, plus a slimmer notification mail.\n\nChanges to src/commands/log.ts lines 404-437:\n1. Keep the mulch learn call to detect suggested domains\n2. For each suggested domain, call mulchClient.record(domain, { type: 'reference', description: '<capability> agent <name> completed work in this domain. Files: <list>', tags: ['auto-session-end', capability], evidenceBead: beadId })\n3. Record at config.project.root (canonical root) so records are immediately available to all agents, not isolated in worktrees\n4. Send a slimmer notification mail with subject 'mulch: auto-recorded insights in <domains>' instead of 'mulch_learn: learning suggestions from <agent>'\n5. Wrap each individual record call in try/catch (non-fatal per domain)\n6. This covers read-only agents (scout/reviewer) whose worktree records would be lost\n\nAlso update src/commands/log.test.ts:\n- Verify mulchClient.record() is called for each suggested domain\n- Verify mail notification subject reflects 'auto-recorded' not 'learning suggestions'\n- Verify non-fatal behavior preserved (record failures don't break session-end)\n\nKey files: src/commands/log.ts, src/commands/log.test.ts, src/mulch/client.ts (record method already implemented but never called programmatically)","closeReason":"Session-end handler now calls mulch record directly instead of sending suggestion mail. Extracted testable autoRecordExpertise function. 36 tests passing.","closedAt":"2026-02-16T17:38:11.477379-08:00"}
{"id":"overstory-7lsr","title":"Doctor: directory structure validation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:12.604341-08:00","updatedAt":"2026-02-15T12:54:28.367995-08:00","assignee":"jayminwest@gmail.com","description":"Verify .overstory/ directory is complete and matches what init.ts creates.\n\nChecks:\n- .overstory/ directory exists\n- Required files exist: config.yaml, agent-manifest.json, hooks.json, .gitignore\n- Required subdirectories exist: agent-defs/, agents/, worktrees/, specs/, logs/\n- .gitignore contains expected entries (worktrees/, *.db, *.db-shm, *.db-wal, logs/, etc.)\n- agent-defs/ contains .md files referenced by agent-manifest.json\n- No leftover files from failed init attempts\n\nSource references:\n- src/commands/init.ts (creates all of this)\n- .overstory/.gitignore (expected contents)\n\nOutput: pass/warn/fail per check. Missing required files = critical.","closeReason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","closedAt":"2026-02-15T12:54:28.367995-08:00"}
{"id":"overstory-7r9","title":"L0-4: Implement config loader in src/config.ts","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:16.788784-08:00","updatedAt":"2026-02-12T07:18:57.544923-08:00","assignee":"jayminwest@gmail.com","description":"YAML config loader for .overstory/config.yaml. Includes sensible defaults for all fields, validation of required fields, path resolution relative to project root. Returns typed OverstoryConfig.","closeReason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)","closedAt":"2026-02-12T07:18:57.544923-08:00"}
{"id":"overstory-7sma","title":"Status display shows completed sessions as active","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T14:42:32.130568-08:00","updatedAt":"2026-02-13T06:45:19.665964-08:00","assignee":"jayminwest@gmail.com","description":"overstory status filters only zombie sessions (status.ts:228) but still shows completed sessions in the active agent count. A completed coordinator shows as 'active' alongside the real running one, making it look like two coordinators are running. Fix: filter completed sessions from the active list, or display them in a separate 'recent/history' section.","closeReason":"Fixed status display: added completed state filter alongside zombie in printStatus active agent count (status.ts line 228)","closedAt":"2026-02-13T06:45:19.665964-08:00"}
{"id":"overstory-7u8","title":"merge/resolver.test.ts: 10 tests fail on CI due to hardcoded 'main' branch","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:08:31.848579-08:00","updatedAt":"2026-02-12T12:26:34.626825-08:00","assignee":"jayminwest@gmail.com","description":"In src/merge/resolver.test.ts, 10 tests fail on CI because helper functions (setupCleanMerge, setupContentConflict, setupDeleteModifyConflict, setupReimagineScenario) call git checkout main, but the temp git repos have 'master' as default branch on the CI runner. Error: 'error: pathspec main did not match any file(s) known to git'. Blocked by fix to createTempGitRepo() in test-helpers.ts.","closeReason":"Replaced all hardcoded 'main' in resolver.test.ts with dynamic defaultBranch from getDefaultBranch() helper, updated helper function signatures to accept baseBranch parameter","closedAt":"2026-02-12T12:26:34.626825-08:00"}
{"id":"overstory-7xf9","title":"Audit mulch domains and coverage — investigate gaps","status":"closed","type":"task","priority":3,"createdAt":"2026-02-17T08:17:37.694655-08:00","updatedAt":"2026-02-20T07:21:10.140079-08:00","assignee":"jayminwest@gmail.com","description":"Investigate whether mulch expertise coverage is comprehensive. Check if new domains are needed beyond the current set (architecture, agents, typescript, cli, messaging). Look at what areas of the codebase lack expertise records — e.g., merge system, watchdog/monitoring, metrics/costs, doctor checks, testing patterns. Also verify existing records are still accurate and not stale. Report findings — may result in no action needed or a list of records to add.","closeReason":"Audit completed: 5 domains, 287 records, coverage adequate. Remaining items (compact cli domain, delete stale mx-454bf3) blocked on mulch compact bugs in external project.","closedAt":"2026-02-20T07:21:10.140079-08:00"}
{"id":"overstory-7y1l","title":"Task group tracking (batch work coordination)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T13:51:22.02572-08:00","updatedAt":"2026-02-12T14:11:41.641978-08:00","assignee":"jayminwest@gmail.com","description":"Implement task group tracking - the ability to batch related beads issues into a group, monitor collective progress, and auto-close when all members complete. Maps to gastown's convoy concept but uses beads relations. Key features: (1) overstory group create '<name>' <issue-ids> - creates a tracking bead with 'tracks' relations to member issues, (2) overstory group status [group-id] - shows progress (N/M complete), active workers, blocked issues, (3) Auto-close: when all tracked issues are closed, group auto-closes and notifies subscribers (coordinator, human), (4) Add/remove issues from active groups (reopen if closed), (5) Cross-project groups: track issues across multiple projects via beads prefix routing. This is critical for the coordinator to manage batched work without manually polling each issue.","closeReason":"Implemented task group tracking (overstory group create/status/add/remove/list with auto-close) and session lifecycle (checkpoint save/restore, handoff orchestration, compaction-aware priming)","closedAt":"2026-02-12T14:11:41.641978-08:00"}
{"id":"overstory-7yie","title":"Fix dashboard merge queue field name mismatch","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T07:22:03.437196-08:00","updatedAt":"2026-02-13T07:26:30.158936-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed merge queue field name mismatch (branchName/agentName vs branch/agent)","closedAt":"2026-02-13T07:26:30.158936-08:00"}
{"id":"overstory-7za6","title":"overstory hooks install --force overwrites existing Claude Code hooks","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-23T11:00:12.474181-08:00","updatedAt":"2026-02-23T11:23:52.093662-08:00","assignee":"jayminwest@gmail.com","description":"hooks.ts:82 does targetConfig.hooks = sourceHooks.hooks which replaces the entire hooks key. Projects with existing .claude/settings.local.json hooks lose their config with no merge strategy and no backup. Fix: merge hook arrays per event type rather than replacing the whole object, or at minimum create a backup before overwriting.","closeReason":"Fixed overstory hooks install --force overwriting existing hooks. Now merges per event type via mergeHooksByEventType(). Builder overstory-ot9d completed: 2 files changed (hooks.ts, hooks.test.ts), 25 tests pass. Branch: overstory/hooks-merge-builder/overstory-ot9d.","closedAt":"2026-02-23T11:23:52.093662-08:00"}
{"id":"overstory-802o","title":"Coordinator runs at project root without hooks - blind spot for monitoring","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T15:33:28.096494-08:00","updatedAt":"2026-02-13T19:07:43.641404-08:00","assignee":"jayminwest@gmail.com","description":"The coordinator agent (depth 0) runs at the project root via overstory coordinator start, but hooks are NOT deployed to the project root (.claude/settings.local.json). This means: (1) no event logging (tool-start, tool-end, session-end), (2) no mail check --inject on UserPromptSubmit, (3) no activity tracking in sessions.json. The coordinator's lastActivity field never updates from startedAt. Comment in coordinator.ts line 146 acknowledges this: 'Hooks are NOT deployed to the project root.' Fix: deploy hooks to the project root when running coordinator, or inject hooks via --append-system-prompt.","closeReason":"coordinator start now calls deployHooks to project root. ENV guard ensures hooks only activate for coordinator tmux session, not user sessions.","closedAt":"2026-02-13T19:07:43.641404-08:00"}
{"id":"overstory-80r","title":"Test hierarchy spawning","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T12:09:25.070495-08:00","updatedAt":"2026-02-12T12:10:07.112732-08:00","assignee":"jayminwest@gmail.com","description":"temp","closeReason":"temp test issues, closed after E2E validation","closedAt":"2026-02-12T12:10:07.112732-08:00"}
{"id":"overstory-851c","title":"Export triage pure functions + write triage tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:04.128481-08:00","updatedAt":"2026-02-13T08:07:49.124207-08:00","assignee":"jayminwest@gmail.com","closeReason":"Exported triage pure functions (buildTriagePrompt, classifyResponse, readRecentLog) and added comprehensive test suite with 22 tests. All quality gates pass.","closedAt":"2026-02-13T08:07:49.124207-08:00"}
{"id":"overstory-85y","title":"sling depth check is off-by-one: depth >= maxDepth should be depth > maxDepth","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:31:08.048368-08:00","updatedAt":"2026-02-12T10:41:32.560494-08:00","assignee":"jayminwest@gmail.com","description":"With default maxDepth=2, the depth check rejects 'depth 2 >= maxDepth 2'. But the CLAUDE.md hierarchy shows 3 levels (orchestrator at 0, lead at 1, specialist at 2), meaning depth=2 should be the deepest allowed leaf node. The check in sling should be 'depth > maxDepth' not 'depth >= maxDepth', or maxDepth semantics should be documented as 'exclusive upper bound'.","closeReason":"Fixed off-by-one: changed depth >= maxDepth to depth > maxDepth in sling.ts","closedAt":"2026-02-12T10:41:32.560494-08:00"}
{"id":"overstory-888d","title":"Scout: explore multi-provider implementation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T06:03:58.901269-08:00","updatedAt":"2026-02-21T06:05:31.385532-08:00","assignee":"jayminwest@gmail.com","closeReason":"Comprehensive exploration of multi-provider implementation with spec documenting architecture, tested scenarios, gaps, and recommendations","closedAt":"2026-02-21T06:05:31.385532-08:00"}
{"id":"overstory-89kt","title":"Multi-provider model support","status":"open","type":"feature","priority":1,"createdAt":"2026-02-19T12:13:22.788837-08:00","updatedAt":"2026-02-19T12:13:22.788837-08:00","assignee":"jayminwest@gmail.com","description":"Allow users to configure non-Anthropic models (via gateways like OpenRouter/LiteLLM) for specific agent roles. Core mechanism: per-tmux-session env var injection (ANTHROPIC_BASE_URL, ANTHROPIC_AUTH_TOKEN, ANTHROPIC_DEFAULT_*_MODEL). See design spec in linked sub-issues."}
{"id":"overstory-8cm","title":"No --help flag support for subcommands","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:09:18.88392-08:00","updatedAt":"2026-02-12T08:32:22.170644-08:00","assignee":"jayminwest@gmail.com","description":"Passing --help to any subcommand (init, sling, prime, status, mail, merge, worktree, log, watch, metrics) either errors or runs the command instead of showing usage help. Examples: 'overstory mail --help' errors with 'Unknown mail subcommand: --help'. 'overstory watch --help' starts the watchdog daemon. 'overstory init --help' warns about already initialized. 'overstory sling --help' errors with validation. Each subcommand should check for --help/-h and display usage info.","closeReason":"Added --help/-h support to all 10 subcommands and the main CLI entry point","closedAt":"2026-02-12T08:32:22.170644-08:00"}
{"id":"overstory-8ezd","title":"Lead: reduce agent spawn overhead across agent definitions","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:30:59.523474-08:00","updatedAt":"2026-02-21T06:48:59.833272-08:00","assignee":"jayminwest@gmail.com","description":"Umbrella task for 4 agent-reduction issues: overstory-tq8g (lightweight mode), overstory-16o7 (optional reviewers), overstory-ck09 (optional scouts), overstory-htnk (remove dead INSIGHT protocol). All changes are to markdown agent definitions in agents/. Single lead should handle all 4 coherently since they overlap heavily on lead.md.","closeReason":"All 4 spawn-reduction tasks completed: lightweight mode (tq8g), optional reviewers (16o7), optional scouts (ck09), INSIGHT removal (htnk). Changes merged to main.","closedAt":"2026-02-21T06:48:59.833272-08:00"}
{"id":"overstory-8fj0","title":"Implement mail debounce: CLI flag + PostToolUse hook + tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T12:37:14.414156-08:00","updatedAt":"2026-02-15T13:01:16.46902-08:00","assignee":"jayminwest@gmail.com","closeReason":"Completed: mail check debounce CLI flag + tests","closedAt":"2026-02-15T13:01:16.46902-08:00"}
{"id":"overstory-8fr","title":"status unread mail count includes ALL agents, not just orchestrator","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T09:41:26.447251-08:00","updatedAt":"2026-02-12T09:48:02.503614-08:00","assignee":"jayminwest@gmail.com","description":"overstory status shows '6 unread' mail but overstory mail check (for orchestrator) shows 0 unread. The status command counts all unread messages across all agents (including test-agent, test-scout-3, x, etc). This is misleading because the orchestrator can't read messages addressed to other agents. The status should either show per-agent counts or only count messages for the current agent.","closeReason":"Filter unread mail count by agent (default orchestrator) instead of counting all agents. Added --agent flag to status command.","closedAt":"2026-02-12T09:48:02.503614-08:00"}
{"id":"overstory-8jo7","title":"Flip .overstory/.gitignore to wildcard+whitelist and auto-heal in prime","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:11:29.118913-08:00","updatedAt":"2026-02-17T07:29:24.992048-08:00","assignee":"jayminwest@gmail.com","description":"State files keep leaking into git status because the .gitignore template in init.ts uses an explicit deny-list that must be manually updated for every new runtime file. Two problems: (1) missing entries (current-run.txt, mail-check-state.json), and (2) deployed gitignores go stale since init skips if the file exists and prime doesn't touch it.\n\nFix: flip to wildcard+whitelist model in OVERSTORY_GITIGNORE (init.ts:431-455):\n  *\n  !.gitignore\n  !config.yaml\n  !agent-manifest.json\n  !hooks.json\n  !groups.json\n\nThen add an auto-heal step in prime that overwrites .overstory/.gitignore if its content differs from the template. This ensures existing projects get updated on next session start.\n\nAlso remove the exists() guard in writeOverstoryGitignore() so --force reinit regenerates it too.","closeReason":"Merged 3 builder branches: wildcard+whitelist gitignore template, removed exists() guard, auto-heal in prime, doctor check updated. All tests pass (1819/1819).","closedAt":"2026-02-17T07:29:24.992048-08:00"}
{"id":"overstory-8m8","title":"Add CLI help text for unknown subcommands","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T11:57:23.398574-08:00","updatedAt":"2026-02-12T11:59:09.647218-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added editDistance function and suggestCommand to src/index.ts. Unknown commands now show 'Did you mean X?' when edit distance <= 2. All quality gates pass (303 tests, biome clean, tsc clean).","closedAt":"2026-02-12T11:59:09.647218-08:00"}
{"id":"overstory-8p1p","title":"Update lead.md Phase 1 to scout-first workflow with parallel scouts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:23:25.755577-08:00","updatedAt":"2026-02-16T13:33:32.579776-08:00","assignee":"jayminwest@gmail.com","description":"Modify agents/lead.md Phase 1 (Scout) section to make spawning scouts the default approach, support 1-2 parallel scouts, and reframe the skip-scout option as the exception.","closeReason":"Updated lead.md Phase 1 to scout-first workflow with parallel scout support. All acceptance criteria passed review.","closedAt":"2026-02-16T13:33:32.579776-08:00"}
{"id":"overstory-8pcf","title":"Fix tool=unknown in feed: stdin handling broken for large PostToolUse payloads","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-17T07:25:32.734467-08:00","updatedAt":"2026-02-17T07:50:36.624508-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\n`overstory feed` shows `tool=unknown summary=unknown` for ~77% of tool_end events and ~19% of tool_start events. This makes the feed largely useless for observability.\n\n## Evidence\n\nFrom events.db analysis:\n- tool_start: 5814 known (81%), 1338 unknown (19%)\n- tool_end: 1546 known (23%), 5098 unknown (77%)\n- All agents affected (100+ agents across history)\n- Known tool_end events are mostly small-output commands (e.g. `overstory mail check`)\n\n## Root Cause\n\nThe hook commands in `templates/hooks.json.tmpl` use a fragile stdin relay pattern:\n```bash\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent NAME --stdin\n```\n\nThree problems:\n\n### 1. Shell `read -r` truncates large payloads\nPostToolUse payloads from Claude Code include `tool_result` (the full tool output — file contents, command output, etc.). These payloads can easily be 10-100KB+. Shell `read -r` may truncate at buffer boundaries, producing malformed JSON that `readStdinJson()` fails to parse.\n\nPreToolUse payloads are much smaller (just tool_name + tool_input), explaining the higher success rate for tool_start.\n\n### 2. `echo \"$INPUT\"` can mangle content\nBSD echo on macOS may interpret escape sequences in the JSON. Special characters in tool results (`\\n`, `\\t`, backticks) can cause corruption.\n\n### 3. `readStdinJson()` silently swallows errors\nIn `src/commands/log.ts`, the function reads only the first chunk from stdin and catches ALL errors returning null:\n```typescript\nasync function readStdinJson() {\n    try {\n        const reader = Bun.stdin.stream().getReader();\n        const { value } = await reader.read(); // only first chunk!\n        reader.releaseLock();\n        if (!value) return null;\n        return JSON.parse(new TextDecoder().decode(value).trim());\n    } catch { return null; } // swallows all errors\n}\n```\n\nWhen it returns null, `toolName` falls back to `toolNameFlag` which defaults to `\"unknown\"`.\n\n## Additional Issue: Orchestrator hooks don't use EventStore\n\nThe orchestrator hooks in `.overstory/hooks.json` use a legacy `--tool-name` flag path with fragile sed extraction. They do NOT use `--stdin`, so the EventStore insert block is never reached (guarded by `if (useStdin)`). Orchestrator tool events get logged to per-agent log files but NOT to EventStore, reducing feed visibility.\n\n## Proposed Fix\n\n### Fix 1: Eliminate the read/echo middleman in hooks template\nReplace:\n```bash\nread -r INPUT; echo \"$INPUT\" | overstory log tool-end --agent NAME --stdin\n```\nWith direct stdin piping:\n```bash\noverstory log tool-end --agent NAME --stdin </dev/stdin\n```\nOr use `cat` as a reliable relay:\n```bash\ncat | overstory log tool-end --agent NAME --stdin\n```\nThe env guard `[ -z \"$OVERSTORY_AGENT_NAME\" ] && exit 0` doesn't consume stdin, so overstory can inherit it directly.\n\n### Fix 2: Read ALL stdin in readStdinJson()\nReplace single-chunk read with full stdin consumption:\n```typescript\nconst chunks: Uint8Array[] = [];\nconst reader = Bun.stdin.stream().getReader();\nwhile (true) {\n    const { value, done } = await reader.read();\n    if (done) break;\n    if (value) chunks.push(value);\n}\n// Concatenate and parse\n```\n\n### Fix 3: For tool_end, only parse tool_name (not full payload)\nSince we only need `tool_name` and `session_id` from PostToolUse, we could extract just those fields without parsing the entire (potentially huge) JSON. A targeted regex or streaming parser would be more robust.\n\n### Fix 4: Update orchestrator hooks to use --stdin path\nAlign orchestrator hooks with the template pattern so orchestrator events also flow to EventStore.\n\n### Fix 5: Add error diagnostics to readStdinJson()\nLog the actual error (or at least a truncated version) so failures are debuggable instead of silently falling back to 'unknown'.\n\n## Files Involved\n- `templates/hooks.json.tmpl` — hook command patterns (primary fix)\n- `src/commands/log.ts` — `readStdinJson()` function, EventStore writes\n- `src/events/tool-filter.ts` — summary generation\n- `src/commands/feed.ts` — display code (shows whatever is stored)\n- `.overstory/hooks.json` — orchestrator hooks (secondary fix)\n- `src/agents/hooks-deployer.ts` — deploys hooks to worktrees","closeReason":"Fixed tool=unknown in feed. Root causes: (1) hooks template used read/echo stdin relay that truncated large payloads — removed relay, stdin flows directly to overstory log. (2) readStdinJson() read only first chunk — now reads all chunks in a loop. (3) Updated test assertions for relay removal. Three branches ready for merge.","closedAt":"2026-02-17T07:50:36.624508-08:00"}
{"id":"overstory-8pg","title":"Test sling json","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T09:43:44.284799-08:00","updatedAt":"2026-02-12T09:44:02.030934-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test issue for sling --json testing, no longer needed","closedAt":"2026-02-12T09:44:02.030934-08:00"}
{"id":"overstory-8v4h","title":"Write merge.test.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:05:28.582239-08:00","updatedAt":"2026-02-13T09:32:05.327816-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.327816-08:00"}
{"id":"overstory-8vf9","title":"Implement inspect command and register in CLI","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T19:58:30.781332-08:00","updatedAt":"2026-02-15T12:42:02.435091-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented overstory inspect command: deep per-agent inspection with EventStore, SessionStore, MetricsStore, tmux capture-pane, --json/--follow/--limit flags, 18 tests","closedAt":"2026-02-15T12:42:02.435091-08:00"}
{"id":"overstory-8xb","title":"Metrics not recorded for headless agents (session-end hook never fires)","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:08:18.828719-08:00","updatedAt":"2026-02-12T12:23:51.477806-08:00","assignee":"jayminwest@gmail.com","description":"The metrics system relies on the Stop hook calling 'overstory log session-end'. In headless mode (claude -p), hooks don't fire, so no session-end event is emitted. Agents complete work but are never recorded in metrics.db. After spawning 4 agents (helptext-builder, mail-scout, merge-scout, json-test-agent), metrics still shows only 1 session from a previous test. This makes the metrics system useless for monitoring agent work. Related to overstory-52z (mail can't be received) and overstory-ebd (no log directories).","closeReason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work.","closedAt":"2026-02-12T12:23:51.477806-08:00"}
{"id":"overstory-8ynj","title":"Update doctor/structure.ts gitignore check for wildcard model","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:18:01.041654-08:00","updatedAt":"2026-02-17T07:25:45.897191-08:00","assignee":"jayminwest@gmail.com","description":"Update .gitignore entries check to validate wildcard+whitelist pattern","closeReason":"Closed","closedAt":"2026-02-17T07:25:45.897191-08:00"}
{"id":"overstory-94i","title":"L3-6: Implement worktree command (src/commands/worktree.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:12:13.847906-08:00","updatedAt":"2026-02-12T07:36:21.737507-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory worktree list | clean [--completed] [--all]. List shows worktrees with agent status. Clean removes: worktree dir, branch ref (if merged), tmux session (kill if running). Logs preserved (never auto-deleted).","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.737507-08:00"}
{"id":"overstory-95za","title":"Mulch-informed task decomposition for lead agents","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-13T21:08:44.380765-08:00","updatedAt":"2026-02-13T22:41:02.534455-08:00","assignee":"jayminwest@gmail.com","description":"Update lead agent overlay and sling.ts to leverage mulch before decomposing work. Before decomposition, leads should:\n1. mulch search <task keywords> to find relevant patterns/failures\n2. mulch prime --files <affected-files> to load file-specific expertise (now available via M1)\n3. Factor known failure patterns and conventions into sub-task specs\n\nThe --files flag makes this much more targeted than generic domain priming.","closeReason":"Lead agents now consult mulch before decomposition: mulch search for patterns, mulch prime --files for file-scoped expertise. Overlay embeds pre-fetched expertise.","closedAt":"2026-02-13T22:41:02.534455-08:00"}
{"id":"overstory-96la","title":"Migrate worktree.ts and daemon.ts to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:58:37.248234-08:00","updatedAt":"2026-02-13T19:16:13.151109-08:00","assignee":"jayminwest@gmail.com","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.151109-08:00"}
{"id":"overstory-98qr","title":"Failure post-mortem recording","status":"open","type":"task","priority":3,"createdAt":"2026-02-15T17:04:55.635506-08:00","updatedAt":"2026-02-15T17:04:55.635506-08:00","assignee":"jayminwest@gmail.com","description":"When watchdog escalates to Tier 1 (AI triage), record the triage result and resolution to mulch. Over time build a knowledge base: 'agent X stalled because Y, resolved by Z'. Use this to improve triage accuracy and reduce escalation times."}
{"id":"overstory-99ec","title":"Dashboard opens/closes 6 SQLite DBs per tick","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-19T13:28:11.623463-08:00","updatedAt":"2026-02-20T08:27:15.428605-08:00","assignee":"jayminwest@gmail.com","description":"Each dashboard refresh opens sessions.db, mail.db (x2), merge-queue.db (x2), and metrics.db (x2) — running PRAGMAs, schema checks, and WAL checkpoints on every open/close. At 2s interval this is constant churn. Fix: hold DB connections open for the poll loop lifetime, pass handles into loadDashboardData, close on SIGINT.","closeReason":"Dashboard DB connection pooling complete. openDashboardStores/closeDashboardStores hold 4 SQLite DBs open for poll loop lifetime instead of opening/closing 7 per tick. loadDashboardData accepts pre-opened DashboardStores. getCachedWorktrees/getCachedTmuxSessions exported from status.ts. 25 tests pass, merged to main.","closedAt":"2026-02-20T08:27:15.428605-08:00"}
{"id":"overstory-99tm","title":"Apply conflict history intelligence to merge resolver","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:07:53.514586-08:00","updatedAt":"2026-02-16T18:17:43.663324-08:00","assignee":"jayminwest@gmail.com","closeReason":"Applied conflict history intelligence to merge resolver. Added ParsedConflictPattern and ConflictHistory types, parseConflictPatterns/buildConflictHistory/queryConflictHistory functions, tier-skipping logic, AI prompt enrichment with historical context, and comprehensive tests. Quality gates passed.","closedAt":"2026-02-16T18:17:43.663324-08:00"}
{"id":"overstory-9ju","title":"Closed task for testing","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T10:06:51.772977-08:00","updatedAt":"2026-02-12T10:06:56.02381-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test issue for sling","closedAt":"2026-02-12T10:06:56.02381-08:00"}
{"id":"overstory-9kuz","title":"Add agent discovery command","status":"closed","type":"task","priority":3,"createdAt":"2026-02-15T17:04:36.435421-08:00","updatedAt":"2026-02-16T18:15:21.790268-08:00","assignee":"jayminwest@gmail.com","description":"New command: 'overstory agents discover --capability builder' returns all active builders with their status, current task, and file scope. Currently agents can't find each other without knowing exact names.","closeReason":"Agent discovery command implemented. overstory agents discover with --capability and --all filtering, --json output, file scope extraction, shell completions, 10 tests.","closedAt":"2026-02-16T18:15:21.790268-08:00"}
{"id":"overstory-9ot9","title":"Phase 5: Session lifecycle independence (handoff, compaction, continuity)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T13:51:02.991283-08:00","updatedAt":"2026-02-12T14:11:41.661546-08:00","assignee":"jayminwest@gmail.com","description":"Implement session lifecycle management so agents survive context compaction, crashes, and restarts without losing work state. Key components: (1) Handoff mechanism - agent saves state to beads, spawns fresh session, new session resumes from checkpoint. State lives in beads issues (not .md files), (2) Compaction hooks - PreCompact saves current progress to beads, SessionStart after compaction restores from beads, (3) Session query - ability to query previous session transcripts for context recovery (like gastown's seance), (4) Three-layer model: Session (ephemeral Claude runtime) / Sandbox (git worktree, persists across sessions) / Identity (permanent agent record with work history, expertise domains, accumulated CV), (5) Identity persistence - agents accumulate capability profiles across assignments, enabling smarter dispatch by coordinator.","closeReason":"Implemented task group tracking (overstory group create/status/add/remove/list with auto-close) and session lifecycle (checkpoint save/restore, handoff orchestration, compaction-aware priming)","closedAt":"2026-02-12T14:11:41.661546-08:00"}
{"id":"overstory-9qb5","title":"Scout: explore provider implementation in config.ts, types.ts, manifest.ts, sling.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T05:56:10.749855-08:00","updatedAt":"2026-02-21T05:58:04.089477-08:00","assignee":"jayminwest@gmail.com","closeReason":"Explored provider implementation across types.ts, config.ts, manifest.ts, sling.ts, and tmux.ts. Documented how native and gateway providers work, including type definitions, validation, env resolution, and environment variable injection during agent spawning.","closedAt":"2026-02-21T05:58:04.089477-08:00"}
{"id":"overstory-9sct","title":"Enforce scout-first workflow in lead agents","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-17T07:34:00.506406-08:00","updatedAt":"2026-02-17T07:51:53.767959-08:00","assignee":"jayminwest@gmail.com","description":"Leads consistently skip Phase 1 (Scout) — 0 scouts spawned across 58-agent run. Fix: (1) Add SCOUT_SKIP named failure mode to lead.md, (2) Strengthen should spawn scouts to MUST spawn scouts with narrower exception, (3) Rebalance cost guidance to not discourage scout/reviewer spawning, (4) Consider structural enforcement in sling.ts or overlay.","closeReason":"Scout-first workflow enforced in lead agents. (1) agents/lead.md: added SCOUT_SKIP failure mode, strengthened Phase 1 to MUST spawn scouts, tightened skip exception, rebalanced cost guidance. (2) src/commands/sling.ts: added parentHasScouts() + non-blocking warning when builder spawned without prior scout, 10 tests.","closedAt":"2026-02-17T07:51:53.767959-08:00"}
{"id":"overstory-9vnb","title":"Token/cost instrumentation for agent sessions","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T14:37:43.55218-08:00","updatedAt":"2026-02-13T09:46:09.803514-08:00","assignee":"jayminwest@gmail.com","description":"Add tracking of input/output tokens and estimated cost per agent session so dashboard can display spend.\n\nChallenge: Claude Code doesn't expose token counts through hook events (tool-start/tool-end). Need to investigate extraction options:\n- Parse ~/.claude/ session data files for token usage\n- Add PostToolUse hook that captures response metadata\n- Scrape Claude Code's own status line output from tmux panes\n- Add a session-end summary parser\n\nStorage: Extend metrics.db sessions table with token_in, token_out, estimated_cost_usd columns. Update SessionMetrics type and MetricsStore accordingly.\n\nThis is exploratory — the extraction method needs scouting before implementation.","closeReason":"Added transcript JSONL parser (src/metrics/transcript.ts) with cost estimation, extended SessionMetrics with token/cost fields, updated metrics store schema with migration, wired session-end handler to parse transcripts via --transcript flag, updated summary display with token/cost totals, 27 new tests","closedAt":"2026-02-13T09:46:09.803514-08:00"}
{"id":"overstory-9vr","title":"worktree/manager.test.ts: 14 tests fail on CI due to hardcoded 'main' branch","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:08:30.655436-08:00","updatedAt":"2026-02-12T12:26:33.09042-08:00","assignee":"jayminwest@gmail.com","description":"In src/worktree/manager.test.ts, 14 tests fail on CI because createWorktree() calls use baseBranch: 'main', but the temp git repos have 'master' as default branch on the CI runner. Failing tests: all 5 createWorktree tests, 4 listWorktrees tests (those calling createWorktree internally), and all 5 removeWorktree tests. Error: 'fatal: invalid reference: main'. Blocked by fix to createTempGitRepo() in test-helpers.ts.","closeReason":"Replaced all hardcoded 'main' in manager.test.ts with dynamic defaultBranch from getDefaultBranch() helper","closedAt":"2026-02-12T12:26:33.09042-08:00"}
{"id":"overstory-9x8m","title":"Update coordinator beacon, hooks-deployer safe prefixes, doctor deps for tracker","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T17:51:43.443892-08:00","updatedAt":"2026-02-23T17:57:54.139882-08:00","assignee":"jayminwest@gmail.com","closeReason":"Updated coordinator beacon, hooks-deployer safe prefixes, and doctor/dependencies for tracker abstraction: buildCoordinatorBeacon accepts cliName param (sd/bd), SAFE_BASH_PREFIXES includes sd, checkDependencies checks sd/bd based on backend config","closedAt":"2026-02-23T17:57:54.139882-08:00"}
{"id":"overstory-9zg","title":"metrics never populated: no code path calls metricsStore.recordSession()","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:32:03.509983-08:00","updatedAt":"2026-02-12T10:41:37.250599-08:00","assignee":"jayminwest@gmail.com","description":"The metrics command always shows 'No sessions recorded' because nothing in the agent lifecycle calls metricsStore.recordSession(). The session-end log event updates identity but skips metrics recording. The log command or worktree clean should record session metrics (agent name, bead id, duration, capability) when an agent session ends.","closeReason":"Added metricsStore.recordSession() call in session-end handler in log.ts","closedAt":"2026-02-12T10:41:37.250599-08:00"}
{"id":"overstory-9zw","title":"CI failing: tests hardcode 'main' branch but CI runner defaults to 'master'","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T12:08:23.589124-08:00","updatedAt":"2026-02-12T12:15:07.52571-08:00","assignee":"jayminwest@gmail.com","description":"All 24 CI test failures stem from a single root cause: createTempGitRepo() in src/test-helpers.ts creates repos via git init + git clone without explicitly setting the default branch name. On macOS (local dev), git defaults to 'main', so tests pass. On CI (ubuntu-latest), git defaults to 'master', so any test referencing 'main' fails with 'fatal: invalid reference: main'. This has caused 26 consecutive CI failures since commit de94853. Fix: pass -b main to git init in getTemplateRepo() in src/test-helpers.ts so the template repo always uses 'main' regardless of system config.","closeReason":"Added -b main to git init in getTemplateRepo()","closedAt":"2026-02-12T12:15:07.52571-08:00"}
{"id":"overstory-a28","title":"L5-11: Write hooks-deployer.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:36.411068-08:00","updatedAt":"2026-02-12T07:56:26.843714-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/agents/hooks-deployer.ts. Cover: deploying hooks config to worktree as .claude/settings.local.json, agent name substitution in commands, all hook types present (SessionStart, UserPromptSubmit, Pre/PostToolUse, Stop, PreCompact).","closeReason":"Closed","closedAt":"2026-02-12T07:56:26.843714-08:00"}
{"id":"overstory-a559","title":"Review: overlay-defs-builder agent defs","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T13:23:35.662106-08:00","updatedAt":"2026-02-20T13:28:05.826715-08:00","assignee":"jayminwest@gmail.com","closeReason":"PASS: all three builder branches reviewed and verified","closedAt":"2026-02-20T13:28:05.826715-08:00"}
{"id":"overstory-a7by","title":"Write watch.test.ts for overstory watch command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:22:14.77068-08:00","updatedAt":"2026-02-13T08:34:59.557497-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files created and merged to main","closedAt":"2026-02-13T08:34:59.557497-08:00"}
{"id":"overstory-a7f","title":"L0-9: Write agents/lead.md base definition","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:35.755539-08:00","updatedAt":"2026-02-12T07:20:05.12537-08:00","assignee":"jayminwest@gmail.com","description":"Team lead agent: can spawn sub-workers via overstory sling. Reads specs, decomposes work, delegates to specialists. Has canSpawn=true. Tracks sub-worker progress via beads and mail.","closeReason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)","closedAt":"2026-02-12T07:20:05.12537-08:00"}
{"id":"overstory-a9qd","title":"Verify and extend config/manifest provider tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:03:00.716527-08:00","updatedAt":"2026-02-24T14:57:26.891Z","assignee":"jayminwest@gmail.com","description":"Add missing edge case tests to config.test.ts and manifest.test.ts per overstory-4p77 spec","closedAt":"2026-02-24T14:57:26.891Z","closeReason":"Config and manifest provider tests added: 10 new test cases in config.test.ts and manifest.test.ts"}
{"id":"overstory-abv","title":"Config resolves to worktree root instead of real project root","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:51:21.956374-08:00","updatedAt":"2026-02-12T11:51:05.849253-08:00","assignee":"jayminwest@gmail.com","description":"When running 'overstory status' (or any command) from inside a worktree (.overstory/worktrees/<name>/), loadConfig resolves project.root to the worktree path instead of the actual repository root. This means sessions.json, mail.db, etc. are looked up in the wrong location. Worktrees have their own .overstory/ directory which is a subset of the main one. The config loader needs to detect git worktrees and resolve up to the real root.","closeReason":"Fixed mail.ts to use resolveProjectRoot instead of raw cwd. Exported resolveProjectRoot from config.ts for reuse. Added worktree resolution tests.","closedAt":"2026-02-12T11:51:05.849253-08:00"}
{"id":"overstory-aeh4","title":"Post-session learning extraction in log.ts","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:08:35.890248-08:00","updatedAt":"2026-02-15T12:42:13.240931-08:00","assignee":"jayminwest@gmail.com","description":"In log.ts handleSessionEnd(), after recording metrics, run mulch learn --since HEAD~1 --json. Parse suggestedDomains and changedFiles. If suggestions exist, include them in the session-end mail to the orchestrator so they can decide what to record. Uses expanded MulchClient.learn().","closeReason":"All 3 mulch integration subtasks completed: (1) Post-session learning extraction in log.ts via mulch learn + mail (overstory-hcia, commit 7130595), (2) Automated failure recording in watchdog daemon via mulch record (overstory-kix0, commit 07b769c), (3) Mulch health checks in overstory clean (overstory-r93n, commit f4d9210). Total: 8 new tests across 3 branches.","closedAt":"2026-02-15T12:42:13.240931-08:00"}
{"id":"overstory-afr9","title":"Implement all 3 sling guard features (bead lock, maxSessionsPerRun, skip-scout)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:53:57.986884-08:00","updatedAt":"2026-02-21T07:09:13.145893-08:00","assignee":"jayminwest@gmail.com","description":"Combined builder task for overstory-b3ks, overstory-ewco, overstory-2evj. See spec for details.","closeReason":"All 3 sling guard features implemented in single builder. 2009 tests pass, typecheck clean.","closedAt":"2026-02-21T07:09:13.145893-08:00"}
{"id":"overstory-afrk","title":"Write triage.test.ts for src/watchdog/triage.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:20:21.482457-08:00","updatedAt":"2026-02-13T08:26:54.37341-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created triage.test.ts with 17 tests covering pure functions and filesystem integration","closedAt":"2026-02-13T08:26:54.37341-08:00"}
{"id":"overstory-aiik","title":"Doctor: agent manifest and identity validation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:42.5891-08:00","updatedAt":"2026-02-15T12:54:28.36983-08:00","assignee":"jayminwest@gmail.com","description":"Validate agent-manifest.json and agent identity files for consistency.\n\nManifest checks:\n- JSON parses without error\n- Required top-level fields: version (non-empty), agents (object), capabilityIndex (object)\n- Each agent definition has required fields: file, model, tools, capabilities, canSpawn, constraints\n- Model values in {haiku, sonnet, opus}\n- Referenced .md files in agent-defs/ actually exist and are readable\n- Capability index bidirectional consistency: if agent X has capability Y, capabilityIndex[Y] includes X, and vice versa\n- No agents with zero capabilities\n- No capabilities with zero providers\n\nIdentity checks:\n- List all identity.yaml files in .overstory/agents/*/\n- Each YAML parses without error\n- Required fields present: name, capability, created (valid ISO timestamp)\n- sessionsCompleted is non-negative integer\n- No stale identity files for agents deleted from manifest\n- Agent names are valid identifiers (alphanumeric, dash, underscore only)\n\nSource references:\n- src/agents/manifest.ts — loadManifest(), agent definition schema, capability index\n- src/agents/identity.ts — identity YAML parsing, field extraction\n- .overstory/agent-manifest.json — real example\n- .overstory/agents/*/identity.yaml — real examples\n\nOutput: pass/warn/fail. Malformed JSON = critical. Missing .md files = fail. Index out of sync = warn with auto-fix suggestion.","closeReason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","closedAt":"2026-02-15T12:54:28.36983-08:00"}
{"id":"overstory-am6","title":"Agent identity (sessionsCompleted, recentTasks) never updated","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:21:18.398521-08:00","updatedAt":"2026-02-12T08:29:56.995341-08:00","assignee":"jayminwest@gmail.com","description":"The updateIdentity() function in src/agents/identity.ts is fully implemented but never called. sessionsCompleted is always 0 and recentTasks is always empty. The session-end log event (src/commands/log.ts) should call updateIdentity() to increment sessionsCompleted and record the completed task. The merge command could also update identity after successful merges. Currently these fields are dead code.","closeReason":"Closed","closedAt":"2026-02-12T08:29:56.995341-08:00"}
{"id":"overstory-aqf","title":"E2E exercise: Add --verbose flag to status command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T10:44:57.452935-08:00","updatedAt":"2026-02-12T10:56:59.739703-08:00","assignee":"jayminwest@gmail.com","description":"E2E validation exercise. Add a --verbose flag to 'overstory status' that shows additional detail about each agent (logs path, worktree path, last mail timestamp). This is a real but small feature used to validate the full overstory lifecycle: issue creation, spec writing, agent sling, mail monitoring, merge, and close.","closeReason":"E2E exercise complete. Agent successfully implemented --verbose flag for status command, merged clean to main. Full lifecycle validated: issue -> spec -> sling -> agent work -> merge -> clean.","closedAt":"2026-02-12T10:56:59.739703-08:00"}
{"id":"overstory-aun","title":"L0-6: Write agents/scout.md base definition","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:23.919487-08:00","updatedAt":"2026-02-12T07:20:05.120278-08:00","assignee":"jayminwest@gmail.com","description":"Scout agent: read-only exploration agent. Can read files, run non-destructive bash commands, search code. Cannot write files. Used for codebase exploration and research tasks.","closeReason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)","closedAt":"2026-02-12T07:20:05.120278-08:00"}
{"id":"overstory-ax6","title":"init should create .overstory/.gitignore for runtime state","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T08:39:42.631463-08:00","updatedAt":"2026-02-12T08:45:12.499255-08:00","assignee":"jayminwest@gmail.com","description":"Move overstory-specific gitignore rules from root .gitignore into .overstory/.gitignore, following the same pattern as .beads/.gitignore. The init command should auto-create this file. Rules to include: SQLite DBs (mail.db, metrics.db + WAL/SHM), worktrees/, logs/, sessions.json, agents/ runtime state, specs/. Config files (config.yaml, agent-manifest.json, hooks.json) should remain tracked.","closeReason":"Closed","closedAt":"2026-02-12T08:45:12.499255-08:00"}
{"id":"overstory-ax7","title":"init generates .overstory/ JSON files with spaces, Biome expects tabs","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:16:27.534419-08:00","updatedAt":"2026-02-12T08:45:12.523887-08:00","assignee":"jayminwest@gmail.com","description":"'overstory init' generates hooks.json and agent-manifest.json with space indentation but Biome is configured for tab indentation. This causes 'biome check' to fail on the generated files. Also, sessions.json (created by sling) has a trailing newline issue. The init command should either: 1) Use tab indentation in generated JSON, or 2) Add .overstory/ to Biome's ignore list (since these are generated files).","closeReason":"Closed","closedAt":"2026-02-12T08:45:12.523887-08:00"}
{"id":"overstory-b02","title":"L4-8: Implement CLI router (src/index.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:43.700846-08:00","updatedAt":"2026-02-12T07:39:42.046983-08:00","assignee":"jayminwest@gmail.com","description":"Main CLI entry point. Command router mapping: init, sling, prime, status, mail (send/check/list/read/reply), merge, worktree (list/clean), log, watch, metrics. Parses args, validates, dispatches to command handlers. Includes --help and --version. Shebang: #!/usr/bin/env bun","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:42.046983-08:00"}
{"id":"overstory-b0l1","title":"Fix doctor.test.ts assertions for implemented check modules","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T14:14:09.236215-08:00","updatedAt":"2026-02-15T14:24:00.854737-08:00","assignee":"jayminwest@gmail.com","closeReason":"Consistency test DI refactor complete (8d52688), doctor tests already fixed (420d8b7)","closedAt":"2026-02-15T14:24:00.854737-08:00"}
{"id":"overstory-b1ac","title":"Add mulch record to leaf agent completion protocols","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T08:07:51.241763-08:00","updatedAt":"2026-02-16T17:39:36.992659-08:00","assignee":"jayminwest@gmail.com","description":"Currently only coordinator and supervisor have mulch record in their completion protocols. All leaf agents (builder, scout, reviewer, merger, lead) mention mulch record in capabilities but don't include it as a required step. This means the self-improvement loop is broken at the leaf level — agents that do the actual work never record what they learn.\n\nChanges needed:\n- builder.md: Add 'mulch record <domain> --type <pattern|convention|decision> --description ...' step before worker_done mail (new step 4, renumber rest)\n- lead.md: Add 'mulch record <domain> --type <pattern|decision> --description ...' step before merge_ready mail (new step 3, renumber rest)  \n- merger.md: Add 'mulch record <domain> --type <pattern|failure> --description ...' step before result mail (new step 4, renumber rest). Skip for clean merges.\n- scout.md: Read-only agent, cannot write files. Update result mail step (step 3) to instruct scouts to prefix reusable findings with 'INSIGHT:' in their result mail body so parents can record them.\n- reviewer.md: Read-only agent, cannot write files. Update result mail step (step 2) to instruct reviewers to prefix findings with 'INSIGHT:' so parents can record them.\n\nNote: Writable agents (builder, merger, lead) run mulch record in their worktree. Records commit with their branch and merge in with code. Read-only agents (scout, reviewer) flow insights through mail to parents.","closeReason":"Added mulch record to builder/lead/merger completion protocols. Scout and reviewer use INSIGHT: prefix in result mail for parent recording.","closedAt":"2026-02-16T17:39:36.992659-08:00"}
{"id":"overstory-b3ks","title":"Add maxSessionsPerRun config to cap total sessions per run","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-21T06:32:09.257497-08:00","updatedAt":"2026-02-21T07:09:12.852746-08:00","assignee":"jayminwest@gmail.com","description":"Add a maxSessionsPerRun setting to .overstory/config.yaml that caps the total number of agent sessions spawned within a single coordinator run. When the limit is approached, the coordinator should stop dispatching new leads and warn. This prevents runaway agent explosion like the audit run that used 60 sessions when 24 were needed. The coordinator should check overstory metrics periodically and enforce the budget.","closeReason":"Implemented checkRunSessionLimit + maxSessionsPerRun config field (default 0 = unlimited). Enforcement in slingCommand step 4b.","closedAt":"2026-02-21T07:09:12.852746-08:00"}
{"id":"overstory-b3sa","title":"Migrate sessions.json to SQLite SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T13:08:30.673852-08:00","updatedAt":"2026-02-13T19:16:13.14516-08:00","assignee":"jayminwest@gmail.com","description":"Create src/sessions/store.ts and src/sessions/compat.ts — replace the race-condition-prone sessions.json with a proper SQLite store.\n\n## Problem\nsessions.json is read/written by multiple concurrent processes (sling, log, status, watch, nudge, monitor) with no locking. Only status.ts uses atomic write (tmp+rename). Under high concurrency (25 agents), this can cause lost writes and data corruption.\n\n## Schema (in sessions.db)\n```sql\nCREATE TABLE sessions (\n  id TEXT PRIMARY KEY,\n  agent_name TEXT NOT NULL UNIQUE,\n  capability TEXT NOT NULL,\n  worktree_path TEXT NOT NULL,\n  branch_name TEXT NOT NULL,\n  bead_id TEXT NOT NULL,\n  tmux_session TEXT NOT NULL,\n  state TEXT NOT NULL DEFAULT 'booting'\n    CHECK(state IN ('booting','working','completed','stalled','zombie')),\n  pid INTEGER,\n  parent_agent TEXT,\n  depth INTEGER NOT NULL DEFAULT 0,\n  run_id TEXT,\n  started_at TEXT NOT NULL,\n  last_activity TEXT NOT NULL,\n  escalation_level INTEGER NOT NULL DEFAULT 0,\n  stalled_since TEXT\n);\nCREATE INDEX idx_sessions_state ON sessions(state);\nCREATE INDEX idx_sessions_run ON sessions(run_id);\n```\n\n## SessionStore Interface\n- upsert(session): void\n- getByName(agentName): AgentSession | null\n- getActive(): AgentSession[] — state IN ('booting','working','stalled')\n- getAll(): AgentSession[]\n- getByRun(runId): AgentSession[]\n- updateState(agentName, state): void\n- updateLastActivity(agentName): void\n- updateEscalation(agentName, level, stalledSince): void\n- remove(agentName): void\n- purge(opts): number\n- close(): void\n\n## Migration (src/sessions/compat.ts)\n```typescript\n// Backward-compatible shim for transition period\nfunction loadSessionsCompat(root: string): AgentSession[]\nfunction saveSessionCompat(root: string, session: AgentSession): void\n```\nOn first call, if sessions.json exists and sessions.db doesn't, import all entries. After that, SQLite is authoritative. sessions.json continues to be written during transition (one release) for safety.\n\n## Consumers to Migrate\nAll these currently read/write sessions.json directly:\n- src/commands/sling.ts — writes new session on spawn\n- src/commands/log.ts — updates lastActivity, transitions to completed\n- src/commands/status.ts — reads all, reconciles with tmux, writes zombie transitions\n- src/watchdog/daemon.ts — reads all, writes state changes + escalation levels\n- src/commands/nudge.ts — reads to find tmux session name\n- src/commands/monitor.ts — reads session state\n- src/commands/coordinator.ts — reads session state\n- src/commands/supervisor.ts — reads session state\n- src/commands/clean.ts — wipes sessions\n\n## Tests\n- src/sessions/store.test.ts: CRUD, state transitions, active filtering, run queries, escalation updates, purge. Use temp file SQLite.\n- src/sessions/compat.test.ts: JSON→SQLite migration, fallback behavior, idempotent migration. Use temp dirs with real files.","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.14516-08:00"}
{"id":"overstory-b3u0","title":"Phase 0: Typed mail protocol for agent coordination","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T13:51:09.166344-08:00","updatedAt":"2026-02-12T14:01:09.444294-08:00","assignee":"jayminwest@gmail.com","description":"Extend the existing SQLite mail system with typed message protocols for structured agent coordination. This is a prerequisite for Phases 1-3 since all inter-agent communication should flow through mail, not .md files. New message types: WORKER_DONE (worker → supervisor: signals completion with exit status, branch, issue ID), MERGE_READY (supervisor → merger: branch verified and ready for merge queue), MERGED (merger → supervisor: branch merged successfully, safe to clean up worker), MERGE_FAILED (merger → supervisor: merge failed, needs rework or fresh worker), ESCALATION (any → coordinator: severity-tagged issue requiring higher-level decision), HEALTH_CHECK (watchdog → agent: liveness probe, agent responds via heartbeat update not mail). Also: mail-based dispatch (coordinator sends DISPATCH message to supervisor, supervisor sends ASSIGN to worker) replacing the current model where the orchestrator must manually run overstory sling.","closeReason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix","closedAt":"2026-02-12T14:01:09.444294-08:00"}
{"id":"overstory-b4jj","title":"Deprecate status --watch, point users to dashboard","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T14:37:46.602486-08:00","updatedAt":"2026-02-13T09:46:09.652926-08:00","assignee":"jayminwest@gmail.com","description":"Once 'overstory dashboard' exists, deprecate the --watch flag on 'overstory status':\n\n- Print a deprecation notice when --watch is used: 'Note: --watch is deprecated. Use overstory dashboard for live monitoring.'\n- Keep --watch working for one release cycle, then remove\n- Update CLI help text and CLAUDE.md command reference\n- status stays as the lean, one-shot or --json machine-readable command","closeReason":"Added --watch deprecation warning to stderr, updated help text to mark --watch as deprecated pointing users to overstory dashboard, updated CLAUDE.md reference, added 2 new tests","closedAt":"2026-02-13T09:46:09.652926-08:00"}
{"id":"overstory-b7of","title":"Implement run-completion detection in watchdog daemon tick","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T07:16:25.104416-08:00","updatedAt":"2026-02-18T07:21:41.531621-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented run-completion detection in watchdog daemon: PERSISTENT_CAPABILITIES set, checkRunCompletion() function with dedup marker file, integrated in runDaemonTick() after session loop. 8 new tests added covering all acceptance criteria.","closedAt":"2026-02-18T07:21:41.531621-08:00"}
{"id":"overstory-b8ay","title":"Add post-workflow cleanup for stale state (mail, sessions, metrics)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T10:47:12.241384-08:00","updatedAt":"2026-02-13T10:58:55.721893-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nAfter a swarm workflow completes (agents terminated, worktrees cleaned), stale runtime state persists in .overstory/:\n\n- **mail.db**: 176K+ with 150+ unread messages between dead agents (builder→lead, coordinator→builder, etc). `overstory status` says '0 unread' because it filters to orchestrator, but `mail list --unread` dumps everything.\n- **sessions.json**: 34 session records from past workflows that are no longer relevant.\n- **metrics.db**: Accumulated metrics from past runs.\n\nNone of this is harmful, but it's confusing — the data from completed workflows clutters the current state view and makes it hard to tell what's active vs historical.\n\n## Design Considerations\n\nSeveral possible approaches (not mutually exclusive):\n\n1. **`overstory clean --state`** — Nuclear option: wipe mail, sessions, metrics for a fresh start. Simple but loses history.\n2. **Mail archiving/purging** — `overstory mail purge --agents-gone` to delete mail to/from agents that no longer have active sessions. Or mark all as read when their agent terminates.\n3. **Auto-cleanup on agent teardown** — When `worktree clean` removes an agent's worktree, also archive/purge their mail and session records.\n4. **Time-based retention** — Only show mail/sessions from the last N hours or current workflow. Archive older data.\n5. **Workflow boundaries** — Tag mail/sessions with a workflow ID. `overstory status` only shows current workflow's data.\n\nOption 3 feels most natural — cleanup should happen at the same time agents are being cleaned. Option 5 is most correct long-term but higher effort.\n\n## Current Behavior\n\n```\noverstory status          → 0 unread (filters to orchestrator)\noverstory mail list       → 2149 lines of output (all historical messages)\noverstory mail list --unread → 759 lines (messages to dead agents)\n.overstory/mail.db        → 176K\n```\n\n## Expected Behavior\n\nAfter a workflow completes and is cleaned up, starting fresh should feel fresh — no stale mail, no dead session records cluttering output.","closeReason":"Implemented overstory clean command (--all for nuclear wipe, individual flags for selective cleanup) and auto mail purge on worktree clean. Added MetricsStore.purge(). All 933 tests pass.","closedAt":"2026-02-13T10:58:55.721893-08:00"}
{"id":"overstory-b8oj","title":"Expertise-routed task assignment","status":"closed","type":"task","priority":3,"createdAt":"2026-02-15T17:04:54.424617-08:00","updatedAt":"2026-02-16T19:10:41.410415-08:00","assignee":"jayminwest@gmail.com","description":"When 'overstory sling' spawns an agent, query mulch for which agent identities have expertise in relevant file domains. Route to best-fit agent rather than random assignment. Agent identity already tracks expertiseDomains and recentTasks -- connect this to mulch for richer routing.","closeReason":"Contradicts disposable agent architecture. No persistent agent identity to route to — sling picks a capability type, not a specific agent with accumulated expertise.","closedAt":"2026-02-16T19:10:41.410415-08:00"}
{"id":"overstory-bc8v","title":"Dashboard: stop duration counter when agents reach completed status","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T12:59:40.850472-08:00","updatedAt":"2026-02-16T07:14:42.268029-08:00","assignee":"jayminwest@gmail.com","description":"The overstory dashboard duration column continues counting up for agents that have reached 'completed' status. Duration should freeze at the time the agent completed, not keep incrementing as a live timer.","closeReason":"Merged: duration counter freezes for completed/zombie agents","closedAt":"2026-02-16T07:14:42.268029-08:00"}
{"id":"overstory-beck","title":"Add overstory stop <agent> to explicitly terminate an agent","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-21T06:32:20.77122-08:00","updatedAt":"2026-02-21T07:05:10.766652-08:00","assignee":"jayminwest@gmail.com","description":"Add an overstory stop <agent-name> command that explicitly terminates a running agent by killing its tmux session, marking the session as completed/terminated in sessions.db, and optionally cleaning up the worktree. Before re-dispatching leads, the coordinator should be able to explicitly kill stale agents to prevent zombie pipelines running in parallel with replacements. Should support --force for immediate kill and graceful shutdown via mail by default.","closeReason":"Implemented overstory stop <agent-name> command. Spawned one builder (stop-cmd-builder) that created stop.ts with DI pattern, 17 tests, and registered the command in index.ts + completions.ts. Branch: overstory/stop-cmd-builder/overstory-51op ready for merge.","closedAt":"2026-02-21T07:05:10.766652-08:00"}
{"id":"overstory-bhz","title":"worktree clean --completed fails on .claude/ untracked files, then says 'No worktrees to clean'","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T09:40:58.28652-08:00","updatedAt":"2026-02-12T09:50:53.388425-08:00","assignee":"jayminwest@gmail.com","description":"When sling deploys hooks to a worktree, it creates .claude/settings.local.json and .claude/CLAUDE.md. These are untracked files. When worktree clean --completed runs, git worktree remove fails because of these untracked files (exit 128). The command then misleadingly prints 'No worktrees to clean' after showing failure warnings. Two fixes needed: (1) worktree clean --completed should use force:true (same as --all) since the .claude/ dir will always be present, and (2) the 'No worktrees to clean' message should not appear when there were failures — it should say something like 'Failed to clean N worktrees (use --all to force)'.","closeReason":"worktree clean --completed now uses force:true for worktree removal (handles untracked .claude/ files). Added failed[] tracking so 'No worktrees to clean' only shows when there are truly zero worktrees — failures now show 'Failed to clean N worktrees' instead.","closedAt":"2026-02-12T09:50:53.388425-08:00"}
{"id":"overstory-bkvc","title":"Migrate merge queue from JSON to SQLite","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T17:04:25.809778-08:00","updatedAt":"2026-02-16T07:37:22.474561-08:00","assignee":"jayminwest@gmail.com","description":"Current JSON queue (.overstory/merge-queue.json) uses readFileSync/writeFileSync with no concurrency safety. Two agents writing simultaneously causes data loss. Migrate to SQLite with WAL mode to align with mail.db, sessions.db, events.db, metrics.db pattern.","closeReason":"Migrated merge queue from JSON (merge-queue.json) to SQLite (merge-queue.db). Eliminates data loss from concurrent writes. 13 files changed across core store, commands, tests, and doctor checks. 1665 tests pass.","closedAt":"2026-02-16T07:37:22.474561-08:00"}
{"id":"overstory-bld","title":"E2E test task: add integration test for mail round-trip","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T10:22:26.928937-08:00","updatedAt":"2026-02-12T10:32:19.184205-08:00","assignee":"jayminwest@gmail.com","closeReason":"e2e test completed","closedAt":"2026-02-12T10:32:19.184205-08:00"}
{"id":"overstory-bnsg","title":"Add pre-scouted exception to lead.md files","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:10:55.216671-08:00","updatedAt":"2026-02-21T06:13:24.895183-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added pre-scouted spec exception to lead workflow: step 9 in agents/lead.md and step 6 in .overstory/agent-defs/lead.md. Both use ALL-conditions-must-be-true guard (dispatch lists spec paths, specs exist with substantive content, specs cover full scope). Prevents redundant scout spawning when prior session already produced specs.","closedAt":"2026-02-21T06:13:24.895183-08:00"}
{"id":"overstory-bsqj","title":"Fix: clamp all .repeat() args in dashboard.ts to prevent negative values","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-20T07:53:09.10787-08:00","updatedAt":"2026-02-20T07:55:41.196004-08:00","assignee":"jayminwest@gmail.com","description":"Wrap all unguarded String.prototype.repeat() calls with Math.max(0, ...) in src/commands/dashboard.ts. Add tests for edge cases.","closeReason":"Guarded all String.prototype.repeat() calls in dashboard.ts with Math.max(0,...). Added early-return guards in truncate() and pad(). Exported pure functions and added 12 edge-case tests. All quality gates pass.","closedAt":"2026-02-20T07:55:41.196004-08:00"}
{"id":"overstory-bsr8","title":"Supervisor agent: behavioral definition (agents/supervisor.md)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T14:34:37.94917-08:00","updatedAt":"2026-02-12T14:55:19.697716-08:00","assignee":"jayminwest@gmail.com","description":"Write the supervisor agent definition file defining HOW the supervisor operates. Based on coordinator.md pattern but scoped to per-project worker management. Covers: spawning workers, monitoring via mail, handling worker-done lifecycle, escalation to coordinator, nudge protocol.","closeReason":"Phase 2 supervisor agent implemented and merged","closedAt":"2026-02-12T14:55:19.697716-08:00"}
{"id":"overstory-bvwi","title":"Write log.test.ts for overstory log command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:22:13.696762-08:00","updatedAt":"2026-02-13T08:34:59.55676-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files created and merged to main","closedAt":"2026-02-13T08:34:59.55676-08:00"}
{"id":"overstory-byro","title":"Add run_id to token_snapshots for live cost filtering by run","status":"open","type":"feature","priority":3,"createdAt":"2026-02-19T12:08:32.19428-08:00","updatedAt":"2026-02-19T12:08:32.19428-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\n`overstory costs --live` shows real-time token snapshots for all active agents, but cannot be filtered by run. The `token_snapshots` table in metrics.db has no `run_id` column, matching the same gap as the sessions table (see related bug for --run returning empty).\n\nWhen multiple runs overlap or snapshots from old runs persist, there's no way to isolate live cost data to a specific run.\n\n## Current Schema\n\n```sql\nCREATE TABLE token_snapshots (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  agent_name TEXT NOT NULL,\n  input_tokens INTEGER NOT NULL DEFAULT 0,\n  output_tokens INTEGER NOT NULL DEFAULT 0,\n  cache_read_tokens INTEGER NOT NULL DEFAULT 0,\n  cache_creation_tokens INTEGER NOT NULL DEFAULT 0,\n  estimated_cost_usd REAL,\n  model_used TEXT,\n  created_at TEXT NOT NULL\n);\n```\n\n## Proposed Fix\n\nAdd `run_id TEXT` column to `token_snapshots`. When recording snapshots in `src/commands/log.ts` (throttled at 30s intervals during tool-end events), include the agent's run_id from the session. The --live path in costs.ts can then filter snapshots by run.\n\nLower priority than the main --run fix since --live is only useful during active runs, not retroactively.\n\n## Files to change\n\n- `src/metrics/store.ts` — Add run_id column migration, update recordSnapshot and getLatestSnapshots\n- `src/commands/log.ts` — Pass run_id when recording snapshots\n- `src/commands/costs.ts` — Filter --live snapshots by --run if both flags provided\n- `src/types.ts` — Add runId to TokenSnapshot if not already present"}
{"id":"overstory-c2q","title":"L0-1: Initialize package.json, tsconfig.json, biome.json","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:05.693767-08:00","updatedAt":"2026-02-12T07:16:21.984219-08:00","assignee":"jayminwest@gmail.com","description":"Bun init with strict TS config (noUncheckedIndexedAccess, no any), Biome config with tab indentation. Zero runtime deps. Bun runs TS directly — no build step. bin entry: overstory -> ./src/index.ts","closeReason":"Created package.json (zero runtime deps, bin entry), tsconfig.json (strict, noUncheckedIndexedAccess), biome.json (tab indent, no any). Installed deps. Created full directory structure.","closedAt":"2026-02-12T07:16:21.984219-08:00"}
{"id":"overstory-c2x","title":"L4-1: Implement watchdog daemon (src/watchdog/daemon.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:11.200545-08:00","updatedAt":"2026-02-12T07:39:41.885421-08:00","assignee":"jayminwest@gmail.com","description":"Tier 1 mechanical process monitoring. Runs on interval (default 30s). For each active session: check tmux alive, check Claude PID alive, check last activity timestamp. State transitions: working -> stalled -> zombie -> terminate. Function: startDaemon(options) -> { stop: () => void }.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.885421-08:00"}
{"id":"overstory-c6ca","title":"Create EventStore SQLite implementation","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T13:07:54.50043-08:00","updatedAt":"2026-02-13T14:24:00.472321-08:00","assignee":"jayminwest@gmail.com","description":"Create src/events/store.ts — the central event store backed by SQLite.\n\n## Schema\n```sql\nCREATE TABLE events (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  run_id TEXT,\n  agent_name TEXT NOT NULL,\n  session_id TEXT,\n  event_type TEXT NOT NULL,\n  tool_name TEXT,\n  tool_args TEXT,           -- JSON, smart-filtered\n  tool_duration_ms INTEGER,\n  level TEXT NOT NULL DEFAULT 'info' CHECK(level IN ('debug','info','warn','error')),\n  data TEXT,                -- JSON payload\n  created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%f','now'))\n);\n-- Indexes: (agent_name, created_at), (run_id, created_at), (event_type, created_at), (tool_name, agent_name), level WHERE error\n```\n\n## Interface\n- insert(event): number — returns row id\n- correlateToolEnd(agentName, toolName): {startId, durationMs} | null — finds most recent unmatched tool_start, computes duration delta, updates row\n- getByAgent(agentName, opts?): StoredEvent[]\n- getByRun(runId, opts?): StoredEvent[]\n- getErrors(opts?): StoredEvent[] — filters level='error' or event_type IN ('error','escalation')\n- getTimeline(opts): StoredEvent[] — flexible query with agent/run/time filters\n- getToolStats(opts?): Array<{toolName, count, avgDurationMs, maxDurationMs}>\n- purge(opts): number\n- close(): void\n\n## Types to add to src/types.ts\nEventType, EventLevel, StoredEvent, EventStore interface\n\n## Patterns to follow\n- src/metrics/store.ts for SQLite setup (WAL mode, busy timeout, prepared statements)\n- src/mail/store.ts for schema migrations and interface shape\n\n## Tests (src/events/store.test.ts)\n- Insert and retrieve events\n- Tool duration correlation (start/end matching, handles missing starts)\n- Query by agent, run, event type, time range\n- Error filtering\n- Tool stats aggregation\n- Purge operations\n- Use :memory: SQLite for tests","closeReason":"Created src/events/store.ts with SQLite EventStore: insert, correlateToolEnd, getByAgent/Run/Errors/Timeline, getToolStats, purge. 48 tests pass.","closedAt":"2026-02-13T14:24:00.472321-08:00"}
{"id":"overstory-c8j2","title":"Merge agent branch back to canonical and verify result","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T12:57:43.152107-08:00","updatedAt":"2026-02-12T13:19:03.170916-08:00","assignee":"jayminwest@gmail.com","description":"After a slung agent completes work, run overstory merge --branch to merge its work back to main. Verify clean merge succeeds. This validates the final step of the e2e lifecycle.","closeReason":"Validated merge E2E: dry-run correctly detects agent/task/files, clean merge succeeds at tier 1. Tested with synthetic agent branch.","closedAt":"2026-02-12T13:19:03.170916-08:00"}
{"id":"overstory-cahb","title":"Register trace command in CLI router (src/index.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:21:25.97898-08:00","updatedAt":"2026-02-13T20:38:31.76157-08:00","assignee":"jayminwest@gmail.com","closeReason":"Registered trace in CLI router, wrote comprehensive tests","closedAt":"2026-02-13T20:38:31.76157-08:00"}
{"id":"overstory-cczf","title":"Beacon prompt does not trigger agent work without nudge","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T13:10:11.423194-08:00","updatedAt":"2026-02-12T13:17:14.472215-08:00","assignee":"jayminwest@gmail.com","description":"During E2E lifecycle validation, the structured beacon sent via tmux sendKeys was received by Claude Code but did not trigger the agent to start working. The agent sat idle showing the beacon text in the prompt area but not generating a response. Only after sending an explicit nudge via 'overstory nudge' did the agent begin processing. Root cause likely: tmux sendKeys multiline text handling or timing issue where Claude Code TUI hasn't fully initialized its input processing when the beacon arrives (2s sleep may be insufficient).","closeReason":"Same root cause as y2ob: multiline beacon prevented TUI submission. Fixed by flattening beacon and guarding sendKeys()","closedAt":"2026-02-12T13:17:14.472215-08:00"}
{"id":"overstory-cec9","title":"Fix logger.test.ts tool event ordering assertion","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T08:46:16.683787-08:00","updatedAt":"2026-02-13T08:55:07.566123-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.566123-08:00"}
{"id":"overstory-ck09","title":"Make scouts optional for well-contexted tasks in lead.md","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-21T06:26:40.832511-08:00","updatedAt":"2026-02-21T06:46:58.949691-08:00","assignee":"jayminwest@gmail.com","description":"Replace MUST with SHOULD language for scout spawning. Allow leads to skip scouts when: (a) mulch provides sufficient context, (b) dispatch mail includes concrete file paths and patterns, (c) task is narrowly scoped. Remove or downgrade SCOUT_SKIP failure mode from hard error to warning. Key lines: lead.md 65, 103, 216, 256. The current exception criteria (lines 99-108) are so narrow they effectively never apply to code tasks. Re-dispatched leads ignore don't-re-scout instructions because their built-in playbook overrides dispatch mail.","closeReason":"Merged via overstory/agent-def-builder/overstory-r9x0. Lead.md now has Task Complexity Assessment (simple/moderate/complex), optional scouts, conditional reviewers, and INSIGHT protocol removed.","closedAt":"2026-02-21T06:46:58.949691-08:00"}
{"id":"overstory-co8","title":"L2-6: Implement prime command (src/commands/prime.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:12:03.955578-08:00","updatedAt":"2026-02-12T07:33:09.627131-08:00","assignee":"jayminwest@gmail.com","description":"The overstory prime command for context loading. Called by SessionStart hook. Loads config, recent agent activity, mulch expertise. Supports --agent flag for per-agent priming and --compact flag for reduced context (PreCompact hook).","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.627131-08:00"}
{"id":"overstory-cz8","title":"sling accepts closed bead issues — should reject non-open issues","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T09:43:39.103379-08:00","updatedAt":"2026-02-12T09:51:02.726516-08:00","assignee":"jayminwest@gmail.com","description":"overstory sling overstory-2mi spawned an agent for a closed issue without warning. The sling command should validate that the bead issue status is 'open' or 'in_progress' before creating the worktree and tmux session. Currently it only checks that the issue exists (bd show succeeds) but not that it's in a workable state. The fix: after fetching the issue via bd show --json, check that the status is 'open' or 'in_progress', and reject closed/resolved issues.","closeReason":"sling now validates bead issue status after fetching. Only 'open' and 'in_progress' issues are accepted. Closed/resolved issues throw ValidationError with a clear message.","closedAt":"2026-02-12T09:51:02.726516-08:00"}
{"id":"overstory-d1cp","title":"Scout: explore multi-provider implementation files","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T05:59:56.171307-08:00","updatedAt":"2026-02-21T06:01:27.961601-08:00","assignee":"jayminwest@gmail.com","closeReason":"Explored multi-provider implementation: ProviderConfig types, resolveModel/resolveProviderEnv functions, config validation, and environment variable injection across all spawn commands. Full details in .overstory/specs/overstory-d1cp.md","closedAt":"2026-02-21T06:01:27.961601-08:00"}
{"id":"overstory-d1g8","title":"Enhance resolveModel() to return provider env vars","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:13:48.882824-08:00","updatedAt":"2026-02-20T07:46:21.609116-08:00","assignee":"jayminwest@gmail.com","description":"Update resolveModel() in src/agents/manifest.ts to resolve provider configuration and return env vars for tmux session injection.\n\nFILES: src/agents/manifest.ts, src/types.ts\n\nChanges:\n- Add ResolvedModel interface: { model: string; env?: Record<string, string> }\n- Update resolveModel() return type from ModelName to ResolvedModel\n- Resolution logic:\n  1. Resolve model string from config.models[role] > manifest.agents[role].model > fallback\n  2. If model is a simple alias (sonnet/opus/haiku): return { model: alias } (no extra env)\n  3. If model is provider-prefixed (e.g. 'openrouter/openai/gpt-5.3'):\n     a. Split on first '/' to get provider name ('openrouter') and model ID ('openai/gpt-5.3')\n     b. Look up provider in config.providers\n     c. Build env: ANTHROPIC_BASE_URL=provider.baseUrl, ANTHROPIC_AUTH_TOKEN from process.env[provider.authTokenEnv], ANTHROPIC_API_KEY='', ANTHROPIC_DEFAULT_{ALIAS}_MODEL=modelId\n     d. Return { model: alias-to-use, env: {...} }\n- Update VALID_MODELS set at line 29 and validation at lines 49-51 to allow arbitrary model strings in manifest\n- resolveModel() now takes config (with providers) as context for env resolution\n- Add resolveProviderEnv() helper function for building the env dict","closeReason":"Completed: Enhanced resolveModel() to return ResolvedModel { model, env? } with provider gateway support. Builder implemented ResolvedModel interface, resolveProviderEnv() helper, updated validation to accept ModelRef, updated 4 callers, added comprehensive tests. All changes merged to main.","closedAt":"2026-02-20T07:46:21.609116-08:00"}
{"id":"overstory-d3x","title":"tmux.test.ts: Document as legitimate mock exception","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T08:56:22.90369-08:00","updatedAt":"2026-02-12T08:59:49.498353-08:00","assignee":"jayminwest@gmail.com","description":"tmux.test.ts is the one test file where mocking is the correct approach — real tmux operations would interfere with the developer's session and are fragile in CI. Add a comment to the top of the test file documenting why mocks are used here (system-level side effects, CI incompatibility). Consider extracting the mockSpawnResult helper to the shared test harness since it may still be needed for tmux and claude CLI mocking.","closeReason":"Added block comment documenting tmux tests as legitimate mock exception; fixed stale import paths from file relocation","closedAt":"2026-02-12T08:59:49.498353-08:00"}
{"id":"overstory-d4bx","title":"clean.test.ts kills live tmux sessions during bun test (dogfood crash root cause)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T20:13:30.43115-08:00","updatedAt":"2026-02-13T20:23:10.98226-08:00","assignee":"jayminwest@gmail.com","description":"## Root Cause\n\nclean.test.ts runs cleanCommand(['--all']) with NO tmux mocks ('never mock what you can use for real'). This calls killAllTmuxSessions() which kills ALL tmux sessions prefixed 'overstory-' globally — not scoped to any project.\n\nDuring dogfooding (bun test run by a builder agent inside a live swarm), this kills:\n- overstory-coordinator\n- overstory-{lead-name}\n- overstory-{builder-name} (kills itself mid-loop)\n\n## Evidence\n- Observed live: coordinator and builder tmux sessions disappeared while builder was running 'bun test'\n- Lead survived because kill loop self-terminated when it killed the builder's own tmux\n- Sequential 34-second death window in previous crash matches killSession() SIGTERM→wait→SIGKILL per-session pattern\n- Only reproduces when dogfooding (running swarm on overstory's own repo) — external projects have no live tmux sessions during bun test\n\n## Fix Options\n1. Mock killAllTmuxSessions in clean.test.ts (simplest, matches tmux.test.ts pattern)\n2. Use fake session name prefix in tests (e.g. 'overstory-agent-fake' per mx-f1dccb convention)\n3. Scope killAllTmuxSessions to project by checking SessionStore before killing\n\n## Secondary Issue: Hook contamination\ndeployHooks() writes coordinator hooks to .claude/settings.local.json at project root. The ENV_GUARD only protects PreToolUse blocking hooks, NOT the logging/lifecycle hooks (SessionStart, UserPromptSubmit, PreToolUse logger, PostToolUse, Stop, PreCompact). This means ALL Claude Code sessions at the project root:\n- Log tool events as coordinator\n- Fire session-end marking coordinator 'completed' on every Stop\n- Run overstory prime/mail check as coordinator\n\nCode comment at coordinator.ts:117-119 incorrectly claims ENV_GUARD protects all hooks.","closeReason":"Fixed: killAllTmuxSessions now project-scoped via SessionStore lookup","closedAt":"2026-02-13T20:23:10.98226-08:00"}
{"id":"overstory-d5n","title":"Agent does not send completion mail to orchestrator","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T12:01:08.534464-08:00","updatedAt":"2026-02-12T12:23:52.87793-08:00","assignee":"jayminwest@gmail.com","description":"When a headless agent completes its task, it closes the bead but does not send a completion mail (--type result) back to the orchestrator. The overlay CLAUDE.md instructs the agent to do this, but the agent did not comply. This means the orchestrator has no mail-based signal that work is done - it must poll status or check worktree state.","closeReason":"Root cause (overstory-d9g mail DB silo) was already fixed. With interactive mode (overstory-37e), agents can now send/receive mail properly. Overlay instructions to send completion mail will be followed.","closedAt":"2026-02-12T12:23:52.87793-08:00"}
{"id":"overstory-d6ph","title":"Update hooks-deployer tests for removed stdin relay","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:41:37.853592-08:00","updatedAt":"2026-02-17T07:45:54.275275-08:00","assignee":"jayminwest@gmail.com","closeReason":"Updated three test assertions to verify stdin relay pattern removal. Tests correctly assert pattern is NOT present (lines 247, 262, 298). Lint and typecheck pass. Tests depend on overstory-nlnl template fix.","closedAt":"2026-02-17T07:45:54.275275-08:00"}
{"id":"overstory-d9d8","title":"Scope dashboard/status views to current run","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-17T07:31:46.313082-08:00","updatedAt":"2026-02-18T07:39:45.422507-08:00","assignee":"jayminwest@gmail.com","description":"The dashboard shows data from ALL sessions/runs ever created, not just the current one. Specifically: (1) Agent panel calls getAll() on sessions.db — shows every session ever. (2) Metrics panel calls getRecentSessions(100) and getAverageDuration() across ALL runs with no run scoping. (3) Mail panel shows last 5 messages from all time. (4) Merge queue shows all entries. Fix: Default dashboard/status views to current-run data (read run ID from current-run.txt, use sessionStore.getByRun() and filter metrics accordingly). Add --all flag for historical view.","closeReason":"Dashboard and status commands now scoped to current run by default. Added --all flag for historical view. Both builder branches merged.","closedAt":"2026-02-18T07:39:45.422507-08:00"}
{"id":"overstory-d9g","title":"CRITICAL: Mail DB is siloed per worktree - agents write to wrong mail.db","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T12:05:57.204117-08:00","updatedAt":"2026-02-12T12:18:32.607829-08:00","assignee":"jayminwest@gmail.com","description":"Each git worktree contains its own .overstory/ directory with a separate mail.db. When agents run 'overstory mail send' from their worktree, the mail is written to the worktree-local .overstory/mail.db instead of the canonical one. The orchestrator reads from the main .overstory/mail.db and never sees agent messages. Verified: mail-scout sent a detailed audit report (msg-tteblz285v8j) that is only in .overstory/worktrees/mail-scout/.overstory/mail.db. Similarly, mail FROM orchestrator TO agents (e.g., msg-45maqn4qfk29) is in the main mail.db but not in the worktree-local DBs. Fix: mail store should resolve to the canonical .overstory/mail.db path, not the worktree-relative one. Or use a shared absolute path.","closeReason":"Fixed resolveProjectRoot() to check git worktree FIRST before local .overstory/config.yaml check. Worktrees have tracked copies of config.yaml that caused the function to short-circuit and return the worktree path instead of the canonical root. Added regression test with committed config.yaml.","closedAt":"2026-02-12T12:18:32.607829-08:00"}
{"id":"overstory-da2","title":"sling --spec: spec file not accessible from agent worktree","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:30:32.763758-08:00","updatedAt":"2026-02-12T10:41:38.926898-08:00","assignee":"jayminwest@gmail.com","description":"The overlay CLAUDE.md references the spec file with a relative path (e.g., .overstory/specs/test-spec.md), but .overstory/ is gitignored so it does not exist in the agent's worktree. The agent cannot read its task spec. Fix options: (1) copy spec file to worktree during sling, (2) use absolute path in overlay, (3) symlink, or (4) embed spec content directly in the overlay.","closeReason":"Resolve spec path to absolute in sling.ts before passing to overlay config, so agents in worktrees can read the spec file from the main repo","closedAt":"2026-02-12T10:41:38.926898-08:00"}
{"id":"overstory-ddep","title":"Implement src/commands/logs.ts command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:04:46.563364-08:00","updatedAt":"2026-02-16T13:09:33.814026-08:00","assignee":"jayminwest@gmail.com","closeReason":"logs.ts command implemented with all filters, follow mode, JSON output","closedAt":"2026-02-16T13:09:33.814026-08:00"}
{"id":"overstory-dfc","title":"L5-6: Write mail-store.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:31.678813-08:00","updatedAt":"2026-02-12T07:47:43.361616-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/mail/store.ts. Cover: schema creation, message CRUD (insert/select/update), WAL mode enabled, concurrent read/write safety, index usage, thread_id grouping.","closeReason":"Wrote mail-store.test.ts with 17 tests covering CRUD, filtering, threading, and concurrent access","closedAt":"2026-02-12T07:47:43.361616-08:00"}
{"id":"overstory-dg4","title":"mail read on already-read message silently succeeds","status":"closed","type":"bug","priority":4,"createdAt":"2026-02-12T10:09:54.425626-08:00","updatedAt":"2026-02-12T10:14:44.881371-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory mail read <id>' on a message that is already marked as read outputs 'Marked <id> as read.' without indicating it was already read. While not harmful, it's misleading. Could either say 'Already read' or 'Marked as read (was already read)' for clarity.","closeReason":"mail read now returns { alreadyRead: boolean } and prints informational message when message was already read","closedAt":"2026-02-12T10:14:44.881371-08:00"}
{"id":"overstory-dh2","title":"Test depth limit","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T12:09:53.187085-08:00","updatedAt":"2026-02-12T12:10:07.133422-08:00","assignee":"jayminwest@gmail.com","description":"temp","closeReason":"temp test issues, closed after E2E validation","closedAt":"2026-02-12T12:10:07.133422-08:00"}
{"id":"overstory-divy","title":"Review: sling-domain-builder domain inference","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T13:23:35.495847-08:00","updatedAt":"2026-02-20T13:28:05.825968-08:00","assignee":"jayminwest@gmail.com","closeReason":"PASS: all three builder branches reviewed and verified","closedAt":"2026-02-20T13:28:05.825968-08:00"}
{"id":"overstory-dp7","title":"L4-2: Implement watchdog triage (src/watchdog/triage.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:14.924625-08:00","updatedAt":"2026-02-12T07:39:41.908478-08:00","assignee":"jayminwest@gmail.com","description":"Tier 2 AI-assisted failure classification. When daemon detects stalled agent, triage analyzes logs to determine: recoverable stall (retry), genuine failure (terminate + report), or expected long operation (extend timeout). Uses claude --print for classification.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.908478-08:00"}
{"id":"overstory-dp9p","title":"Implement mulch-informed lead decomposition: types, overlay, sling, lead.md","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:23:01.453443-08:00","updatedAt":"2026-02-13T22:28:20.580206-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented mulch-informed lead decomposition: mulchExpertise field in OverlayConfig, formatMulchExpertise() in overlay.ts, {{MULCH_EXPERTISE}} template placeholder, auto-fetch in sling.ts, lead.md Phase 1 workflow updated with mulch search + file-scoped priming. 50 overlay tests + 32 sling tests pass.","closedAt":"2026-02-13T22:28:20.580206-08:00"}
{"id":"overstory-dpk","title":" env var referenced in agent definitions but never set","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:22:12.116692-08:00","updatedAt":"2026-02-12T08:45:12.475531-08:00","assignee":"jayminwest@gmail.com","description":"All base agent definitions (scout.md, builder.md, lead.md, reviewer.md, merger.md) reference $OVERSTORY_AGENT_NAME for the agent to know its own name. However, the sling command never sets this environment variable in the tmux session. The hooks work because they use hardcoded agent names (via {{AGENT_NAME}} template substitution), but if an agent tries to use $OVERSTORY_AGENT_NAME in ad-hoc commands, it will be empty. Either set the env var in the tmux session or update the agent definitions to reference the overlay.","closeReason":"Closed","closedAt":"2026-02-12T08:45:12.475531-08:00"}
{"id":"overstory-dt9o","title":"Strengthen review-mandatory language in lead.md","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:01:19.932443-08:00","updatedAt":"2026-02-17T08:06:54.098567-08:00","assignee":"jayminwest@gmail.com","description":"Edit agents/lead.md to strengthen Phase 3 review requirement language and add cost awareness","closeReason":"Strengthened review-mandatory language in agents/lead.md with production data (2/98 reviews) and imperative phrasing. Phase 3 title now MANDATORY, step 12 uses MUST language, reviewer cost comparison added, REVIEW_SKIP failure mode enhanced, explicit reviewer coverage verification added to Completion Protocol, new constraint added. All acceptance criteria met.","closedAt":"2026-02-17T08:06:54.098567-08:00"}
{"id":"overstory-dvy","title":"temp test for spec validation","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T12:04:52.577478-08:00","updatedAt":"2026-02-12T12:10:07.091749-08:00","assignee":"jayminwest@gmail.com","description":"temp","closeReason":"temp test issues, closed after E2E validation","closedAt":"2026-02-12T12:10:07.091749-08:00"}
{"id":"overstory-dy0j","title":"Migrate supervisor.ts + test to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:56:45.562983-08:00","updatedAt":"2026-02-13T15:03:23.306603-08:00","assignee":"jayminwest@gmail.com","closeReason":"Migrated supervisor.ts to SessionStore: replaced sessions.json operations with SQLite store, removed loadSessions/saveSessions functions and tests, added store.close() in finally blocks. All quality gates passed.","closedAt":"2026-02-13T15:03:23.306603-08:00"}
{"id":"overstory-e1fp","title":"Add event subscription system","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:33.451509-08:00","updatedAt":"2026-02-15T17:16:51.778925-08:00","assignee":"jayminwest@gmail.com","description":"Agents subscribe to events (file changed, test suite passed, merge conflict detected). When an event fires, subscribed agents get auto-notified via mail. Currently agents only learn about the world when polled on UserPromptSubmit hook.","closeReason":"Closing along with blackboard system — not needed at this stage","closedAt":"2026-02-15T17:16:51.778925-08:00"}
{"id":"overstory-e1q2","title":"Fix unused merging status in MergeEntry","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-15T17:04:37.696942-08:00","updatedAt":"2026-02-16T18:28:15.339091-08:00","assignee":"jayminwest@gmail.com","description":"MergeEntry type has 'merging' status but the resolver never sets it (goes directly from 'pending' to 'merged'/'conflict'/'failed'). Either wire it up in the resolver or remove it from the type.","closeReason":"Merging status fix included in the merge resolver refactor.","closedAt":"2026-02-16T18:28:15.339091-08:00"}
{"id":"overstory-e3kd","title":"Fix typecheck: add providers to config fixtures and update resolveModel","status":"closed","type":"task","priority":1,"createdAt":"2026-02-19T12:37:40.343012-08:00","updatedAt":"2026-02-19T12:42:12.02714-08:00","assignee":"jayminwest@gmail.com","description":"Add providers field to 10 test fixtures and update resolveModel types in manifest.ts. Also replicate types.ts provider changes for branch coherence.","closeReason":"Added providers field to 10 test fixture files (manifest.test.ts + 9 doctor test files), updated resolveModel to use string type instead of local ModelName alias, replicated types.ts/config.ts provider types. All quality gates passed: 1911 tests, typecheck clean, lint clean on scoped files.","closedAt":"2026-02-19T12:42:12.02714-08:00"}
{"id":"overstory-e4jk","title":"Implement: replace mulch_learn mail with actual mulch record","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T17:30:29.129949-08:00","updatedAt":"2026-02-16T17:37:17.448762-08:00","assignee":"jayminwest@gmail.com","closeReason":"Replaced mulch_learn mail with actual mulch record in session-end handler. Extracted autoRecordExpertise function for testability. 4 new tests, 2 test renames. Quality gates pass.","closedAt":"2026-02-16T17:37:17.448762-08:00"}
{"id":"overstory-e4t","title":"Agent lastActivity timestamp never updates in headless mode","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T12:04:44.541702-08:00","updatedAt":"2026-02-12T12:23:51.498511-08:00","assignee":"jayminwest@gmail.com","description":"In status output, agent lastActivity shows the spawn time and never changes because tool-start/tool-end hooks do not fire in headless mode (claude -p). This makes it appear agents are idle when they are actually working. The status --verbose output shows stale timestamps.","closeReason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work.","closedAt":"2026-02-12T12:23:51.498511-08:00"}
{"id":"overstory-e5jb","title":"git push hook bypassed in interactive sessions","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-17T09:21:24.190522-08:00","updatedAt":"2026-02-18T07:57:12.253785-08:00","assignee":"jayminwest@gmail.com","description":"All PreToolUse hooks in .claude/settings.local.json start with ENV_GUARD ([ -z \"$OVERSTORY_AGENT_NAME\" ] && exit 0), so git push blocking only activates for spawned agents. Interactive Claude Code sessions have no agent name set, so the hook is a no-op and git push goes through unchecked. Need a separate hook entry without the env guard for universal git push blocking.","closeReason":"Universal hook guard added to templates/hooks.json.tmpl without ENV_GUARD prefix. Blocks the dangerous remote operation in both agent and interactive sessions. 7 test count assertions updated, env guard test patched, new verification test added. 1868 tests pass.","closedAt":"2026-02-18T07:57:12.253785-08:00"}
{"id":"overstory-e72","title":"agent-manifest.json capabilityIndex is always empty","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:15:59.653102-08:00","updatedAt":"2026-02-12T08:45:12.547374-08:00","assignee":"jayminwest@gmail.com","description":"After 'overstory init', the agent-manifest.json has 'capabilityIndex: {}'. The manifest defines agents with capabilities (e.g., builder has 'implement, refactor, fix') but the capabilityIndex is never populated. This index should map capabilities to agent names for lookup (e.g., {'implement': ['builder', 'lead'], 'explore': ['scout']}). Without it, capability-based agent selection requires iterating all agents.","closeReason":"Closed","closedAt":"2026-02-12T08:45:12.547374-08:00"}
{"id":"overstory-e7hf","title":"Conflict pattern learning for merge","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:51.101367-08:00","updatedAt":"2026-02-16T18:28:15.214329-08:00","assignee":"jayminwest@gmail.com","description":"Close the loop on recordConflictPattern(). Before attempting merge, query mulch for similar past conflicts. Use historical patterns to: skip tiers that historically fail for this file/pattern combo, inform AI-resolve prompts with past successful resolutions, predict which files are likely to conflict.","closeReason":"Conflict pattern learning for merge implemented. queryConflictHistory function, tier-skip logic based on failure rates, AI prompt enrichment with past resolutions. 38 tests pass.","closedAt":"2026-02-16T18:28:15.214329-08:00"}
{"id":"overstory-e86r","title":"Phase 4: Deep watchdog chain (multi-tier health monitoring)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T13:50:56.70583-08:00","updatedAt":"2026-02-13T07:03:46.728909-08:00","assignee":"jayminwest@gmail.com","description":"Evolve the current single-tier watchdog into a multi-tier health monitoring chain with autonomous recovery. Architecture: Tier 0 (Mechanical daemon) - Go/Bun process, heartbeat every 30-60s, checks tmux/pid liveness, spawns Tier 1 on anomaly. Tier 1 (Triage agent) - Ephemeral AI agent, fresh spawn each tick (no context debt), makes single decision: is intervention needed? Exits immediately. Tier 2 (Monitor agent) - Continuous patrol, long-running session, monitors all supervisors and workers, handles lifecycle requests (respawn, restart, cycle). Tier 3 (Supervisor monitors) - Per-project supervisors already monitor their own workers. Additional features: (1) Stale escalation auto-bump (severity increases over time if unacknowledged), (2) Progressive nudging before kill (warn → nudge → escalate → terminate), (3) Zombie detection and reconciliation every tick.","closeReason":"Phase 4 complete: Tier 0 (mechanical daemon with progressive nudging), Tier 1 (AI triage gated behind config), Tier 2 (monitor agent definition + command), Tier 3 (supervisor monitors existing). Added: progressive nudge stages (warn→nudge→escalate→terminate), stale escalation auto-bump, triage retry action, tier renaming with backward compat, 18 daemon integration tests, monitor.md agent definition, overstory monitor start/stop/status command.","closedAt":"2026-02-13T07:03:46.728909-08:00"}
{"id":"overstory-e9d3","title":"Add Run type and RunStore to sessions.db","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:20:50.337554-08:00","updatedAt":"2026-02-13T20:32:57.294862-08:00","assignee":"jayminwest@gmail.com","description":"Add Run type/RunStore interface to types.ts, implement runs table and RunStore in sessions/store.ts","closeReason":"Added Run type/RunStore interface to types.ts, implemented runs table and RunStore methods in sessions/store.ts with tests","closedAt":"2026-02-13T20:32:57.294862-08:00"}
{"id":"overstory-e9my","title":"Add dispatch-level overrides for scout/review phases","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T06:26:47.386241-08:00","updatedAt":"2026-02-21T06:26:47.386241-08:00","assignee":"jayminwest@gmail.com","description":"Let the coordinator/operator pass structured overrides in dispatch mail payload like skip_scouts:true, skip_review:true, or max_agents:N. Leads should check dispatch mail payload for these flags and respect them over their default playbook. This solves the postmortem finding where don't-re-scout instructions in mail body were ignored because they couldnt override the hardcoded playbook. Changes needed in: lead.md (honor payload flags), coordinator.md (document override options), possibly supervisor.md."}
{"id":"overstory-ebd","title":"No agent log directory created in headless mode","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T12:04:47.109507-08:00","updatedAt":"2026-02-12T12:23:51.519688-08:00","assignee":"jayminwest@gmail.com","description":"Agent log directories under .overstory/logs/{agent-name}/ are never created for headless agents because the 'overstory log' command (called by hooks) creates the directory, but hooks don't fire in 'claude -p' mode. Verified: after sling of mail-scout, merge-scout, and helptext-builder, no log directories exist for any of them.","closeReason":"Resolved by overstory-37e: switching to interactive mode means all hooks (SessionStart, UserPromptSubmit, PreToolUse, PostToolUse, Stop) now fire. Mail injection, metrics recording, lastActivity updates, and log directories all work.","closedAt":"2026-02-12T12:23:51.519688-08:00"}
{"id":"overstory-edbz","title":"Cherry-pick resolver conflict recording commits onto main","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:37:12.430871-08:00","updatedAt":"2026-02-13T22:41:03.870773-08:00","assignee":"jayminwest@gmail.com","description":"Cherry-pick commits c884e83 (mulch conflict pattern recording in resolver.ts/resolver.test.ts) and 971b58b (mulch record .mulch/expertise/typescript.jsonl) onto main. These are from overstory/conflict-recorder/overstory-typs.","closeReason":"Cherry-pick completed, merged to main","closedAt":"2026-02-13T22:41:03.870773-08:00"}
{"id":"overstory-eef1","title":"Write logger.test.ts for src/logging/logger.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:05:00.046146-08:00","updatedAt":"2026-02-13T09:18:50.221719-08:00","assignee":"jayminwest@gmail.com","closeReason":"wrote comprehensive logger.test.ts with 46 tests covering all Logger methods, output file formats, session.log key=value formatting, events.ndjson field completeness, errors.log structure with cause chains, secret redaction in all outputs, close() preventing writes across all event types, lazy directory creation, verbose mode, and error isolation","closedAt":"2026-02-13T09:18:50.221719-08:00"}
{"id":"overstory-eft1","title":"Dashboard mail query does full table scan with no SQL LIMIT","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-19T13:28:08.956578-08:00","updatedAt":"2026-02-20T07:52:23.206403-08:00","assignee":"jayminwest@gmail.com","description":"dashboard.ts:163 calls mailStore.getAll() which fetches the entire messages table, then slices to 5 in JS. With 40+ agents exchanging frequent mail, this table grows to thousands of rows. Fix: add a getRecent(n) method to MailStore using ORDER BY created_at DESC LIMIT n, or pass limit options to getAll().","closeReason":"Fixed dashboard mail query full table scan. Added limit option to MailStore.getAll() (SQL LIMIT clause). Dashboard now uses limit:5/50 instead of fetching all rows. Branch: overstory/dashboard-mail-builder/overstory-6r7j (commit 6ab923d). All quality gates pass.","closedAt":"2026-02-20T07:52:23.206403-08:00"}
{"id":"overstory-ekv","title":"init succeeds in non-git directory without warning","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:19:03.976557-08:00","updatedAt":"2026-02-12T08:29:23.535152-08:00","assignee":"jayminwest@gmail.com","description":"'overstory init' succeeds in a directory that is not a git repository. Since overstory depends entirely on git (worktrees, branches, merge), init should detect whether the directory is inside a git repo and either fail with a clear error or warn the user that git is required.","closeReason":"Added git repo check at start of init command. Throws ValidationError if not inside a git repository.","closedAt":"2026-02-12T08:29:23.535152-08:00"}
{"id":"overstory-el16","title":"Record merge conflict patterns in mulch","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:08:42.651498-08:00","updatedAt":"2026-02-13T22:41:00.667966-08:00","assignee":"jayminwest@gmail.com","description":"In src/merge/resolver.ts, after conflict resolution, record a pattern to the architecture domain with conflicting file paths, branch names, and resolution tier used. Tag with merge-conflict. Use --evidence-bead to link conflict patterns back to the bead that caused the merge. Over time this builds knowledge to help agents avoid conflicts.","closeReason":"Merge conflict patterns now recorded in mulch after tier 2-4 resolution. Fire-and-forget pattern, evidenceBead linking, 7 new tests.","closedAt":"2026-02-13T22:41:00.667966-08:00"}
{"id":"overstory-en4","title":"E2E test: builder agent concurrent test","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T10:24:05.31921-08:00","updatedAt":"2026-02-12T10:35:41.188861-08:00","assignee":"jayminwest@gmail.com","closeReason":"e2e test completed, builder agent concurrent test validated","closedAt":"2026-02-12T10:35:41.188861-08:00"}
{"id":"overstory-ep5m","title":"Implement session insight analyzer module","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T17:51:18.608903-08:00","updatedAt":"2026-02-16T18:00:41.522769-08:00","assignee":"jayminwest@gmail.com","description":"Create src/insights/analyzer.ts with pattern extraction from EventStore data, add types to types.ts, integrate into autoRecordExpertise in log.ts, and add tests","closeReason":"Implemented session insight analyzer: src/insights/analyzer.ts with pattern extraction from EventStore data, integrated into autoRecordExpertise in log.ts, types added to types.ts, all tests passing","closedAt":"2026-02-16T18:00:41.522769-08:00"}
{"id":"overstory-eqj0","title":"Hybrid enforcement: coordinator delegation must use overstory sling (structural + behavioral)","status":"closed","type":"epic","priority":1,"createdAt":"2026-02-13T06:21:01.394114-08:00","updatedAt":"2026-02-13T06:49:17.729163-08:00","assignee":"jayminwest@gmail.com","description":"Parent epic for the coordinator delegation enforcement problem. The coordinator agent uses Claude Code built-in Task tool instead of overstory sling, completely bypassing the overstory system (no worktrees, no mail, no groups, no specs). The fix requires a hybrid approach: (1) STRUCTURAL: Block Task/TeamCreate/SendMessage tools via PreToolUse hooks in hooks-deployer.ts for coordinator and supervisor capabilities (overstory-x6xm). (2) BEHAVIORAL: Update coordinator.md and supervisor.md with explicit prohibitions, a NATIVE_DELEGATION failure mode, and a workaround heuristic — if you are reaching for workarounds you should be delegating (overstory-q4nb). (3) OBSERVABILITY: Fix tool logging so we can detect this behavior from logs instead of requiring tmux capture (overstory-nq0y). Neither structural nor behavioral enforcement alone is sufficient (Gastown learned this too). The hybrid ensures the model cannot use Task even if it wants to, AND understands why it should use overstory sling instead.","closeReason":"All 3 subtasks complete: structural hook blocking (x6xm), behavioral agent def updates (q4nb), tool logging fix (nq0y). Remaining design concerns filed as separate issues.","closedAt":"2026-02-13T06:49:17.729163-08:00"}
{"id":"overstory-eu6y","title":"Write molecules.test.ts for src/beads/molecules.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:05:01.062301-08:00","updatedAt":"2026-02-13T09:32:05.321585-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.321585-08:00"}
{"id":"overstory-ewco","title":"Add --skip-scout / --phase flag for leads to skip scouting","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-21T06:32:13.43441-08:00","updatedAt":"2026-02-21T07:09:12.998982-08:00","assignee":"jayminwest@gmail.com","description":"Allow leads to be slung with a flag that skips the scout phase entirely, jumping straight to Build. Options: (a) --skip-scout flag on overstory sling that gets injected into the lead overlay, (b) --phase build to start at a specific phase, (c) pre-populated spec detection where leads check for existing specs and skip scouting automatically. This prevents the re-dispatch problem where Phase 2 leads ignore dispatch mail instructions to skip scouting because their built-in playbook overrides mail content.","closeReason":"Implemented --skip-scout flag: parsed in sling, passed to overlay via skipScout field, rendered as SKIP_SCOUT_SECTION in lead overlays.","closedAt":"2026-02-21T07:09:12.998982-08:00"}
{"id":"overstory-ewe","title":"L5-8: Write merge-queue.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:33.339278-08:00","updatedAt":"2026-02-12T07:54:20.509727-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/merge/queue.ts. Cover: FIFO ordering, enqueue/dequeue, status transitions (pending/merging/merged/conflict/failed), conflict detection between overlapping file sets.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.509727-08:00"}
{"id":"overstory-ez8j","title":"Update all merge queue consumers for SQLite migration","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:06:28.975074-08:00","updatedAt":"2026-02-16T07:36:53.363366-08:00","assignee":"jayminwest@gmail.com","closeReason":"All 11 consumer files updated from merge-queue.json to merge-queue.db. Tests pass. Two minor lint fixes needed on main.","closedAt":"2026-02-16T07:36:53.363366-08:00"}
{"id":"overstory-ezh6","title":"Build tracker module (src/tracker/*)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T15:47:23.571955-08:00","updatedAt":"2026-02-23T15:58:02.148684-08:00","assignee":"jayminwest@gmail.com","description":"Create all src/tracker/ files: types.ts, beads.ts, seeds.ts, index.ts, templates-beads.ts, templates-seeds.ts, templates.ts, plus tests (index.test.ts, beads.test.ts, seeds.test.ts)","closeReason":"Implemented src/tracker/ module with TaskTrackerClient interface for both beads and seeds backends. 39 tests pass, quality gates clean.","closedAt":"2026-02-23T15:58:02.148684-08:00"}
{"id":"overstory-f0kl","title":"Mulch enhancements for structured pattern storage","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:05:01.395564-08:00","updatedAt":"2026-02-16T13:12:21.119968-08:00","assignee":"jayminwest@gmail.com","description":"Project-agnostic mulch improvements to support the learning flywheel: (1) structured pattern records with success/failure metadata, (2) better search/query for 'find patterns matching this file type and task type', (3) pattern scoring/weighting so frequently-confirmed patterns rank higher. These should be general mulch capabilities, not Overstory-specific.","closeReason":"Scoped: mulch is an external CLI tool. The requested enhancements (structured pattern records with success/failure metadata, pattern scoring/weighting, advanced search) require changes in the mulch-cli repo, not in overstory. The overstory mulch client (src/mulch/client.ts) already wraps all available mulch CLI features including record (with types, classification, tags, evidence), search (with domain/type/tag filters), learn, compact, and diff. No changes needed on overstory's side until mulch-cli adds these features. Filed as external work.","closedAt":"2026-02-16T13:12:21.119968-08:00"}
{"id":"overstory-fe19","title":"Review: mulch-client-builder search+record changes","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T13:23:35.335152-08:00","updatedAt":"2026-02-20T13:28:05.824975-08:00","assignee":"jayminwest@gmail.com","closeReason":"PASS: all three builder branches reviewed and verified","closedAt":"2026-02-20T13:28:05.824975-08:00"}
{"id":"overstory-ff2s","title":"Agent worktree missing biome/tsc on PATH","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T13:10:08.254508-08:00","updatedAt":"2026-02-12T13:20:03.174148-08:00","assignee":"jayminwest@gmail.com","description":"When a builder agent runs 'biome check .' or 'tsc --noEmit' directly in a worktree, the commands are not found (exit code 127). The agent must use 'bun run lint' and 'bun run typecheck' instead. Either: (1) update the builder agent definition to use bun run scripts, (2) add node_modules/.bin to PATH in the tmux session, or (3) update the overlay quality gates section to use the correct commands.","closeReason":"Updated all agent definitions (builder, merger, lead, reviewer) and overlay.ts to use bun run lint and bun run typecheck instead of direct biome/tsc calls","closedAt":"2026-02-12T13:20:03.174148-08:00"}
{"id":"overstory-fjme","title":"Update CLAUDE.md to document all 24 commands","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T17:04:21.926337-08:00","updatedAt":"2026-02-15T17:12:59.643569-08:00","assignee":"jayminwest@gmail.com","description":"CLAUDE.md CLI reference only documents ~15 commands but 24 exist. Missing: dashboard, inspect, coordinator, supervisor, hooks, spec, group, trace, errors, replay, run, costs, clean, doctor, nudge. Also missing sessions/, events/, doctor/ from directory structure section.","closeReason":"Updated CLAUDE.md: documented all 24 commands (was ~15), added sessions/events/doctor subsystems to directory tree, added 4 SQLite databases to target project structure, added 8 agent definitions (was 6)","closedAt":"2026-02-15T17:12:59.643569-08:00"}
{"id":"overstory-fles","title":"Add discoverOrchestratorTranscript to transcript.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-19T12:52:41.401532-08:00","updatedAt":"2026-02-19T12:55:57.888032-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added discoverOrchestratorTranscript to src/metrics/transcript.ts. Scans ~/.claude/projects/{project-key}/ for most recent JSONL. 5 tests added, all passing. Quality gates clean.","closedAt":"2026-02-19T12:55:57.888032-08:00"}
{"id":"overstory-fnar","title":"Add mulch diff PostToolUse hook to agent template","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T13:17:21.60208-08:00","updatedAt":"2026-02-20T13:24:05.871593-08:00","assignee":"jayminwest@gmail.com","description":"Add a PostToolUse Bash hook to templates/hooks.json.tmpl that detects git commit and runs mulch diff HEAD~1","closeReason":"Added PostToolUse Bash hook to templates/hooks.json.tmpl: uses ENV_GUARD, reads stdin, greps for git commit, runs mulch diff HEAD~1 silently. Always exits 0.","closedAt":"2026-02-20T13:24:05.871593-08:00"}
{"id":"overstory-fp1z","title":"Hooks must live in .overstory/, not project root .claude/","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T07:26:50.037672-08:00","updatedAt":"2026-02-13T09:26:17.868504-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nCoordinator and hooks-deployer write Claude Code hooks to `.claude/settings.local.json` at the **project root**. This has two critical consequences:\n\n1. **Breaks project-agnosticism**: Overstory is supposed to work in ANY repo. Writing to `.claude/` at root makes it only work inside its own repo — the target project's `.claude/` gets polluted with overstory-specific hook config.\n\n2. **ENV_GUARD was a band-aid, not a fix**: The ig8t fix added `[ -z \"$OVERSTORY_AGENT_NAME\" ]` guards so hooks don't fire for non-overstory sessions, but the hooks are still physically present in the project's `.claude/settings.local.json`, which is wrong.\n\n## Root Cause\n\n- `src/agents/hooks-deployer.ts` writes hooks to `<projectRoot>/.claude/settings.local.json`\n- The coordinator has no worktree (it runs at project root), so it deploys hooks directly to root `.claude/`\n- Slinged agents correctly get hooks in their worktree, but the coordinator does not\n\n## Required Fix\n\nAll overstory hooks config must live inside `.overstory/`, NOT in `.claude/`. Possible approaches:\n- (a) Coordinator gets its own worktree (isolates its `.claude/` entirely)\n- (b) Hooks go in `.overstory/hooks.json` and a thin shim in `.claude/` just delegates\n- (c) Claude Code supports reading hooks from a custom path (unlikely upstream change)\n- (d) Coordinator skips hook deployment entirely; only slinged agents (which have worktrees) get hooks\n\nThe chosen solution MUST ensure that running `overstory init` + `overstory coordinator start` in someone else's repo does NOT modify their `.claude/` directory.","closeReason":"Removed deployHooks() from coordinator start. Added 'overstory hooks install/uninstall/status' command for explicit orchestrator hook management. Hooks source of truth is .overstory/hooks.json. Cleaned up .claude/settings.local.json to contain only orchestrator hooks (no capability guards, no ENV_GUARD).","closedAt":"2026-02-13T09:26:17.868504-08:00"}
{"id":"overstory-fsgf","title":"Add run scoping to gatherStatus() and --all flag to status command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-18T07:15:24.139573-08:00","updatedAt":"2026-02-18T07:19:13.372019-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added run scoping to gatherStatus() via optional runId param, --all flag to statusCommand(), currentRunId field to StatusData, run display in printStatus(), updated help text. 13 tests passing.","closedAt":"2026-02-18T07:19:13.372019-08:00"}
{"id":"overstory-fsh","title":"L5-10: Write overlay.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:35.132065-08:00","updatedAt":"2026-02-12T07:54:20.530193-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/agents/overlay.ts. Cover: template rendering with all variables (BEAD_ID, AGENT_NAME, SPEC_PATH, BRANCH_NAME, FILE_SCOPE, etc.), writeOverlay creates .claude/CLAUDE.md in worktree, missing template handling.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.530193-08:00"}
{"id":"overstory-ftq2","title":"Fix dashboard/status run-scoping to include null-runId sessions (coordinator)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-20T07:26:23.760979-08:00","updatedAt":"2026-02-20T07:33:09.154071-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed: coordinator (null runId) now visible in run-scoped status and dashboard. status.ts includes null-runId sessions via supplemental filter; dashboard.ts uses exported filterAgentsByRun() helper. Tests added.","closedAt":"2026-02-20T07:33:09.154071-08:00"}
{"id":"overstory-fvur","title":"Wire logs command into index.ts and completions.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:04:47.63928-08:00","updatedAt":"2026-02-16T13:16:04.778042-08:00","assignee":"jayminwest@gmail.com","closeReason":"index.ts and completions.ts wired for logs command","closedAt":"2026-02-16T13:16:04.778042-08:00"}
{"id":"overstory-fxrx","title":"Wire feed command into index.ts and completions.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:46:21.042015-08:00","updatedAt":"2026-02-16T13:58:25.446963-08:00","assignee":"jayminwest@gmail.com","closeReason":"Wired feed command into src/index.ts (import, COMMANDS, HELP, switch case) and src/commands/completions.ts (COMMANDS array with all flags, bash completion string)","closedAt":"2026-02-16T13:58:25.446963-08:00"}
{"id":"overstory-fynf","title":"Build: Add --monitor flag to coordinator start/stop/status","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:11:21.416119-08:00","updatedAt":"2026-02-16T13:18:46.889965-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added --monitor flag to coordinator start/stop/status following the --watchdog pattern. 78 tests passing.","closedAt":"2026-02-16T13:18:46.889965-08:00"}
{"id":"overstory-fz0","title":"merge-queue.json: missing trailing newline in JSON write","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T10:09:29.940528-08:00","updatedAt":"2026-02-12T10:14:00.644204-08:00","assignee":"jayminwest@gmail.com","description":"src/merge/queue.ts line 64 writes JSON with writeFileSync without appending a trailing newline. This causes biome check to fail on merge-queue.json. Convention per mx-24764f requires all JSON written via Bun.write to include trailing newline. Fix: change writeFileSync call to append \\n to the JSON.stringify output.","closeReason":"Fixed: writeQueue now appends trailing newline to JSON.stringify output per convention mx-24764f","closedAt":"2026-02-12T10:14:00.644204-08:00"}
{"id":"overstory-g0al","title":"Implement provider and model validation in validateConfig()","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T07:26:45.134202-08:00","updatedAt":"2026-02-20T07:31:33.016681-08:00","assignee":"jayminwest@gmail.com","description":"Update validateConfig() in config.ts and add tests in config.test.ts for provider validation and extended model refs","closeReason":"Added provider validation (type, gateway baseUrl+authTokenEnv) and replaced hardcoded model list with provider-prefixed ref support + stderr warning for tool-heavy roles. 9 new tests, all quality gates pass.","closedAt":"2026-02-20T07:31:33.016681-08:00"}
{"id":"overstory-g2za","title":"Add debounced mail polling to PostToolUse hook for mid-task message delivery","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T22:45:04.621179-08:00","updatedAt":"2026-02-15T13:01:42.340825-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nAgents only poll for mail via the UserPromptSubmit hook. Short-running agents (builders, cherry-pick specialists) often complete their entire task in a single work cycle — one prompt to Claude that triggers a chain of tool calls. They never submit a second prompt, so UserPromptSubmit never fires after boot. Any message sent by the orchestrator mid-task (corrections, additional instructions) is silently dropped.\n\n### Evidence from run-2026-02-14T05-51-12-265Z\n\nThree orchestrator→agent messages were sent but never read:\n- cherry-pick-lead: 'Cherry-pick commit 1a271f0' (dispatch, 06:33:32) — NEVER READ\n- cherry-pick-lead: 'ALSO cherry-pick c884e83 and 971b58b' (status, 06:34:33) — NEVER READ  \n- resolver-pick-lead: 'Cherry-pick 2 commits' (dispatch, 06:37:32) — NEVER READ\n\nThe cherry-pick-lead completed its original task and exited in ~110s. The orchestrator sent the 'ALSO cherry-pick' message 66 seconds in, but the agent never polled again. Result: conflict-recorder branch changes were never merged to main.\n\nThe pending-nudge marker system doesn't help either — it writes a file, but that file is only read on the next mail check --inject, which only runs on UserPromptSubmit.\n\n## Design\n\nAdd debounced mail polling to the PostToolUse hook. PostToolUse fires after every tool call, so even single-cycle agents will check mail between tool executions.\n\n### Changes required:\n\n**1. Add --debounce flag to 'overstory mail check' (src/commands/mail.ts)**\n- New flag: --debounce <ms> (default: 0 = no debounce)\n- Track last-check timestamp per agent in .overstory/agents/{name}/last-mail-check\n- If --debounce is set and less than <ms> has elapsed since last check, exit immediately with no output (no DB query, no file I/O beyond a single stat())\n- If debounce has expired (or no timestamp file exists), proceed with normal mail check and update timestamp\n\n**2. Add mail check to PostToolUse hook template (templates/hooks.json.tmpl)**\n- Add a second hook entry to the PostToolUse array (after the existing tool-end logger):\n  overstory mail check --inject --agent {{AGENT_NAME}} --debounce 30000\n- This means agents check for mail at most every 30 seconds between tool calls\n- The --inject flag outputs to stdout which Claude Code hooks surface to the agent's context\n\n**3. Update hooks-deployer.ts (src/agents/hooks-deployer.ts)**\n- No code changes needed if the template change above is sufficient\n- The deployer already reads and deploys the template as-is\n\n**4. Rebuild and test**\n- Add tests to mail.test.ts for debounce behavior: skip when within window, check when expired, check when no timestamp file\n- Update hooks-deployer.test.ts if needed for the new PostToolUse entry\n- Verify the timestamp file path is gitignored\n\n### Why PostToolUse + debounce (not other approaches):\n- PreToolUse would add latency before every tool execution\n- A background daemon adds complexity and a new process to manage\n- tmux sendkeys was already tried and abandoned (corrupts tool I/O — see pending-nudge marker system)\n- PostToolUse + 30s debounce adds ~1ms overhead (a stat() call) per tool and full mail check at most every 30s\n- Uses existing hook and mail infrastructure, no new subsystems","closeReason":"Implemented debounced mail polling in PostToolUse hook. Two builder branches ready for merge: hooks-template-builder (correct template + deployer tests) and debounce-fix-builder (mail.ts debounce logic + tests). All quality gates passed.","closedAt":"2026-02-15T13:01:42.340825-08:00"}
{"id":"overstory-g3ym","title":"Cost-per-bead breakdown in overstory costs","status":"open","type":"feature","priority":3,"createdAt":"2026-02-19T12:08:34.363539-08:00","updatedAt":"2026-02-19T12:08:34.363539-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nThere's no way to answer 'how much did task X cost?' across all agents that worked on it. Since multiple agents can work on the same bead (scout, builder, reviewer), and the metrics.db sessions table is keyed by `(agent_name, bead_id)`, the data is there but no query surface exists.\n\n## Desired Behavior\n\n```bash\noverstory costs --bead overstory-ye8f\n```\n\nShould show all agent sessions that worked on that bead with their individual costs, plus a total. This would let users understand which tasks are expensive and optimize their decomposition strategy.\n\n## Implementation\n\n- `src/metrics/store.ts` — Add `getSessionsByBead(beadId)` method (simple WHERE bead_id = ? query)\n- `src/commands/costs.ts` — Add --bead flag, call new method, render with existing table formatting\n- Help text update\n\nLow effort since the data already exists in the right shape — just needs a query path and CLI flag."}
{"id":"overstory-g8iw","title":"Investigate smolvm-sdk for agent auto-containerization","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-13T11:50:14.467625-08:00","updatedAt":"2026-02-13T22:16:14.595352-08:00","assignee":"jayminwest@gmail.com","description":"Stretch goal: Research using the smolvm-node SDK (https://github.com/smol-machines/smolvm-sdk/tree/main/smolvm-node) to automatically containerize agents in lightweight VMs instead of running them in git worktrees on the host. Benefits: (1) true isolation between agents, (2) agents can't accidentally modify host state, (3) resource limits per agent, (4) clean teardown. Investigate: SDK maturity, macOS support, startup latency, filesystem sharing for git repos, network access for API calls, compatibility with tmux-based session management. This would be a significant architecture change - evaluate feasibility before committing.","closeReason":"Research complete: smolvm is 2 weeks old, alpha, no npm package, critical filesystem bugs, no TTY support. Not viable. Instead, integrating Claude Code's built-in Seatbelt sandbox (sandbox-runtime) as opt-out default in overstory config.","closedAt":"2026-02-13T22:16:14.595352-08:00"}
{"id":"overstory-ga4z","title":"Fix watchdog nudge to be phase-aware in checkRunCompletion","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:22:28.100624-08:00","updatedAt":"2026-02-19T12:26:40.739763-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added exported buildCompletionMessage() helper with phase-aware completion messages based on worker capabilities. Updated checkRunCompletion to use it. Added capabilities/phase to run_complete event data. 50 tests pass.","closedAt":"2026-02-19T12:26:40.739763-08:00"}
{"id":"overstory-gago","title":"Write mulch client tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:05.352147-08:00","updatedAt":"2026-02-13T09:32:05.326634-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.326634-08:00"}
{"id":"overstory-gaio","title":"Coordinator needs prompting to delegate scouting tasks","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T11:49:56.661642-08:00","updatedAt":"2026-02-13T12:35:10.616846-08:00","assignee":"jayminwest@gmail.com","description":"During e2e testing, the coordinator agent does not proactively delegate scouting work to scout agents without being reminded. Investigate using Claude Code's --system-prompt-file flag to inject stronger orchestration instructions into the coordinator's system prompt at spawn time. The coordinator overlay CLAUDE.md may not be sufficient to drive delegation behavior - a system prompt override could ensure the coordinator always checks for available scouts and delegates exploration tasks before attempting them itself.","closeReason":"Coordinator now gets agents/coordinator.md injected via --append-system-prompt at spawn time. Beacon also strengthened with explicit DELEGATION instruction to spawn leads for exploration.","closedAt":"2026-02-13T12:35:10.616846-08:00"}
{"id":"overstory-ggbi","title":"Implement overstory costs command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:09:49.131544-08:00","updatedAt":"2026-02-13T20:58:16.30155-08:00","assignee":"jayminwest@gmail.com","description":"Create src/commands/costs.ts — token usage and cost analysis.\n\n## Usage\n```\noverstory costs [--agent <name>] [--run <id>] [--by-capability] [--json]\n```\n\n## Behavior\nQuery metrics.db for token data and display cost breakdowns by agent, capability, and model.\n\n## Output Format (human)\n```\nCost Summary\n\nTotal:  $4.23 (5 agents, 12m 34s)\n\nBy agent:\n  builder-auth-1    $1.23  (15K in, 3K out, 100K cache-read)\n  builder-db-2      $1.56  (18K in, 4K out, 120K cache-read)\n  lead-tests-1      $0.89  (10K in, 2K out, 80K cache-read)\n\nBy capability:\n  builder    $2.79  (avg $1.40/agent)\n  lead       $0.89\n  reviewer   $0.34\n\nModel breakdown:\n  claude-opus-4-6          3 agents  $3.68\n  claude-sonnet-4-5  2 agents  $0.55\n```\n\n## Flags\n- --agent: filter to specific agent\n- --run: filter to specific run (requires SessionStore to map run→agents)\n- --by-capability: group by capability type\n- --json: structured output with all breakdowns\n\n## Implementation\n- Query existing MetricsStore for token data\n- Use SessionStore for run→agent mapping when --run is passed\n- Token formatting: >1M shown as '1.2M', otherwise comma-separated (follow existing pattern in metrics/summary.ts)\n- Cost estimation uses existing pricing in metrics/transcript.ts\n- This is an enhanced version of the existing 'overstory metrics' — more filters, more groupings\n\n## Tests (src/commands/costs.test.ts)\n- Total cost calculation\n- Per-agent breakdown\n- Per-capability grouping\n- Model breakdown\n- --run filter via session mapping\n- --json output\n- No data shows clean message","closeReason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","closedAt":"2026-02-13T20:58:16.30155-08:00"}
{"id":"overstory-gh1d","title":"Doctor: merge queue validation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:48.954477-08:00","updatedAt":"2026-02-15T12:48:10.818428-08:00","assignee":"jayminwest@gmail.com","description":"Validate merge-queue.json for correctness and staleness.\n\nChecks:\n- JSON parses without error (or file doesn't exist yet, which is fine)\n- Each entry has required fields: branchName, beadId, agentName, filesModified, enqueuedAt, status, resolvedTier\n- Status values in {pending, merging, merged, conflict, failed}\n- Tier values in {clean-merge, auto-resolve, ai-resolve, reimagine} or null\n- enqueuedAt is valid ISO timestamp, not in future\n- No duplicate branch names in queue\n- For each entry: branch exists in git ('git branch --list <name>')\n- For 'merging' entries: check if actually stalled (no recent activity, no active merge process)\n- For 'merged' entries: verify branch is actually merged into canonical branch\n- For 'conflict' entries: verify files still have conflict markers\n- Detect branches that were manually merged outside the queue\n\nSource references:\n- src/merge/queue.ts — queue shape, status/tier enums, FIFO semantics\n- src/merge/resolver.ts — tier ordering, conflict detection patterns\n\nOutput: pass/warn/fail. Malformed JSON = fail. Stale entries = warn. Stuck 'merging' = warn with remediation.","closeReason":"Implemented database health and merge queue validation checks with comprehensive test coverage","closedAt":"2026-02-15T12:48:10.818428-08:00"}
{"id":"overstory-ghnu","title":"Quality gates are hardcoded to bun/biome/tsc — must be configurable in config.yaml","status":"closed","type":"bug","priority":0,"createdAt":"2026-02-23T11:00:05.601089-08:00","updatedAt":"2026-02-23T11:31:09.856859-08:00","assignee":"jayminwest@gmail.com","description":"overlay.ts:99-101 hardcodes 'bun test', 'bun run lint', 'bun run typecheck' for every builder agent. formatQualityGates() accepts no config input. Agent base defs (agents/builder.md, agents/reviewer.md) also reference bun commands directly. This makes overstory unusable for non-TypeScript projects without manual template surgery. Fix: add a project.qualityGates array to config.yaml schema (types.ts), read it in overlay.ts formatQualityGates(), and fall back to current defaults if unset.","closeReason":"Quality gates are now configurable via project.qualityGates in config.yaml. Non-TS projects can specify custom test/lint/typecheck commands. Falls back to bun/biome/tsc defaults when unset. Builder branch: overstory/quality-gates-builder/overstory-2sz3.","closedAt":"2026-02-23T11:31:09.856859-08:00"}
{"id":"overstory-giqq","title":"Fix doctor.test.ts: 9 tests fail even in isolation","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T14:06:14.848651-08:00","updatedAt":"2026-02-15T14:15:31.073801-08:00","assignee":"jayminwest@gmail.com","description":"doctorCommand tests fail in isolation (not just in full suite). Tests expect empty check arrays when empty stubs are passed, but real checks execute. 9 of 19 tests fail. Root cause: check runner stubs are not being respected — doctor command runs real dependency/config checks instead of using injected stubs. Fix: ensure doctorCommand properly uses injected checkRunners and skips real checks when stubs are provided.","closeReason":"DI fix merged. All 19 doctor tests pass.","closedAt":"2026-02-15T14:15:31.073801-08:00"}
{"id":"overstory-givh","title":"Mandatory review loop: builder → reviewer → merge-ready","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-16T08:05:52.42613-08:00","updatedAt":"2026-02-16T13:12:59.717182-08:00","assignee":"jayminwest@gmail.com","description":"Update lead.md workflow to spawn a reviewer agent after each builder completes, creating a quality feedback loop. Builder completes → lead spawns reviewer on same branch → PASS triggers merge_ready → FAIL sends feedback for revision cycle. This is the biggest missing feedback loop in the swarm.","closeReason":"Mandatory review loop implemented in agents/lead.md. Phase 3 now requires reviewer spawning after each builder completes, with PASS/FAIL feedback loop (3 revision cap), REVIEW_SKIP failure mode, and review-verified completion constraints.","closedAt":"2026-02-16T13:12:59.717182-08:00"}
{"id":"overstory-gktc","title":"Add deduplication checks to prevent duplicate leads per bead","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T06:26:52.526392-08:00","updatedAt":"2026-02-21T06:26:52.526392-08:00","assignee":"jayminwest@gmail.com","description":"Prevent spawning a lead for a bead ID that already has an active lead. In the postmortem, Phase 1 and Phase 2 leads ran simultaneously on the same bead IDs with no deduplication. Add a check in sling.ts: before spawning a lead for a bead, verify no other active session (state != completed/zombie) is already assigned to that bead. Emit a warning or error. File: src/commands/sling.ts, around the bead validation section (lines 380-398)."}
{"id":"overstory-goqp","title":"Add --self flag to overstory costs command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-19T12:52:42.437092-08:00","updatedAt":"2026-02-19T13:05:04.234319-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added --self flag to overstory costs: discovers and parses orchestrator transcript JSONL, displays token usage and cost estimate. Text and JSON output modes. Graceful error when no transcript found. 5 new tests, all quality gates pass.","closedAt":"2026-02-19T13:05:04.234319-08:00"}
{"id":"overstory-gp2b","title":"Fix overstory merge to support --into flag instead of always targeting main","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-17T06:11:28.862317-08:00","updatedAt":"2026-02-17T06:16:57.29262-08:00","assignee":"jayminwest@gmail.com","description":"overstory merge unconditionally checks out config.project.canonicalBranch (default: main) and merges there, ignoring the user's active branch. No --into flag exists. This silently contaminated main with 36 unrelated commits in a real session. Fix: add --into <branch> flag to merge command, pass it through to resolver.resolve() which already accepts target as a parameter. Files: src/commands/merge.ts (parse flag, update help), src/merge/resolver.ts (already parameterized). Update tests in merge.test.ts and resolver.test.ts. See GitHub issue #4.","closeReason":"Added --into flag to overstory merge command. Flag overrides config.project.canonicalBranch as merge target. Resolver was already parameterized. Added 3 tests for --into with --branch, --into with --all, and default fallback.","closedAt":"2026-02-17T06:16:57.29262-08:00"}
{"id":"overstory-gqlo","title":"Integrate health state machine with dashboard TUI","status":"open","type":"task","priority":3,"createdAt":"2026-02-15T17:04:40.944148-08:00","updatedAt":"2026-02-15T17:04:40.944148-08:00","assignee":"jayminwest@gmail.com","description":"Connect watchdog health states (booting→working→stalled→zombie) to the dashboard TUI. Currently dashboard shows status but not the health state machine transitions in real-time."}
{"id":"overstory-gr3","title":"L1-4: Implement tmux session manager (src/worktree/tmux.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:37.64304-08:00","updatedAt":"2026-02-12T07:25:37.447979-08:00","assignee":"jayminwest@gmail.com","description":"Tmux session management via Bun.spawn(['tmux', ...]). Session naming: overstory-{agentName}. Functions: createSession, listSessions, killSession, isSessionAlive, sendKeys.","closeReason":"Implemented tmux session manager — createSession, listSessions, killSession, isSessionAlive, sendKeys via Bun.spawn","closedAt":"2026-02-12T07:25:37.447979-08:00"}
{"id":"overstory-gst","title":"L0-2: Define shared types in src/types.ts","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:09.615167-08:00","updatedAt":"2026-02-12T07:18:57.541223-08:00","assignee":"jayminwest@gmail.com","description":"All shared interfaces: OverstoryConfig, AgentManifest, AgentDefinition, AgentSession, AgentIdentity, MailMessage, OverlayConfig, MergeEntry, MergeResult, HealthCheck, LogEvent, SessionMetrics. Strict TypeScript, no any.","closeReason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)","closedAt":"2026-02-12T07:18:57.541223-08:00"}
{"id":"overstory-gtj","title":"L1-8: Implement mail SQLite store (src/mail/store.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:55.353422-08:00","updatedAt":"2026-02-12T07:26:01.474216-08:00","assignee":"jayminwest@gmail.com","description":"SQLite mail storage via bun:sqlite. Schema: messages table with id, from_agent, to_agent, subject, body, type, priority, thread_id, read, created_at. WAL mode + busy_timeout=5000. Indexes on inbox (to_agent, read) and thread_id. CRUD operations.","closeReason":"Implemented metrics storage (SQLite store + summary reporter) and mail SQLite store (schema, CRUD, WAL mode, prepared statements)","closedAt":"2026-02-12T07:26:01.474216-08:00"}
{"id":"overstory-gv2i","title":"Fix test isolation: tmux/nudge tests fail in full suite but pass individually","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T13:38:33.817339-08:00","updatedAt":"2026-02-15T14:39:31.951702-08:00","assignee":"jayminwest@gmail.com","description":"24 tests across tmux.test.ts and nudge.test.ts pass when run individually (bun test src/worktree/tmux.test.ts) but fail in the full suite (bun test). This is a test isolation issue, likely mock.module() leakage across test files (see mulch record mx-56558b). Failing tests: createSession (8), listSessions (4), isProcessAlive (1), killProcessTree (1), killSession (4), isSessionAlive (2), nudgeAgent (4). Fix: investigate which test file runs before these and leaks mocks; refactor to avoid mock.module() or ensure proper cleanup.","closeReason":"All 33 test failures resolved. 1603/1603 pass.","closedAt":"2026-02-15T14:39:31.951702-08:00"}
{"id":"overstory-gvw","title":"L2-4: Implement mail client (src/mail/client.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:11:54.498358-08:00","updatedAt":"2026-02-12T07:33:09.58236-08:00","assignee":"jayminwest@gmail.com","description":"Mail client over SQLite store. Interface: send(msg) -> id, check(agentName) -> MailMessage[], checkInject(agentName) -> string (hook format), list(filters) -> MailMessage[], markRead(id), reply(id, body) -> id. Synchronous by design (bun:sqlite is sync, ~1-5ms).","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.58236-08:00"}
{"id":"overstory-gz4u","title":"Implement overstory replay CLI command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T20:44:45.216383-08:00","updatedAt":"2026-02-13T20:58:11.202289-08:00","assignee":"jayminwest@gmail.com","description":"Interleaved chronological replay across multiple agents. Query events.db, show all agents' events in chronological order with agent labels. Support --run, --agent (repeatable), --since, --until, --limit, --json flags. Without --run, default to most recent run or last 24h. Follow trace.ts patterns.","closeReason":"Implemented and tested in commit 35531bc","closedAt":"2026-02-13T20:58:11.202289-08:00"}
{"id":"overstory-h4kt","title":"Bug: overstory group create fails — bd show --json returns array, not object","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T14:38:08.150643-08:00","updatedAt":"2026-02-13T06:41:33.788323-08:00","assignee":"jayminwest@gmail.com","description":"In src/commands/group.ts line 87, getIssueStatus() does JSON.parse(stdout) as { status?: string } but bd show --json returns an array [{ status: ... }]. Should be parsed as array and index [0]. This causes all validateIssueExists calls to fail with 'not found in beads'.","closeReason":"Already fixed in current code — group.ts line 88 already parses bd show --json output as array and indexes [0]","closedAt":"2026-02-13T06:41:33.788323-08:00"}
{"id":"overstory-h8wt","title":"Write tests for worktree command (src/commands/worktree.test.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:04:37.931111-08:00","updatedAt":"2026-02-13T09:32:05.332019-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.332019-08:00"}
{"id":"overstory-h8yi","title":"Cherry-pick fixed logger.test.ts onto lead-tests-3 branch","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:36:08.279136-08:00","updatedAt":"2026-02-13T08:41:55.105934-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed logger.test.ts copied to builder-final-merge branch for merge","closedAt":"2026-02-13T08:41:55.105934-08:00"}
{"id":"overstory-hah","title":"merge command resolves merge-queue.json path inside worktree instead of project root","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T08:18:07.628623-08:00","updatedAt":"2026-02-12T08:29:56.95078-08:00","assignee":"jayminwest@gmail.com","description":"'overstory merge --branch <name>' fails with 'Failed to write merge queue at ...worktree/.overstory/merge-queue.json'. The merge command is resolving the .overstory/ path relative to the worktree directory instead of the actual project root. Worktrees don't have their own .overstory/ directory. The merge queue file should be written to the main project's .overstory/merge-queue.json.","closeReason":"Closed","closedAt":"2026-02-12T08:29:56.95078-08:00"}
{"id":"overstory-hc35","title":"Implement src/commands/feed.ts and tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:46:19.894934-08:00","updatedAt":"2026-02-16T13:53:40.45214-08:00","assignee":"jayminwest@gmail.com","closeReason":"Feed command implementation and tests complete — 362 lines of command code, 578 lines of tests covering help, arg parsing, JSON output, agent filtering, run filtering, limit, since, event types, edge cases","closedAt":"2026-02-16T13:53:40.45214-08:00"}
{"id":"overstory-hc6w","title":"Graceful degradation for optional dependencies (beads, mulch)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T12:57:51.8062-08:00","updatedAt":"2026-02-12T13:02:57.232271-08:00","assignee":"jayminwest@gmail.com","description":"When bd CLI isn't installed or beads isn't initialized, sling should still work (skip bead validation/claiming). When mulch isn't installed, agents shouldn't fail on mulch prime. The hooks reference overstory by name - needs to be globally available or hooks need a fallback path. Currently the system hard-fails if any optional dependency is missing.","closeReason":"Removed from plan - too large a scope change, getting ahead of ourselves. Focus on e2e validation first.","closedAt":"2026-02-12T13:02:57.232271-08:00"}
{"id":"overstory-hcia","title":"Fix mulch learn in log.ts: add mail sending, PERSISTENT guard, HEAD~1","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T12:35:54.724872-08:00","updatedAt":"2026-02-15T12:41:55.372556-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed mulch learn extraction in log.ts: uses HEAD~1, PERSISTENT_CAPABILITIES guard, mail sending via createMailClient, proper imports. 2 tests. Committed 7130595.","closedAt":"2026-02-15T12:41:55.372556-08:00"}
{"id":"overstory-hcud","title":"Write summary.test.ts for src/metrics/summary.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:20:20.673184-08:00","updatedAt":"2026-02-13T08:26:53.505681-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created summary.test.ts with 11 tests","closedAt":"2026-02-13T08:26:53.505681-08:00"}
{"id":"overstory-hfus","title":"Create smart tool argument filter","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T13:08:10.256971-08:00","updatedAt":"2026-02-13T14:24:00.316655-08:00","assignee":"jayminwest@gmail.com","description":"Create src/events/tool-filter.ts — filters tool arguments for storage, keeping useful data while discarding noise.\n\n## Interface\n```typescript\ninterface FilteredToolArgs {\n  args: Record<string, unknown>;  // JSON-serializable filtered args\n  summary: string;                // Human-readable one-line summary\n}\n\nfunction filterToolArgs(toolName: string, toolInput: Record<string, unknown>): FilteredToolArgs;\n```\n\n## Per-Tool Filtering Rules (Smart Defaults)\n- **Bash**: Keep command, description. Drop timeout, run_in_background, dangerouslyDisableSandbox.\n  Summary: `bash: <first 80 chars of command>`\n- **Read**: Keep file_path, offset, limit. Drop content from response.\n  Summary: `read: <file_path> (lines X-Y)` or `read: <file_path>`\n- **Write**: Keep file_path. Drop content (too large).\n  Summary: `write: <file_path>`\n- **Edit**: Keep file_path. Drop old_string, new_string (too large).\n  Summary: `edit: <file_path>`\n- **Glob**: Keep pattern, path (small payload, keep all).\n  Summary: `glob: <pattern> in <path>`\n- **Grep**: Keep pattern, path, glob, output_mode. Drop result content.\n  Summary: `grep: \"<pattern>\" in <path>`\n- **WebFetch**: Keep url. Drop prompt, response.\n  Summary: `fetch: <url>`\n- **WebSearch**: Keep query. Drop response.\n  Summary: `search: <query>`\n- **Task**: Keep description, subagent_type. Drop prompt (too large).\n  Summary: `task: <description> (<subagent_type>)`\n- **Unknown tools**: Keep tool_name only, empty args.\n  Summary: `<tool_name>`\n\n## Design Principle\nLog what you'd want to know during post-mortem. Skip content bodies that bloat the DB. A filtered event row should be ~200 bytes, not ~20KB.\n\n## Tests (src/events/tool-filter.test.ts)\n- Each tool type: correct fields kept/dropped\n- Summary string generation and truncation\n- Unknown tool fallback\n- Empty/null/missing input handling\n- Pure functions, no mocks needed","closeReason":"Created src/events/tool-filter.ts with per-tool filtering for 9 tool types. 36 tests pass.","closedAt":"2026-02-13T14:24:00.316655-08:00"}
{"id":"overstory-hgc4","title":"Update lead.md: add SCOUT_SKIP failure mode, strengthen scout-first language, rebalance cost guidance","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:38:46.198028-08:00","updatedAt":"2026-02-17T07:51:34.611515-08:00","assignee":"jayminwest@gmail.com","closeReason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning.","closedAt":"2026-02-17T07:51:34.611515-08:00"}
{"id":"overstory-hjmp","title":"Doctor: SQLite database health checks","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:25.998295-08:00","updatedAt":"2026-02-15T12:48:10.817261-08:00","assignee":"jayminwest@gmail.com","description":"Verify integrity of all 4 SQLite databases: mail.db, sessions.db, metrics.db, events.db.\n\nFor each database:\n- File exists and is accessible (open without error)\n- WAL mode enabled: PRAGMA journal_mode returns 'wal'\n- Busy timeout configured: PRAGMA busy_timeout returns >= 5000\n- Schema correct: expected tables and columns exist\n- PRAGMA integrity_check returns 'ok'\n- No stale WAL files (suggest checkpoint if WAL is large)\n\nDatabase-specific checks:\n- mail.db: messages table with CHECK constraints, valid message types (15 types from MAIL_MESSAGE_TYPES), payload JSON parseable, thread_id integrity\n- sessions.db: sessions table with valid states {booting, working, completed, stalled, zombie}, runs table exists, no duplicate agent_name entries\n- metrics.db: sessions table with token columns (migration applied), no negative durations, completedAt >= startedAt\n- events.db: verify table structure, check for excessive size\n\nSource references:\n- src/mail/store.ts — schema, migration, CHECK constraints\n- src/sessions/store.ts — schema, state enum, runs table\n- src/metrics/store.ts — schema, token column migration\n- src/events/ — event store schema\n\nOutput: pass/warn/fail per database. Inaccessible or corrupt = critical. Missing columns/migration needed = warn with auto-fix suggestion.","closeReason":"Implemented database health and merge queue validation checks with comprehensive test coverage","closedAt":"2026-02-15T12:48:10.817261-08:00"}
{"id":"overstory-hr2b","title":"Add INSIGHT recording guidance to supervisor.md and lead.md Expertise sections","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T17:34:28.770039-08:00","updatedAt":"2026-02-16T17:37:37.446604-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added INSIGHT recording bullet to supervisor.md and lead.md expertise sections. Parent agents now instructed to record INSIGHT: items from read-only worker result mails.","closedAt":"2026-02-16T17:37:37.446604-08:00"}
{"id":"overstory-hrzi","title":"Fix biome formatting in mail.test.ts and merge-queue.test.ts","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-16T07:41:51.685295-08:00","updatedAt":"2026-02-16T07:43:27.651648-08:00","assignee":"jayminwest@gmail.com","description":"Run 'bunx biome check --write src/commands/mail.test.ts src/doctor/merge-queue.test.ts' to auto-fix formatting (multi-line arrays to single-line) and import organization (sort bun:sqlite before bun:test). Then commit the changes.","closeReason":"Fixed biome lint and formatting issues across all three files","closedAt":"2026-02-16T07:43:27.651648-08:00"}
{"id":"overstory-htnk","title":"Remove dead INSIGHT: mail protocol from agent definitions","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T13:09:42.442162-08:00","updatedAt":"2026-02-21T06:46:58.951179-08:00","assignee":"jayminwest@gmail.com","description":"The INSIGHT: prefix protocol in agent definitions is dead — zero agents across 123 sessions have ever used it. Scouts have never been spawned. Reviewers who discover reusable patterns just mulch record directly. Remove INSIGHT: protocol from agents/scout.md, agents/reviewer.md, agents/lead.md, agents/supervisor.md. Simplify the definitions. If we want insight flow from read-only agents, it should be via mulch record (which reviewers already do) not a mail convention nobody follows.","closeReason":"Merged via overstory/agent-def-builder/overstory-r9x0. Lead.md now has Task Complexity Assessment (simple/moderate/complex), optional scouts, conditional reviewers, and INSIGHT protocol removed.","closedAt":"2026-02-21T06:46:58.951179-08:00"}
{"id":"overstory-hy7a","title":"Scope killAllTmuxSessions to current project via SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T20:19:06.674008-08:00","updatedAt":"2026-02-13T20:23:10.830038-08:00","assignee":"jayminwest@gmail.com","description":"killAllTmuxSessions() in clean.ts currently kills ALL tmux sessions with 'overstory-' prefix globally. Even after adding project name to session names, add a defense-in-depth check: only kill sessions that are registered in this project's SessionStore.\n\nCurrent code (clean.ts:128-129):\n  const sessions = await listSessions();\n  const overStorySessions = sessions.filter(s => s.name.startsWith('overstory-'));\n\nFix: filter by project-specific prefix AND cross-reference with SessionStore entries.\n\nThis is the immediate fix for overstory-d4bx (the dogfood crash root cause). The session naming change (sibling issue) is the structural fix.","closeReason":"Implemented via loadRegisteredTmuxNames() — pcef is a separate future enhancement","closedAt":"2026-02-13T20:23:10.830038-08:00"}
{"id":"overstory-i1kt","title":"Add debounced mail check to PostToolUse hook template","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T12:17:35.259174-08:00","updatedAt":"2026-02-15T13:01:16.313779-08:00","assignee":"jayminwest@gmail.com","closeReason":"Completed: PostToolUse hook with separate entry and --debounce 30000","closedAt":"2026-02-15T13:01:16.313779-08:00"}
{"id":"overstory-i1v4","title":"Auto-insight capture on task completion","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:48.314452-08:00","updatedAt":"2026-02-16T18:01:19.968196-08:00","assignee":"jayminwest@gmail.com","description":"When agents complete tasks, auto-analyze what worked and record structured patterns to mulch. The 'log session-end' command already records to mulch; deepen this to capture patterns (what approach worked, what files were tricky, what tools were most useful) not just events.","closeReason":"Auto-insight capture implemented. New src/insights/analyzer.ts module with analyzeSessionInsights(). 21 tests in analyzer.test.ts, 38 tests in log.test.ts. Captures tool usage patterns, file complexity, and approach strategies.","closedAt":"2026-02-16T18:01:19.968196-08:00"}
{"id":"overstory-i375","title":"Write metrics store + summary tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:03.197784-08:00","updatedAt":"2026-02-13T08:08:39.403282-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created comprehensive test suites for metrics store and summary modules. 33 tests total covering all CRUD operations, aggregations, formatting, and edge cases. All quality gates passed.","closedAt":"2026-02-13T08:08:39.403282-08:00"}
{"id":"overstory-i3wv","title":"Phase 4: Self-Improvement Flywheel (Mulch Learning)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:44.803783-08:00","updatedAt":"2026-02-16T17:48:37.057295-08:00","assignee":"jayminwest@gmail.com","description":"Build a learning system where agents do work, insights get auto-captured to mulch, and future agents are primed with relevant insights. The flywheel: work → insights → smarter agents → better work → more insights. Mulch changes should stay project-agnostic (mulch is a separate tool), adding general-purpose capabilities that happen to benefit Overstory.","closeReason":"Phase 4 flywheel complete. Just shipped the mulch insight loop: builder/lead/merger record insights via mulch record, scout/reviewer flow INSIGHT: prefix through mail to parents, session-end handler auto-records via autoRecordExpertise(), and mulch prime injects all insights at session start. The cycle: work -> mulch record -> mulch prime -> smarter agents -> better work.","closedAt":"2026-02-16T17:48:37.057295-08:00"}
{"id":"overstory-i4xb","title":"Write monitor.test.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:05:26.751556-08:00","updatedAt":"2026-02-13T09:32:05.329985-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.329985-08:00"}
{"id":"overstory-i8v9","title":"Implement shell completion generation for overstory CLI","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:07:23.638917-08:00","updatedAt":"2026-02-16T07:17:02.663453-08:00","assignee":"jayminwest@gmail.com","closeReason":"Shell completion generation implemented: completions.ts with COMMANDS array (26 commands), generateBash/generateZsh/generateFish generators, completionsCommand entry point. Full test coverage (26 tests). Integrated into index.ts via --completions flag.","closedAt":"2026-02-16T07:17:02.663453-08:00"}
{"id":"overstory-i9be","title":"Add sandbox config section to types.ts and config.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:22:27.651045-08:00","updatedAt":"2026-02-15T12:32:07.47584-08:00","assignee":"jayminwest@gmail.com","description":"Add SandboxConfig interface to types.ts: { enabled: boolean (default true), allowedDomains: string[] (default ['api.anthropic.com', 'github.com']), denyReadPaths: string[] (default ['~/.ssh', '~/.aws']) }. Add sandbox field to OverstoryConfig. Add defaults in DEFAULT_CONFIG in config.ts. Add validation in validateConfig(). This is the foundation — other tasks depend on this.","closeReason":"Sandbox integration complete - all code + tests implemented and passing","closedAt":"2026-02-15T12:32:07.47584-08:00"}
{"id":"overstory-iaae","title":"Auto-nudge coordinator when lead transitions to completed state","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T20:02:39.711412-08:00","updatedAt":"2026-02-13T20:22:49.80413-08:00","assignee":"jayminwest@gmail.com","description":"When a lead agent's session ends and transitionToCompleted() fires (log.ts:90-103), the coordinator should be automatically nudged so it can process merge_ready / worker_done messages without waiting for user input.\n\nCurrently leads send merge_ready mail (in AUTO_NUDGE_TYPES, mail.ts:19-27) which writes a pending-nudge marker to .overstory/pending-nudges/coordinator.json — but this marker only gets read when the coordinator's UserPromptSubmit hook fires, requiring the user to manually type something.\n\nProposed: In the session-end handler (log.ts case 'session-end'), after transitionToCompleted() succeeds, if the agent's capability is 'lead', write a pending-nudge marker for the coordinator (or call overstory nudge coordinator). This closes the loop so the coordinator wakes up when leads finish.\n\nKey references:\n- transitionToCompleted(): src/commands/log.ts:90-103\n- AUTO_NUDGE_TYPES: src/commands/mail.ts:19-27\n- PendingNudge markers: src/commands/mail.ts:110-144\n- AgentState type: src/types.ts:79\n- SessionStore.updateState(): src/sessions/store.ts:254\n- Lead def: .overstory/agent-defs/lead.md (merge_ready protocol)","closeReason":"Fixed in this session","closedAt":"2026-02-13T20:22:49.80413-08:00"}
{"id":"overstory-ib5q","title":"Improve sendKeys error to distinguish server-not-running from session-not-found","status":"closed","type":"task","priority":2,"createdAt":"2026-02-18T16:46:45.380495-08:00","updatedAt":"2026-02-18T16:50:04.379124-08:00","assignee":"jayminwest@gmail.com","description":"In tmux.ts sendKeys(), parse stderr to distinguish tmux server not running from session not found and emit distinct error messages","closeReason":"sendKeys() now distinguishes no-server-running from session-not-found errors with targeted messages mentioning root/UID 0 causes and agent crash. 3 new tests added, all 43 pass.","closedAt":"2026-02-18T16:50:04.379124-08:00"}
{"id":"overstory-ig4m","title":"Refactor dashboard to hold DB connections open across poll ticks","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T08:17:46.994483-08:00","updatedAt":"2026-02-20T08:24:08.943324-08:00","assignee":"jayminwest@gmail.com","closeReason":"Dashboard DB connection pooling: openDashboardStores/closeDashboardStores, loadDashboardData takes pre-opened stores, getCachedWorktrees/getCachedTmuxSessions exported. All quality gates pass.","closedAt":"2026-02-20T08:24:08.943324-08:00"}
{"id":"overstory-ig8t","title":"Coordinator hooks pollute project root settings.local.json","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T06:50:30.817645-08:00","updatedAt":"2026-02-13T07:10:36.975222-08:00","assignee":"jayminwest@gmail.com","description":"overstory coordinator start deploys hooks to project root .claude/settings.local.json, which affects ALL Claude Code sessions in the project, not just the coordinator. Slinged agents get hooks in their worktree (isolated), but the coordinator has no worktree. Options: (a) coordinator gets its own worktree, (b) hooks scope by OVERSTORY_AGENT_NAME env var, (c) coordinator skips hook deployment.","closeReason":"Fixed: ENV_GUARD prefix on all hook commands (ig8t), runtime eval patterns in DANGEROUS_BASH_PATTERNS (lhva)","closedAt":"2026-02-13T07:10:36.975222-08:00"}
{"id":"overstory-ii1o","title":"Auto-nudge sends tmux keys during tool execution causing tool interruption","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T15:33:19.387487-08:00","updatedAt":"2026-02-13T19:07:43.361266-08:00","assignee":"jayminwest@gmail.com","description":"When auto-nudge fires (via mail send for urgent/high priority or protocol types like worker_done), it calls sendKeys() which blindly sends tmux keystrokes to the agent's pane. If Claude Code is currently executing a bash tool, the injected text corrupts the tool's I/O, causing Claude Code to SIGKILL the subprocess (exit code 137) and report 'Request interrupted by user for tool use'. There is no synchronization between the nudge system and Claude Code's tool execution lifecycle. Fix: either (1) check tool execution state before nudging, (2) queue nudges for delivery between tool executions, or (3) use a different injection mechanism that doesn't interfere with running tools.","closeReason":"Replaced auto-nudge tmux sendKeys with pending-nudge marker files. Messages now surface via mail check --inject on next prompt cycle. Manual nudge preserved.","closedAt":"2026-02-13T19:07:43.361266-08:00"}
{"id":"overstory-in3q","title":"End-to-end test on throwaway external project","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T12:57:50.261869-08:00","updatedAt":"2026-02-12T13:31:02.605315-08:00","assignee":"jayminwest@gmail.com","description":"Create a temp git repo, run overstory init, sling an agent, verify the full init->sling->work->merge lifecycle works in a project that is NOT the overstory repo itself. This proves the project-agnostic promise. Depends on init deploying agent defs being fixed first.","closeReason":"E2E init-sling lifecycle test validates full init->config->manifest->overlay pipeline on a throwaway external project. 6 tests, zero mocks.","closedAt":"2026-02-12T13:31:02.605315-08:00"}
{"id":"overstory-inxu","title":"Merger agent trigger for non-trivial conflicts","status":"open","type":"feature","priority":3,"createdAt":"2026-02-16T08:06:00.918285-08:00","updatedAt":"2026-02-16T08:06:00.918285-08:00","assignee":"jayminwest@gmail.com","description":"Use overstory merge --dry-run to detect conflicts before merging. If conflicts are detected (would need Tier 3+), spawn a merger agent with full LLM context instead of relying on the programmatic resolver's one-shot claude --print approach. The merger agent can reason about intent across both branches."}
{"id":"overstory-ip89","title":"Add provider types and config defaults","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:22:52.122011-08:00","updatedAt":"2026-02-19T12:33:11.780897-08:00","assignee":"jayminwest@gmail.com","description":"Add ProviderConfig, ModelAlias, ModelRef to types.ts; add providers to OverstoryConfig; add providers default to config.ts; add tests","closeReason":"Added ModelAlias, ModelRef, ProviderConfig types to types.ts. Added providers field to OverstoryConfig and DEFAULT_CONFIG. Updated models field to use ModelRef. Added config.test.ts tests for providers. Tests pass (1896/1896), lint clean. Typecheck fails on 11 out-of-scope files (10 test fixtures missing providers field, manifest.ts:290 needs as-cast). Parent notified via mail for scope expansion.","closedAt":"2026-02-19T12:33:11.780897-08:00"}
{"id":"overstory-iwlg","title":"Fix merge queue SQLite migration: update all consumers to use merge-queue.db","status":"closed","type":"bug","priority":0,"createdAt":"2026-02-16T07:16:27.850704-08:00","updatedAt":"2026-02-16T07:33:58.46221-08:00","assignee":"jayminwest@gmail.com","description":"The SQLite migration (commit 7c6b208) changed queue.ts to use SQLite but left all consumers referencing merge-queue.json as a JSON file path. Now createMergeQueue() tries to open the JSON file as SQLite, causing 'file is not a database' error. All merges are blocked. Consumers to update: src/commands/merge.ts, src/commands/dashboard.ts, src/commands/status.ts, src/commands/clean.ts, src/commands/init.ts, src/doctor/merge-queue.ts (and all their test files). Change path from merge-queue.json to merge-queue.db. Delete old merge-queue.json. Update doctor checks from JSON validation to SQLite validation.","closeReason":"Merged: all branches clean-merged to main","closedAt":"2026-02-16T07:33:58.46221-08:00"}
{"id":"overstory-ixpu","title":"Orchestrator not nudged when lead sends merge_ready/worker_done — mail is pull-only","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T13:06:09.534874-08:00","updatedAt":"2026-02-13T14:37:18.884457-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nWhen lead-steelman completed its task and sent merge_ready + worker_done mail to the orchestrator, nothing happened. The orchestrator was never triggered to:\n1. Read the merge_ready message\n2. Commit the work in the builder's worktree (builder couldn't commit, lead couldn't commit, so work sat uncommitted)\n3. Run overstory merge\n4. Tear down the lead and builder agents\n\nThe messages were only surfaced when the USER manually typed a prompt, which triggered the UserPromptSubmit hook (overstory mail check --inject). This means the entire orchestration pipeline stalls at the merge step until a human intervenes.\n\n## Root Cause\n\nMail delivery to the orchestrator is entirely pull-based:\n- UserPromptSubmit hook fires overstory mail check --inject\n- This only triggers when the USER submits a prompt\n- There is no push mechanism for agents to wake the orchestrator\n\nThe orchestrator (user's Claude Code session) sits idle between user messages. When an agent completes work and sends mail, that mail sits in the SQLite DB until the next UserPromptSubmit hook fires.\n\n## Evidence from latest run\n\nTimeline:\n- 21:00:27 — lead dispatches builder-steelman-2\n- 21:04:24 — lead sends merge_ready to orchestrator\n- 21:04:48 — lead sends worker_done to orchestrator\n- ??? — orchestrator does nothing until user types a message minutes later\n- lead-steelman tmux session still alive even after worker_done\n\n## Possible Solutions\n\n1. **Polling loop in orchestrator**: After dispatching work, the orchestrator should enter a polling loop (overstory mail check + overstory status) at regular intervals, not just on user prompt.\n\n2. **tmux nudge from agent to orchestrator**: When an agent sends a high-priority message (merge_ready, worker_done, error), also send a tmux send-keys nudge to the orchestrator session to trigger it to check mail.\n\n3. **Watchdog escalation**: The Tier 0 watchdog could detect completed agents and nudge the orchestrator.\n\n4. **PostToolUse hook on agent side**: After an agent sends worker_done mail, a hook could trigger a nudge to the orchestrator's tmux session.\n\nOption 2 (tmux nudge) is probably the most direct — it mirrors how the orchestrator nudges stalled agents but in reverse.\n\n## Impact\n\nWithout this fix, every agent run requires human babysitting at the merge step, which defeats the purpose of autonomous orchestration.","closeReason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","closedAt":"2026-02-13T14:37:18.884457-08:00"}
{"id":"overstory-iy8","title":"Improve process cleanup with descendant tree walking","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T12:13:09.593077-08:00","updatedAt":"2026-02-12T13:11:16.107872-08:00","assignee":"jayminwest@gmail.com","description":"Current killSession() just runs tmux kill-session. New: walk process descendant tree via pane_pid, send SIGTERM to all descendants (deepest first), wait 2s grace period, send SIGKILL to survivors, then kill tmux session. Ensures all child processes (git, bun test, biome, etc.) are properly cleaned up. Follow gastown's KillSessionWithProcesses pattern which handles reparented processes (PPID=1) and process groups.","closeReason":"Implemented descendant tree walking for process cleanup: getPanePid(), getDescendantPids(), isProcessAlive(), killProcessTree(), and updated killSession() to walk process trees before killing tmux. Tests pass.","closedAt":"2026-02-12T13:11:16.107872-08:00"}
{"id":"overstory-iycz","title":"Implement overstory inspect command for real-time agent inspection","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-13T19:55:59.564543-08:00","updatedAt":"2026-02-16T07:02:09.382524-08:00","assignee":"jayminwest@gmail.com","description":"New CLI command: overstory inspect <agent-name> [--follow]. Aggregates EventStore (recent tool calls with args/durations), SessionStore (state, lastActivity, beadId), MetricsStore (token usage if available), and tmux capture-pane (live terminal output) into a single per-agent detail view. Must: (1) show agent current state + time since last activity, (2) list recent tool calls with summaries from EventStore, (3) show current file being edited (extract from most recent Edit/Write/Read tool event), (4) show token usage from metrics.db or live transcript parsing, (5) optionally capture live tmux pane output. Register command in index.ts. Add --json flag for programmatic consumption. Acceptance: running overstory inspect <name> on an active agent shows its live activity.","closeReason":"Inspect command implemented (commit db84991 v0.4.0)","closedAt":"2026-02-16T07:02:09.382524-08:00"}
{"id":"overstory-j1c","title":"L0-8: Write agents/reviewer.md base definition","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:31.656197-08:00","updatedAt":"2026-02-12T07:20:05.123949-08:00","assignee":"jayminwest@gmail.com","description":"Reviewer agent: read-only validation agent. Can read files, run tests and lint. Cannot write files. Reviews code for correctness, style, security issues.","closeReason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)","closedAt":"2026-02-12T07:20:05.123949-08:00"}
{"id":"overstory-j3x","title":"worktree clean --all fails on worktrees with untracked files","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:14:02.576868-08:00","updatedAt":"2026-02-12T08:29:25.004703-08:00","assignee":"jayminwest@gmail.com","description":"'overstory worktree clean --all' fails to remove worktrees that have modified/untracked files because it doesn't pass --force to git worktree remove. The error is 'contains modified or untracked files, use --force to delete it'. Since --all is an explicit user request to force-remove everything, it should pass --force to git. Note that the settings.local.json and .claude/CLAUDE.md written by hooks-deployer are 'untracked' files in the worktree, so this will always fail for agent worktrees.","closeReason":"Added force option to removeWorktree and passed it from clean --all to handle untracked files.","closedAt":"2026-02-12T08:29:25.004703-08:00"}
{"id":"overstory-j46a","title":"overstory coordinator start: auto-attach to spawned tmux session","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T14:31:17.964209-08:00","updatedAt":"2026-02-13T06:37:08.687526-08:00","assignee":"jayminwest@gmail.com","description":"When running 'overstory coordinator start' from an interactive terminal, auto-attach to the tmux session after spawning it. Currently the command spawns the coordinator in a detached tmux session and returns, requiring the user to manually 'tmux attach -t overstory-coordinator'. Add a --attach flag (default on when interactive TTY detected, off when piped/scripted) that attaches to the session after startup completes.","closeReason":"Added --attach/--no-attach flags to overstory coordinator start. Auto-attaches to tmux when run from interactive TTY. resolveAttach() exported for testing with comprehensive test coverage.","closedAt":"2026-02-13T06:37:08.687526-08:00"}
{"id":"overstory-j4j9","title":"Fix molecules.test.ts Bun.spawn mock leak","status":"closed","type":"bug","priority":0,"createdAt":"2026-02-13T08:38:41.867635-08:00","updatedAt":"2026-02-13T08:42:32.912503-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed Bun.spawn mock leak: added afterEach to restore original Bun.spawn","closedAt":"2026-02-13T08:42:32.912503-08:00"}
{"id":"overstory-j53z","title":"Expand MulchClient: new commands (diff, learn, prune, doctor, ready, compact) and new flags (prime --files/--exclude-domain, record --stdin/--evidence-bead)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:08:34.78013-08:00","updatedAt":"2026-02-13T22:20:12.445309-08:00","assignee":"jayminwest@gmail.com","description":"src/mulch/client.ts only wraps prime, status, record, query, search. Expand it in two ways:\n\n1. New command wrappers: diff, learn, prune, doctor, ready, compact. All should use --json for structured output parsing. Add corresponding result types to src/types.ts.\n\n2. New flags on existing methods:\n   - prime(): add files?: string[] (--files) and excludeDomains?: string[] (--exclude-domain) parameters\n   - record(): add stdin?: boolean (--stdin) and evidenceBead?: string (--evidence-bead) parameters\n\nThis is the foundation for O1, O2, O3, O5, and all beads-mulch cross-linking.","closeReason":"MulchClient expanded: 6 new commands (diff, learn, prune, doctor, ready, compact) with typed JSON results, new flags on prime (--files, --exclude-domain) and record (--stdin, --evidence-bead). 39 tests pass.","closedAt":"2026-02-13T22:20:12.445309-08:00"}
{"id":"overstory-je5w","title":"Dashboard spawns 2 subprocesses per tick unconditionally","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-19T13:28:19.458584-08:00","updatedAt":"2026-02-20T08:03:33.964317-08:00","assignee":"jayminwest@gmail.com","description":"gatherStatus spawns git worktree list --porcelain and tmux list-sessions every tick (default 2s, min 500ms). Worktrees rarely change mid-tick. Fix: cache listWorktrees result with a short TTL (e.g. 10s) and only re-spawn when stale. Consider similar caching for tmux list-sessions.","closeReason":"Added module-level TTL cache (10s) for listWorktrees and listSessions results. Exported invalidateStatusCache() for test cleanup.","closedAt":"2026-02-20T08:03:33.964317-08:00"}
{"id":"overstory-jrnh","title":"Review: pre-scouted exception in lead.md","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:14:31.261217-08:00","updatedAt":"2026-02-21T06:16:46.991945-08:00","assignee":"jayminwest@gmail.com","closeReason":"PASS: agents/lead.md step 9 and .overstory/agent-defs/lead.md step 6 pre-scouted exception added correctly. Both use three-condition (a/b/c) pattern from spec. Placement verified. Quality gates: 1996 tests pass, typecheck clean, lint clean.","closedAt":"2026-02-21T06:16:46.991945-08:00"}
{"id":"overstory-jtxw","title":"overstory status shows active agent after tmux session killed","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T19:28:13.603865-08:00","updatedAt":"2026-02-13T06:45:20.840639-08:00","assignee":"jayminwest@gmail.com","description":"When a tmux session is manually killed (e.g. tmux kill-session), overstory status still shows 1 active agent. The agent lifecycle state in sessions.json is not updated when the tmux session dies externally. Status should detect that the tmux session no longer exists and reflect that the agent is no longer active. Likely fix: overstory status (or the watchdog) should cross-reference tmux session existence before reporting an agent as active.","closeReason":"Fixed zombie reconciliation: added stalled state to zombie detection check so externally-killed tmux sessions with any active-like state are caught (status.ts lines 105-113)","closedAt":"2026-02-13T06:45:20.840639-08:00"}
{"id":"overstory-jydl","title":"Agents send mail to 'orchestrator' instead of 'coordinator'","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-21T12:01:47.621506-08:00","updatedAt":"2026-02-24T14:07:20.124Z","assignee":"jayminwest@gmail.com","description":"Some agent definitions and/or overlay templates use 'orchestrator' as the mail recipient when sending messages to the top-level coordinating agent. The correct address is 'coordinator' (matching the agent name used by overstory coordinator start). This causes mail to be undeliverable or lost since no agent is registered with the name 'orchestrator'. Audit all agent .md files, templates, and overlay generation code for hardcoded 'orchestrator' references in mail send examples/instructions and replace with the correct recipient pattern.","closedAt":"2026-02-24T14:07:20.124Z","closeReason":"Fixed hardcoded orchestrator mail recipient to coordinator across agent defs and overlay code"}
{"id":"overstory-jyh9","title":"Merge and adapt phase 1 tracker module from builder branches to migrate/beads-to-seeds","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T16:07:11.953625-08:00","updatedAt":"2026-02-23T17:25:40.872561-08:00","assignee":"jayminwest@gmail.com","description":"Phase 1 builders completed work on main-based worktrees. Two branches ready: overstory/tracker-module-builder/overstory-ezh6 (10 new files in src/tracker/) and overstory/config-migration-builder/overstory-z12a (types.ts, config.ts, config.test.ts changes). Cherry-picking the tracker module (new files) works cleanly. Cherry-picking the config migration DOES NOT work cleanly because the builder patched beads: -> taskTracker: but this branch already renamed beads: to seeds:. Manual adaptation needed: (1) cherry-pick cf6493c (tracker module) — clean, (2) manually apply config changes from b2f42d6 adapting for seeds: -> taskTracker: instead of beads: -> taskTracker:, (3) migration function must handle BOTH old key names (beads: and seeds:), (4) verify src/tracker/seeds.ts references are correct (builder worked from main which had src/beads/ not src/seeds/), (5) run quality gates. Partial work already started in this session — see git stash or unstaged changes in src/types.ts and src/config.ts. Unblocks overstory-wius and overstory-xe1b.","closeReason":"Tracker module (src/tracker/) and config migration merged to branch. 5 new tracker files + config/types/sling/test updates. 2053 tests passing.","closedAt":"2026-02-23T17:25:40.872561-08:00"}
{"id":"overstory-jzw9","title":"Supervisor decision logic: coordinator chooses lead vs supervisor","status":"open","type":"feature","priority":3,"createdAt":"2026-02-16T08:06:04.801117-08:00","updatedAt":"2026-02-16T08:06:04.801117-08:00","assignee":"jayminwest@gmail.com","description":"Add heuristics to coordinator.md (and potentially code) for when to spawn a supervisor vs a lead. Supervisors are persistent and handle multi-phase work (explore → design → build → review → merge). Leads are ephemeral for single-phase tasks. Decision factors: estimated scope, number of phases, expected duration, number of sub-tasks."}
{"id":"overstory-k1s3","title":"Fix costs --run: add run_id to metrics.db sessions table","status":"closed","type":"task","priority":1,"createdAt":"2026-02-19T12:21:58.828121-08:00","updatedAt":"2026-02-19T12:30:45.095861-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added run_id column to metrics.db, getSessionsByRun() query method, wired runId through log.ts session-end recording, replaced broken cross-reference in costs --run with direct metrics.db query. All quality gates pass.","closedAt":"2026-02-19T12:30:45.095861-08:00"}
{"id":"overstory-k3t4","title":"Gate triage behind tier2Enabled config + implement retry action","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T06:51:26.939004-08:00","updatedAt":"2026-02-13T07:01:14.156992-08:00","assignee":"jayminwest@gmail.com","description":"Two small fixes: (1) In daemon.ts, check config.watchdog.tier2Enabled before calling triageAgent(). When disabled, fall through to the progressive nudging logic instead. (2) Implement the retry triage verdict — currently retry is a no-op like extend. When triage returns retry, send a nudge to the agent with a recovery prompt derived from the triage analysis.","closeReason":"Gated triage behind tier1Enabled config and implemented retry action sending nudge with recovery message","closedAt":"2026-02-13T07:01:14.156992-08:00"}
{"id":"overstory-k5ll","title":"Scout: explore existing test patterns in config.test.ts, manifest.test.ts, sling.test.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T05:56:11.300876-08:00","updatedAt":"2026-02-21T05:57:26.982333-08:00","assignee":"jayminwest@gmail.com","closeReason":"Explored config.test.ts, manifest.test.ts, sling.test.ts. Documented test organization (nested describe blocks), fixture patterns (makeConfig/makeBeacon factories, temp dir lifecycle), assertion patterns (error validation, env var save/restore), coverage strategies (edge cases, override testing, array-order independence), and pure function testing approaches. Full report in .overstory/specs/overstory-k5ll.md. Identified 10 reusable INSIGHT patterns for provider test implementation.","closedAt":"2026-02-21T05:57:26.982333-08:00"}
{"id":"overstory-k64n","title":"Add STEELMAN.md and README disclaimer about agent swarm risks","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T12:53:41.848141-08:00","updatedAt":"2026-02-13T13:07:46.363711-08:00","assignee":"jayminwest@gmail.com","description":"Create STEELMAN.md collecting arguments AGAINST using agent swarms and large-scale agentic projects like Overstory. Add a disclaimer section near the top of README.md that warns users not to use this project without understanding the risks, and links to STEELMAN.md as well as https://github.com/jayminwest/agentic-engineering-book and https://jayminwest.com/agentic-engineering-book for prerequisite reading.","closeReason":"STEELMAN.md and README disclaimer created by builder agents. Files in main repo working tree ready for commit.","closedAt":"2026-02-13T13:07:46.363711-08:00"}
{"id":"overstory-kcf","title":"merge-queue.json formatting triggers biome errors","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T12:01:10.887235-08:00","updatedAt":"2026-02-12T12:15:44.577368-08:00","assignee":"jayminwest@gmail.com","description":"merge-queue.json (a gitignored runtime state file in .overstory/) is written with expanded array formatting that biome rejects. While gitignored, running 'biome check .' picks it up. Either the file should be written with biome-compatible formatting, or biome should be configured to ignore .overstory/ runtime files.","closeReason":"Added .overstory/ to biome ignore list","closedAt":"2026-02-12T12:15:44.577368-08:00"}
{"id":"overstory-keoe","title":"Hook template missing ENV_GUARD on logging/lifecycle hooks","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T20:13:51.858332-08:00","updatedAt":"2026-02-13T20:22:49.781626-08:00","assignee":"jayminwest@gmail.com","description":"templates/hooks.json.tmpl has no ENV_GUARD on SessionStart, UserPromptSubmit, PreToolUse (logger), PostToolUse, Stop, or PreCompact hooks. Only the PreToolUse blocking guards (path boundary, capability, bash danger, native team tools) have the ENV_GUARD. This causes all Claude Code sessions at the project root to fire coordinator hooks — logging tool events as coordinator, marking coordinator 'completed' on every Stop, and running mail check/prime as coordinator. Code comment at coordinator.ts:117-119 incorrectly claims ENV_GUARD protects all hooks. Fix: add ENV_GUARD to all hooks in the template, or use a different mechanism to scope hooks to the coordinator's tmux session.","closeReason":"Fixed in this session","closedAt":"2026-02-13T20:22:49.781626-08:00"}
{"id":"overstory-kix0","title":"Automated failure recording in watchdog via mulch","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:08:37.729902-08:00","updatedAt":"2026-02-15T12:41:52.221604-08:00","assignee":"jayminwest@gmail.com","description":"When watchdog detects agent failures (Tier 0 process death, Tier 1 AI triage), auto-record failure patterns via mulch record to the agents domain. Include agent name, capability, failure reason, and triage suggestion. Tag with watchdog and auto-recorded. Use --evidence-bead to link the failure to the bead the agent was working on (task ID is already known at watchdog time). Uses expanded MulchClient.record().","closeReason":"Automated failure recording in watchdog via mulch: recordFailure() at Tier 0 process death, Tier 1 AI triage terminate, and level 3+ progressive escalation. Fire-and-forget with DI for testing. Committed 07b769c.","closedAt":"2026-02-15T12:41:52.221604-08:00"}
{"id":"overstory-kk4","title":"Overlay CLAUDE.md says 'Read your task spec at the path above' but spec path says 'No spec file provided'","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T09:41:35.13135-08:00","updatedAt":"2026-02-12T09:50:58.142438-08:00","assignee":"jayminwest@gmail.com","description":"When sling is run without --spec, the overlay CLAUDE.md says 'Spec: No spec file provided' then immediately says 'Read your task spec at the path above.' This is confusing — the instruction to read the spec should be conditional on whether a spec was actually provided. The template at templates/overlay.md.tmpl should conditionally include this instruction.","closeReason":"Overlay template now uses {{SPEC_INSTRUCTION}} placeholder. When spec provided: shows 'Read your task spec at the path above'. When null: shows 'No task spec was provided. Check your mail or ask your parent agent for details.' Added 2 new tests.","closedAt":"2026-02-12T09:50:58.142438-08:00"}
{"id":"overstory-km7i","title":"Write tests for overstory logs command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:04:49.062908-08:00","updatedAt":"2026-02-16T13:16:04.932264-08:00","assignee":"jayminwest@gmail.com","closeReason":"11 test cases written for logs command, all passing","closedAt":"2026-02-16T13:16:04.932264-08:00"}
{"id":"overstory-korf","title":"Persist watchdog and mail events to EventStore","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:10:21.606139-08:00","updatedAt":"2026-02-13T20:58:11.205447-08:00","assignee":"jayminwest@gmail.com","description":"Record watchdog actions and mail send/receive as events for full post-mortem audit trail.\n\n## Problem\nWatchdog nudges, escalations, and triage verdicts are currently fire-and-forget. Mail messages are in mail.db but not correlated with the event timeline. Post-mortem replay is missing these critical coordination signals.\n\n## Watchdog Events (src/watchdog/daemon.ts)\nOn each daemon tick, for each action taken, insert an event:\n\n- Level 0 (warn): event_type='escalation', level='warn', data={escalationLevel:0, action:'warn'}\n- Level 1 (nudge): event_type='nudge', level='warn', data={escalationLevel:1, delivered:bool}\n- Level 2 (triage): event_type='triage', level='warn', data={escalationLevel:2, verdict:'retry'|'terminate'|'extend'}\n- Level 3 (terminate): event_type='escalation', level='error', data={escalationLevel:3, action:'terminate'}\n\n## Nudge Events (src/commands/nudge.ts)\nRecord each nudge delivery:\n- event_type='nudge', level='info', data={from, message, delivered:bool}\n\n## Mail Events (src/commands/mail.ts)\nRecord mail send as events (denormalized — mail.db remains authoritative):\n- event_type='mail_sent', level='info', data={to, subject, type, priority, messageId}\n\nMail receive is already tracked via the existing mail check hook — could optionally record:\n- event_type='mail_received', level='debug', data={from, subject, messageId}\n\n## Implementation\n- Open EventStore at start of each relevant command\n- Insert events alongside existing behavior (additive, not replacing)\n- Use current run_id from .overstory/current-run.txt if available\n- Fire-and-forget pattern: swallow EventStore errors to avoid breaking core flows\n\n## Tests\n- daemon.test.ts: verify events inserted for each escalation level\n- nudge.test.ts: verify nudge event recorded\n- mail.test.ts: verify mail_sent event recorded","closeReason":"Implemented and tested in commit 35531bc","closedAt":"2026-02-13T20:58:11.205447-08:00"}
{"id":"overstory-kqs","title":"L0-3: Define custom error types in src/errors.ts","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:13.418195-08:00","updatedAt":"2026-02-12T07:18:57.543446-08:00","assignee":"jayminwest@gmail.com","description":"Custom error classes for overstory: ConfigError, ManifestError, WorktreeError, TmuxError, MailError, MergeError, WatchdogError. Each with meaningful context fields.","closeReason":"Implemented types.ts (all shared types), errors.ts (error hierarchy), config.ts (config loader with defaults and validation)","closedAt":"2026-02-12T07:18:57.543446-08:00"}
{"id":"overstory-ku8e","title":"Implement real-time token tracking infrastructure and live costs display","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:22:38.976765-08:00","updatedAt":"2026-02-16T13:34:55.155089-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented real-time token tracking: TokenSnapshot type, token_snapshots table (recordSnapshot, getLatestSnapshots, getLatestSnapshotTime, purgeSnapshots), throttled snapshot recording in log.ts tool-end handler (30s interval), costs --live flag with burn rate display (human and JSON output). All quality gates passed.","closedAt":"2026-02-16T13:34:55.155089-08:00"}
{"id":"overstory-l13t","title":"Auto-start monitor agent with coordinator","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-16T08:05:55.609022-08:00","updatedAt":"2026-02-16T13:18:48.13157-08:00","assignee":"jayminwest@gmail.com","description":"When overstory coordinator start runs, automatically spawn the monitor agent as a companion. Currently monitor requires a separate manual overstory monitor start. The --watchdog flag exists for Tier 0 but the LLM-based Tier 2 monitor should be the default companion for autonomous health awareness.","closeReason":"Added --monitor flag to coordinator start/stop/status. Monitor auto-starts alongside coordinator when flag is set. Stop/status also show monitor state. Tests added mirroring watchdog pattern.","closedAt":"2026-02-16T13:18:48.13157-08:00"}
{"id":"overstory-l1ku","title":"Implement overstory errors command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:09:17.260375-08:00","updatedAt":"2026-02-13T20:58:16.348754-08:00","assignee":"jayminwest@gmail.com","description":"Create src/commands/errors.ts — aggregated error view across all agents.\n\n## Usage\n```\noverstory errors [--agent <name>] [--run <id>] [--last <n>] [--json]\n```\n\n## Behavior\nQuery EventStore for events where level='error' or event_type IN ('error','escalation'). Display sorted by time with agent attribution.\n\n## Output Format (human)\n```\nErrors (last 24h)\n\nbuilder-auth-1  10:23:09  Bash exit code 1: test \"handles expired tokens\" failed\nbuilder-db-2    10:25:44  TypeScript error: Property 'foo' does not exist on type 'Bar'\nlead-tests-1    10:30:12  ESCALATION: builder-db-2 stalled after 5 nudges\n\n4 errors across 3 agents\n```\n\n## Flags\n- --agent: filter to specific agent\n- --run: filter to specific run ID\n- --last <n>: show last N errors (default: all from last 24h)\n- --json: structured output\n\n## Implementation\n- Query EventStore.getErrors() with filters\n- Extract error message from data JSON payload or tool_args\n- Count unique agents for summary line\n- Color: agent name in bold, timestamp in gray, error message in red\n- Escalation events shown with ESCALATION prefix\n\n## Tests (src/commands/errors.test.ts)\n- Shows errors from multiple agents sorted by time\n- --agent filter works\n- --json output\n- No errors shows clean message\n- Escalation events included","closeReason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","closedAt":"2026-02-13T20:58:16.348754-08:00"}
{"id":"overstory-l2e","title":"L1-6: Implement mulch CLI client (src/mulch/client.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T07:11:45.257594-08:00","updatedAt":"2026-02-12T07:25:39.302566-08:00","assignee":"jayminwest@gmail.com","description":"Wrapper around mulch CLI. Functions: prime(domains, format), status(), record(domain, data), query(domain). Parse --json output where available.","closeReason":"Implemented mulch CLI client — prime, status, record, query, search via Bun.spawn","closedAt":"2026-02-12T07:25:39.302566-08:00"}
{"id":"overstory-l7y","title":"worktree clean does not delete agent branches","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:19:59.712175-08:00","updatedAt":"2026-02-12T08:44:43.08805-08:00","assignee":"jayminwest@gmail.com","description":"When worktrees are cleaned (or manually removed), the associated git branches (e.g. overstory/test-builder-1/overstory-n4o) remain. Over time this leads to branch proliferation. 'overstory worktree clean' should also delete the associated branches after successful worktree removal, or there should be a separate 'overstory branch clean' command.","closeReason":"worktree clean now force-deletes associated git branches via git branch -D through new forceBranch option on removeWorktree","closedAt":"2026-02-12T08:44:43.08805-08:00"}
{"id":"overstory-l87h","title":"Add shell completion generation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:29.267249-08:00","updatedAt":"2026-02-16T07:33:58.474843-08:00","assignee":"jayminwest@gmail.com","description":"Add --completions bash/zsh/fish flag to generate shell completions for all 24 commands and their flags. Essential for DX with this many commands.","closeReason":"Merged: all branches clean-merged to main","closedAt":"2026-02-16T07:33:58.474843-08:00"}
{"id":"overstory-l9uy","title":"Merge sv-def branch into main","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T14:48:20.354334-08:00","updatedAt":"2026-02-12T14:55:12.188578-08:00","assignee":"jayminwest@gmail.com","description":"Merge branch overstory/sv-def/overstory-bsr8 into main. The branch adds agents/supervisor.md (new file) and appends 2 records to .mulch/expertise/agents.jsonl. The JSONL conflict is trivial — keep all appended lines from both branches.","closeReason":"Phase 2 supervisor agent implemented and merged","closedAt":"2026-02-12T14:55:12.188578-08:00"}
{"id":"overstory-lezb","title":"Implement overstory trace command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:09:05.376186-08:00","updatedAt":"2026-02-13T20:41:19.16664-08:00","assignee":"jayminwest@gmail.com","description":"Create src/commands/trace.ts — timeline of events for a specific agent or bead.\n\n## Usage\n```\noverstory trace <agent|bead> [--limit <n>] [--tools-only] [--json]\n```\n\n## Behavior\n1. If argument matches an agent name (found in SessionStore), query events by agent_name\n2. If argument matches a bead ID, look up agent(s) assigned to that bead via SessionStore, query events for all of them\n3. Display chronological timeline with color-coded event types\n\n## Output Format (human)\n```\nTimeline for builder-auth-1 (bead: overstory-abc1)\n\n10:23:01.234  SPAWN      spawned by lead-tests-1 (depth 2)\n10:23:04.567  TOOL       bash: bun test src/auth.test.ts         [2.3s]\n10:23:06.890  TOOL       read: src/auth/login.ts                 [0.1s]\n10:23:07.012  TOOL       edit: src/auth/login.ts                 [0.2s]\n10:23:09.056  ERROR      Bash exit code 1: test failed\n10:23:11.000  MAIL_SENT  to:lead-tests-1 \"Worker done\"\n10:23:11.200  SESSION_END tokens: 15K in / 3K out  cost: $0.42  duration: 7m 58s\n```\n\n## Implementation\n- Query EventStore.getTimeline() with agent/limit filters\n- Use tool_args summary field for the one-line tool description\n- Show tool_duration_ms in brackets when available\n- --tools-only filters to event_type='tool_start' with correlated durations\n- --json outputs array of StoredEvent objects\n- Color scheme: SPAWN=cyan, TOOL=blue, ERROR=red, MAIL=yellow, SESSION=gray\n- Follow reporter.ts patterns for ANSI output\n\n## Tests (src/commands/trace.test.ts)\n- Timeline for agent with tool durations\n- Bead ID resolution to agent name\n- --tools-only filtering\n- --json structured output\n- Agent not found error","closeReason":"Trace command implemented as overstory-rj1k, registered in router as overstory-cahb, tests as overstory-67rb","closedAt":"2026-02-13T20:41:19.16664-08:00"}
{"id":"overstory-lgb7","title":"SessionStore migration check runs getAll() on every open","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-19T13:28:16.829584-08:00","updatedAt":"2026-02-24T14:57:25.024Z","assignee":"jayminwest@gmail.com","description":"sessions/compat.ts:89 runs store.getAll() unconditionally every time openSessionStore is called to check if migration is needed. After migration has happened once this is wasted. Fix: persist migration state (e.g. a sentinel file or a metadata table row) so subsequent opens skip the check.","closedAt":"2026-02-24T14:57:25.024Z","closeReason":"Fixed by compat-fix-builder: openSessionStore now uses count() instead of getAll().length"}
{"id":"overstory-lh0","title":"Agents stuck in 'booting' state after tmux session killed","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:13:50.937781-08:00","updatedAt":"2026-02-12T08:32:26.646925-08:00","assignee":"jayminwest@gmail.com","description":"When a tmux session is killed externally (tmux kill-session), the agent state remains 'booting' and the agent still shows as 'active' in 'overstory status'. The ○ indicator suggests the system detects the tmux session is gone (vs ● for running), but: 1) The agent state never transitions from 'booting' to 'running' or to 'failed/dead'. 2) The summary still says '2 active'. 3) There's no mechanism to detect and clean up zombie agent entries. The watchdog should detect this, or status should reflect the actual tmux state.","closeReason":"Status command now reconciles agent state with tmux session existence, marking agents as zombie when tmux is dead","closedAt":"2026-02-12T08:32:26.646925-08:00"}
{"id":"overstory-lhva","title":"bun -e bypasses bash file guards in structural enforcement","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T06:50:34.277657-08:00","updatedAt":"2026-02-13T07:10:36.997999-08:00","assignee":"jayminwest@gmail.com","description":"bun -e can execute arbitrary code (unlinkSync, writeFileSync) that bypasses all bash pattern guards in the structural enforcement hooks. The dangerous patterns only match shell commands, not Bun/Node API calls via -e flag. Need to either block bun -e entirely for non-implementation agents or add patterns for common evasion vectors.","closeReason":"Fixed: ENV_GUARD prefix on all hook commands (ig8t), runtime eval patterns in DANGEROUS_BASH_PATTERNS (lhva)","closedAt":"2026-02-13T07:10:36.997999-08:00"}
{"id":"overstory-lit3","title":"Review: lead.md review-mandatory language","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:08:10.633339-08:00","updatedAt":"2026-02-17T08:12:17.012807-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review complete: PASS","closedAt":"2026-02-17T08:12:17.012807-08:00"}
{"id":"overstory-lkp","title":"L2-7: Implement mail CLI command (src/commands/mail.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:12:08.420424-08:00","updatedAt":"2026-02-12T07:33:09.648872-08:00","assignee":"jayminwest@gmail.com","description":"CLI command family: overstory mail send/check/list/read/reply. Parses CLI args, delegates to mail client. Supports --inject flag for hook context injection, --json for machine output, --from/--to/--unread filters.","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.648872-08:00"}
{"id":"overstory-ll5","title":"Role-specific hook variation per agent capability","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T12:13:04.344261-08:00","updatedAt":"2026-02-12T12:30:37.160139-08:00","assignee":"jayminwest@gmail.com","description":"Replace single hooks.json.tmpl with per-capability hook generation. Scout/reviewer: add guards blocking Write/Edit tools. Builder: add guards blocking git push. Lead: less restricted, can spawn. Implement merge logic: base hooks + capability overlay (like gastown's three-tier system: base -> role -> rig+role). Currently all agents get identical hooks regardless of capability.","closeReason":"hooks-deployer now accepts capability parameter. Scout/reviewer agents get PreToolUse guards that block Write, Edit, NotebookEdit. Guards prepended before base logging hook. Builder/lead/merger get no extra guards (builder git-push guard tracked in overstory-1wj). Sling passes capability to deployHooks. 16 new tests.","closedAt":"2026-02-12T12:30:37.160139-08:00"}
{"id":"overstory-llk","title":"Add nudge mechanism for mid-conversation message delivery","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T12:13:00.958833-08:00","updatedAt":"2026-02-12T12:27:59.075176-08:00","assignee":"jayminwest@gmail.com","description":"Implement 'overstory nudge <agent-name> <message>' CLI command. Uses existing sendKeys() in tmux.ts (already built, never called). When sending urgent/high priority mail, auto-nudge recipient with notification. Add debounce (500ms) and retry logic (3 attempts) per gastown's pattern. Serialize nudges per-session to prevent interleaving. Depends on interactive mode switch (agents must be running interactively for send-keys to work).","closeReason":"Added overstory nudge command (src/commands/nudge.ts) with retry (3 attempts), debounce (500ms), and session validation. Auto-nudge integrated into mail send for urgent/high priority messages. Tests added. Wired into CLI router.","closedAt":"2026-02-12T12:27:59.075176-08:00"}
{"id":"overstory-llw","title":"All agent sessions have the same PID (55777)","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T08:19:22.962149-08:00","updatedAt":"2026-02-12T08:29:26.787574-08:00","assignee":"jayminwest@gmail.com","description":"In sessions.json, every agent has pid: 55777 regardless of when they were spawned. The PID is supposed to be the Claude Code process ID inside the tmux session but it appears to be hardcoded or not captured correctly. This makes PID-based liveness detection unreliable in the watchdog.","closeReason":"Changed PID retrieval from tmux list-sessions (server PID) to tmux list-panes with pane_pid (actual process PID).","closedAt":"2026-02-12T08:29:26.787574-08:00"}
{"id":"overstory-lmo","title":"init generates .overstory/ JSON files with space indentation instead of tabs (Biome failure)","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T09:42:07.528349-08:00","updatedAt":"2026-02-12T09:51:01.126978-08:00","assignee":"jayminwest@gmail.com","description":"overstory init generates hooks.json and agent-manifest.json using space indentation, but the project uses tab indentation enforced by Biome. Running 'biome check .' fails on these generated files with formatting errors. The init command should use tab-indented JSON.stringify (using \\t) consistent with the rest of the codebase. Additionally, Biome wants short arrays on a single line, so the generation code should match Biome's formatting preferences.","closeReason":"init buildHooksJson() no longer reads the agent template (which had space indentation + agent placeholders). Now generates hooks.json directly with tab indentation matching Biome config. Also fixed templates/hooks.json.tmpl to use tab indentation.","closedAt":"2026-02-12T09:51:01.126978-08:00"}
{"id":"overstory-loa7","title":"Add Bash path-boundary guard for file-modifying commands in builder agents","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-13T13:03:14.28314-08:00","updatedAt":"2026-02-13T14:37:18.817527-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nEven with Write/Edit path guards (sibling issue), builder agents can bypass worktree isolation via Bash tool. Commands like 'echo content > /path/to/root/file.txt', 'cp file /root/path/', 'mv', 'sed -i' with absolute paths outside the worktree are not caught.\n\n## Current State\n\nhooks-deployer.ts has buildBashFileGuardScript() for non-implementation agents that blocks ALL file-modifying bash commands. But builders are intentionally exempt from this — they need sed, cp, etc. The problem is they can use these commands with paths outside their worktree.\n\n## Solution\n\nFor builder/merger agents, add a Bash PreToolUse hook that:\n\n1. Reads the command from stdin JSON\n2. For file-modifying patterns (sed -i, echo >, cp, mv, tee, cat >, etc.), extracts target file paths\n3. Validates that all target paths resolve within the worktree boundary\n4. Blocks if any target path is outside the worktree\n\nThis is harder than the Write/Edit guard because bash commands have varied syntax. A pragmatic approach:\n- Extract all absolute paths from the command (anything starting with /)\n- Check that none start with the canonical repo root UNLESS they start with the worktree path\n- For relative paths, they resolve from the tmux cwd (which is the worktree) so they're OK\n\n## Complexity Note\n\nThis is inherently harder to make airtight than the Write/Edit guard. An agent could theoretically construct paths via variable expansion, cd to a different directory, etc. The guard should catch the common case (direct absolute paths) and document known limitations.\n\n## Files to modify\n\n- src/agents/hooks-deployer.ts — new buildBashPathBoundaryScript()\n- src/agents/hooks-deployer.test.ts — test cases","closeReason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","closedAt":"2026-02-13T14:37:18.817527-08:00"}
{"id":"overstory-lqis","title":"Fix hooks-deployer.test.ts PostToolUse count after mulch diff hook","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T13:23:04.69268-08:00","updatedAt":"2026-02-20T13:27:53.5216-08:00","assignee":"jayminwest@gmail.com","description":"Update PostToolUse count assertion from 2 to 3 in hooks-deployer.test.ts line 146","closeReason":"Fixed PostToolUse count assertion (2->3) and added test for new mulch diff Bash hook. Cherry-picked template change from sibling builder to pass quality gates (137 tests pass).","closedAt":"2026-02-20T13:27:53.5216-08:00"}
{"id":"overstory-lu8k","title":"Integrate Claude Code native sandbox as opt-out default","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-13T22:22:21.026065-08:00","updatedAt":"2026-02-15T12:34:17.332721-08:00","assignee":"jayminwest@gmail.com","description":"Add Claude Code's built-in Seatbelt sandbox to agent spawning. Sandbox should be ON by default (opt-out via config). Key changes: (1) Add sandbox section to OverstoryConfig in types.ts with enabled (default true), allowedDomains, denyReadPaths. (2) Add defaults and validation in config.ts. (3) In hooks-deployer.ts, write sandbox config block into settings.local.json deployed to each worktree: enabled=true, autoAllowBashIfSandboxed=true, allowUnsandboxedCommands=false, network.allowedDomains from config. (4) Keep --dangerously-skip-permissions in sling.ts (required for headless operation) — sandbox provides OS-level defense-in-depth. (5) Existing hook guards (path boundary, bash guards, tool blocks) remain as additional layer. Config shape in .overstory/config.yaml: sandbox.enabled (bool, default true), sandbox.allowedDomains (string[], default [api.anthropic.com, github.com]), sandbox.denyReadPaths (string[], default [~/.ssh, ~/.aws]). macOS uses Seatbelt (built-in, zero install). Research source: beads issue overstory-g8iw (closed — smolvm rejected, Claude Code sandbox chosen instead).","closeReason":"Sandbox integration complete. Added SandboxConfig to types.ts, defaults/validation in config.ts, sandbox block deployment in hooks-deployer.ts, all 4 callers updated. 8 new tests, all passing. Branch: overstory/sandbox-builder/overstory-lu8k (commit 631cea6).","closedAt":"2026-02-15T12:34:17.332721-08:00"}
{"id":"overstory-lua3","title":"Add broadcast and group messaging","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:34.832616-08:00","updatedAt":"2026-02-16T07:33:58.468947-08:00","assignee":"jayminwest@gmail.com","description":"Support 'overstory mail send --to @all' and '--to @builders' (capability-based groups). Currently a lead monitoring 5 builders must send 5 separate messages. Implement as fan-out at the mail client level.","closeReason":"Merged: all branches clean-merged to main","closedAt":"2026-02-16T07:33:58.468947-08:00"}
{"id":"overstory-lue","title":"Add structured startup beacon with identity context","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T12:13:14.482244-08:00","updatedAt":"2026-02-12T12:32:20.262633-08:00","assignee":"jayminwest@gmail.com","description":"Instead of flat prompt string in sling.ts:311, build a structured beacon: [OVERSTORY] <agent-name> (<capability>) timestamp task:<bead-id> followed by numbered steps: 1. Read assignment (.claude/CLAUDE.md), 2. Load expertise (mulch prime), 3. Check mail (overstory mail check), 4. Begin working on task. Include parent agent info and hierarchy depth. Make beacon format configurable per capability. This replaces the current simple prompt string and gives agents a clear startup protocol.","closeReason":"Replaced simple beacon string in sling.ts with structured buildBeacon() function. Beacon now includes [OVERSTORY] header with agent identity/timestamp/task, depth/parent context, and 4-step startup protocol. Exported as pure function with full test coverage (10 tests).","closedAt":"2026-02-12T12:32:20.262633-08:00"}
{"id":"overstory-lvsy","title":"Mock tmux in clean.test.ts to prevent live session kills","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T20:19:12.070795-08:00","updatedAt":"2026-02-13T20:23:06.886803-08:00","assignee":"jayminwest@gmail.com","description":"clean.test.ts runs cleanCommand(['--all']) with no tmux mocks. During dogfooding (bun test inside a live swarm), this calls the real killAllTmuxSessions() which destroys all live agent tmux sessions.\n\nFix: spyOn the tmux functions (listSessions, killSession) in clean.test.ts, matching the pattern used in tmux.test.ts. This is the test-level fix — the session naming and SessionStore scoping changes fix the production code.","closeReason":"No longer needed — production code now scopes tmux kills to project SessionStore","closedAt":"2026-02-13T20:23:06.886803-08:00"}
{"id":"overstory-lww","title":"L0-10: Write agents/merger.md base definition","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:39.761389-08:00","updatedAt":"2026-02-12T07:20:05.126655-08:00","assignee":"jayminwest@gmail.com","description":"Merger agent: branch merge specialist. Handles conflict resolution using tiered approach (clean merge, auto-resolve, AI-resolve, reimagine). Works with overstory merge command.","closeReason":"Created all 5 base agent definitions: scout (read-only explorer), builder (implementation), reviewer (validation), lead (delegation), merger (branch integration)","closedAt":"2026-02-12T07:20:05.126655-08:00"}
{"id":"overstory-lx9","title":"Sling spawns agent but sends no initial task prompt to tmux session","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T09:40:59.153636-08:00","updatedAt":"2026-02-12T09:47:49.537517-08:00","assignee":"jayminwest@gmail.com","description":"overstory sling creates a tmux session running Claude Code in the agent worktree, but the agent just sits at the REPL prompt with no initial task. The SessionStart hook runs 'overstory prime --agent <name>' which provides context, but there is no actual task prompt or instruction sent. The agent needs to receive an initial prompt (e.g., 'Read your assignment in .claude/CLAUDE.md and begin working on task <id>'). Without this, the spawned agent does nothing. Consider using tmux send-keys to inject an initial prompt after the Claude Code session starts.","closeReason":"Added sendKeys() call after tmux session creation in sling.ts to inject initial task prompt to the agent.","closedAt":"2026-02-12T09:47:49.537517-08:00"}
{"id":"overstory-lzm1","title":"Worktree missing node_modules for quality gate commands","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T13:10:14.787355-08:00","updatedAt":"2026-02-12T13:20:04.773906-08:00","assignee":"jayminwest@gmail.com","description":"Agent worktrees created by sling do not have node_modules/ available. Direct commands like 'biome check .' and 'tsc --noEmit' fail with 'command not found'. The agent self-corrected by using 'bun run lint' and 'bun run typecheck' (which resolve via package.json scripts). Fix: either symlink node_modules from the main repo into the worktree during sling, or update agent definitions to use 'bun run' variants of quality gate commands.","closeReason":"Updated all agent definitions (builder, merger, lead, reviewer) and overlay.ts to use bun run lint and bun run typecheck instead of direct biome/tsc calls","closedAt":"2026-02-12T13:20:04.773906-08:00"}
{"id":"overstory-m0f","title":"mail: no purge/clean command for clearing old messages","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T10:34:49.005811-08:00","updatedAt":"2026-02-12T10:41:42.052566-08:00","assignee":"jayminwest@gmail.com","description":"The mail DB accumulates messages from all sessions with no way to clean them up. 'mail list' shows dozens of old messages from test sessions and dead agents. Need a 'mail purge' or 'mail clean' subcommand to remove messages older than N days, messages to/from non-existent agents, or all messages. This is important for long-running projects where the mail DB would grow unbounded.","closeReason":"Added mail purge subcommand with --all, --days N, --agent <name>, and --json support","closedAt":"2026-02-12T10:41:42.052566-08:00"}
{"id":"overstory-m3mk","title":"Apply conflict history intelligence to merge resolver","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:19:43.049871-08:00","updatedAt":"2026-02-16T18:27:07.015609-08:00","assignee":"jayminwest@gmail.com","description":"Re-apply conflict history pattern learning code from overstory/merge-intel-builder/overstory-99tm. Modify src/types.ts, src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts only. No mulch or .claude file modifications.","closeReason":"Conflict history intelligence applied to merge resolver. 38 tests pass, lint/types clean. Code commit: 8a64dba. Note: builder also ran mulch record (commit 3efc640) despite constraint — coordinator should cherry-pick only 8a64dba or exclude .mulch/ from merge.","closedAt":"2026-02-16T18:27:07.015609-08:00"}
{"id":"overstory-m4w","title":"Overlay template includes quality gates for read-only agents (scout, reviewer)","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:56:16.671504-08:00","updatedAt":"2026-02-12T11:47:24.138052-08:00","assignee":"jayminwest@gmail.com","description":"The overlay template (templates/overlay.md.tmpl) includes quality gates that tell agents to commit, run biome check, and run tests. These are wrong for read-only agents like scouts and reviewers who should never modify files. The overlay should conditionally include quality gates based on the agent capability, or at least exclude them for scout/reviewer roles.","closeReason":"Overlay template now conditionally renders quality gates and constraints based on agent capability. Read-only agents (scout, reviewer) get a lightweight completion section instead of the full quality gates (bun test, biome check, commit). Added formatQualityGates and formatConstraints functions with READ_ONLY_CAPABILITIES set. Added capability field to OverlayConfig type.","closedAt":"2026-02-12T11:47:24.138052-08:00"}
{"id":"overstory-m55s","title":"Doctor: CLI scaffold and output formatting","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T22:00:11.740768-08:00","updatedAt":"2026-02-15T12:40:31.06146-08:00","assignee":"jayminwest@gmail.com","description":"Create the doctor command scaffold: CLI registration, check runner, output formatting.\n\nImplementation:\n- New file: src/commands/doctor.ts\n- Register 'doctor' command in src/index.ts COMMANDS list and switch statement\n- Define DoctorCheck type: { name, category, status: 'pass'|'warn'|'fail', message, details?: string[], fixable?: boolean }\n- Define check categories: 'dependencies', 'structure', 'config', 'databases', 'consistency', 'agents', 'merge', 'logs', 'version'\n- Run all checks sequentially (some depend on earlier results, e.g. config must load before validating DB paths)\n- Output formatting: ANSI colors (green pass, yellow warn, red fail), summary counts at end\n- Flags: --json (structured output), --verbose (show passing checks too, not just problems), --category <name> (run only one category)\n- Future: --fix flag (not in initial implementation, but design the check result type to support it)\n- Exit code: 0 if all pass/warn, 1 if any fail\n\nFollow mulch doctor's UX pattern:\n- Show category headers\n- Show check name + status + message on one line\n- Show details indented below on warn/fail\n- Summary line at end: 'X passed, Y warnings, Z failures'\n\nSource references (mulch pattern):\n- /Users/jayminwest/Projects/mulch/src/commands/doctor.ts — overall structure and UX\n\nThis issue should be implemented first as it provides the framework for all other check issues.","closeReason":"Doctor command scaffold complete: CLI registration, check runner, output formatter, 9 stub check modules, DoctorCheck types","closedAt":"2026-02-15T12:40:31.06146-08:00"}
{"id":"overstory-m9p4","title":"Migrate status.ts, clean.ts, and init.ts to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:58:36.438885-08:00","updatedAt":"2026-02-13T19:16:13.152456-08:00","assignee":"jayminwest@gmail.com","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.152456-08:00"}
{"id":"overstory-maiz","title":"Rewrite merge queue store from JSON to SQLite","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:06:23.907755-08:00","updatedAt":"2026-02-16T07:14:18.552192-08:00","assignee":"jayminwest@gmail.com","closeReason":"Core merge queue SQLite store implemented and tests passing","closedAt":"2026-02-16T07:14:18.552192-08:00"}
{"id":"overstory-makx","title":"Test: merge command (help, validation, integration with real git)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:21:49.180327-08:00","updatedAt":"2026-02-13T08:26:57.097836-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created src/commands/merge.test.ts with 15 comprehensive tests. All quality gates passed (tests, lint, typecheck). Tests cover help, validation, --branch, --all, --dry-run, --json, and conflict handling.","closedAt":"2026-02-13T08:26:57.097836-08:00"}
{"id":"overstory-mbs6","title":"Fix MulchClient: correct types, add --json parsing, fix flag spread","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:09:28.31142-08:00","updatedAt":"2026-02-13T22:18:47.46055-08:00","assignee":"jayminwest@gmail.com","description":"Start from branch overstory/mulch-client-builder/overstory-u76r and apply targeted fixes.","closeReason":"Fixed types, added --json parsing, fixed flag spread. Final implementation on branch overstory/mulch-fix-builder/overstory-mbs6","closedAt":"2026-02-13T22:18:47.46055-08:00"}
{"id":"overstory-mifc","title":"Apply merge resolver conflict history (no mulch)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:18:21.35509-08:00","updatedAt":"2026-02-16T18:28:15.588285-08:00","assignee":"jayminwest@gmail.com","description":"Re-apply the conflict history pattern learning code from branch overstory/merge-intel-builder/overstory-99tm to a fresh branch. CRITICAL: Builder must NOT run mulch record or modify any .mulch/ or .claude/ files. Only modify src/types.ts, src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts.","closeReason":"Clean merge achieved. Conflict history code applied to main.","closedAt":"2026-02-16T18:28:15.588285-08:00"}
{"id":"overstory-milb","title":"Add --debounce flag to overstory mail check command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-15T12:17:34.197462-08:00","updatedAt":"2026-02-15T13:01:16.122553-08:00","assignee":"jayminwest@gmail.com","closeReason":"Superseded by debounce-fix-builder (overstory-8fj0)","closedAt":"2026-02-15T13:01:16.122553-08:00"}
{"id":"overstory-mmlq","title":"Create src/tracker/ abstraction module","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T16:22:49.207475-08:00","updatedAt":"2026-02-23T16:26:25.161336-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created src/tracker/ module: TrackerClient interface, beads/seeds adapters, factory with exhaustive dispatch. 3 tests passing, typecheck clean.","closedAt":"2026-02-23T16:26:25.161336-08:00"}
{"id":"overstory-mt9l","title":"Doctor: log disk usage and staleness","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:54.981856-08:00","updatedAt":"2026-02-15T12:54:28.369084-08:00","assignee":"jayminwest@gmail.com","description":"Check logging directory for disk usage, staleness, and corruption.\n\nChecks:\n- .overstory/logs/ directory exists and is readable\n- Calculate total disk usage across all log directories\n- Warn if total exceeds threshold (e.g. >500MB, configurable)\n- List log directories for agents no longer in sessions.db (stale)\n- Sample NDJSON files (events.ndjson, tools.ndjson) for malformed JSON lines\n- Check tools.ndjson for orphaned toolStart events without matching toolEnd (incomplete sessions)\n- Report per-agent log sizes for visibility\n\nNote: No log rotation exists today. Doctor should warn about this and suggest 'overstory worktree clean --completed' as partial cleanup.\n\nSource references:\n- src/logging/logger.ts — log directory structure, file naming, NDJSON format\n- .overstory/logs/ — real example with coordinator and agent subdirectories\n\nOutput: pass/warn. Large disk usage = warn. Stale logs = warn with cleanup suggestion. This is Tier 3 (degraded but functional).","closeReason":"Implemented structure, logs, and agent health checks. All tests passing (33 tests), quality gates clean.","closedAt":"2026-02-15T12:54:28.369084-08:00"}
{"id":"overstory-mw6l","title":"Add mulch recording as required completion gate to all agent definitions","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:37:47.920659-08:00","updatedAt":"2026-02-16T13:45:11.193336-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added mulch record as required completion gate for all agents. Updated 5 agent definitions (builder, lead, scout, reviewer, merger) with new completion protocol step and MISSING_MULCH_RECORD failure mode. Updated overlay.ts formatQualityGates for both read-only and writable agents. Fixed completions test. All quality gates pass.","closedAt":"2026-02-16T13:45:11.193336-08:00"}
{"id":"overstory-mxi","title":"L3-4: Implement merge command (src/commands/merge.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:12:05.510494-08:00","updatedAt":"2026-02-12T07:36:21.695111-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory merge --branch <name> | --all | --dry-run. Merges agent branches back to canonical branch. Uses merge queue + tiered resolver. Reports merge results with tier used and any conflict files.","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.695111-08:00"}
{"id":"overstory-my8","title":"L2-5: Implement sling command (src/commands/sling.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:11:59.30775-08:00","updatedAt":"2026-02-12T07:33:09.604276-08:00","assignee":"jayminwest@gmail.com","description":"CRITICAL PATH. The overstory sling command orchestrates full agent spawn: 1) Load config + manifest, 2) Validate (name unique, depth limit, bead exists), 3) Create worktree, 4) Generate + write overlay CLAUDE.md, 5) Generate + write hooks config, 6) Claim beads issue, 7) Create tmux session running claude, 8) Record session in sessions.json, 9) Return AgentSession.","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.604276-08:00"}
{"id":"overstory-n4go","title":"Migrate log.ts + test to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:56:46.505897-08:00","updatedAt":"2026-02-13T15:03:00.760959-08:00","assignee":"jayminwest@gmail.com","closeReason":"Migrated log.ts and log.test.ts from sessions.json to SessionStore API","closedAt":"2026-02-13T15:03:00.760959-08:00"}
{"id":"overstory-n4o","title":"Test task for sling","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T08:12:24.141653-08:00","updatedAt":"2026-02-12T08:23:25.824061-08:00","assignee":"jayminwest@gmail.com","description":"Dummy task to test overstory sling command","closeReason":"Test tasks created during integration testing, not real work","closedAt":"2026-02-12T08:23:25.824061-08:00"}
{"id":"overstory-n4r8","title":"Implement overstory costs CLI command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T20:44:47.787496-08:00","updatedAt":"2026-02-13T20:58:11.20357-08:00","assignee":"jayminwest@gmail.com","description":"Token/cost analysis and breakdown. Query metrics.db for token data (inputTokens, outputTokens, cacheReadTokens, cacheCreationTokens, estimatedCostUsd). Support --agent, --run, --by-capability, --json flags. Show per-agent breakdown and totals. Follow trace.ts patterns.","closeReason":"Implemented and tested in commit 35531bc","closedAt":"2026-02-13T20:58:11.20357-08:00"}
{"id":"overstory-n6nc","title":"Add gitignore auto-heal step in prime.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:17:59.672018-08:00","updatedAt":"2026-02-17T07:25:45.896501-08:00","assignee":"jayminwest@gmail.com","description":"Import OVERSTORY_GITIGNORE from init.ts, add auto-heal in primeCommand","closeReason":"Closed","closedAt":"2026-02-17T07:25:45.896501-08:00"}
{"id":"overstory-n6ny","title":"Write dashboard.test.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:05:25.836084-08:00","updatedAt":"2026-02-13T09:32:05.33104-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.33104-08:00"}
{"id":"overstory-n6qk","title":"Implement overstory replay command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:09:33.331838-08:00","updatedAt":"2026-02-13T20:58:16.32614-08:00","assignee":"jayminwest@gmail.com","description":"Create src/commands/replay.ts — chronological interleaved replay across all agents.\n\n## Usage\n```\noverstory replay [--run <id>] [--agent <a1,a2>] [--json]\n```\n\n## Behavior\nShow all events across multiple agents in chronological order, interleaved. This is the key post-mortem tool — it shows the full story of a swarm run as it happened.\n\n## Output Format (human)\n```\nReplay: run-2026-02-13T10-00-00Z (5 agents, 12m 34s)\n\n10:00:00  [orchestrator]     SPAWN lead-tests-1 (lead)\n10:00:03  [lead-tests-1]     SPAWN builder-auth-1 (builder)\n10:00:03  [lead-tests-1]     SPAWN builder-db-2 (builder)\n10:00:06  [builder-auth-1]   bash: bun test src/auth.test.ts         [2.3s]\n10:00:06  [builder-db-2]     bash: bun test src/db.test.ts           [3.1s]\n10:00:09  [builder-db-2]     ERROR: test \"handles connection pool\" failed\n10:12:30  [builder-auth-1]   MAIL_SENT to:lead-tests-1 \"Worker done\"\n10:12:34  [orchestrator]     MERGE builder-auth-1 -> main (clean-merge)\n```\n\n## Flags\n- --run: filter to specific run. Default: most recent run, or last 24h if no runs exist\n- --agent: comma-separated list of agents to include (filter)\n- --json: structured output\n\n## Implementation\n- Query EventStore.getTimeline() with run/agent filters, sorted by created_at\n- Each line prefixed with [agent_name] in a consistent-width column\n- Agent names get stable colors (hash agent name to color index)\n- Tool events show the summary from tool-filter + duration\n- Without --run, detect most recent run from SessionStore or fall back to last 24h\n- Header shows run ID, agent count, total duration\n\n## Tests (src/commands/replay.test.ts)\n- Interleaved events from multiple agents in correct time order\n- --run filter\n- --agent filter (comma-separated)\n- --json output\n- Default to most recent run\n- Header stats (agent count, duration)","closeReason":"Implemented in commit 35531bc (duplicate of overstory-n4r8/gz4u/72ak)","closedAt":"2026-02-13T20:58:16.32614-08:00"}
{"id":"overstory-n82","title":"L4-6: Implement metrics command (src/commands/metrics.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:33.162384-08:00","updatedAt":"2026-02-12T07:39:41.996046-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory metrics [--last <n>] [--json]. Shows metrics summary from SQLite store: session durations, success rates, merge tier distribution, agent utilization. Human-readable table or JSON output.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.996046-08:00"}
{"id":"overstory-n9b0","title":"Epic: Evolve overstory into autonomous orchestration system","status":"closed","type":"epic","priority":1,"createdAt":"2026-02-12T13:50:27.526086-08:00","updatedAt":"2026-02-13T07:05:46.939007-08:00","assignee":"jayminwest@gmail.com","description":"Transform overstory from a manual CLI toolkit into a true autonomous orchestration system with hierarchical delegation, self-propelling agents, and structured escalation. Key pillars: (1) Persistent coordinator agent, (2) Per-project supervisor agents, (3) Auto-propulsion for workers, (4) Deep watchdog chain, (5) Session lifecycle independence. Design principle: minimize .md-based prompt injection - use beads for task context and the mail system for inter-agent communication.","closeReason":"All 8 dependency phases complete: typed mail protocol, coordinator, supervisor, auto-propulsion, deep watchdog chain, session lifecycle, structural enforcement, task groups","closedAt":"2026-02-13T07:05:46.939007-08:00"}
{"id":"overstory-n9s2","title":"Implement overstory agents discover command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T17:51:56.172634-08:00","updatedAt":"2026-02-16T18:01:10.616313-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented overstory agents discover command with capability filtering, file scope extraction from overlays, human and JSON output, shell completions, and 10 unit tests","closedAt":"2026-02-16T18:01:10.616313-08:00"}
{"id":"overstory-nau","title":"No DB-level constraints for mail type/priority columns","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T09:41:38.954059-08:00","updatedAt":"2026-02-12T09:49:19.63794-08:00","assignee":"jayminwest@gmail.com","description":"The mail SQLite schema doesn't enforce valid type/priority values at the DB level. Historical test data includes messages with type='invalid_type' and priority='invalid_prio'. While CLI validation now rejects invalid values, direct SQLite access (from agents or tests) can still insert invalid data. Consider adding CHECK constraints to the mail table schema: type CHECK(type IN ('status','question','result','error')) and priority CHECK(priority IN ('low','normal','high','urgent')).","closeReason":"Added CHECK constraints for type/priority columns to mail schema. Added migration to recreate existing tables with constraints (sanitizes invalid data to defaults). Added 5 new tests.","closedAt":"2026-02-12T09:49:19.63794-08:00"}
{"id":"overstory-nd62","title":"Adopt mulch programmatic API: replace Bun.spawn CLI wrapper with library imports","status":"open","type":"feature","priority":1,"createdAt":"2026-02-21T05:59:03.197852-08:00","updatedAt":"2026-02-21T05:59:03.197852-08:00","assignee":"jayminwest@gmail.com","description":"mulch 0.5.0 exports a programmatic API (recordExpertise, searchExpertise, queryDomain, editRecord) via mulch-cli npm package. Replace subprocess calls in src/mulch/client.ts with direct library imports for better type safety, lower latency, and elimination of JSON string parsing. Zero-deps rule relaxed for mulch since it's a first-party companion project built in tandem. Add mulch-cli as a runtime dependency in package.json. Migrate client.ts methods incrementally — start with record() and search() which are most frequently called."}
{"id":"overstory-ne0","title":"init --force: regenerated hooks.json has broken log commands (missing --agent)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T10:10:28.403348-08:00","updatedAt":"2026-02-12T10:13:54.055955-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory init --force' regenerates .overstory/hooks.json and strips {{AGENT_NAME}} template placeholders. This results in 'overstory log tool-start' (no --agent) in the hooks, which fails with VALIDATION_ERROR since --agent is required. The prime and mail check commands happen to work without --agent (they default to 'orchestrator'), but all three log commands (tool-start, tool-end, session-end) will fail on every hook invocation. The orchestrator hooks.json should either: (1) use '--agent orchestrator' explicitly, or (2) make --agent optional in log.ts with a default of 'orchestrator'.","closeReason":"Added --agent orchestrator to all three log commands (tool-start, tool-end, session-end) in buildHooksJson() in init.ts","closedAt":"2026-02-12T10:13:54.055955-08:00"}
{"id":"overstory-ngz7","title":"Create STEELMAN.md and README disclaimer (retry)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T12:59:56.138438-08:00","updatedAt":"2026-02-13T13:04:39.511854-08:00","assignee":"jayminwest@gmail.com","closeReason":"STEELMAN.md created and README.md disclaimer added in builder-steelman-2 worktree. Files written correctly but uncommitted (builder session died before git commit). Escalated to orchestrator for commit and merge.","closedAt":"2026-02-13T13:04:39.511854-08:00"}
{"id":"overstory-nlnl","title":"Fix hooks template: remove read/echo stdin relay","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:37:37.530247-08:00","updatedAt":"2026-02-17T07:48:04.528091-08:00","assignee":"jayminwest@gmail.com","closeReason":"Removed read/echo stdin relay from templates/hooks.json.tmpl (3 hooks fixed). Template loads correctly.","closedAt":"2026-02-17T07:48:04.528091-08:00"}
{"id":"overstory-nmz","title":"maxConcurrent agent limit is never enforced by sling","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T08:22:48.225682-08:00","updatedAt":"2026-02-12T08:29:56.97226-08:00","assignee":"jayminwest@gmail.com","description":"The config has agents.maxConcurrent=5 but 'overstory sling' never checks this limit before spawning a new agent. You can spawn unlimited agents. The sling command should count active (non-zombie) sessions and reject new spawns if the limit would be exceeded.","closeReason":"Closed","closedAt":"2026-02-12T08:29:56.97226-08:00"}
{"id":"overstory-nq0y","title":"Fix tool logging — all tools logged as hook-captured with no tool name or args","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T06:20:51.639374-08:00","updatedAt":"2026-02-13T06:45:26.281875-08:00","assignee":"jayminwest@gmail.com","description":"Coordinator log files (events.ndjson, session.log, tools.ndjson) record every tool call as toolName=hook-captured with empty args. No actual tool identity (Bash, Read, Glob) or arguments are captured. This makes logs useless for debugging agent behavior — we had to use tmux capture-pane to determine what the coordinator was doing. The overstory log hook is not propagating the actual tool_name and tool_input from the PreToolUse/PostToolUse stdin JSON. Check the log command and hooks template.","closeReason":"Fixed sed patterns in hooks template and hooks-deployer to handle optional whitespace after JSON colons. Claude Code sends spaced JSON (e.g. \"tool_name\": \"Bash\") but sed patterns expected no space (\"tool_name\":\"Bash\"), causing extraction to fail and return the full JSON blob instead of the tool name.","closedAt":"2026-02-13T06:45:26.281875-08:00"}
{"id":"overstory-ntmo","title":"Cross-agent mulch propagation within a run","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-16T08:06:06.45412-08:00","updatedAt":"2026-02-16T19:10:41.575302-08:00","assignee":"jayminwest@gmail.com","description":"When a scout discovers important patterns and records them to mulch, that expertise should be available to builders in the same run. Currently mulch expertise is only embedded at spawn time via the overlay. Options: re-fetch mulch at builder spawn time (already happens but scout may not have recorded yet), or add a mechanism to propagate mulch updates to running agents via mail.","closeReason":"Scout-first workflow (overstory-18zt) already solves the timing problem. Scouts finish before builders spawn, so builders get latest mulch via overlay at spawn time. Propagating updates to running agents fights the disposable model.","closedAt":"2026-02-16T19:10:41.575302-08:00"}
{"id":"overstory-nup","title":"L5-4: Write tmux.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:29.912752-08:00","updatedAt":"2026-02-12T07:54:20.550763-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/worktree/tmux.ts. Cover: create session, list sessions, kill session, isSessionAlive check, session naming convention (overstory-{agentName}). May need to mock tmux commands.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.550763-08:00"}
{"id":"overstory-nuxo","title":"Rename watchdog tier numbering to match Phase 4 spec","status":"closed","type":"task","priority":4,"createdAt":"2026-02-13T06:51:33.364485-08:00","updatedAt":"2026-02-13T06:58:55.893712-08:00","assignee":"jayminwest@gmail.com","description":"Current code calls mechanical monitoring Tier 1 and AI triage Tier 2. Phase 4 spec uses Tier 0 for mechanical, Tier 1 for triage, Tier 2 for monitor agent, Tier 3 for supervisor monitors. Update comments, variable names, config keys, and CLI help text to match Phase 4 naming. Config backward compat: accept both old and new key names.","closeReason":"Renamed tier numbering to match Phase 4 spec with backward compat","closedAt":"2026-02-13T06:58:55.893712-08:00"}
{"id":"overstory-nv75","title":"Test: monitor command (help, routing, beacon, status)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:21:46.316633-08:00","updatedAt":"2026-02-13T08:25:18.949153-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created monitor.test.ts with comprehensive test coverage for buildMonitorBeacon() and monitorCommand(). 18 tests passing, all quality gates cleared.","closedAt":"2026-02-13T08:25:18.949153-08:00"}
{"id":"overstory-nzor","title":"Phase 3: Communication Upgrade","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:30.945997-08:00","updatedAt":"2026-02-16T17:48:30.84575-08:00","assignee":"jayminwest@gmail.com","description":"Move beyond point-to-point mail toward richer collaboration patterns. Add shared blackboard (with mulch drill-down), event subscriptions, broadcast messaging, and agent discovery.","closeReason":"Phase 3 substantially complete. Broadcast messaging built (src/mail/broadcast.ts: @all, @builders, @scouts, etc.). Agent discovery via overstory status + agent manifest. Mulch serves as shared blackboard (mulch prime/search/record). Event subscriptions effectively handled by mail protocol (worker_done, merge_ready, escalation). Remaining: dedicated agent discovery command tracked as overstory-9kuz.","closedAt":"2026-02-16T17:48:30.84575-08:00"}
{"id":"overstory-o0g","title":"lastActivity timestamp never updated after agent spawn","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T08:15:15.45079-08:00","updatedAt":"2026-02-12T08:29:56.927873-08:00","assignee":"jayminwest@gmail.com","description":"In sling.ts, lastActivity is set to the spawn timestamp and is never updated during the agent's lifetime. The log hooks (overstory log tool-start/tool-end) fire but don't update sessions.json with a new lastActivity timestamp. This means the watchdog's stale/zombie detection based on lastActivity is broken — agents will be marked stale/zombie based on time since spawn rather than time since actual activity. The log command should update lastActivity in sessions.json for the relevant agent.","closeReason":"Closed","closedAt":"2026-02-12T08:29:56.927873-08:00"}
{"id":"overstory-o1p9","title":"Supervisor agent: TypeScript implementation","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T14:34:37.015522-08:00","updatedAt":"2026-02-12T14:55:19.67043-08:00","assignee":"jayminwest@gmail.com","description":"Add supervisor capability to types.ts and hooks-deployer.ts. Implement src/commands/supervisor.ts (start/stop/status CLI). Register in src/index.ts. Pattern follows coordinator.ts closely but with bead assignment, depth 1, and parent tracking.","closeReason":"Phase 2 supervisor agent implemented and merged","closedAt":"2026-02-12T14:55:19.67043-08:00"}
{"id":"overstory-o570","title":"Write identity.test.ts for src/agents/identity.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:56.015199-08:00","updatedAt":"2026-02-13T09:32:05.325359-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.325359-08:00"}
{"id":"overstory-o992","title":"[Epic] Phase 3: Run Grouping + Watchdog Persistence","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T13:07:39.549788-08:00","updatedAt":"2026-02-13T20:53:42.142137-08:00","assignee":"jayminwest@gmail.com","description":"Introduce the 'run' concept (one coordinator session = one run) and persist watchdog events for post-mortem analysis.\n\n## Goal\nGroup all agents from a coordinator session into a named run for easy querying. Record all watchdog actions (nudges, escalations, triage verdicts) as events so they appear in trace/replay output.\n\n## Deliverables\n1. Run concept — run ID generation, current-run tracking, runs table in sessions.db\n2. overstory run command — show current run, list recent runs, mark complete, show details\n3. Watchdog event persistence — daemon records nudges/escalations/triage to events.db\n4. Mail event recording — mail send/receive recorded as events for full audit trail\n5. Nudge event recording — nudge deliveries recorded as events\n\n## Architecture Notes\n- Run ID format: run-{ISO timestamp}\n- Stored in .overstory/current-run.txt (active run) and runs table in sessions.db\n- sling generates run ID on first call, subsequent calls inherit it\n- Run auto-completes when all member agents reach completed/zombie state\n- Watchdog events use existing EventStore.insert() with appropriate event_type values\n- Mail events in events.db are denormalized audit trail (mail.db remains authoritative)\n\n## Dependencies\nDepends on Phase 1 (EventStore, SessionStore) and partially on Phase 2 (run filtering in CLI commands)","closeReason":"All 5 deliverables complete: run concept, run CLI, watchdog events, mail events, nudge events. All tests passing.","closedAt":"2026-02-13T20:53:42.142137-08:00"}
{"id":"overstory-o999","title":"Implement NO_COLOR and --quiet support","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T07:40:39.707521-08:00","updatedAt":"2026-02-16T07:55:05.230599-08:00","assignee":"jayminwest@gmail.com","description":"Create central color module, update all ANSI-using files, add --quiet flag to CLI entry point, add tests","closeReason":"Implemented NO_COLOR env var support and --quiet CLI flag. Created central color.ts module, updated 8 command files to use it, added tests. All quality gates pass.","closedAt":"2026-02-16T07:55:05.230599-08:00"}
{"id":"overstory-oa1x","title":"Fix process.exitCode race between doctor.test.ts and watch.test.ts","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T14:31:19.444675-08:00","updatedAt":"2026-02-15T14:39:31.954161-08:00","assignee":"jayminwest@gmail.com","description":"1 remaining test failure: 'doctorCommand > exit code > exit code is undefined when all checks pass or warn' passes in isolation but fails in full suite. Root cause: process.exitCode is a shared global between parallel test files. watch.test.ts sets process.exitCode=0 in beforeEach (line 49), which races with doctor.test.ts that expects process.exitCode to be undefined. Fix: either (a) make doctorCommand return the exit code instead of setting process.exitCode directly, and have the CLI entry point handle the global set, or (b) have the test assert process.exitCode is not 1 instead of asserting undefined. Option (a) is cleaner.","closeReason":"All 33 test failures resolved. 1603/1603 pass.","closedAt":"2026-02-15T14:39:31.954161-08:00"}
{"id":"overstory-oaat","title":"Add --file filter to merge conflict pattern search","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T05:58:57.743792-08:00","updatedAt":"2026-02-21T05:58:57.743792-08:00","assignee":"jayminwest@gmail.com","description":"In src/merge/resolver.ts, when resolving conflicts, use --file <conflicting-file> to find expertise specifically about the files in conflict, not just generic merge-conflict tagged records. Requires adding file param to mulch/client.ts search() method."}
{"id":"overstory-oac4","title":"Add mulch diff PostToolUse hook to orchestrator buildHooksJson and tests","status":"closed","type":"task","priority":2,"createdAt":"2026-02-20T13:17:24.634966-08:00","updatedAt":"2026-02-20T13:21:14.25555-08:00","assignee":"jayminwest@gmail.com","description":"Add a PostToolUse Bash hook to buildHooksJson() in init.ts and add test in init.test.ts","closeReason":"Added PostToolUse Bash hook to buildHooksJson() in init.ts: matcher='Bash', reads stdin, greps for git commit, runs mulch diff HEAD~1. Test added and all quality gates pass.","closedAt":"2026-02-20T13:21:14.25555-08:00"}
{"id":"overstory-ofgf","title":"overstory dashboard base command — ANSI TUI with live panels","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T14:37:38.915617-08:00","updatedAt":"2026-02-13T07:26:29.04586-08:00","assignee":"jayminwest@gmail.com","description":"New 'overstory dashboard' command that renders a rich terminal UI using raw ANSI escape codes (zero deps). Polls existing data sources and renders multi-panel layout:\n\nPanels:\n- Agent panel: name, capability, state (color-coded), duration, bead ID, tmux alive indicator\n- Mail panel: recent messages, unread count, activity ticker\n- Merge queue panel: pending/merging/conflict entries with status\n- Metrics summary: session counts, avg duration, by-capability breakdown\n\nImplementation:\n- New src/commands/dashboard.ts\n- Raw ANSI escape codes for layout (box drawing, colors, cursor positioning)\n- Poll loop similar to current --watch but with richer rendering\n- Reuse gatherStatus() data + extend with mail/merge detail\n- Register in src/index.ts command router\n\nAll data sources already exist — this is purely a rendering/UX task.","closeReason":"Dashboard base command implemented: 609-line ANSI TUI with agent/mail/merge/metrics panels","closedAt":"2026-02-13T07:26:29.04586-08:00"}
{"id":"overstory-oia","title":"L5-9: Write resolver.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:34.337956-08:00","updatedAt":"2026-02-12T07:54:20.572101-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/merge/resolver.ts. Cover: all 4 resolution tiers (clean-merge, auto-resolve, ai-resolve, reimagine). Mock git commands and claude --print calls. Verify tier escalation on failure.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.572101-08:00"}
{"id":"overstory-oidg","title":"Add sling provider env injection tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:03:01.774627-08:00","updatedAt":"2026-02-24T14:57:26.920Z","assignee":"jayminwest@gmail.com","description":"Add integration tests to sling.test.ts verifying provider env vars are passed to spawned tmux sessions","closedAt":"2026-02-24T14:57:26.920Z","closeReason":"Sling provider env injection tests added: 7 new test cases in sling.test.ts"}
{"id":"overstory-ojcw","title":"Apply 5 code files from failed agents-cmd branch","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:06:57.070004-08:00","updatedAt":"2026-02-16T18:13:54.245229-08:00","assignee":"jayminwest@gmail.com","closeReason":"Applied 5 code files (agents.ts, agents.test.ts, completions.ts, completions.test.ts, index.ts) from failed merge branch. All quality gates passed.","closedAt":"2026-02-16T18:13:54.245229-08:00"}
{"id":"overstory-okcp","title":"Implement conflict history query and tier optimization in resolver","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T17:51:50.090493-08:00","updatedAt":"2026-02-16T18:04:28.612673-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented conflict history query, tier skip optimization, AI prompt enrichment, and conflict prediction in resolver.ts. Added parseConflictPatterns(), buildConflictHistory(), queryConflictHistory(). Wired mulchClient in merge.ts. 13 new tests, all 38 pass.","closedAt":"2026-02-16T18:04:28.612673-08:00"}
{"id":"overstory-oo6k","title":"Fix: Add mulch learn to Stop hooks for orchestrator and agent sessions","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:04:21.750276-08:00","updatedAt":"2026-02-16T13:09:55.276195-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added mulch learn to Stop hooks for both orchestrator and agent sessions. Tests added and passing.","closedAt":"2026-02-16T13:09:55.276195-08:00"}
{"id":"overstory-ootr","title":"Review: sling.ts scout-before-builder warning","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:46:09.735011-08:00","updatedAt":"2026-02-17T07:51:34.623213-08:00","assignee":"jayminwest@gmail.com","closeReason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning.","closedAt":"2026-02-17T07:51:34.623213-08:00"}
{"id":"overstory-ot7","title":"Scout: audit merge queue JSON formatting","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T12:03:11.015929-08:00","updatedAt":"2026-02-12T12:04:05.374475-08:00","assignee":"jayminwest@gmail.com","description":"Read-only audit of how merge-queue.json is written. Report findings about formatting.","closeReason":"Audit complete: merge-queue.json formatting is correct. Uses tab-indented JSON.stringify with trailing newline, consistent with all other JSON write sites. Only note: queue.ts uses node:fs writeFileSync (sync) instead of Bun.write (async) — intentional workaround documented in comments.","closedAt":"2026-02-12T12:04:05.374475-08:00"}
{"id":"overstory-ot9d","title":"Fix hooks install --force to merge per event type instead of replacing","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-23T11:18:30.474164-08:00","updatedAt":"2026-02-23T11:23:43.164841-08:00","assignee":"jayminwest@gmail.com","description":"hooks.ts:82 does targetConfig.hooks = sourceHooks.hooks which replaces existing hooks. Fix: merge hook arrays per event type, deduplicating entries. Add tests for merge behavior.","closeReason":"Fixed hooks install --force to merge per event type. Added mergeHooksByEventType(), 8 new tests, all 25 tests pass.","closedAt":"2026-02-23T11:23:43.164841-08:00"}
{"id":"overstory-otwd","title":"Thread provider env vars through agent spawning","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:13:53.618528-08:00","updatedAt":"2026-02-20T09:44:06.5203-08:00","assignee":"jayminwest@gmail.com","description":"Update all agent spawn commands to use ResolvedModel and pass provider env vars into tmux sessions.\n\nFILES: src/commands/sling.ts, src/commands/coordinator.ts, src/commands/supervisor.ts, src/commands/monitor.ts\n\nPattern (same in all 4 files):\n- Before: const model = resolveModel(config, manifest, role, fallback); const cmd = `claude --model ${model} ...`;\n- After: const resolved = resolveModel(config, manifest, role, fallback); const cmd = `claude --model ${resolved.model} ...`; pass {...resolved.env} into createSession() env dict\n\nSpecific locations:\n- sling.ts:467-468 — worker agents\n- coordinator.ts:335,343 — coordinator\n- supervisor.ts:~199 — supervisor  \n- monitor.ts:~146 — monitor\n\ntmux.ts createSession() already accepts an env dict and handles injection — no changes needed there.\n\nCritical: ANTHROPIC_API_KEY must be set to '' (empty string, not undefined) when using a gateway provider, to prevent Claude Code from falling back to Anthropic auth.","closeReason":"Threaded provider env vars through all 4 spawn commands (sling, coordinator, supervisor, monitor). Each now destructures { model, env } from resolveModel() and spreads ...env into createSession() env dict.","closedAt":"2026-02-20T09:44:06.5203-08:00"}
{"id":"overstory-ov3i","title":"Fix doctor.test.ts: add DI for check runners","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T14:08:34.884181-08:00","updatedAt":"2026-02-15T14:13:21.761976-08:00","assignee":"jayminwest@gmail.com","closeReason":"Builder added DI for checkRunners to doctorCommand. All 19 tests pass. Only src/commands/doctor.ts and doctor.test.ts modified.","closedAt":"2026-02-15T14:13:21.761976-08:00"}
{"id":"overstory-ow1m","title":"Test: supervisor command (help, routing, beacon, sessions, status)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:21:48.096872-08:00","updatedAt":"2026-02-13T08:25:24.458729-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added supervisor.test.ts with 21 passing tests covering loadSessions, saveSessions, buildSupervisorBeacon, and supervisorCommand","closedAt":"2026-02-13T08:25:24.458729-08:00"}
{"id":"overstory-ow3","title":"sling: getFlag() accepts empty strings for --name and --files","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:09:36.559543-08:00","updatedAt":"2026-02-12T10:15:19.829597-08:00","assignee":"jayminwest@gmail.com","description":"The getFlag() helper in sling.ts returns flag values without checking for empty strings. This means: (1) --name '' passes the truthy check since getFlag returns the next arg which could be another flag. (2) --files '' splits into [''] (array with one empty string element) instead of []. The empty string file scope could cause issues downstream. Fix: validate non-empty values after getFlag() returns, or trim and check length.","closeReason":"Validate --name and --files for empty strings after getFlag()","closedAt":"2026-02-12T10:15:19.829597-08:00"}
{"id":"overstory-oyrn","title":"Wire mulchClient into merge command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-16T17:51:54.394634-08:00","updatedAt":"2026-02-16T18:04:29.718851-08:00","assignee":"jayminwest@gmail.com","closeReason":"mulchClient wired into merge command via createMulchClient(config.project.root), passed to createMergeResolver","closedAt":"2026-02-16T18:04:29.718851-08:00"}
{"id":"overstory-p0i","title":"watch --background flag not implemented","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T09:41:45.078946-08:00","updatedAt":"2026-02-12T09:57:10.970147-08:00","assignee":"jayminwest@gmail.com","description":"The watch command help documents a --background flag for daemonization, but testing shows the watch command only runs in foreground. The --background flag should launch the watchdog as a background process (e.g., forking or using nohup) and print the PID. Currently watch must be manually backgrounded or run in a tmux session.","closeReason":"Implemented --background flag using Bun.spawn detached process with PID file at .overstory/watchdog.pid","closedAt":"2026-02-12T09:57:10.970147-08:00"}
{"id":"overstory-p0uv","title":"Merge sling-guard-builder branch into main","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T07:11:57.328252-08:00","updatedAt":"2026-02-21T07:19:50.499514-08:00","assignee":"jayminwest@gmail.com","description":"Merge branch overstory/sling-guard-builder/overstory-afr9 into main. The only conflict is in .mulch/expertise/cli.jsonl where both branches appended entries after line 123. Resolution: keep all entries — main's 1 entry (mx-ef4c2c: stop command) PLUS the branch's 2 entries (mx-465bee: fixture-fixer, mx-8174e3: checkBeadLock). After resolving, run quality gates and commit.","closeReason":"Merged overstory/sling-guard-builder/overstory-afr9 into main. Conflict in .mulch/expertise/cli.jsonl resolved: all 3 appended entries preserved (mx-ef4c2c, mx-465bee, mx-8174e3). Merge commit 55bfae2, 2026 tests pass, lint+typecheck clean.","closedAt":"2026-02-21T07:19:50.499514-08:00"}
{"id":"overstory-p4st","title":"isCanonicalRoot guard blocks ALL worktree overlays when dogfooding on overstory repo","status":"closed","type":"bug","priority":0,"createdAt":"2026-02-13T14:45:19.716806-08:00","updatedAt":"2026-02-13T14:48:58.944774-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nisCanonicalRoot() in src/agents/overlay.ts:197 uses the presence of .overstory/config.yaml as a heuristic to identify the canonical project root. When dogfooding overstory on its own repo, .overstory/config.yaml is tracked in git. Every worktree is a git checkout, so every worktree also contains .overstory/config.yaml. The guard returns true for ALL worktrees, blocking overlay writes and preventing ALL agent spawning.\n\n## Reproduction\n\noverstory sling overstory-b3sa --capability lead --name lead-sessions --depth 1\nError: Refusing to write overlay to canonical project root\n\nThe worktree was created (step 6 in sling), but the overlay write (step 7) fails, leaving an orphaned worktree.\n\n## Root Cause\n\n1. .overstory/config.yaml is tracked in git\n2. createWorktree() checks out a branch including all tracked files\n3. The checkout includes .overstory/config.yaml\n4. isCanonicalRoot(worktreePath) finds it and returns true\n5. writeOverlay() throws AgentError\n\n## Impact\n\nP0 blocker: Cannot spawn ANY agents when dogfooding. The entire swarm system is inoperable on its own repo. Orphaned worktrees left behind on failure. Existing test (overlay.test.ts:436) does not simulate the dogfooding scenario.\n\n## Fix\n\nReplace the .overstory/config.yaml heuristic with a deterministic path comparison. Pass canonicalRoot (from config.project.root) to writeOverlay() and compare resolved paths:\n\nisCanonicalRoot(dir, canonicalRoot): resolve(dir) === resolve(canonicalRoot)\n\nUpdate writeOverlay signature and call site in sling.ts line 364.\n\n## Files\n\n- src/agents/overlay.ts: fix isCanonicalRoot(), update writeOverlay() signature\n- src/commands/sling.ts: pass config.project.root to writeOverlay()\n- src/agents/overlay.test.ts: add dogfooding test case\n\n## Secondary\n\nsling.ts should clean up the worktree if overlay write fails (currently orphaned on error).","closeReason":"Replaced file-existence heuristic with deterministic path comparison. writeOverlay() now takes canonicalRoot param. Added worktree cleanup on overlay failure in sling.ts. Added dogfooding test case.","closedAt":"2026-02-13T14:48:58.944774-08:00"}
{"id":"overstory-p5mm","title":"Implement status.ts perf fixes: Set lookup + subprocess caching","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T07:58:34.160819-08:00","updatedAt":"2026-02-20T08:01:18.26609-08:00","assignee":"jayminwest@gmail.com","description":"Fix overstory-4zcj (Set lookup) and overstory-je5w (subprocess caching) in src/commands/status.ts","closeReason":"Implemented Set-based tmux lookup (replaces .some()) and module-level TTL subprocess cache in status.ts. Exported invalidateStatusCache() for tests. 16 tests passing, all quality gates clean.","closedAt":"2026-02-20T08:01:18.26609-08:00"}
{"id":"overstory-p6pn","title":"Phase 2: Supervisor agent (per-project team lead)","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T13:50:43.380336-08:00","updatedAt":"2026-02-12T14:55:25.842897-08:00","assignee":"jayminwest@gmail.com","description":"Implement a per-project supervisor agent that monitors and manages workers within a single project. The supervisor bridges the coordinator and leaf workers. Key properties: (1) Structurally cannot write code - tool restrictions enforced at spawn time, not via prompt discipline, (2) Spawns workers via overstory sling, monitors progress, nudges stalled agents, (3) Handles the worker-done → merge-ready → cleanup lifecycle, (4) Escalates to coordinator when stuck (after N nudge attempts), (5) One supervisor per active project, persistent session with self-managed compaction. Communication: uses mail system for all inter-agent coordination (WORKER_DONE, MERGE_READY, MERGED, MERGE_FAILED message types). No .md files for runtime context - beads issues carry task state, mail carries coordination signals.","closeReason":"Phase 2 complete: supervisor capability added to types, hooks-deployer enforces read-only, supervisor.ts CLI command (start/stop/status), agents/supervisor.md behavioral definition (406 lines). All quality gates pass (499 tests, lint, typecheck).","closedAt":"2026-02-12T14:55:25.842897-08:00"}
{"id":"overstory-padg","title":"Write tests for watch command (src/commands/watch.test.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:04:37.020189-08:00","updatedAt":"2026-02-13T08:08:37.132252-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added comprehensive test suite for watch command with 14 tests covering help display, background mode, PID file operations, and error handling. All quality gates passed.","closedAt":"2026-02-13T08:08:37.132252-08:00"}
{"id":"overstory-pb1p","title":"Add per-lead agent budget/ceiling","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T06:26:48.855484-08:00","updatedAt":"2026-02-21T06:26:48.855484-08:00","assignee":"jayminwest@gmail.com","description":"Let the coordinator specify max_agents per lead or per batch in dispatch mail or config. Leads should respect this ceiling when deciding how many scouts/builders/reviewers to spawn. Prevents runaway spawning where 6 leads x (2 scouts + N builders + N reviewers) = 60+ agents. Could be implemented as: config.yaml agents.maxAgentsPerLead, or as a --max-agents flag on overstory sling, or as a payload field in dispatch mail."}
{"id":"overstory-pcef","title":"Add project name to tmux session naming convention","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T20:19:01.117617-08:00","updatedAt":"2026-02-13T20:34:18.294275-08:00","assignee":"jayminwest@gmail.com","description":"Change tmux session names from 'overstory-{agent}' to 'overstory-{projectName}-{agent}' using config.project.name. This prevents cross-project collisions and enables project-scoped cleanup.\n\nTouch points:\n- sling.ts:382 — overstory-${name} → overstory-${projectName}-${name}\n- coordinator.ts:29 — hardcoded TMUX_SESSION constant, needs config.project.name\n- monitor.ts:30 — hardcoded TMUX_SESSION constant, needs config.project.name\n- supervisor.ts:187 — overstory-supervisor-${name} → overstory-${projectName}-supervisor-${name}\n- tmux.ts:5 — update naming convention doc comment\n- clean.ts:129 — filter by 'overstory-{projectName}-' instead of 'overstory-'\n\nNote: coordinator.ts and monitor.ts currently define TMUX_SESSION as a module-level constant. They'll need to compute it after loadConfig() returns the project name, or accept it as a parameter.","closeReason":"Implemented project-scoped tmux naming across sling, coordinator, monitor, supervisor, clean, and tmux.ts. All tmux sessions now use overstory-{projectName}-{agentName} pattern derived from config.project.name.","closedAt":"2026-02-13T20:34:18.294275-08:00"}
{"id":"overstory-plpq","title":"Update coordinator.md to delegate spec writing to scouts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T14:48:24.994953-08:00","updatedAt":"2026-02-13T06:37:06.852134-08:00","assignee":"jayminwest@gmail.com","closeReason":"Updated coordinator.md to delegate spec writing to scouts: added scout-delegated spec pattern (preferred for complex tasks) alongside direct spec writing, updated scout capability description, added cost awareness note","closedAt":"2026-02-13T06:37:06.852134-08:00"}
{"id":"overstory-pob7","title":"Lead 2: CLI standard commands test coverage (prime, log, watch, worktree)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T07:58:39.515081-08:00","updatedAt":"2026-02-13T08:55:07.56063-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.56063-08:00"}
{"id":"overstory-ptia","title":"Cascading waste: lead spawns redundant builders when work lands in root instead of worktree","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T13:03:55.147119-08:00","updatedAt":"2026-02-13T14:42:42.523851-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nIn the latest coordinator run, the cascading failure went:\n\n1. Orchestrator dispatched steelman task to lead-steelman (20:54)\n2. Lead spawned builder-steelman (20:56) to create STEELMAN.md and edit README.md\n3. builder-steelman wrote both files to the CANONICAL REPO ROOT instead of its worktree\n4. Lead couldn't see any commits on builder-steelman's branch (because there were none in the worktree)\n5. Lead concluded builder-steelman failed and spawned builder-steelman-2 (21:00)\n6. Lead even explicitly warned builder-2: 'The previous builder wrote files to the main repo instead of its worktree'\n7. builder-steelman was marked zombie, builder-steelman-2 continued — likely hitting the same root-write problem\n\n## Impact\n\n- Double the agent sessions (2 builders instead of 1) = doubled token cost\n- builder-steelman went zombie with no useful output on its branch\n- Root repo polluted with untracked files (STEELMAN.md) and unstaged modifications (README.md)\n- No useful work on ANY agent branch — all three worktrees have zero commits\n- Lead wasted tokens diagnosing the problem and re-dispatching\n\n## Root Cause Chain\n\n1. No path boundary enforcement (see overstory-4200, overstory-loa7)\n2. No worktree path in overlay instructions (see overstory-sv0q)\n3. Claude Code resolves file paths from project root, not tmux cwd\n4. Lead has no mechanism to PREVENT builders from writing to root — only advisory text\n\n## This issue is a symptom — blocked by\n\n- overstory-4200 (Write/Edit path boundary guard)\n- overstory-loa7 (Bash path boundary guard)\n- overstory-sv0q (overlay worktree path + constraints)\n\nFixing the three dependency issues eliminates this cascading failure mode entirely.","closeReason":"All 3 root cause issues (overstory-4200 path boundary guard, overstory-loa7 bash guard, overstory-sv0q overlay constraints) are closed. The cascading waste symptom is eliminated.","closedAt":"2026-02-13T14:42:42.523851-08:00"}
{"id":"overstory-ptpx","title":"Canonical branch auto-detection only recognizes main/master/develop","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-23T11:00:09.730665-08:00","updatedAt":"2026-02-23T11:14:41.663117-08:00","assignee":"jayminwest@gmail.com","description":"init.ts:81-89 only matches 'main', 'master', or 'develop' as canonical branch names. Anything else (prod, mainline, release, trunk) silently falls back to 'main'. This will cause merge operations to target the wrong branch in legacy projects. Fix: accept whatever branch is detected as current, or prompt the user to confirm during init rather than silently defaulting.","closeReason":"Canonical branch auto-detection fix: removed hardcoded allowlist (main/master/develop) from detectCanonicalBranch fallback path. Now accepts any non-empty branch name. Builder delivered, self-verified (15/15 tests, typecheck clean), merge_ready sent.","closedAt":"2026-02-23T11:14:41.663117-08:00"}
{"id":"overstory-pvn7","title":"Daemon integration tests (startDaemon loop, session load/save, escalation)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-13T06:51:37.377415-08:00","updatedAt":"2026-02-13T07:00:42.648051-08:00","assignee":"jayminwest@gmail.com","description":"Add integration tests for the full daemon loop in daemon.test.ts. Test: (1) tick with no sessions file (graceful no-op), (2) tick with healthy sessions (no state changes), (3) tick with dead tmux → zombie transition + termination, (4) tick with stalled agent → escalation flow, (5) session persistence round-trip (load → modify → save → reload). Use real temp directories and real SQLite. Mock only tmux operations (isSessionAlive, killSession) since real tmux interferes with dev sessions.","closeReason":"Added 18 daemon integration tests in src/watchdog/daemon.test.ts covering: no sessions file no-op, healthy sessions, dead tmux zombie transition, progressive nudging escalation (levels 0-3), triage integration with tier1Enabled toggle, agent recovery reset, session persistence round-trip, backward compatibility for pre-escalation sessions. Used DI for tmux/triage/nudge instead of mock.module().","closedAt":"2026-02-13T07:00:42.648051-08:00"}
{"id":"overstory-pz8y","title":"Add overstory logs command for cross-agent log querying","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:29.463653-08:00","updatedAt":"2026-02-16T13:16:38.49758-08:00","assignee":"jayminwest@gmail.com","description":"New CLI command to query NDJSON logs across agents. Support: --agent X, --level error, --since 1h, --follow. Unified timeline view from logs scattered across .overstory/logs/{agent-name}/{session-timestamp}/ directories.","closeReason":"Implemented overstory logs command via 3 builders: logs.ts (impl), index.ts+completions.ts (wiring), logs.test.ts (11 tests). All branches ready for merge. Note: completions.test.ts needs 26->27 update post-merge.","closedAt":"2026-02-16T13:16:38.49758-08:00"}
{"id":"overstory-pzds","title":"Tier 2 monitor agent — continuous patrol definition and command","status":"closed","type":"task","priority":3,"createdAt":"2026-02-13T06:51:30.384385-08:00","updatedAt":"2026-02-13T07:03:33.664682-08:00","assignee":"jayminwest@gmail.com","description":"Define a new monitor agent capability for long-running patrol. Create agents/monitor.md with: continuous monitoring of all active supervisors and workers, mail-based lifecycle requests (respawn, restart, cycle), periodic health summaries sent to orchestrator via mail. Add overstory monitor start/stop/status subcommands (similar to coordinator). The monitor agent runs at project root (no worktree, like coordinator) and uses overstory mail + nudge for all interactions.","closeReason":"Created agents/monitor.md (Tier 2 patrol agent definition), src/commands/monitor.ts (start/stop/status), added to agent-manifest.json, hooks-deployer.ts (NON_IMPLEMENTATION + COORDINATION sets), and CLI router","closedAt":"2026-02-13T07:03:33.664682-08:00"}
{"id":"overstory-q1dp","title":"Add unified agent activity feed","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:37.343435-08:00","updatedAt":"2026-02-16T13:59:07.999795-08:00","assignee":"jayminwest@gmail.com","description":"New command: 'overstory feed' for a unified real-time event stream across all agents. Like 'tail -f' for the whole fleet. Currently 'overstory inspect --follow' is per-agent only.","closeReason":"Implemented overstory feed command: unified real-time event stream across all agents. Created src/commands/feed.ts (362 lines) with --follow/-f live tailing, --agent/--run/--since/--limit/--interval/--json flags. 32 tests passing in feed.test.ts. Wired into index.ts and completions.ts. Two branches ready for merge: feed-builder and feed-wiring-builder.","closedAt":"2026-02-16T13:59:07.999795-08:00"}
{"id":"overstory-q4nb","title":"Add explicit Task tool prohibition and workaround heuristic to coordinator/supervisor agent definitions","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T06:20:50.645213-08:00","updatedAt":"2026-02-13T06:31:53.163487-08:00","assignee":"jayminwest@gmail.com","description":"coordinator.md and supervisor.md list available tools and workflows but never explicitly prohibit Claude Code built-in Task/TeamCreate/SendMessage tools. The model gravitates toward Task because it is familiar and always present. Fix: (1) Add to Constraints: NEVER use Claude Code built-in Task, TeamCreate, SendMessage, or any native subagent tools. ALL delegation MUST go through overstory sling. (2) Add Failure Mode: NATIVE_DELEGATION — Using Task tool instead of overstory sling. (3) Add Workaround Heuristic: If you find yourself reaching for workarounds (bun -e to edit, manual file writes, piping through bash) STOP. You are doing implementation work that should be delegated via overstory sling to a builder in a worktree. The coordinator never needs workarounds because it never touches code.","closeReason":"Added explicit Task tool prohibition, NATIVE_DELEGATION failure mode, and workaround heuristic to coordinator.md and supervisor.md. Both agents now have clear behavioral guidance to use overstory sling instead of Claude Code native tools.","closedAt":"2026-02-13T06:31:53.163487-08:00"}
{"id":"overstory-q9qk","title":"Lead agent stays alive after sending worker_done — no self-termination","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T13:06:17.241674-08:00","updatedAt":"2026-02-15T12:36:20.884254-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nlead-steelman sent worker_done mail at 21:04:48 but its tmux session is still alive. The lead should either:\n1. Self-terminate after sending worker_done (the builder.md completion protocol says 'Exit. Do NOT idle')\n2. Be torn down by the orchestrator after receiving worker_done\n\nCurrently neither happens. The lead's tmux session stays running, consuming resources.\n\n## Evidence\n\n- overstory status shows lead-steelman still active in 'working' state\n- tmux has-session confirms the session is alive\n- lead sent worker_done 10+ minutes ago\n\n## Root Cause\n\nThe lead.md base definition likely doesn't have the same strict 'Exit after completion' protocol that builder.md has. And the orchestrator isn't processing the worker_done message to trigger teardown (see sibling issue about orchestrator not being nudged).\n\n## Solution\n\n1. lead.md should include explicit self-termination after worker_done (same as builder.md's 'Exit. Do NOT idle')\n2. Orchestrator should tear down agents after receiving worker_done (overstory worktree clean or direct tmux kill)\n3. Both mechanisms should exist as defense-in-depth","closeReason":"Updated agents/lead.md Completion Protocol to send worker_done mail instead of merge_ready, added explicit exit instruction, and added MISSING_WORKER_DONE and POST_CLOSE_IDLE failure modes","closedAt":"2026-02-15T12:36:20.884254-08:00"}
{"id":"overstory-q9v1","title":"Deploy sandbox settings in hooks-deployer.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:22:31.410325-08:00","updatedAt":"2026-02-15T12:32:07.476617-08:00","assignee":"jayminwest@gmail.com","description":"Modify deployHooks() in hooks-deployer.ts to write sandbox configuration into the settings.local.json deployed to each agent worktree. When sandbox.enabled is true in overstory config, add the sandbox block: { enabled: true, autoAllowBashIfSandboxed: true, allowUnsandboxedCommands: false, network: { allowedDomains: [...from config...] } }. The denyReadPaths from config should map to Claude Code's sandbox filesystem deny rules. When sandbox.enabled is false, omit the sandbox block entirely (current behavior). The hooks-deployer already writes .claude/settings.local.json — this extends the existing mechanism.","closeReason":"Sandbox integration complete - all code + tests implemented and passing","closedAt":"2026-02-15T12:32:07.476617-08:00"}
{"id":"overstory-q9xo","title":"Implement overstory run CLI command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:20:51.362334-08:00","updatedAt":"2026-02-13T20:39:38.684109-08:00","assignee":"jayminwest@gmail.com","description":"New src/commands/run.ts with subcommands, wire into index.ts, add tests","closeReason":"Implemented run command with list/show/complete subcommands, registered in CLI router, wrote tests","closedAt":"2026-02-13T20:39:38.684109-08:00"}
{"id":"overstory-qc7t","title":"Review: lead.md mandatory review loop changes","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:07:39.210623-08:00","updatedAt":"2026-02-16T13:12:46.859236-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review completed - false FAIL due to reviewer checking its own worktree instead of builder branch. Manual verification confirms all changes applied correctly.","closedAt":"2026-02-16T13:12:46.859236-08:00"}
{"id":"overstory-qd3n","title":"Make model configurable for coordinator, supervisor, and monitor agents","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-17T06:11:31.941305-08:00","updatedAt":"2026-02-17T07:05:30.181583-08:00","assignee":"jayminwest@gmail.com","description":"coordinator.ts, supervisor.ts, and monitor.ts hardcode their Claude model (opus/opus/sonnet) instead of reading from agent-manifest.json or config. sling.ts already reads agentDef.model correctly for regular workers. Fix: have the 3 persistent agent commands read from manifest/config instead of hardcoding. Add missing supervisor and monitor entries to agent-manifest.json. Optionally add a models: section to config.yaml for user overrides. ~20-30 lines for minimal fix, ~100 lines for full config support. See GitHub issue #6.","closeReason":"Implemented configurable model selection for coordinator, supervisor, and monitor agents. Added models: section to config.yaml, supervisor/monitor entries to manifest, resolveModel() helper. Resolution: config > manifest > fallback. GH issue #6.","closedAt":"2026-02-17T07:05:30.181583-08:00"}
{"id":"overstory-qfln","title":"Update config validation for providers and extended model refs","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:13:40.48878-08:00","updatedAt":"2026-02-20T07:32:53.477781-08:00","assignee":"jayminwest@gmail.com","description":"Update validateConfig() in config.ts to handle the new providers section and extended model references.\n\nFILES: src/config.ts\n\nChanges:\n- Validate providers section: each provider must have a valid type ('native' or 'gateway'), gateway providers require baseUrl and authTokenEnv\n- Validate models section: allow both simple aliases ('sonnet','opus','haiku') and provider-prefixed strings ('openrouter/openai/gpt-5.3')\n- For provider-prefixed model refs, validate that the referenced provider exists in the providers section\n- Warn (not error) when a non-Anthropic model is assigned to a tool-heavy role (builder, scout) since tool-use compat can't be verified at config time\n- Remove the hardcoded validModels=['sonnet','opus','haiku'] gate at lines 420-429, replace with richer validation","closeReason":"Completed config validation update. Spawned config-validator-builder which added provider validation (type native/gateway, gateway requires baseUrl+authTokenEnv) and replaced hardcoded model aliases with provider-prefixed ref support. Stderr warning for non-Anthropic models in builder/scout roles. 9 new tests, all 44 pass.","closedAt":"2026-02-20T07:32:53.477781-08:00"}
{"id":"overstory-qh1l","title":"Add --outcome-status filter for merge conflict pattern queries","status":"open","type":"feature","priority":3,"createdAt":"2026-02-21T05:59:05.82857-08:00","updatedAt":"2026-02-21T05:59:05.82857-08:00","assignee":"jayminwest@gmail.com","description":"When querying merge patterns in src/merge/resolver.ts, add --outcome-status success filter to only use patterns that have been confirmed to work before. Depends on outcome feedback loop being in place (records need outcomes data first). Requires adding outcomeStatus param to mulch/client.ts search() or query() methods."}
{"id":"overstory-qk0f","title":"Outcome feedback loop: append outcomes to applied expertise records","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T05:58:54.806083-08:00","updatedAt":"2026-02-21T05:58:54.806083-08:00","assignee":"jayminwest@gmail.com","description":"During session-end (src/commands/log.ts), overstory already records new expertise. Extend this to also append outcomes to the specific mx-* records that were loaded at spawn time. This requires: (1) tracking which record IDs were embedded in the agent overlay during sling, (2) on session-end, using mulch edit or the programmatic editRecord() API to append outcome entries to those records. This feeds mulch's confirmation-frequency scoring, making future priming smarter over time."}
{"id":"overstory-qn3h","title":"Enable score-aware priming via --sort-by-score","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-20T12:49:40.172836-08:00","updatedAt":"2026-02-20T13:19:25.813201-08:00","assignee":"jayminwest@gmail.com","description":"Add sortByScore option to MulchClient.prime() in src/mulch/client.ts and pass --sort-by-score flag to mulch CLI. Default to true in src/commands/sling.ts when pre-loading file-scoped expertise for spawned agents. This ensures agents receive the most battle-tested records first when token budget is tight, leveraging mulch 0.4.3's confirmation-frequency scoring.","closeReason":"Added search() options (file, sortByScore) and record() outcome flags (outcomeStatus, outcomeDuration, outcomeTestResults, outcomeAgent) to MulchClient. 45 tests pass.","closedAt":"2026-02-20T13:19:25.813201-08:00"}
{"id":"overstory-qne","title":"Sling launches interactive claude instead of headless -p mode","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T10:46:54.440719-08:00","updatedAt":"2026-02-12T10:56:58.596219-08:00","assignee":"jayminwest@gmail.com","description":"sling.ts line 310 runs 'claude --dangerously-skip-permissions' in interactive mode, then tries sendKeys to submit the initial prompt. The Claude Code welcome screen blocks input, causing agents to get stuck. Fix: use 'claude -p <prompt>' for headless execution.","closeReason":"Fixed: sling now uses 'claude -p' headless mode instead of interactive mode with sendKeys. Removes sendKeys step entirely, baking the prompt into the command.","closedAt":"2026-02-12T10:56:58.596219-08:00"}
{"id":"overstory-qpdn","title":"Validate overstory status monitoring during agent lifecycle","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T12:57:42.2969-08:00","updatedAt":"2026-02-12T13:19:58.374386-08:00","assignee":"jayminwest@gmail.com","description":"While agent runs, verify overstory status shows agent as active with correct state. After agent finishes, verify status transitions to completed/zombie. Check that tmux reconciliation logic works.","closeReason":"Validated overstory status with --json and human-readable output. Shows agents, worktrees, tmux sessions, mail, merge queue counts correctly.","closedAt":"2026-02-12T13:19:58.374386-08:00"}
{"id":"overstory-qqnv","title":"Verify and fix template resolution for external projects","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T12:57:49.443545-08:00","updatedAt":"2026-02-12T13:01:21.998251-08:00","assignee":"jayminwest@gmail.com","description":"overlay.ts and hooks-deployer.ts read template files (overlay.md.tmpl, hooks.json.tmpl). These must resolve from overstory's installation directory, not from the target project's cwd. Verify how paths are resolved - fix if broken. Related to template resolution task in phase 1 but specifically for external projects.","closeReason":"Verified: overlay.ts:10-12 and hooks-deployer.ts:24-26 use import.meta.dir to resolve template paths relative to overstory source, not process.cwd(). Config resolveProjectRoot() also handles worktree resolution. No fix needed.","closedAt":"2026-02-12T13:01:21.998251-08:00"}
{"id":"overstory-qqr4","title":"Dashboard crashes: String.prototype.repeat argument must be >= 0 and not Infinity","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-19T12:43:10.073063-08:00","updatedAt":"2026-02-20T08:03:35.506832-08:00","assignee":"jayminwest@gmail.com","description":"The `overstory dashboard` command crashes with:\n\n```\nError: String.prototype.repeat argument must be greater than or equal to 0 and not be Infinity\n```\n\nThis likely occurs when a calculated column width or padding value is negative or Infinity, possibly due to terminal width calculations or when agent name/status strings exceed expected bounds. The repeat() call in the TUI rendering logic needs to clamp its argument to Math.max(0, n).","closeReason":"All .repeat() calls in dashboard.ts now guarded with Math.max(0, ...). Added early-return guards in pad() and truncate(). 12 edge-case tests added.","closedAt":"2026-02-20T08:03:35.506832-08:00"}
{"id":"overstory-qs85","title":"Write sanitizer.test.ts for src/logging/sanitizer.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:04:57.059708-08:00","updatedAt":"2026-02-13T09:32:05.323934-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.323934-08:00"}
{"id":"overstory-quik","title":"Doctor: version and update check","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T22:00:02.828031-08:00","updatedAt":"2026-02-15T12:49:03.90798-08:00","assignee":"jayminwest@gmail.com","description":"Check if overstory is up to date (once published to npm).\n\nChecks:\n- Read current version from package.json or src/index.ts VERSION constant\n- Query npm registry: 'npm view overstory version' (or whatever the package name will be)\n- Compare versions using semver logic\n- If outdated, warn with: 'Update available: X.Y.Z → A.B.C. Run: npm update -g overstory'\n- Graceful degradation: if npm registry unreachable, report 'unable to check' and pass\n\nThis mirrors mulch's approach in src/commands/doctor.ts (lines 209-223) and src/utils/version.ts.\n\nImplementation:\n- Create src/utils/version.ts with getCurrentVersion(), getLatestVersion(), compareSemver()\n- Reuse these in both doctor and a future 'overstory update' command\n\nSource references (mulch pattern):\n- /Users/jayminwest/Projects/mulch/src/utils/version.ts — version utilities\n- /Users/jayminwest/Projects/mulch/src/commands/doctor.ts lines 209-223 — update check in doctor\n\nOutput: pass/warn. Outdated = warn. Registry unreachable = pass with note. This is Tier 3.","closeReason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","closedAt":"2026-02-15T12:49:03.90798-08:00"}
{"id":"overstory-qun","title":"sessions.json grows unbounded - no cleanup of zombie entries","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T08:19:29.245975-08:00","updatedAt":"2026-02-12T08:44:44.296082-08:00","assignee":"jayminwest@gmail.com","description":"sessions.json accumulates all agent sessions (including zombies) indefinitely. There's no mechanism to prune old zombie entries. Over time with many sling cycles, this file will grow. Should add a cleanup mechanism - either 'overstory sessions prune' command, or auto-prune zombies older than a threshold, or move zombies to a separate history file.","closeReason":"worktree clean now prunes zombie entries from sessions.json whose worktree paths no longer exist on disk","closedAt":"2026-02-12T08:44:44.296082-08:00"}
{"id":"overstory-qwyv","title":"Fix dashboard DB connection churn (retry): hold stores open for poll loop","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T08:13:39.132718-08:00","updatedAt":"2026-02-20T08:23:28.356198-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed dashboard DB connection churn: PreOpenedStores interface + gatherStatus 5th param, openDashboardStores/closeDashboardStores helpers in dashboard.ts, poll loop opens stores once and closes on SIGINT/finally. Backward-compatible. All quality gates pass.","closedAt":"2026-02-20T08:23:28.356198-08:00"}
{"id":"overstory-qxwc","title":"Monitor agent: mulch domain health checks via enriched status --json","status":"open","type":"feature","priority":3,"createdAt":"2026-02-13T21:42:26.932182-08:00","updatedAt":"2026-02-13T21:42:26.932182-08:00","assignee":"jayminwest@gmail.com","description":"The Tier 2 monitor agent already patrols fleet health. Extend it to check mulch domain health using the enriched mulch status --json output (governance utilization, stale counts, type/classification distribution). Warn when domains approach governance limits. Suggest pruning or compaction when stale counts are high. Natural extension of the monitor's existing patrol loop."}
{"id":"overstory-r2nk","title":"Add unmerged branch safety check to worktree clean","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T16:33:16.06798-08:00","updatedAt":"2026-02-18T16:41:12.486717-08:00","assignee":"jayminwest@gmail.com","description":"Add isBranchMerged to manager.ts, add --force flag to worktree clean command, warn/skip unmerged branches without --force, tests for both","closeReason":"Added isBranchMerged() to manager.ts. worktree clean now skips unmerged branches by default with clear warnings, requires --force to delete them. Tests cover merged, unmerged, and JSON output scenarios.","closedAt":"2026-02-18T16:41:12.486717-08:00"}
{"id":"overstory-r39g","title":"Fix mock.module() leakage in consistency.test.ts","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T14:14:07.967675-08:00","updatedAt":"2026-02-15T14:24:00.8537-08:00","assignee":"jayminwest@gmail.com","closeReason":"Consistency test DI refactor complete (8d52688), doctor tests already fixed (420d8b7)","closedAt":"2026-02-15T14:24:00.8537-08:00"}
{"id":"overstory-r4ki","title":"Update scout.md to include spec-writing workflow","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T14:48:23.900469-08:00","updatedAt":"2026-02-13T06:26:41.411897-08:00","assignee":"jayminwest@gmail.com","closeReason":"Updated agents/scout.md with spec-writing workflow. Added overstory spec write to tools, bd create for issue filing, a Spec-Writing Workflow subsection under Workflow, clarified constraints to allow spec writing as the one exception, added SPEC_WITHOUT_ISSUE failure mode, and updated Completion Protocol to include spec creation step.","closedAt":"2026-02-13T06:26:41.411897-08:00"}
{"id":"overstory-r8a","title":"init --force doesn't preserve/migrate existing SQLite data (mail.db, metrics.db)","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T09:41:31.601869-08:00","updatedAt":"2026-02-12T09:50:55.889866-08:00","assignee":"jayminwest@gmail.com","description":"Running overstory init --force reinitializes config files (config.yaml, agent-manifest.json, hooks.json) and recreates directories, but it doesn't warn that existing mail.db and metrics.db data will be orphaned. The DBs themselves survive (they're not deleted), but re-running init after the DBs exist means the new init doesn't check compatibility. If the schema ever changes, init --force won't migrate. Consider either: (1) adding a warning about existing data, (2) running schema migration on init, or (3) documenting this as expected behavior.","closeReason":"init --force now runs schema migration on existing mail.db and metrics.db. Opens each DB, enables WAL mode, re-runs CREATE TABLE/INDEX IF NOT EXISTS to apply any schema additions without losing existing data. Prints migration status.","closedAt":"2026-02-12T09:50:55.889866-08:00"}
{"id":"overstory-r93n","title":"Mulch maintenance in overstory clean","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:08:40.066579-08:00","updatedAt":"2026-02-15T12:41:50.83171-08:00","assignee":"jayminwest@gmail.com","description":"Add mulch health checks to overstory clean. Report domains approaching governance limits (warn threshold). Run mulch prune --dry-run and report stale record counts. Run mulch doctor and report issues. All informational by default, not destructive. Uses expanded MulchClient.prune() and .doctor().","closeReason":"Mulch health checks in overstory clean: checkMulchHealth() with status/prune/doctor, informational output on --all flag. Committed f4d9210.","closedAt":"2026-02-15T12:41:50.83171-08:00"}
{"id":"overstory-r9g","title":"L2-1: Implement overlay generator (src/agents/overlay.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:11:41.648364-08:00","updatedAt":"2026-02-12T07:33:09.513247-08:00","assignee":"jayminwest@gmail.com","description":"Generate per-worker CLAUDE.md overlay from template. Functions: generateOverlay(config: OverlayConfig) -> string, writeOverlay(worktreePath, config) -> Promise<void>. Reads templates/overlay.md.tmpl, fills variables, writes to {worktree}/.claude/CLAUDE.md.","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.513247-08:00"}
{"id":"overstory-r9x0","title":"Build: all spawn-reduction changes across agent definitions","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T06:34:07.026015-08:00","updatedAt":"2026-02-21T06:44:08.626583-08:00","assignee":"jayminwest@gmail.com","closeReason":"Modified 4 agent definition files to reduce unnecessary spawning: added Task Complexity Assessment to lead.md (simple/moderate/complex tiers), made scouts and reviewers optional for simple/moderate tasks, added self-verification path for lead, replaced INSIGHT: protocol with plain notable findings across scout/reviewer/supervisor. All quality gates pass.","closedAt":"2026-02-21T06:44:08.626583-08:00"}
{"id":"overstory-ra2z","title":"Coordinator cannot spawn agents in Claude Code sandbox mode","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-15T13:45:38.817592-08:00","updatedAt":"2026-02-15T13:57:25.081452-08:00","assignee":"jayminwest@gmail.com","description":"overstory sling fails with 'error connecting to /private/tmp/tmux-501/default (Operation not permitted)' when run inside Claude Code sandbox. The sandbox blocks tmux socket access, preventing the coordinator from spawning any agents. This makes the entire swarm system non-functional when the coordinator runs inside Claude Code. Need to either: (a) document that coordinator must run outside sandbox, (b) add tmux socket path to sandbox allowlist in hooks/init, or (c) provide a non-tmux agent spawning backend.","closeReason":"Removed sandbox config feature from overstory. PreToolUse hook guards are the real security layer. Backlog issue overstory-toyn tracks future revisit.","closedAt":"2026-02-15T13:57:25.081452-08:00"}
{"id":"overstory-rbj","title":"[Epic] Layer 2: Agent Lifecycle + Mail","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T07:11:37.127858-08:00","updatedAt":"2026-02-12T07:33:22.806001-08:00","assignee":"jayminwest@gmail.com","description":"Agent lifecycle management and mail system. 7 parallel tasks. Depends on Layer 1 completion.","closeReason":"All 7 L2 subtasks completed","closedAt":"2026-02-12T07:33:22.806001-08:00"}
{"id":"overstory-rbqc","title":"Update agent protocols: INSIGHT prefix for read-only agents, clean merge skip for merger","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T17:28:17.738181-08:00","updatedAt":"2026-02-16T17:32:21.247873-08:00","assignee":"jayminwest@gmail.com","closeReason":"Updated agent completion protocols: scout/reviewer use INSIGHT prefix instead of mulch record (read-only), merger skips mulch record for clean Tier 1 merges. All acceptance criteria met.","closedAt":"2026-02-16T17:32:21.247873-08:00"}
{"id":"overstory-rdd","title":"Test depth limit","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T08:16:53.488036-08:00","updatedAt":"2026-02-12T08:23:25.843231-08:00","assignee":"jayminwest@gmail.com","description":"Temporary test task for depth limit testing","closeReason":"Test tasks created during integration testing, not real work","closedAt":"2026-02-12T08:23:25.843231-08:00"}
{"id":"overstory-rdo","title":"[Epic] Layer 5: Tests","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T07:12:22.489209-08:00","updatedAt":"2026-02-12T07:56:38.532666-08:00","assignee":"jayminwest@gmail.com","description":"All test files. 11 parallel tasks. Can run in parallel with Layers 3-4. Depends on Layer 2 completion.","closeReason":"All 11 test files written and passing (238 tests, 505 assertions)","closedAt":"2026-02-12T07:56:38.532666-08:00"}
{"id":"overstory-rgst","title":"Add provider types and config schema","status":"closed","type":"task","priority":2,"createdAt":"2026-02-19T12:13:34.910901-08:00","updatedAt":"2026-02-19T12:50:45.262705-08:00","assignee":"jayminwest@gmail.com","description":"Extend types.ts and config.ts to support a providers section and extended model references.\n\nFILES: src/types.ts, src/config.ts\n\nTypes changes (src/types.ts):\n- Add ProviderConfig interface: { type: 'native' | 'gateway'; baseUrl?: string; authTokenEnv?: string }\n- Add to OverstoryConfig: providers: Record<string, ProviderConfig>\n- Change ModelRef: allow string (backward-compat alias like 'sonnet') OR 'provider/model' string format (e.g. 'openrouter/openai/gpt-5.3')\n- Keep ModelAlias type ('sonnet'|'opus'|'haiku') for backward compat\n\nConfig changes (src/config.ts):\n- Add DEFAULT_CONFIG.providers: { anthropic: { type: 'native' } }\n- Parse providers section from config.yaml and config.local.yaml\n- Merge providers across config layers (local overrides base)\n\nBackward compat: empty providers section = current behavior (Anthropic only). Simple model strings ('sonnet') still work.","closeReason":"Provider types and config schema implemented. ModelAlias, ModelRef, ProviderConfig types added. Config.ts parses providers section. All fixtures updated. 1911 tests, typecheck clean.","closedAt":"2026-02-19T12:50:45.262705-08:00"}
{"id":"overstory-rhk5","title":"Mulch integration improvements: priming, search, recording, overlay","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-20T13:14:05.568731-08:00","updatedAt":"2026-02-20T13:28:19.046465-08:00","assignee":"jayminwest@gmail.com","description":"Umbrella for mulch integration batch. Covers 4 sub-issues: (1) overstory-qn3h P1 sort-by-score in client.ts + sling.ts, (2) overstory-0fuu P1 auto-detect domains in sling.ts, (3) overstory-4jca P3 --file filter in client.ts search(), (4) overstory-vs8z P3 outcome recording flags in client.ts + overlay.ts + agents/*.md. File area: src/mulch/client.ts, src/mulch/client.test.ts, src/commands/sling.ts, src/commands/sling.test.ts, src/agents/overlay.ts, agents/*.md. Acceptance: all 4 sub-issues closed, quality gates pass, branch ready to merge.","closeReason":"Mulch integration batch complete: (1) search() file+sortByScore options in client.ts, (2) auto-detect domains from file scope in sling.ts, (3) --file filter for search in client.ts, (4) outcome flags in record() + overlay quality gates + agent defs. 3 builders, 3 reviewers, all PASS. 3 branches ready to merge.","closedAt":"2026-02-20T13:28:19.046465-08:00"}
{"id":"overstory-rhlb","title":"Update lead.md: mandatory review loop after builder completion","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:03:17.055243-08:00","updatedAt":"2026-02-16T13:12:45.294229-08:00","assignee":"jayminwest@gmail.com","closeReason":"Builder completed all 4 edits to agents/lead.md: mandatory review loop, REVIEW_SKIP failure mode, completion protocol update, constraints update. Tests pass.","closedAt":"2026-02-16T13:12:45.294229-08:00"}
{"id":"overstory-rinz","title":"Write tests for prime command (src/commands/prime.test.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:04:34.684569-08:00","updatedAt":"2026-02-13T08:09:31.926325-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added comprehensive test coverage for prime command with 18 test cases covering help flags, orchestrator priming, agent priming, error handling, and mulch integration. All quality gates pass.","closedAt":"2026-02-13T08:09:31.926325-08:00"}
{"id":"overstory-rj1k","title":"Implement trace command (src/commands/trace.ts)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:21:22.931606-08:00","updatedAt":"2026-02-13T20:31:38.635567-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented trace command with agent/bead resolution, timeline formatting, JSON output, and time/limit filtering","closedAt":"2026-02-13T20:31:38.635567-08:00"}
{"id":"overstory-rn0f","title":"Migrate coordinator.ts + test to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:56:44.777927-08:00","updatedAt":"2026-02-13T19:16:13.147429-08:00","assignee":"jayminwest@gmail.com","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.147429-08:00"}
{"id":"overstory-rnqn","title":"Sling a real builder agent and validate full lifecycle","status":"closed","type":"task","priority":1,"createdAt":"2026-02-12T12:57:40.496735-08:00","updatedAt":"2026-02-12T13:10:14.577591-08:00","assignee":"jayminwest@gmail.com","description":"Create a beads issue for a trivial task, write a minimal spec, run overstory sling with --capability builder. Observe: tmux session starts, Claude boots, reads overlay, does work, commits, closes bead. This is the critical e2e validation.","closeReason":"Full E2E lifecycle validated: sling -> tmux boot -> overlay read -> mulch prime -> spec read -> implement -> quality gates (test/lint/typecheck) -> commit -> bd close -> mail send. Two bugs filed: overstory-y2ob (beacon sendKeys multiline not auto-submitting, P1) and overstory-ff2s (biome/tsc not on PATH in worktree, P2).","closedAt":"2026-02-12T13:10:14.577591-08:00"}
{"id":"overstory-ru1f","title":"Replace overstory status --watch with overstory dashboard","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T14:35:09.593283-08:00","updatedAt":"2026-02-13T07:26:32.059053-08:00","assignee":"jayminwest@gmail.com","description":"Replace 'overstory status --watch' with 'overstory dashboard' — a rich ANSI TUI for humans. Agents keep using 'overstory status --json' programmatically, humans get the live experience.\n\nCurrent status --watch is a simple clear+repoll of the same static text. Dashboard should feel like htop for agent swarms: color-coded panels, live activity, real-time metrics.\n\nData sources already available: sessions.json, tmux, mail.db, merge-queue.json, metrics.db, worktrees. Zero runtime deps rule means raw ANSI escape codes (no blessed/ink).\n\nSub-issues track the breakdown.","closeReason":"Dashboard feature complete: overstory dashboard replaces status --watch with rich ANSI TUI","closedAt":"2026-02-13T07:26:32.059053-08:00"}
{"id":"overstory-rum0","title":"Add resolveBackend+trackerCliName to tracker factory, update sling.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T17:51:41.910987-08:00","updatedAt":"2026-02-23T17:55:36.444146-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added resolveBackend() and trackerCliName() to tracker/factory.ts; updated sling.ts to use tracker abstraction (createTrackerClient, tracker.show, tracker.claim) and pass trackerCli/trackerName to overlayConfig. All quality gates passed.","closedAt":"2026-02-23T17:55:36.444146-08:00"}
{"id":"overstory-rurd","title":"Fix noImplicitAnyLet in merge-queue.ts:41","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-16T07:38:05.797945-08:00","updatedAt":"2026-02-16T07:43:27.650271-08:00","assignee":"jayminwest@gmail.com","description":"Add type annotation to 'let tableCheck;' on line 41 of src/doctor/merge-queue.ts. Change to 'let tableCheck: unknown;' to fix biome noImplicitAnyLet lint error.","closeReason":"Fixed biome lint and formatting issues across all three files","closedAt":"2026-02-16T07:43:27.650271-08:00"}
{"id":"overstory-rvv4","title":"Test: dashboard command (help, validation, data loading)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:21:45.252116-08:00","updatedAt":"2026-02-13T08:26:12.235729-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added dashboard.test.ts with help and validation tests","closedAt":"2026-02-13T08:26:12.235729-08:00"}
{"id":"overstory-rxvu","title":"Phase 1: Coordinator agent (persistent orchestrator)","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-12T13:50:38.641934-08:00","updatedAt":"2026-02-12T14:29:11.035718-08:00","assignee":"jayminwest@gmail.com","description":"Implement a persistent coordinator agent that runs as its own Claude Code session (via tmux). This is the 'brain' of the system - it receives work requests, decomposes them into subtasks, creates beads issues, dispatches workers via overstory sling, and tracks completion. Key design decisions: (1) Runs at project-root level with cross-project visibility via beads routing, (2) Cannot implement code - structurally enforced via tool restrictions (not just .md instructions), (3) Creates task groups (batches of related beads) and auto-closes when all tracked issues complete, (4) Receives escalations from supervisors and watchdog, (5) Context passed via beads + mail, NOT .md overlay files. Subsystems: coordinator lifecycle management, task group tracking, strategic dispatch logic, escalation routing with severity levels.","closeReason":"Implemented Phase 1 coordinator agent: new 'coordinator' capability type, agents/coordinator.md definition, 'overstory coordinator start|stop|status' CLI command, structural tool enforcement (read-only), manifest integration, 33 new tests, all 499 tests passing","closedAt":"2026-02-12T14:29:11.035718-08:00"}
{"id":"overstory-ryp0","title":"Add root-user guard to 4 spawn commands","status":"closed","type":"task","priority":2,"createdAt":"2026-02-18T16:46:43.295589-08:00","updatedAt":"2026-02-18T16:51:57.907368-08:00","assignee":"jayminwest@gmail.com","description":"Add process.getuid?.() === 0 check early in sling, coordinator start, supervisor start, monitor start that throws a clear error before tmux creation","closeReason":"Added isRunningAsRoot() pure function to sling.ts (exported, injectable getuid for testability). Applied root-user guard before loadConfig() in sling, coordinator, supervisor, and monitor spawn commands. AgentError thrown with clear message on UID 0. Tests added in all 4 test files. All quality gates pass.","closedAt":"2026-02-18T16:51:57.907368-08:00"}
{"id":"overstory-s1w","title":"Scout: audit error handling in mail commands","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T12:03:09.915969-08:00","updatedAt":"2026-02-12T12:04:29.256422-08:00","assignee":"jayminwest@gmail.com","description":"Read-only audit of error handling patterns in src/commands/mail.ts. Report findings.","closeReason":"Completed read-only audit of error handling in src/commands/mail.ts. Found 2 bugs (P2: empty string flag validation, P3: fragile positional ID extraction in read/reply) and 4 observations (agent name validation, DB path existence, store/client asymmetry in purge, positive note on error type structure). Results sent via mail to orchestrator.","closedAt":"2026-02-12T12:04:29.256422-08:00"}
{"id":"overstory-s6aa","title":"Update group.ts and supervisor.ts to use tracker abstraction","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T17:51:42.669612-08:00","updatedAt":"2026-02-23T17:55:50.370832-08:00","assignee":"jayminwest@gmail.com","closeReason":"Replaced hardcoded beads client in group.ts and supervisor.ts with unified tracker abstraction. group.ts uses TrackerClient.show() for issue status queries; supervisor.ts imports createTrackerClient from tracker/factory.ts. All quality gates pass.","closedAt":"2026-02-23T17:55:50.370832-08:00"}
{"id":"overstory-sbto","title":"Add shared blackboard system","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-15T17:04:32.410715-08:00","updatedAt":"2026-02-15T17:16:32.90319-08:00","assignee":"jayminwest@gmail.com","description":"New SQLite-backed shared knowledge base where agents post/read by topic. 'overstory blackboard post --topic api-design --content ...' and 'overstory blackboard read --topic api-design'. Any agent can contribute to any topic. Design: blackboard gives high-level context, agents can drill into mulch for deeper explanation when referenced. The prompting for agents should guide them to check mulch for more detail when blackboard entries reference expertise domains.","closeReason":"Decided the blackboard system isn't needed — existing mail + mulch provide sufficient shared context for agents","closedAt":"2026-02-15T17:16:32.90319-08:00"}
{"id":"overstory-sgy6","title":"Enforce reviewer-after-builder workflow in lead agents","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-17T07:34:04.201712-08:00","updatedAt":"2026-02-17T08:13:02.213393-08:00","assignee":"jayminwest@gmail.com","description":"Leads consistently skip Phase 3 (Review) — only 2 reviewers spawned out of ~98 builder completions. REVIEW_SKIP failure mode exists in lead.md but is being ignored. Fix: (1) Strengthen review requirement language from descriptive to imperative, (2) Consider structural enforcement — require reviewer PASS reference before merge_ready can be sent, (3) Add explicit language that cost of skipping review exceeds cost of reviewer agent, (4) Track reviewer spawns per lead in metrics for observability.","closeReason":"Enforced reviewer-after-builder workflow in lead agents via 3 changes: (1) Strengthened lead.md Phase 3 language from descriptive to imperative with production data (2/98 reviews), cost comparisons, and new constraint. (2) Added structural enforcement in mail.ts — merge_ready sends now check SessionStore for reviewer coverage and warn on stderr. (3) Added reviewer-coverage doctor consistency check for observability. All 3 builders reviewed and passed.","closedAt":"2026-02-17T08:13:02.213393-08:00"}
{"id":"overstory-sjus","title":"Add TRACKER_CLI/TRACKER_NAME replacement in overlay.ts + tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T17:49:22.627771-08:00","updatedAt":"2026-02-23T17:52:37.829037-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added TRACKER_CLI/TRACKER_NAME template vars to overlay.ts replacements map after BASE_DEFINITION. Updated formatQualityGates() and formatConstraints() to use config.trackerCli ?? 'bd'. Added 8 new tests; all 62 tests pass, typecheck clean.","closedAt":"2026-02-23T17:52:37.829037-08:00"}
{"id":"overstory-smkc","title":"Add scout-before-builder warning in sling.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:38:47.034491-08:00","updatedAt":"2026-02-17T07:51:34.615901-08:00","assignee":"jayminwest@gmail.com","closeReason":"All subtasks complete. lead.md updated with scout-first enforcement. sling.ts has scout-before-builder warning.","closedAt":"2026-02-17T07:51:34.615901-08:00"}
{"id":"overstory-so0b","title":"Reframe lead agent identity: coordinator-not-doer, encourage delegation","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-18T08:05:51.529931-08:00","updatedAt":"2026-02-18T16:41:49.144025-08:00","assignee":"jayminwest@gmail.com","description":"The lead agent definition (agents/lead.md) currently allows leads to self-justify skipping scouts and reviewers. In practice, leads explore the codebase themselves (using Read/Glob/Grep), write detailed specs from their own findings, and skip reviewers because builders already report quality gate results. The lead identity should be reframed as a team lead who coordinates, not a doer who also delegates. Key adjustments: (1) Reframe the Role section — the lead primary value is decomposition, delegation, and verification, not exploration. (2) Narrow the scout exception clause (Phase 1 step 8) — currently too easy to invoke when dispatch messages include file areas and mulch expertise is pre-loaded. (3) Strengthen the reviewer framing — reviewers catch spec drift, edge cases, and integration issues that unit tests miss, not just redundant quality gates. (4) Reframe propulsion principle as start delegating immediately not start doing immediately. (5) Adjust cost awareness — lead time is most valuable for coordination, not exploration. No structural enforcement changes — prompt and identity adjustment only.","closeReason":"Reframed agents/lead.md identity: 6 edits applied (intro, role, scout exception, reviewer framing, propulsion principle, cost awareness) shifting lead from doer to coordinator. Builder + reviewer pipeline completed with PASS verdict. Quality gates: 1872 tests, lint clean, typecheck clean.","closedAt":"2026-02-18T16:41:49.144025-08:00"}
{"id":"overstory-sp4j","title":"[Epic] Phase 1: Event Store Foundation","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-13T13:07:16.330422-08:00","updatedAt":"2026-02-13T19:08:32.885908-08:00","assignee":"jayminwest@gmail.com","description":"Central SQLite event store, sessions.json→SQLite migration, and hook data capture fixes. This is the backbone of the post-mortem observability system.\n\n## Goal\nReplace scattered per-agent log files with a queryable central event store. Fix known data gaps (tool args, durations, tokens, exit codes). Eliminate sessions.json race condition.\n\n## Deliverables\n1. Central EventStore (src/events/store.ts) — SQLite events.db with schema for all event types\n2. Smart tool argument filter (src/events/tool-filter.ts) — extract useful args per tool type, skip noise\n3. SessionStore (src/sessions/store.ts) — SQLite replacement for sessions.json with concurrent access safety\n4. Sessions migration shim (src/sessions/compat.ts) — backward-compatible reader during transition\n5. Hook updates — pipe full stdin JSON to overstory log, capture tool_input, transcript_path, session_id\n6. Log command updates — parse hook stdin, write to events.db, correlate tool durations, auto-parse transcripts\n7. Migrate all sessions.json consumers (sling, status, daemon, nudge) to SessionStore\n\n## Architecture Notes\n- events.db schema: id, run_id, agent_name, session_id, event_type, tool_name, tool_args (filtered JSON), tool_duration_ms, level, data (JSON payload), created_at\n- SessionStore schema mirrors current AgentSession type but in SQLite with proper indexes\n- Tool duration correlation: tool_end queries most recent unmatched tool_start for same (agent, tool), computes delta\n- Smart defaults for tool args: Bash→command, Read→file_path, Write→file_path, Edit→file_path, Grep→pattern+path, Task→description+subagent_type. Skip content bodies.\n- Existing per-agent log files continue as backup (no removal)\n\n## Dependencies\nNone — this is the foundation. Phase 2 and 3 depend on this.","closeReason":"Phase 1 complete: EventStore (events.db), SessionStore (sessions.db), tool argument filter, compat migration layer, and hook data capture all implemented. All 12 sessions.json consumers migrated to SessionStore. 1170 tests passing.","closedAt":"2026-02-13T19:08:32.885908-08:00"}
{"id":"overstory-sv0q","title":"Add worktree root path and isolation constraints to overlay template","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-13T13:03:22.987232-08:00","updatedAt":"2026-02-13T14:23:42.772665-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nThe overlay template (templates/overlay.md.tmpl) tells agents their branch name, file scope, and parent — but never tells them their worktree root path. It also does not explicitly instruct agents to use relative paths or stay within their worktree directory.\n\nIn the latest run, agents resolved paths relative to the canonical repo root (the git project root) rather than their worktree, likely because:\n1. Claude Code's default cwd is the project root, not the tmux session cwd\n2. The overlay doesn't mention the worktree path at all\n3. File scope lists relative paths but doesn't anchor them to the worktree\n\n## Solution\n\n1. Add a {{WORKTREE_PATH}} template variable to overlay.md.tmpl\n2. Add a prominent 'Working Directory' section near the top of the overlay:\n   - State the absolute worktree path\n   - Explicitly instruct: 'All file operations MUST use paths within this directory'\n   - Instruct: 'Use relative paths from your worktree root, NOT absolute paths to the canonical repo'\n   - Warn: 'Writing to the canonical repo root (/path/to/project/) instead of your worktree is a critical error'\n3. In the File Scope section, anchor file paths to the worktree:\n   - 'These paths are relative to your worktree root: {{WORKTREE_PATH}}'\n4. In the Constraints section, add:\n   - 'NEVER write to the canonical repo root — all writes go to your worktree'\n   - 'If you see files at the canonical root, read them but write to your worktree copy'\n\n## Files to modify\n\n- templates/overlay.md.tmpl — add worktree path section and constraints\n- src/agents/overlay.ts — pass worktreePath to template substitution\n- agents/builder.md — reinforce worktree isolation in base definition\n- agents/lead.md — reinforce worktree isolation","closeReason":"Added worktreePath to OverlayConfig and overlay template. New Working Directory section, file scope anchored to worktree root, constraints include WORKTREE ISOLATION and PATH_BOUNDARY_VIOLATION failure mode. Updated builder.md and lead.md.","closedAt":"2026-02-13T14:23:42.772665-08:00"}
{"id":"overstory-sx1l","title":"Merge sling-guard-builder branch: resolve cli.jsonl conflict","status":"closed","type":"task","priority":1,"createdAt":"2026-02-21T07:14:26.847395-08:00","updatedAt":"2026-02-21T07:19:46.132171-08:00","assignee":"jayminwest@gmail.com","closeReason":"Merged sling-guard-builder branch into main. Tier 1 clean merge, cli.jsonl conflict resolved with all entries preserved. Quality gates passed.","closedAt":"2026-02-21T07:19:46.132171-08:00"}
{"id":"overstory-t0f","title":"L4-3: Implement health check definitions (src/watchdog/health.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:18.810003-08:00","updatedAt":"2026-02-12T07:39:41.929193-08:00","assignee":"jayminwest@gmail.com","description":"Health check types and state machine. HealthCheck interface: agentName, timestamp, processAlive, tmuxAlive, lastActivity, state (AgentState), action (none/escalate/terminate). State transition rules and thresholds.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:41.929193-08:00"}
{"id":"overstory-t0vh","title":"Scout: explore existing test files for provider coverage gaps","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T05:59:56.811395-08:00","updatedAt":"2026-02-21T06:01:33.734193-08:00","assignee":"jayminwest@gmail.com","closeReason":"Exploration completed: identified provider test coverage gaps in sling, coordinator, monitor, supervisor integration tests; spec written","closedAt":"2026-02-21T06:01:33.734193-08:00"}
{"id":"overstory-t3i9","title":"Scout: explore existing test patterns and coverage","status":"closed","type":"task","priority":2,"createdAt":"2026-02-21T06:03:59.726817-08:00","updatedAt":"2026-02-21T06:07:13.397183-08:00","assignee":"jayminwest@gmail.com","closeReason":"Completed exploration of test patterns and coverage. Key findings: 95.5% test coverage (72/76 files), 73 test files with ~8,337 assertions, bun:test framework, strong preference for real implementations over mocks. Detailed spec written to .overstory/specs/overstory-t3i9.md. Identified test patterns: setup/teardown, fixture factories, real impl testing, selective mocking via spyOn/DI, async patterns, error testing, property roundtrips, complex scenarios.","closedAt":"2026-02-21T06:07:13.397183-08:00"}
{"id":"overstory-t62v","title":"Nudges typed but not entered: missing follow-up Enter in sendNudgeWithRetry","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T11:49:49.377399-08:00","updatedAt":"2026-02-13T12:29:48.169892-08:00","assignee":"jayminwest@gmail.com","description":"Root cause identified: sendNudgeWithRetry() in src/commands/nudge.ts:124-136 does a single sendKeys() call (text + Enter). Claude Code's TUI sometimes consumes the Enter keystroke during re-render/focus events, leaving text visible in the input but unsubmitted. The beacon in both sling.ts:436-441 and coordinator.ts:200-202 already has a workaround: a follow-up sendKeys(session, '') after a 500ms sleep to send a redundant Enter. Nudge code was never given this fix. Affects ALL nudge targets (coordinator, builders, agents), not just the coordinator. Fix: add the same double-Enter pattern (sleep 500ms + empty sendKeys) after each successful sendKeys in sendNudgeWithRetry().","closeReason":"Added double-Enter pattern (sleep 500ms + empty sendKeys) to sendNudgeWithRetry in nudge.ts, matching existing workaround in sling.ts and coordinator.ts","closedAt":"2026-02-13T12:29:48.169892-08:00"}
{"id":"overstory-tdp","title":"L5-1: Write config.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:27.056998-08:00","updatedAt":"2026-02-12T07:47:43.22018-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/config.ts. Cover: loading valid config, defaults for missing fields, validation errors for bad config, path resolution, missing config file handling.","closeReason":"Wrote config.test.ts with 20 tests covering defaults, merging, parsing, and validation","closedAt":"2026-02-12T07:47:43.22018-08:00"}
{"id":"overstory-tdw","title":"Trust observable state in watchdog (ZFC principle)","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-12T12:13:12.054161-08:00","updatedAt":"2026-02-12T13:11:17.910517-08:00","assignee":"jayminwest@gmail.com","description":"Watchdog should check tmux session liveness as primary signal, not sessions.json state. Add isProcessRunning(pid) check as secondary signal. When tmux says dead but sessions.json says working, mark zombie immediately. When tmux says alive but sessions.json says zombie, investigate (don't auto-kill). Document ZFC (Zero Failure Crash) principle: observable state (tmux alive, git status) is source of truth, not recorded state (sessions.json fields). The current watchdog partially does this but should lean into it more consistently.","closeReason":"Implemented ZFC principle in watchdog: tmux liveness as primary signal, pid check as secondary, sessions.json as tertiary. Added isProcessRunning(), ZFC rules 1-3, investigate action for conflicting state, comprehensive tests.","closedAt":"2026-02-12T13:11:17.910517-08:00"}
{"id":"overstory-tgb","title":"L3-3: Implement molecule helpers (src/beads/molecules.ts)","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T07:12:01.871321-08:00","updatedAt":"2026-02-12T07:36:21.672447-08:00","assignee":"jayminwest@gmail.com","description":"Beads molecule management for multi-step workflows. Helpers for creating molecule prototypes, pouring instances, tracking convoy progress. Wraps bd mol commands.","closeReason":"All L3 modules implemented, lint+types clean","closedAt":"2026-02-12T07:36:21.672447-08:00"}
{"id":"overstory-tgcl","title":"Auto-complete run on coordinator stop/exit","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-17T07:31:43.747446-08:00","updatedAt":"2026-02-17T07:50:53.892625-08:00","assignee":"jayminwest@gmail.com","description":"When the coordinator stops (either via 'overstory coordinator stop' or by just exiting the tmux window), the current run should be automatically completed. Currently: (1) 'coordinator stop' marks the coordinator session completed but does NOT call 'run complete', so current-run.txt persists and new agents may attach to the stale run. (2) Just exiting tmux bypasses even that — the coordinator stays 'working' until zombie detection. Fix: Make 'coordinator stop' call run complete automatically. Add a tmux exit trap or session-end hook that triggers cleanup when the user just closes the tmux window.","closeReason":"Auto-complete run on coordinator stop/exit implemented. Two builder branches ready for merge: (1) coordinator stop now auto-completes the current run with runCompleted output, (2) session-end hook completes the run when coordinator exits via tmux close. Both paths are non-fatal and include comprehensive tests.","closedAt":"2026-02-17T07:50:53.892625-08:00"}
{"id":"overstory-tia","title":"Colocate tests with source files (move from __tests__/ to src/)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:06.312445-08:00","updatedAt":"2026-02-12T09:00:57.441947-08:00","assignee":"jayminwest@gmail.com","description":"Move test files from the centralized __tests__/ directory to live alongside their source files. E.g. __tests__/config.test.ts -> src/config.test.ts, __tests__/mail-store.test.ts -> src/mail/store.test.ts. This improves discoverability, makes it obvious which modules have tests, and aligns with modern TS project conventions. Update biome/tsconfig if needed to include new test locations.","closeReason":"Colocated all 12 test files from __tests__/ to src/. Updated all import paths, fixed Biome import ordering, updated tsconfig.json include. All 261 tests pass, biome check clean, tsc clean.","closedAt":"2026-02-12T09:00:57.441947-08:00"}
{"id":"overstory-tjy0","title":"Export SUPPORTED_CAPABILITIES constant from types.ts","status":"closed","type":"task","priority":3,"createdAt":"2026-02-12T13:04:37.648738-08:00","updatedAt":"2026-02-12T13:09:24.291346-08:00","assignee":"jayminwest@gmail.com","description":"Add an exported const SUPPORTED_CAPABILITIES array to src/types.ts listing all valid agent capability strings: 'scout', 'builder', 'reviewer', 'lead', 'merger'. This enables type-safe capability validation at compile time.","closeReason":"Added SUPPORTED_CAPABILITIES constant and Capability type to src/types.ts. All quality gates pass (tests, lint, typecheck).","closedAt":"2026-02-12T13:09:24.291346-08:00"}
{"id":"overstory-tk46","title":"Fix readStdinJson to read all stdin chunks","status":"closed","type":"task","priority":2,"createdAt":"2026-02-17T07:37:39.466868-08:00","updatedAt":"2026-02-17T07:40:37.021729-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed readStdinJson() to read all stdin chunks. Large payloads (>64KB) now parsed correctly. Added test for 100KB payload verification.","closedAt":"2026-02-17T07:40:37.021729-08:00"}
{"id":"overstory-tko","title":"L0-12: Write templates/overlay.md.tmpl","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:48.034743-08:00","updatedAt":"2026-02-12T07:18:45.108437-08:00","assignee":"jayminwest@gmail.com","description":"Template for per-worker dynamic overlay CLAUDE.md. Variables: {{BEAD_ID}}, {{AGENT_NAME}}, {{SPEC_PATH}}, {{BRANCH_NAME}}, {{FILE_SCOPE}}, {{MULCH_DOMAINS}}, {{PARENT_AGENT}}, {{CAN_SPAWN}}.","closeReason":"Created all 3 templates: CLAUDE.md.tmpl (orchestrator awareness), overlay.md.tmpl (per-worker overlay), hooks.json.tmpl (agent hooks config)","closedAt":"2026-02-12T07:18:45.108437-08:00"}
{"id":"overstory-toyn","title":"Revisit: Claude Code Seatbelt sandbox support for agents","status":"open","type":"feature","priority":3,"createdAt":"2026-02-15T13:56:53.508544-08:00","updatedAt":"2026-02-15T13:56:53.508544-08:00","assignee":"jayminwest@gmail.com","description":"Stripped sandbox config from overstory (ra2z, 79fh) because: (1) tmux socket blocked by sandbox, (2) agent sandbox config was half-baked, (3) PreToolUse hook guards are the real security layer. Future work: investigate TMUX_TMPDIR approach, evaluate whether Seatbelt sandbox adds value on top of hook guards, handle temp dir access for tests."}
{"id":"overstory-tq8g","title":"Add lightweight mode for leads on simple tasks","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-21T06:26:42.92997-08:00","updatedAt":"2026-02-21T06:46:58.939755-08:00","assignee":"jayminwest@gmail.com","description":"For tasks below a complexity threshold (single file, docs-only, config changes, small code changes), the lead should be able to do the work itself without spawning any sub-agents. Add a concept of task complexity assessment to lead.md: simple tasks get done directly by the lead, moderate tasks get a builder but no scout/reviewer, complex tasks get the full pipeline. This prevents the minimum 8-9 agent overhead for trivial changes.","closeReason":"Merged via overstory/agent-def-builder/overstory-r9x0. Lead.md now has Task Complexity Assessment (simple/moderate/complex), optional scouts, conditional reviewers, and INSIGHT protocol removed.","closedAt":"2026-02-21T06:46:58.939755-08:00"}
{"id":"overstory-ttfo","title":"Make mulch recording a required completion gate for builder agents","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:29:02.86351-08:00","updatedAt":"2026-02-16T13:47:07.188467-08:00","assignee":"jayminwest@gmail.com","description":"Builder agent definition (agents/builder.md) lists mulch record as a soft suggestion. Agents inconsistently record learnings — some skip it entirely. Update the builder (and other agent) definitions to make mulch recording a required step in the completion checklist, alongside quality gates (bun test, biome check, tsc). This is a simple agent definition change that doesn't depend on the structured pattern storage work in overstory-f0kl.","closeReason":"Made mulch recording a required completion gate for all agent definitions. Updated 5 agent .md files (builder, lead, scout, reviewer, merger) with a numbered mulch record step in each Completion Protocol and a MISSING_MULCH_RECORD failure mode. Updated overlay.ts to include mulch recording in the generated quality gates for both read-only and writable agents. Builder quality gates passed.","closedAt":"2026-02-16T13:47:07.188467-08:00"}
{"id":"overstory-tv31","title":"Add --sort-by-score to merge conflict history search","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T05:58:59.15172-08:00","updatedAt":"2026-02-21T05:58:59.15172-08:00","assignee":"jayminwest@gmail.com","description":"When building conflict history via mulch.search('merge-conflict') in src/merge/resolver.ts, add --sort-by-score flag to prioritize patterns that have been confirmed to work. Requires adding sortByScore param to mulch/client.ts search() method."}
{"id":"overstory-typs","title":"Implement mulch conflict pattern recording in resolver.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:21:51.463105-08:00","updatedAt":"2026-02-13T22:32:41.221794-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented mulch conflict pattern recording in resolver.ts with 7 new tests. All quality gates passed.","closedAt":"2026-02-13T22:32:41.221794-08:00"}
{"id":"overstory-u19","title":"[Epic] Layer 4: Watchdog + CLI Router","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-12T07:12:07.077987-08:00","updatedAt":"2026-02-12T07:39:53.50198-08:00","assignee":"jayminwest@gmail.com","description":"Watchdog daemon, remaining CLI commands, and main CLI router. 8 parallel tasks. Depends on Layer 3 completion.","closeReason":"All 8 L4 subtasks completed","closedAt":"2026-02-12T07:39:53.50198-08:00"}
{"id":"overstory-u4qm","title":"Fix OverstoryConfig fixtures for providers field","status":"closed","type":"task","priority":1,"createdAt":"2026-02-19T12:34:41.002355-08:00","updatedAt":"2026-02-19T12:35:52.267083-08:00","assignee":"jayminwest@gmail.com","description":"Add providers field to all OverstoryConfig test fixtures and fix resolveModel return type in manifest.ts","closeReason":"Merged into overstory-ip89 scope expansion","closedAt":"2026-02-19T12:35:52.267083-08:00"}
{"id":"overstory-u76r","title":"Implement MulchClient expansion: new commands + new flags","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T21:53:14.685041-08:00","updatedAt":"2026-02-13T22:18:47.123714-08:00","assignee":"jayminwest@gmail.com","description":"Add diff, learn, prune, doctor, ready, compact wrappers to src/mulch/client.ts. Add prime --files/--exclude-domain and record --stdin/--evidence-bead flags. Add result types to src/types.ts. Add tests.","closeReason":"Implemented by mulch-client-builder: 6 new methods added, initial implementation","closedAt":"2026-02-13T22:18:47.123714-08:00"}
{"id":"overstory-u8d0","title":"Add universal git push guard to hooks template + update tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T07:43:57.950698-08:00","updatedAt":"2026-02-18T07:55:06.243895-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added universal Bash PreToolUse guard to hooks template without ENV_GUARD. Updated 7 test count assertions, patched env guard test, added verification test. All 1868 tests pass.","closedAt":"2026-02-18T07:55:06.243895-08:00"}
{"id":"overstory-udid","title":"Doctor: external dependency checks","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:09.49888-08:00","updatedAt":"2026-02-15T12:49:03.90708-08:00","assignee":"jayminwest@gmail.com","description":"Check that all external tools overstory depends on are available and functional.\n\nChecks:\n- git installed and on PATH: run 'git --version', verify exit 0\n- tmux installed and accessible: run 'tmux -V', verify exit 0\n- bd (beads) available: run 'bd --version', verify exit 0, also check .beads/ dir exists with issues.jsonl\n- mulch available: run 'mulch --version', verify exit 0 (warn-only since mulch is optional)\n- overstory itself resolvable from worktree context: run 'which overstory' or equivalent\n\nSource references:\n- Various Bun.spawn calls throughout src/worktree/manager.ts, src/beads/client.ts, src/mulch/client.ts\n\nOutput: pass/fail per dependency with version info. Fail = critical (blocks operation).","closeReason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","closedAt":"2026-02-15T12:49:03.90708-08:00"}
{"id":"overstory-uecg","title":"Scope dashboard panels to current run and add --all flag","status":"closed","type":"task","priority":2,"createdAt":"2026-02-18T07:15:24.49891-08:00","updatedAt":"2026-02-18T07:28:16.512046-08:00","assignee":"jayminwest@gmail.com","closeReason":"Dashboard panels now scope to current run by default via AgentSession.runId filtering. Added --all flag for historical view, run scope indicator in header, and updated help text. All quality gates pass.","closedAt":"2026-02-18T07:28:16.512046-08:00"}
{"id":"overstory-uh0","title":"L5-5: Write beads-client.test.ts","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:30.698722-08:00","updatedAt":"2026-02-12T07:54:20.592935-08:00","assignee":"jayminwest@gmail.com","description":"Tests for src/beads/client.ts. Cover: ready(), show(id), create(), claim(), close(), status(). Mock bd CLI subprocess calls. Verify --json flag usage and output parsing.","closeReason":"Closed","closedAt":"2026-02-12T07:54:20.592935-08:00"}
{"id":"overstory-uh2h","title":"Resolve merge-intel-builder merge conflict","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T18:06:01.826042-08:00","updatedAt":"2026-02-16T18:28:15.462856-08:00","assignee":"jayminwest@gmail.com","description":"Branch overstory/merge-intel-builder/overstory-okcp failed to merge due to conflicts on .mulch/expertise/typescript.jsonl and possibly src/types.ts. Code files: src/merge/resolver.ts, src/merge/resolver.test.ts, src/commands/merge.ts, src/types.ts. Resolution: create fresh branch from main, read files from failed branch, apply code changes to current main versions, run quality gates, signal merge_ready.","closeReason":"Resolved via overstory-mifc (fresh branch approach).","closedAt":"2026-02-16T18:28:15.462856-08:00"}
{"id":"overstory-uid","title":"beads-client.test.ts: Replace Bun.spawn mocks with real bd CLI","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:19.499166-08:00","updatedAt":"2026-02-12T09:08:48.083455-08:00","assignee":"jayminwest@gmail.com","description":"beads-client.test.ts mocks all Bun.spawn calls for bd CLI invocations. Replace with real bd operations using a temp directory with an initialized beads project. This tests actual bd JSON output parsing, flag handling, and error behavior. Guard with a check for bd availability so tests skip gracefully in environments without bd installed. Keep the existing mock-based tests as a fallback or remove if real tests provide equivalent coverage.","closeReason":"Replaced Bun.spawn mocks with real bd CLI integration tests, fixed client to handle bd show array response and issue_type field mapping","closedAt":"2026-02-12T09:08:48.083455-08:00"}
{"id":"overstory-uo1y","title":"[Epic] Phase 2: CLI Query Commands","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T13:07:28.112969-08:00","updatedAt":"2026-02-13T20:53:33.145815-08:00","assignee":"jayminwest@gmail.com","description":"Four new CLI commands for post-mortem analysis: trace, errors, replay, costs. These are the primary interface for understanding swarm behavior after a run.\n\n## Goal\nGive the operator CLI tools to slice event data by agent, bead, run, or time range. All commands support --json for scripting.\n\n## Deliverables\n1. overstory trace <agent|bead> — chronological timeline of events for an agent or bead task\n2. overstory errors [--agent] [--run] — aggregated error view across all agents\n3. overstory replay [--run] [--agent] — interleaved chronological replay across multiple agents\n4. overstory costs [--agent] [--run] [--by-capability] — token/cost analysis and breakdown\n\n## Architecture Notes\n- All commands query events.db via EventStore interface\n- costs additionally queries metrics.db for token data\n- trace resolves bead IDs to agent names via SessionStore\n- replay without --run defaults to most recent run or last 24h of events\n- Human output uses ANSI colors consistent with existing reporter.ts patterns\n- Each command gets its own file in src/commands/ with colocated tests\n\n## Dependencies\nDepends on Phase 1 (EventStore, SessionStore must exist)","closeReason":"All 4 CLI query commands implemented: trace, errors, replay, costs. All tests passing.","closedAt":"2026-02-13T20:53:33.145815-08:00"}
{"id":"overstory-uo2o","title":"Watchdog incorrectly flags coordinator as stalled while waiting for workers","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-15T12:28:58.607734-08:00","updatedAt":"2026-02-15T17:04:26.997175-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\nThe watchdog daemon sends 'coordinator stalled' nudges to the coordinator while it's intentionally waiting for worker agents to finish. This is because stalled detection treats all agents identically — it only checks lastActivity (updated on tool-start/tool-end events) against a threshold. The coordinator's normal work while waiting is conversational (waiting for mail), not tool-based, so lastActivity goes stale and the watchdog escalates.\n\nProgressive escalation (warn → nudge → triage → terminate) can even kill a healthy coordinator that's simply waiting.\n\n## Root Cause\n\n- `src/watchdog/daemon.ts:205-298` iterates ALL non-completed sessions with zero capability-aware filtering\n- `src/watchdog/health.ts:172-181` flags any agent as stalled if lastActivity exceeds staleThresholdMs, regardless of capability\n- `src/commands/log.ts:90` already defines `PERSISTENT_CAPABILITIES = new Set(['coordinator', 'monitor'])` but this is never imported or used by the watchdog\n\n## Recommended Fix\n\nAdd capability-aware logic to `evaluateHealth()` in `src/watchdog/health.ts`: skip stale/zombie detection for persistent capabilities (coordinator, monitor). These agents should only be checked for tmux liveness, not activity-based staleness.\n\nThis means importing/sharing the PERSISTENT_CAPABILITIES concept from log.ts (or defining it in types.ts) and adding an early return in evaluateHealth() that returns state='working' with action='none' for persistent agents, with a reconciliation note explaining the exemption.\n\n## Files Involved\n\n- `src/watchdog/health.ts` — primary fix location (evaluateHealth)\n- `src/watchdog/daemon.ts` — alternative fix location (session loop filtering)\n- `src/commands/log.ts:90` — existing PERSISTENT_CAPABILITIES constant to share/reuse\n- `src/types.ts` — possible home for shared PERSISTENT_CAPABILITIES constant","closeReason":"Fix already implemented - PERSISTENT_CAPABILITIES in health.ts exempts coordinator/monitor from time-based staleness checks","closedAt":"2026-02-15T17:04:26.997175-08:00"}
{"id":"overstory-uow","title":"mail read silently succeeds for nonexistent message IDs","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:11:07.145987-08:00","updatedAt":"2026-02-12T08:43:48.204637-08:00","assignee":"jayminwest@gmail.com","description":"'overstory mail read nonexistent-id' reports 'Marked nonexistent-id as read' with exit 0 even though no such message exists. Should validate the message ID and return an error. In contrast, 'overstory mail reply nonexistent-id' correctly errors with 'Message not found'.","closeReason":"Added existence check in MailClient.markRead — now throws MailError with message ID when the ID is not found, matching the pattern already used by reply()","closedAt":"2026-02-12T08:43:48.204637-08:00"}
{"id":"overstory-uox","title":"L0-5: Write CLAUDE.md project conventions","status":"closed","type":"task","priority":0,"createdAt":"2026-02-12T07:11:20.300086-08:00","updatedAt":"2026-02-12T07:18:36.442366-08:00","assignee":"jayminwest@gmail.com","description":"Overstory project conventions file. Documents CLI commands, agent workflow, beads integration, mulch usage, hook patterns. This is the orchestrator's reference.","closeReason":"Wrote comprehensive CLAUDE.md with project overview, architecture, coding conventions, CLI reference, and quality gates","closedAt":"2026-02-12T07:18:36.442366-08:00"}
{"id":"overstory-us0f","title":"Write tests for log command (src/commands/log.test.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T08:04:35.682723-08:00","updatedAt":"2026-02-13T09:32:05.333121-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files already written and committed","closedAt":"2026-02-13T09:32:05.333121-08:00"}
{"id":"overstory-usoq","title":"Rewrite agents/lead.md: reframe identity as coordinator-not-doer","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T16:32:56.671499-08:00","updatedAt":"2026-02-18T16:41:27.486717-08:00","assignee":"jayminwest@gmail.com","closeReason":"All 6 edits to agents/lead.md applied and review-verified: intro, role, scout exception, reviewer framing, propulsion principle, cost awareness all reframed to coordinator-not-doer identity","closedAt":"2026-02-18T16:41:27.486717-08:00"}
{"id":"overstory-uwg4","title":"Subagent overwrites root .claude/CLAUDE.md during e2e run","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T14:14:28.829591-08:00","updatedAt":"2026-02-13T14:37:18.862226-08:00","assignee":"jayminwest@gmail.com","description":"During an overstory e2e run, the root .claude/CLAUDE.md was populated/modified unexpectedly. Root cause is unclear — could be a subagent escaping its worktree scope, or an agent-spawning function (e.g., sling, overlay generation) writing to the wrong path. Investigate what wrote to root .claude/CLAUDE.md and under what conditions. Check overlay.ts, sling.ts, hooks-deployer.ts, and any code that touches CLAUDE.md paths. Add a guard to prevent unintended writes to the orchestrator's .claude/ directory.","closeReason":"Implemented in session: bash path guard, hook capture updates, CLAUDE.md overwrite guard, and orchestrator nudge fix","closedAt":"2026-02-13T14:37:18.862226-08:00"}
{"id":"overstory-v248","title":"Fix dashboard DB connection churn: hold stores open for poll loop","status":"closed","type":"task","priority":1,"createdAt":"2026-02-20T07:59:11.308317-08:00","updatedAt":"2026-02-20T08:09:45.994071-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed dashboard DB connection churn: added PreOpenedStores to gatherStatus(), openDashboardStores()/closeDashboardStores() to dashboard.ts. Each DB opened once per poll loop, closed on SIGINT or error. Backward compatible. Tests and quality gates pass.","closedAt":"2026-02-20T08:09:45.994071-08:00"}
{"id":"overstory-v2o2","title":"Wire tier2Enabled into coordinator.ts --monitor auto-start","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T17:00:34.604918-08:00","updatedAt":"2026-02-18T17:04:36.940596-08:00","assignee":"jayminwest@gmail.com","closeReason":"Wired tier2Enabled into coordinator --monitor auto-start: skips monitor.start() when tier2Enabled is false, adds 2 tests, updates beforeEach config. 86 tests pass.","closedAt":"2026-02-18T17:04:36.940596-08:00"}
{"id":"overstory-v3b1","title":"Review: lead.md Phase 1 scout-first workflow update","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:29:04.545424-08:00","updatedAt":"2026-02-16T13:33:34.44722-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review PASS for lead.md Phase 1 update. All 8 acceptance criteria verified.","closedAt":"2026-02-16T13:33:34.44722-08:00"}
{"id":"overstory-vajl","title":"Implement run concept and overstory run command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T13:10:05.120105-08:00","updatedAt":"2026-02-13T20:41:18.354247-08:00","assignee":"jayminwest@gmail.com","description":"Introduce the 'run' grouping concept and a CLI command to manage it.\n\n## Concept\nA 'run' groups all agents spawned from one coordinator session. It provides the top-level unit for post-mortem analysis — 'show me everything from that run.'\n\n## Run ID\nFormat: run-{ISO timestamp} (e.g., run-2026-02-13T10-00-00Z)\n\n## Storage\n- Active run ID in .overstory/current-run.txt (simple text file)\n- Run metadata in sessions.db (new runs table):\n```sql\nCREATE TABLE runs (\n  id TEXT PRIMARY KEY,\n  started_at TEXT NOT NULL,\n  completed_at TEXT,\n  agent_count INTEGER NOT NULL DEFAULT 0,\n  coordinator_session_id TEXT,\n  status TEXT NOT NULL DEFAULT 'active'\n    CHECK(status IN ('active','completed','failed'))\n);\n```\n\n## Run Lifecycle\n1. First overstory sling call checks for .overstory/current-run.txt\n2. If absent, creates new run, writes ID to current-run.txt\n3. Each sling call increments agent_count\n4. Run auto-completes when all member agents reach completed/zombie (detected by watchdog or explicit command)\n5. overstory clean resets current run\n\n## CLI Command\n```\noverstory run                    Show current run status\noverstory run list [--last <n>]  List recent runs\noverstory run complete           Mark current run as completed\noverstory run show <id>          Show run details (agents, duration, cost)\n```\n\n## Changes to existing code\n- src/commands/sling.ts: generate/inherit run_id, pass to SessionStore and EventStore\n- src/sessions/store.ts: add runs table and RunStore methods\n- src/commands/clean.ts: delete current-run.txt on clean\n\n## Tests (src/commands/run.test.ts)\n- Create run, show status\n- List recent runs\n- Run auto-completion logic\n- Run show with agent/cost details","closeReason":"Run concept fully implemented across overstory-e9d3 (RunStore), overstory-q9xo (run CLI), overstory-w00d (sling/clean integration)","closedAt":"2026-02-13T20:41:18.354247-08:00"}
{"id":"overstory-vdg7","title":"Update lead.md Phase 1 to mandate parallel scout spawning","status":"closed","type":"task","priority":1,"createdAt":"2026-02-16T13:16:37.148339-08:00","updatedAt":"2026-02-16T17:39:34.399486-08:00","assignee":"jayminwest@gmail.com","description":"Modify agents/lead.md to make scout-first workflow mandatory with parallel scouts","closeReason":"Parallel scout spawning already mandated in prior commit c2229d3.","closedAt":"2026-02-16T17:39:34.399486-08:00"}
{"id":"overstory-vm0","title":"L2-2: Implement hooks deployer (src/agents/hooks-deployer.ts)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T07:11:45.827006-08:00","updatedAt":"2026-02-12T07:33:09.537094-08:00","assignee":"jayminwest@gmail.com","description":"Deploy hooks config to agent worktree as .claude/settings.local.json. Reads templates/hooks.json.tmpl, fills agent name, writes to worktree. Configures SessionStart, UserPromptSubmit, Pre/PostToolUse, Stop, PreCompact hooks.","closeReason":"All L2 modules implemented, lint+types clean","closedAt":"2026-02-12T07:33:09.537094-08:00"}
{"id":"overstory-vo3e","title":"Wire SessionInsight analyzer to auto-record outcomes","status":"open","type":"feature","priority":3,"createdAt":"2026-02-20T12:49:41.082187-08:00","updatedAt":"2026-02-20T13:09:54.88097-08:00","assignee":"jayminwest@gmail.com","description":"src/insights/analyzer.ts exists but is never called. Wire analyzeSessionInsights() into src/agents/lifecycle.ts session completion to automatically analyze tool events and record outcomes via mulch record with --outcome-status based on quality gate results. This closes the feedback loop without relying on agents to self-report, enabling mulch 0.4.3's confirmation scoring to accumulate real data."}
{"id":"overstory-vs8z","title":"Add outcome recording flags to MulchClient.record()","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-20T12:49:36.802913-08:00","updatedAt":"2026-02-20T13:23:14.039048-08:00","assignee":"jayminwest@gmail.com","description":"Wire --outcome-status, --outcome-duration, --outcome-test-results, --outcome-agent flags into src/mulch/client.ts record() method. Update agent overlay template quality gates (src/agents/overlay.ts) and agent definitions (agents/*.md) to instruct agents to pass outcome data when recording learnings after completing work. This gives mulch's confirmation-frequency scoring system real signal about which patterns work.","closeReason":"Outcome flags (outcomeStatus, outcomeDuration, outcomeTestResults, outcomeAgent) added to record() in client.ts (mulch-client-builder). Overlay quality gates and builder.md updated with outcome flags (overlay-defs-builder).","closedAt":"2026-02-20T13:23:14.039048-08:00"}
{"id":"overstory-vu16","title":"Add test coverage for metrics command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T13:40:23.227744-08:00","updatedAt":"2026-02-12T13:47:15.259885-08:00","assignee":"jayminwest@gmail.com","closeReason":"Added comprehensive test coverage for metrics command with 16 test cases covering all requirements: help flags, empty/missing DB handling, output formatting, JSON mode, --last flag, merge tier distribution, and duration formatting. All tests pass, zero lint errors, typecheck clean.","closedAt":"2026-02-12T13:47:15.259885-08:00"}
{"id":"overstory-vxx","title":"Test task: scout the codebase","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:00:56.934175-08:00","updatedAt":"2026-02-12T08:04:14.502201-08:00","assignee":"jayminwest@gmail.com","closeReason":"Hands-on testing complete","closedAt":"2026-02-12T08:04:14.502201-08:00"}
{"id":"overstory-w00d","title":"Integrate run_id into sling and clean commands","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T19:20:56.601799-08:00","updatedAt":"2026-02-13T20:39:00.38154-08:00","assignee":"jayminwest@gmail.com","description":"sling.ts: auto-create/inherit run_id via current-run.txt. clean.ts: delete current-run.txt on clean","closeReason":"Integrated run_id auto-creation in sling, cleanup in clean","closedAt":"2026-02-13T20:39:00.38154-08:00"}
{"id":"overstory-w4zv","title":"Stale escalation auto-bump (severity increases over time)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T06:51:23.819644-08:00","updatedAt":"2026-02-13T07:03:35.52015-08:00","assignee":"jayminwest@gmail.com","description":"When a stalled agent is not acknowledged, automatically bump severity over time. Track escalation start time and bump count in AgentSession. Add configurable bump interval to WatchdogConfig. Integrate with progressive nudging — each bump advances the nudge stage. After max bumps reached, transition to zombie/terminate. This is tightly coupled with the progressive nudging task and should be implemented together.","closeReason":"Implemented as part of progressive nudging (overstory-5bic) — escalationLevel auto-bumps on each daemon tick while agent remains stalled, configured via nudgeIntervalMs","closedAt":"2026-02-13T07:03:35.52015-08:00"}
{"id":"overstory-wadc","title":"Scouts should write specs as files, not deliver via mail","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T11:49:53.340879-08:00","updatedAt":"2026-02-13T12:41:29.428962-08:00","assignee":"jayminwest@gmail.com","description":"During e2e testing, scout agents are delivering entire spec documents via overstory mail messages to the coordinator. This causes the coordinator to try to manually rewrite/transcribe the specs. Scouts should default to writing specs as files (e.g. .overstory/specs/{bead-id}.md) using 'overstory spec write', and then notify the coordinator via a short mail message with the file path. The mail system should be used for notifications/status, not as a file transport mechanism.","closeReason":"Added overstory spec write command (src/commands/spec.ts with 17 tests). Scouts now use overstory spec write to persist specs as files to .overstory/specs/<bead-id>.md instead of sending them via mail. Updated agents/scout.md with spec-write workflow, SPEC_VIA_MAIL failure mode, and mail-as-notification-only constraint.","closedAt":"2026-02-13T12:41:29.428962-08:00"}
{"id":"overstory-wb6i","title":"Add --classification filter to merge conflict pattern search","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T05:58:56.462755-08:00","updatedAt":"2026-02-21T05:58:56.462755-08:00","assignee":"jayminwest@gmail.com","description":"In src/merge/resolver.ts, mulch.search('merge-conflict') queries historical conflict patterns. Add --classification foundational filter to prioritize high-confidence patterns and filter out noisy tactical/observational records. Requires adding classification param to mulch/client.ts search() method."}
{"id":"overstory-wg9n","title":"Fix triage.test.ts timeout: triageAgent returns 'extend' when session.log exists but claude binary fails","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T09:09:44.846116-08:00","updatedAt":"2026-02-13T09:18:10.299416-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed triage.test.ts timeout by adding configurable timeoutMs to spawnClaude (default 30s). The subprocess is killed via setTimeout+proc.kill() if it exceeds the limit. Test passes timeoutMs: 500 to fail fast instead of hanging when the claude binary exists.","closedAt":"2026-02-13T09:18:10.299416-08:00"}
{"id":"overstory-wgdi","title":"Doctor: config.yaml validation","status":"closed","type":"task","priority":2,"createdAt":"2026-02-13T21:59:18.32135-08:00","updatedAt":"2026-02-15T12:49:03.908758-08:00","assignee":"jayminwest@gmail.com","description":"Validate config.yaml syntax, schema, and semantic correctness.\n\nChecks:\n- YAML parses without error\n- All required fields present: project.root, project.canonicalBranch, agents.maxConcurrent, agents.maxDepth, etc.\n- Value validation: maxConcurrent >= 1, maxDepth >= 0, non-negative timeouts\n- Threshold ordering: zombieThresholdMs > staleThresholdMs\n- mulch.primeFormat in {markdown, xml, json}\n- project.root points to a real git repository (resolve and check)\n- Deprecated config keys detected and warned (tier1Enabled → tier0Enabled, tier2Enabled → tier1Enabled)\n\nSource references:\n- src/config.ts — loadConfig(), DEFAULT_CONFIG, validation logic\n- .overstory/config.yaml — real example\n\nOutput: pass/warn/fail. Malformed YAML or missing required fields = critical. Deprecated keys = warn.","closeReason":"Implemented dependency, version, and config health checks with comprehensive test coverage. All quality gates pass.","closedAt":"2026-02-15T12:49:03.908758-08:00"}
{"id":"overstory-wgx","title":"prime --agent for nonexistent agent outputs full mulch context without warning","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T10:09:45.565836-08:00","updatedAt":"2026-02-12T10:15:29.244925-08:00","assignee":"jayminwest@gmail.com","description":"Running 'overstory prime --agent nonexistent' succeeds (exit 0) and outputs a full context block including all mulch expertise, with only a subtle 'New agent - no prior sessions' line to indicate the agent doesn't exist. Should either warn that the agent name is not in the active sessions, or at minimum make the 'new agent' notice more prominent. Currently easy to miss that you've primed for the wrong agent name.","closeReason":"Check sessions.json and identity store before outputting agent context, warn if agent not found","closedAt":"2026-02-12T10:15:29.244925-08:00"}
{"id":"overstory-wius","title":"Agent definition template variables + overlay generation updates","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-23T15:41:06.118351-08:00","updatedAt":"2026-02-23T18:04:30.664587-08:00","assignee":"jayminwest@gmail.com","description":"Replace ~58 hardcoded sd/seeds references in 8 agent .md files (agents/builder.md, coordinator.md, lead.md, merger.md, monitor.md, reviewer.md, scout.md, supervisor.md) with TRACKER_CLI and TRACKER_NAME template variables. Update src/agents/overlay.ts: add TRACKER_CLI and TRACKER_NAME to replacement map using trackerCli/trackerName from OverlayConfig, update formatQualityGates() and formatConstraints() to use template vars instead of hardcoded sd. Update templates/CLAUDE.md.tmpl and templates/overlay.md.tmpl similarly. Tests for overlay changes.","closeReason":"Agent definition template variables + overlay generation merged. 8 agent .md files updated with TRACKER_CLI/TRACKER_NAME template vars, overlay.ts replacement map updated, templates checked. All 5 builder branches merged clean.","closedAt":"2026-02-23T18:04:30.664587-08:00"}
{"id":"overstory-wsuc","title":"Review: reviewer-ratio doctor check","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:08:13.248692-08:00","updatedAt":"2026-02-17T08:12:17.014439-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review complete: PASS","closedAt":"2026-02-17T08:12:17.014439-08:00"}
{"id":"overstory-ww0t","title":"Add --classification guidance to agent overlay instructions","status":"open","type":"task","priority":4,"createdAt":"2026-02-20T12:49:46.268871-08:00","updatedAt":"2026-02-20T12:49:46.268871-08:00","assignee":"jayminwest@gmail.com","description":"Update agent .md definitions and overlay template to guide agents on classifying mulch record entries (--classification foundational for core conventions, tactical for session-specific patterns, observational for one-off findings). The flag is already wired in MulchClient.record() but agents are never instructed to use it. Better classification improves mulch's pruning and budget sorting behavior."}
{"id":"overstory-wz22","title":"Create unified tracker module (src/tracker/) + config migration","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-23T15:41:01.114872-08:00","updatedAt":"2026-02-23T16:00:12.988323-08:00","assignee":"jayminwest@gmail.com","description":"Create src/tracker/ with: types.ts (TaskTrackerBackend, TaskIssue, TaskTrackerClient interface), seeds.ts (move from src/seeds/client.ts, unwraps sd envelope), beads.ts (restore from git history, handles bd raw arrays), index.ts (detectBackend + createTaskTracker factory). Move src/seeds/templates.ts to src/tracker/templates-seeds.ts, create templates-beads.ts and templates.ts facade. Update src/types.ts: replace seeds config with taskTracker: { backend: auto|seeds|beads, enabled: boolean } in OverstoryConfig, add trackerCli and trackerName to OverlayConfig. Update src/config.ts: migrateDeprecatedTaskTrackerKeys(), DEFAULT_CONFIG, validation. Delete old src/seeds/. Full test coverage.","closeReason":"Unified tracker module (src/tracker/) and config migration complete. 2 parallel builders delivered: tracker module (10 files, 39 tests) and config migration (3 files, 59 tests). Branches ready for merge.","closedAt":"2026-02-23T16:00:12.988323-08:00"}
{"id":"overstory-wzaq","title":"Embed relevant mulch expertise directly in agent overlay","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:42:21.90105-08:00","updatedAt":"2026-02-13T22:28:26.773836-08:00","assignee":"jayminwest@gmail.com","description":"In src/agents/overlay.ts, during overlay generation, if files are known call mulch prime --files <files> --budget 1000 and embed the result directly under a Relevant Expertise section in the overlay. Agents start with relevant context without needing to run mulch themselves. Still include the mulch prime command for when they need more. Tradeoff: larger overlays vs faster agent ramp-up. --budget 1000 keeps it bounded. Depends on expanded MulchClient (overstory-j53z).","closeReason":"Implemented as part of overstory-95za: sling.ts auto-fetches mulch prime --files when files scoped (4ab0), overlay embeds mulchExpertise with Pre-loaded Expertise section (wzaq).","closedAt":"2026-02-13T22:28:26.773836-08:00"}
{"id":"overstory-x4fm","title":"Rework: Fix MulchClient types and add --json parsing","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T22:03:42.558101-08:00","updatedAt":"2026-02-13T22:18:47.317422-08:00","assignee":"jayminwest@gmail.com","description":"Fix incorrect types in src/types.ts to match actual mulch CLI JSON output. Change new methods to use --json flag and return typed results instead of raw strings. Fix --files flag to use spread args.","closeReason":"Superseded by mulch-fix-builder (overstory-mbs6)","closedAt":"2026-02-13T22:18:47.317422-08:00"}
{"id":"overstory-x5z6","title":"Add universal git push block to hooks template + update tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-18T07:19:06.574215-08:00","updatedAt":"2026-02-20T07:21:08.517978-08:00","assignee":"jayminwest@gmail.com","description":"Add guardless git push block to hooks.json.tmpl PreToolUse section, update 7 Bash guard count tests in hooks-deployer.test.ts, and update env guard test to exclude the universal guard.","closeReason":"Already implemented and merged to main (commit 4e4db5b). PreToolUse push guard added to hooks.json.tmpl, 7 test assertions updated in hooks-deployer.test.ts.","closedAt":"2026-02-20T07:21:08.517978-08:00"}
{"id":"overstory-x6xm","title":"Block Task tool via hooks for coordinator/supervisor capabilities","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T06:20:42.673062-08:00","updatedAt":"2026-02-13T06:45:08.747804-08:00","assignee":"jayminwest@gmail.com","description":"The coordinator agent uses Claude Code's built-in Task tool (subagents) instead of overstory sling for delegation. This bypasses the entire overstory system — no worktrees, no mail, no groups, no specs. Evidence from the current coordinator session: '4 Task agents launched' via Claude Code native UI, zero worktrees created, zero mail messages, no groups.json. Fix: Add 'Task' to blocked tools in hooks-deployer.ts for NON_IMPLEMENTATION_CAPABILITIES. Also consider blocking TeamCreate, SendMessage, and other Claude Code native team tools. Reference: Gastown also lacks this but plans structural enforcement via delegate mode.","closeReason":"Added NATIVE_TEAM_TOOLS list (Task, TeamCreate, TeamDelete, SendMessage, TaskCreate, TaskUpdate, TaskList, TaskGet, TaskOutput, TaskStop). All overstory agents now get these blocked via PreToolUse hooks, enforcing use of overstory sling for delegation.","closedAt":"2026-02-13T06:45:08.747804-08:00"}
{"id":"overstory-x7nj","title":"Write worktree.test.ts for overstory worktree command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:22:15.720427-08:00","updatedAt":"2026-02-13T08:34:59.558145-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test files created and merged to main","closedAt":"2026-02-13T08:34:59.558145-08:00"}
{"id":"overstory-x9n3","title":"Dashboard excludes coordinator due to run-scoping filter (runId: null)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-19T13:28:06.975135-08:00","updatedAt":"2026-02-20T07:34:48.181474-08:00","assignee":"jayminwest@gmail.com","description":"Coordinator registers with runId: null (coordinator.ts:370) but dashboard filters by current run ID via store.getByRun() (status.ts:95) and a JS filter (dashboard.ts:148-150). SQL WHERE run_id = $run_id never matches NULL. Regression from run-scoping feature in 0.5.7. Fix: include runId IS NULL sessions when run-scoping is active, or have coordinator adopt the current run ID at startup. Workaround: overstory dashboard --all.","closeReason":"Fixed: coordinator excluded from dashboard due to run-scoping filter (runId=null never matched SQL WHERE). Builder overstory-ftq2 patched status.ts and dashboard.ts to include null-runId sessions. Tests added and passing.","closedAt":"2026-02-20T07:34:48.181474-08:00"}
{"id":"overstory-xe1b","title":"Consumer command updates for tracker abstraction","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-23T15:41:10.834459-08:00","updatedAt":"2026-02-23T18:04:34.464769-08:00","assignee":"jayminwest@gmail.com","description":"Update all CLI command files that directly use seeds client to use the new tracker abstraction. src/commands/sling.ts: import from tracker/, use detectBackend()+createTaskTracker(), pass trackerCli/trackerName to overlay config. src/commands/group.ts: replace hardcoded Bun.spawn sd with tracker client. src/commands/supervisor.ts: use tracker instead of seeds client. src/commands/coordinator.ts: interpolate CLI name in beacon string. src/agents/hooks-deployer.ts: add bd to SAFE_BASH_PREFIXES alongside sd. src/doctor/dependencies.ts: dynamic tool check based on backend config. Update associated tests.","closeReason":"Consumer command updates merged. sling.ts, group.ts, supervisor.ts, coordinator.ts all use tracker abstraction. hooks-deployer has bd in SAFE_BASH_PREFIXES. doctor/dependencies.ts has dynamic tool check. All 3 builder branches merged clean.","closedAt":"2026-02-23T18:04:34.464769-08:00"}
{"id":"overstory-xhg8","title":"Migrate session readers and cleanup to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:53:50.864086-08:00","updatedAt":"2026-02-13T19:16:13.149856-08:00","assignee":"jayminwest@gmail.com","description":"Replace sessions.json read/write in status display, worktree cleanup, nudge resolution, priming, clean, init, and watchdog files with the SQLite-backed SessionStore.\n\nFiles to migrate: src/commands/status.ts, src/commands/worktree.ts, src/commands/nudge.ts, src/commands/prime.ts, src/commands/clean.ts, src/commands/init.ts, src/watchdog/daemon.ts.\n\nReplace patterns:\n- loadSessions() JSON helpers -> openSessionStore() from sessions/compat.ts\n- store.getActive() for active session queries\n- store.getAll() for full listing\n- store.remove() for cleanup\n- store.purge() for reset/clean operations\n- For init.ts: stop creating sessions.json (SessionStore auto-creates sessions.db)\n- For clean.ts: purge SessionStore (store.purge({all:true})) instead of resetting sessions.json\n- For worktree.ts: use store.remove() instead of filtering JSON array\n- For daemon.ts: use store.getActive(), store.updateState(), store.updateEscalation()\n\nUpdate all associated test files to use SessionStore instead of sessions.json fixtures.\n\nAcceptance criteria:\n- All 7 source files use SessionStore exclusively\n- All tests pass (bun test)\n- Type checking passes (tsc --noEmit)\n- Lint passes (biome check .)","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.149856-08:00"}
{"id":"overstory-xj3m","title":"Write client.test.ts for src/mulch/client.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:20:22.707305-08:00","updatedAt":"2026-02-13T08:26:57.058321-08:00","assignee":"jayminwest@gmail.com","closeReason":"Created client.test.ts with 18 tests using real mulch CLI","closedAt":"2026-02-13T08:26:57.058321-08:00"}
{"id":"overstory-xkvr","title":"Fix biome lint/format issues from merge batch","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-16T07:35:43.904826-08:00","updatedAt":"2026-02-16T07:44:27.595379-08:00","assignee":"jayminwest@gmail.com","description":"Three files have biome issues after merge: (1) src/commands/mail.test.ts - formatting (multi-line arrays should be single-line), (2) src/doctor/merge-queue.test.ts - import organization, (3) src/doctor/merge-queue.ts:41 - noImplicitAnyLet lint error. Fix all three with bunx biome check --write . or manual edits. All quality gates must pass.","closeReason":"Merged: biome lint/format issues fixed","closedAt":"2026-02-16T07:44:27.595379-08:00"}
{"id":"overstory-xkyq","title":"Lead 4: Data layer test coverage (metrics, triage, mulch client)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T07:58:41.809109-08:00","updatedAt":"2026-02-13T08:55:07.564498-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.564498-08:00"}
{"id":"overstory-xn5","title":"sling --spec does not validate that spec file exists","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-12T08:18:49.318108-08:00","updatedAt":"2026-02-12T08:43:21.436478-08:00","assignee":"jayminwest@gmail.com","description":"'overstory sling --spec /nonexistent/spec.md' succeeds and launches an agent with an overlay that says 'Spec: /nonexistent/spec.md' and instructs 'Read your task spec at the path above'. The agent will waste time trying to read a nonexistent file. Sling should validate the spec path exists before spawning.","closeReason":"Added spec file existence validation in sling --spec. Uses Bun.file().exists() to check the spec path before spawning, throwing a ValidationError if the file does not exist.","closedAt":"2026-02-12T08:43:21.436478-08:00"}
{"id":"overstory-xo8h","title":"Add mulch diff PostToolUse hook on git commit","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-20T13:09:45.68128-08:00","updatedAt":"2026-02-20T13:30:13.313159-08:00","assignee":"jayminwest@gmail.com","description":"Add a PostToolUse Bash hook to templates/hooks.json.tmpl that detects git commit and runs mulch diff HEAD~1. Agents passively see what expertise records were affected by their commit without having to remember to check. Lightweight, zero cost when no mulch changes. Hook: read stdin, grep for git commit, run mulch diff HEAD~1 2>/dev/null || true.","closeReason":"mulch diff PostToolUse hook implemented across 3 builders: template hook, init.ts buildHooksJson, and hooks-deployer test fix. All merged to main.","closedAt":"2026-02-20T13:30:13.313159-08:00"}
{"id":"overstory-xxu7","title":"Add doctor checks for provider configuration","status":"open","type":"task","priority":3,"createdAt":"2026-02-19T12:13:58.066103-08:00","updatedAt":"2026-02-19T12:13:58.066103-08:00","assignee":"jayminwest@gmail.com","description":"Add health checks in the doctor system for multi-provider configuration.\n\nFILES: src/doctor/ (new check file or extend existing)\n\nChecks to add:\n1. Provider reachability: for each gateway provider, verify baseUrl is reachable (HTTP HEAD)\n2. Auth token presence: for each gateway provider, verify the referenced env var (authTokenEnv) is set in the environment\n3. Tool-use warning: for non-Anthropic models assigned to tool-heavy roles (builder, scout, merger), emit a warning that tool-use compat is not guaranteed\n4. Model format validation: verify provider-prefixed model strings have a valid provider reference\n5. Empty ANTHROPIC_API_KEY reminder: if any gateway provider is configured, check that tests/docs mention the ANTHROPIC_API_KEY='' requirement\n\nFollow existing doctor check patterns (see src/doctor/*.ts for conventions)."}
{"id":"overstory-y2ob","title":"Beacon prompt not auto-submitted in interactive mode (sendKeys multiline bug)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-12T13:10:04.916741-08:00","updatedAt":"2026-02-12T13:17:14.333996-08:00","assignee":"jayminwest@gmail.com","description":"When overstory sling sends the multiline beacon prompt via tmux send-keys, the text is entered into Claude Code's TUI input buffer but NOT submitted. The newlines in the beacon text are inserted as literal newlines in the input field rather than triggering a submit. A manual Enter keypress is needed to actually submit the prompt. Fix: either send beacon as single line, escape newlines, or send a separate Enter keystroke after a delay.","closeReason":"Flattened beacon to single line (parts joined by em-dash) and added newline-to-space guard in sendKeys() to prevent multiline tmux send-keys issues","closedAt":"2026-02-12T13:17:14.333996-08:00"}
{"id":"overstory-y3ng","title":"Replace bd/beads with TRACKER_CLI/TRACKER_NAME template vars in 8 agent .md files + CLAUDE.md.tmpl","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T17:49:22.136034-08:00","updatedAt":"2026-02-23T17:58:45.349594-08:00","assignee":"jayminwest@gmail.com","closeReason":"Replaced all bd CLI command invocations with {{TRACKER_CLI}} and beads concept references with {{TRACKER_NAME}} in all 8 agent definition files (builder, coordinator, lead, merger, monitor, reviewer, scout, supervisor) and templates/CLAUDE.md.tmpl. Preserved angle-bracket bead-id vars, beadId code identifiers, and bd-xyz example IDs.","closedAt":"2026-02-23T17:58:45.349594-08:00"}
{"id":"overstory-y58o","title":"Fix coordinator.test.ts timeout: startCoordinator writes session to sessions.json with correct fields","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-13T09:09:46.373923-08:00","updatedAt":"2026-02-13T09:21:21.599524-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed coordinator.test.ts mock.module leak: replaced mock.module() with DI pattern (CoordinatorDeps interface) matching daemon.ts _tmux/_triage/_nudge pattern. Tests now pass fake tmux/deployHooks via coordinatorCommand's deps parameter instead of process-global mock.module().","closedAt":"2026-02-13T09:21:21.599524-08:00"}
{"id":"overstory-y72","title":"Create shared test harness: real git repo + temp dir helpers","status":"closed","type":"task","priority":2,"createdAt":"2026-02-12T08:56:10.598442-08:00","updatedAt":"2026-02-12T09:00:03.92038-08:00","assignee":"jayminwest@gmail.com","description":"Build a small shared test utility module (e.g. src/test-helpers.ts or test/helpers.ts) that provides: (1) createTempGitRepo() - initializes a real git repo in a temp dir with an initial commit, (2) cleanupTempDir() - rm -rf helper, (3) commitFile() - add and commit a file to a test repo. These helpers enable multiple test files to use real git instead of mocking Bun.spawn. Keeps test setup DRY across worktree, resolver, and sling tests.","closeReason":"Created src/test-helpers.ts with createTempGitRepo(), commitFile(), cleanupTempDir() + src/test-helpers.test.ts (8 tests passing)","closedAt":"2026-02-12T09:00:03.92038-08:00"}
{"id":"overstory-y9ec","title":"Add --watchdog flag to coordinator start","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-13T21:33:59.4982-08:00","updatedAt":"2026-02-15T12:42:00.190547-08:00","assignee":"jayminwest@gmail.com","description":"Add a --watchdog flag to 'overstory coordinator start' that auto-starts the Tier 0 watchdog daemon in the background when the coordinator is launched.\n\n## Context\nThe watchdog daemon (overstory watch) monitors agent health but must be started manually — easy to forget. The coordinator is the natural lifecycle owner: when it starts, agents will be spawned; when it stops, there's nothing to monitor.\n\n## Implementation Details\n\n### 1. Add --watchdog flag to startCoordinator (src/commands/coordinator.ts)\nAfter the coordinator tmux session is spawned and the beacon is sent, if --watchdog is present:\n- Shell out to 'overstory watch --background' using Bun.spawn\n- This reuses all existing watchdog logic (PID file management, duplicate detection, config loading) without refactoring watch.ts\n- Log that the watchdog was started (or warn if it failed / was already running)\n\n### 2. Auto-stop watchdog in stopCoordinator (src/commands/coordinator.ts)\nWhen stopping the coordinator, always check for and kill a running watchdog:\n- Read .overstory/watchdog.pid\n- Check if the PID is alive (process.kill(pid, 0))\n- If alive, kill it (process.kill(pid, SIGTERM)) and remove the PID file\n- Runs regardless of whether --watchdog was used at start — if the coordinator is going down, there's nothing to monitor\n- Import isProcessRunning from src/watchdog/health.ts (already exported)\n\n### 3. Update help text and --json output\n- Add --watchdog to the help string in COORDINATOR_HELP\n- Include watchdog: true/false in --json output of start\n- Include watchdogStopped: true/false in --json output of stop\n\n### 4. Add watchdog field to statusCoordinator\n- Check the PID file and report whether watchdog is running in status output\n\n### 5. Tests (src/commands/coordinator.test.ts)\nAdd tests using DI to avoid real subprocess spawns:\n- startCoordinator with --watchdog calls the watchdog spawn logic\n- startCoordinator without --watchdog does not start watchdog\n- stopCoordinator kills watchdog when PID file exists and process is alive\n- stopCoordinator cleans up stale PID file when process is dead\n- stopCoordinator works fine when no watchdog PID file exists\nDI approach: Add _watchdog to CoordinatorDeps with start and stop functions, similar to the existing _tmux pattern. Real implementation shells out to 'overstory watch --background' / reads PID file + kills. Tests inject fakes.\n\n## Files to modify\n- src/commands/coordinator.ts — main changes\n- src/commands/coordinator.test.ts — new tests\n\n## Verification\n1. bun test src/commands/coordinator.test.ts\n2. bun test (all tests pass)\n3. biome check . (lint clean)\n4. tsc --noEmit (types clean)\n5. Manual: overstory coordinator start --watchdog → verify watchdog.pid exists and process is alive\n6. Manual: overstory coordinator stop → verify watchdog process is killed and PID file removed","closeReason":"Implemented --watchdog flag: auto-start on coordinator start, auto-stop on coordinator stop, status reporting, DI for testing, 288 lines of tests","closedAt":"2026-02-15T12:42:00.190547-08:00"}
{"id":"overstory-ye8f","title":"Flip OVERSTORY_GITIGNORE to wildcard+whitelist in init.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T07:17:58.622439-08:00","updatedAt":"2026-02-23T17:43:27.830533-08:00","assignee":"jayminwest@gmail.com","description":"Change init.ts gitignore constant and writeOverstoryGitignore function","closeReason":"Fixed metrics.db schema: updated bead_id column name to task_id in CREATE TABLE statement (line 433) and PRIMARY KEY constraint (line 441) in init.ts. Updated corresponding test description in metrics/store.test.ts line 66. All quality gates pass: 2055 tests pass, lint clean, typecheck clean.","closedAt":"2026-02-23T17:43:27.830533-08:00"}
{"id":"overstory-yg84","title":"costs --run returns empty: metrics.db missing run_id column","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-19T12:08:21.530768-08:00","updatedAt":"2026-02-19T12:33:08.886395-08:00","assignee":"jayminwest@gmail.com","description":"## Problem\n\n`overstory costs --run <run-id>` always returns 'No session data found' even when `overstory run list` shows runs with agents and `overstory costs` (without --run) shows cost data for those same agents.\n\n## Root Cause\n\nThe --run code path in `src/commands/costs.ts:429-439` uses a two-step indirection that is fundamentally broken:\n\n1. Queries `sessions.db` via `sessionStore.getByRun(runId)` to find agent names belonging to a run\n2. Queries `metrics.db` via `metricsStore.getRecentSessions(1000)` and filters by those agent names\n\nThis fails because:\n\n**Problem A:** `metrics.db`'s `sessions` table has no `run_id` column. Schema is `(agent_name, bead_id)` as PK with no run association. Confirmed via `PRAGMA table_info(sessions)`.\n\n**Problem B:** `sessions.db` session rows are ephemeral — they get purged when agents complete or `overstory clean` runs. After a run completes, `getByRun()` returns empty because the session rows are gone, even though the `runs` table still records the run metadata (id, agent_count, status). In current state, sessions.db has only 1 row (zombie coordinator with NULL run_id) while metrics.db has 20 cost records.\n\n## Reproduction\n\n```bash\noverstory run list                    # Shows runs with agent counts\noverstory costs                       # Shows 20 sessions, $105.22 total\noverstory costs --run run-2026-02-19T00-31-12-810Z   # 'No session data found'\noverstory costs --run run-2026-02-16T15-03-37-730Z   # 'No session data found' (72 agents!)\n```\n\n## Proposed Fix\n\nAdd `run_id TEXT` column to `metrics.db`'s sessions table so cost queries can filter by run directly without depending on the ephemeral sessions.db lifecycle data.\n\n### Files to change:\n\n1. **`src/types.ts`** — Add `runId: string | null` to `SessionMetrics` interface\n2. **`src/metrics/store.ts`** — Add `run_id` column via migration (same pattern as `migrateTokenColumns`), add `getSessionsByRun(runId)` method to MetricsStore interface, update `recordSession` to accept and store run_id\n3. **`src/commands/log.ts`** — Pass `session.runId` through when calling `metricsStore.recordSession()` at session-end (the AgentSession already has run_id from sessions.db at that point)\n4. **`src/commands/costs.ts`** — Replace the broken indirection (lines 429-439) with direct `metricsStore.getSessionsByRun(runId)` call\n5. **`src/metrics/store.ts` tests** — Add test for `getSessionsByRun()`\n\n### Migration note:\nExisting metrics rows will have NULL run_id after the migration. This is acceptable — only new sessions recorded after the fix will have run_id populated. The --run query should still work correctly (returns only rows with matching run_id, older rows simply won't appear).","closeReason":"Fixed costs --run by adding run_id column to metrics.db. Builder run-id-builder implemented: (1) runId field on SessionMetrics type, (2) run_id column with migration in metrics/store.ts, (3) getSessionsByRun() query method, (4) runId passed through in log.ts session-end, (5) costs.ts --run path uses direct query instead of broken cross-reference. All 1895 tests pass.","closedAt":"2026-02-19T12:33:08.886395-08:00"}
{"id":"overstory-yhbn","title":"Phase 3: Auto-propulsion system (self-dispatching workers)","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T13:50:50.06679-08:00","updatedAt":"2026-02-13T06:37:11.551274-08:00","assignee":"jayminwest@gmail.com","description":"Implement an auto-propulsion mechanism so agents self-execute when work is assigned rather than waiting for explicit commands. Core principle: when work appears on an agent's assignment, they MUST execute it. Key components: (1) Assignment binding - atomic association of a beads issue to an agent at spawn time (stored in agent session, not an .md file), (2) Hook-driven activation - SessionStart checks for bound work and begins immediately, (3) No idle state for workers - complete task, self-clean, exit. No lingering sessions, (4) Self-cleaning lifecycle: worker signals completion, pushes branch, requests own termination, (5) Task group tracking: auto-close task groups when all member issues resolve, notify coordinator. This replaces the current manual 'orchestrator decides everything' model with propulsion-driven autonomy.","closeReason":"Phase 3 auto-propulsion implemented: (1) builder.md updated with worker_done mail protocol and MISSING_WORKER_DONE failure mode, (2) overlay.ts quality gates now include worker_done signal step, (3) prime.ts injects activation context for bound tasks so agents self-start even if beacon is lost, (4) group.ts sends mail notification to coordinator on auto-close","closedAt":"2026-02-13T06:37:11.551274-08:00"}
{"id":"overstory-yhv6","title":"Beacon sendKeys requires extra Enter to trigger agent processing","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-12T13:50:45.144963-08:00","updatedAt":"2026-02-12T14:01:09.49012-08:00","assignee":"jayminwest@gmail.com","description":"During dogfood testing, the agent spawned via 'overstory sling' sat idle after the beacon prompt was sent via tmux sendKeys. The Claude Code TUI showed the prompt text but never started processing it. A manual 'tmux send-keys Enter' was needed to trigger the agent. The 2s sleep in sling.ts (line ~356) before sendKeys may not be enough for Claude Code's TUI to fully initialize. Possible fixes: (1) increase the sleep, (2) poll tmux pane for readiness indicator before sending, (3) send an extra Enter after the beacon.","closeReason":"Implemented typed mail protocol with 8 new message types + payload column, structural tool enforcement hooks, and beacon sendKeys fix","closedAt":"2026-02-12T14:01:09.49012-08:00"}
{"id":"overstory-yiey","title":"overstory spec write CLI command","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-12T14:48:22.714956-08:00","updatedAt":"2026-02-12T14:56:03.380592-08:00","assignee":"jayminwest@gmail.com","closeReason":"Implemented overstory spec write command with full test coverage. Command creates spec files at .overstory/specs/{bead-id}.md populated with beads issue metadata. Includes --force flag for overwriting existing specs. All quality gates pass.","closedAt":"2026-02-12T14:56:03.380592-08:00"}
{"id":"overstory-yj6n","title":"Add NO_COLOR and --quiet support","status":"closed","type":"task","priority":2,"createdAt":"2026-02-15T17:04:32.941226-08:00","updatedAt":"2026-02-16T07:56:40.055887-08:00","assignee":"jayminwest@gmail.com","description":"Support NO_COLOR env var (suppress ANSI codes) and --quiet flag (suppress non-error output). Standard for CI/scripting environments. Currently reporter.ts uses ANSI directly with no way to disable.","closeReason":"Merged: NO_COLOR env var and --quiet flag support added","closedAt":"2026-02-16T07:56:40.055887-08:00"}
{"id":"overstory-yoyx","title":"Inject base agent definition content into spawned agents","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T10:30:55.428064-08:00","updatedAt":"2026-02-13T10:35:19.839308-08:00","assignee":"jayminwest@gmail.com","description":"Base agent definition files (agents/builder.md, scout.md, etc.) are copied to .overstory/agent-defs/ during init but never read or injected into agent context at runtime. The overlay template (overlay.md.tmpl) only contains Layer 2 (task-specific WHAT) but Layer 1 (role-specific HOW) is missing. Agents miss ~100+ lines per role: workflow instructions, propulsion principles, named failure modes, completion protocols, tool constraints. Fix: either have overlay.ts read and prepend the base def into CLAUDE.md, or have prime.ts inject it during SessionStart.","closeReason":"Inject base agent definition (Layer 1) into overlay CLAUDE.md: added baseDefinition field to OverlayConfig, read agent def file in sling.ts, added {{BASE_DEFINITION}} placeholder to overlay template","closedAt":"2026-02-13T10:35:19.839308-08:00"}
{"id":"overstory-yrsp","title":"Allow leads to self-review for simple changes","status":"open","type":"feature","priority":3,"createdAt":"2026-02-21T06:26:50.477882-08:00","updatedAt":"2026-02-21T06:26:50.477882-08:00","assignee":"jayminwest@gmail.com","description":"For simple changes (single file, well-scoped, quality gates pass), the lead should be able to read the diff, run quality gates itself, and send merge_ready directly without spawning a reviewer agent. Add self-review guidance to lead.md Phase 3 as an alternative to spawning a reviewer. Criteria: single-file change, builder reports clean quality gates, lead can verify in fewer than 5 tool calls."}
{"id":"overstory-ywno","title":"Migrate nudge.ts and prime.ts session readers to SessionStore","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T14:58:35.026666-08:00","updatedAt":"2026-02-13T19:16:13.153791-08:00","assignee":"jayminwest@gmail.com","closeReason":"All consumers migrated to SQLite SessionStore. compat.ts empty-DB migration gap also fixed.","closedAt":"2026-02-13T19:16:13.153791-08:00"}
{"id":"overstory-z12a","title":"Config migration: beads → taskTracker","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T15:47:25.157631-08:00","updatedAt":"2026-02-23T15:52:35.529202-08:00","assignee":"jayminwest@gmail.com","description":"Update src/types.ts (OverstoryConfig.beads → taskTracker, OverlayConfig trackerCli/trackerName), src/config.ts (migrateDeprecatedTaskTrackerKeys, DEFAULT_CONFIG, validation), src/config.test.ts (migration tests)","closeReason":"Migrated beads config key to taskTracker with backend field. Added TaskTrackerBackend type, migration function, updated defaults and validation. All 59 tests pass.","closedAt":"2026-02-23T15:52:35.529202-08:00"}
{"id":"overstory-z1c2","title":"Add TaskTrackerBackend type and taskTracker config with migration","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T16:22:48.49618-08:00","updatedAt":"2026-02-23T16:34:36.311551-08:00","assignee":"jayminwest@gmail.com","closeReason":"Replaced OverstoryConfig.beads with taskTracker: { backend, enabled }. Added TaskTrackerBackend type, migrateDeprecatedTaskTrackerKeys() for beads:/seeds: legacy config, validation, and 5 new tests. Fixed cascade in sling.ts and 11 test fixture files. All 2052 tests pass, typecheck clean.","closedAt":"2026-02-23T16:34:36.311551-08:00"}
{"id":"overstory-z5y","title":"L4-7: Implement init command (src/commands/init.ts)","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T07:12:37.582518-08:00","updatedAt":"2026-02-12T07:39:42.022851-08:00","assignee":"jayminwest@gmail.com","description":"CLI: overstory init. Scaffolds .overstory/ in current project: creates config.yaml with defaults, agent-manifest.json, hooks.json, directories (agents/, worktrees/, specs/, logs/). Updates .gitignore with worktrees, logs, metrics.db, mail.db. Updates .claude/CLAUDE.md with overstory awareness.","closeReason":"All L4 modules implemented, lint+types clean","closedAt":"2026-02-12T07:39:42.022851-08:00"}
{"id":"overstory-zbwi","title":"Review: merge_ready validation in mail.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-17T08:08:11.958613-08:00","updatedAt":"2026-02-17T08:12:17.013744-08:00","assignee":"jayminwest@gmail.com","closeReason":"Review complete: PASS","closedAt":"2026-02-17T08:12:17.013744-08:00"}
{"id":"overstory-ze4","title":"Test sling edge case","status":"closed","type":"task","priority":4,"createdAt":"2026-02-12T12:02:02.778813-08:00","updatedAt":"2026-02-12T12:10:07.068336-08:00","assignee":"jayminwest@gmail.com","description":"temp task for testing sling edge cases","closeReason":"temp test issues, closed after E2E validation","closedAt":"2026-02-12T12:10:07.068336-08:00"}
{"id":"overstory-zicy","title":"Fix dashboard.test.ts leaking stdout via infinite poll loop","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-13T08:50:40.770657-08:00","updatedAt":"2026-02-13T08:55:07.567538-08:00","assignee":"jayminwest@gmail.com","closeReason":"Test coverage blitz complete: 830 tests, 0 failures, 42 files. All 17 modules now have test coverage.","closedAt":"2026-02-13T08:55:07.567538-08:00"}
{"id":"overstory-znju","title":"Score-based priming in sling: add --sort-by-score to mulch prime calls","status":"open","type":"feature","priority":2,"createdAt":"2026-02-21T05:58:51.126399-08:00","updatedAt":"2026-02-21T05:58:51.126399-08:00","assignee":"jayminwest@gmail.com","description":"When sling spawns agents and pre-fetches file-scoped expertise via mulch.prime(), add --sort-by-score flag so agents get the most battle-tested (highest confirmation-frequency score) records first within the budget window. Simple flag addition to mulch/client.ts prime() method and the sling call site at src/commands/sling.ts:421-422."}
{"id":"overstory-zq15","title":"Add root-user pre-flight guard to agent spawn commands","status":"closed","type":"task","priority":3,"createdAt":"2026-02-18T06:39:50.273142-08:00","updatedAt":"2026-02-18T16:55:21.808451-08:00","assignee":"jayminwest@gmail.com","description":"When overstory runs as root (UID 0), the claude CLI rejects --dangerously-skip-permissions and the tmux session dies immediately. The current error is misleading ('no server running on /tmp/tmux-0/default'). Add a process.getuid?.() === 0 check in all 4 spawn commands (sling.ts, coordinator.ts, supervisor.ts, monitor.ts) that emits a clear error before attempting tmux creation. Also improve the sendKeys() error in tmux.ts to distinguish 'server not running' from 'session not found'. See GitHub issue #13 for context.","closeReason":"Root-user pre-flight guard added to sling, coordinator, supervisor, monitor spawn commands via isRunningAsRoot() pure function. sendKeys() in tmux.ts now distinguishes server-not-running from session-not-found errors. 2 builders completed, all 1879 tests pass.","closedAt":"2026-02-18T16:55:21.808451-08:00"}
{"id":"overstory-zsan","title":"Fix: remove hardcoded canonical branch allowlist in detectCanonicalBranch","status":"closed","type":"task","priority":2,"createdAt":"2026-02-23T11:09:46.191849-08:00","updatedAt":"2026-02-23T11:14:37.509404-08:00","assignee":"jayminwest@gmail.com","closeReason":"Fixed detectCanonicalBranch to accept any current branch name instead of hardcoded main/master/develop allowlist. Added 2 tests.","closedAt":"2026-02-23T11:14:37.509404-08:00"}
{"id":"overstory-zyz7","title":"Add DI for _spawnClaude to triage.ts + export pure helpers","status":"closed","type":"task","priority":1,"createdAt":"2026-02-13T08:20:18.874467-08:00","updatedAt":"2026-02-13T08:26:50.046515-08:00","assignee":"jayminwest@gmail.com","closeReason":"Exported buildTriagePrompt and classifyResponse, created triage.test.ts with 17 tests","closedAt":"2026-02-13T08:26:50.046515-08:00"}
{"id":"overstory-c53f","title":"test","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T02:33:24.071Z","updatedAt":"2026-02-24T02:33:31.395Z","closedAt":"2026-02-24T02:33:31.395Z","closeReason":"test issue, cleaning up"}
{"id":"overstory-6cf5","title":"flag-test","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-24T02:33:36.445Z","updatedAt":"2026-02-24T02:33:41.641Z","assignee":"test@test.com","description":"testing desc","closedAt":"2026-02-24T02:33:41.641Z","closeReason":"test issue, cleaning up"}
{"id":"overstory-6bd6","title":"deployHooks() overwrites project settings.local.json instead of merging","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T02:42:04.680Z","updatedAt":"2026-02-24T13:22:08.438Z","description":"## Problem\n\n`deployHooks()` in `src/agents/hooks-deployer.ts:488` writes `.claude/settings.local.json` from scratch via `Bun.write()`, destroying any existing user hooks or non-hooks settings (permissions, env, $schema) that were already in the file.\n\nThis affects three callers that pass `projectRoot` (not a fresh worktree):\n- `src/commands/coordinator.ts:331` — `deployHooks(projectRoot, COORDINATOR_NAME, \"coordinator\")`\n- `src/commands/supervisor.ts:185` — `deployHooks(projectRoot, flags.name, \"supervisor\")`\n- `src/commands/monitor.ts:123` — `deployHooks(projectRoot, MONITOR_NAME, \"monitor\")`\n\nThe `sling.ts` caller is unaffected since it writes to a freshly created worktree.\n\n## Context\n\nThe CLI `hooks install` path was already fixed in commit `a544a7e` — `mergeHooksByEventType()` in `src/commands/hooks.ts:37` deduplicates and merges hooks per event type. But `deployHooks()` in hooks-deployer.ts never received the same treatment.\n\nExternal PR #27 (feat/hooks-merge by @greghughespdx) identified this same gap, but is now partially outdated because the `hooks.ts` half already landed. The `deployHooks()` fix from that PR is the remaining valuable piece.\n\nRelated closed issues: overstory-7za6, overstory-ot9d (fixed the CLI path only).\n\n## Fix\n\n1. Before writing, read existing `.claude/settings.local.json` if it exists.\n2. Strip stale overstory hook entries (matching `overstory` or `OVERSTORY_` patterns).\n3. Merge new overstory hooks alongside user hooks using the same `mergeHooksByEventType()` pattern from `hooks.ts`, or import it directly.\n4. Preserve non-hooks keys (permissions, env, $schema, etc.).\n5. Place overstory hooks before user hooks per event type (security guards must run first).\n6. Make re-deployment idempotent (no duplicates on repeated calls).\n\n## Files likely affected\n\n- `src/agents/hooks-deployer.ts` — update `deployHooks()` to read-then-merge\n- `src/agents/hooks-deployer.test.ts` — add tests for merge-aware deployment\n- Possibly extract shared merge utils from `src/commands/hooks.ts` if needed by both paths","closedAt":"2026-02-24T13:22:08.438Z","closeReason":"Already patched — deployHooks() now reads existing settings.local.json, strips stale overstory entries, merges with user hooks, and preserves non-hooks keys"}
{"id":"overstory-bdbe","title":"Native canopy integration in overstory sling/overlay","status":"open","type":"feature","priority":3,"createdAt":"2026-02-24T02:53:24.991Z","updatedAt":"2026-02-24T02:56:41.612Z","description":"Wrap cn CLI via Bun.spawn in src/canopy/client.ts (same pattern as mulch/seeds wrappers). This enables: (1) render-on-demand at sling time — instead of reading static .md files from agents/, call cn render <name> to get the fully-resolved prompt with inheritance, (2) pre-sling schema validation — run cn validate <name> before spawning to catch broken prompts early, (3) prompt version tracking per session/run — log which prompt version each agent was spawned with in sessions.db, (4) version pinning per agent spawn — optionally pin agents to specific prompt versions via cn pin. Implementation: src/canopy/client.ts CanopyClient class, update manifest.ts to load from canopy, update sling.ts to call render()+validate() before spawn, add promptVersion to session records. Tests in src/canopy/client.test.ts with real cn CLI calls. Depends on Path A (.canopy/ managing agent prompts) being stable first."}
{"id":"overstory-d362","title":"Test description flag","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T02:59:31.829Z","updatedAt":"2026-02-24T02:59:39.140Z","description":"This is a test to see if --description works","closedAt":"2026-02-24T02:59:39.140Z","closeReason":"test issue, cleaning up"}
{"id":"overstory-d5b9","title":"Incrementally adopt Commander for CLI parsing","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T03:30:01.860Z","updatedAt":"2026-02-24T22:40:00.534Z","description":"Replace manual argv parsing (getFlag/hasFlag/parseArgs helpers) with Commander across 30+ commands. Incremental plan: (1) Add Commander dependency, (2) Migrate simple commands first (init, status, clean, doctor), (3) Then complex commands with subcommands (agents, coordinator, supervisor, mail, run, group, spec, hooks, worktree), (4) Finally observability commands (dashboard, inspect, trace, errors, replay, feed, logs). Each migration should be a standalone PR. Each command should export a register function that takes a Commander program instance.","closedAt":"2026-02-24T22:40:00.534Z","closeReason":"Superseded by completed epic overstory-541f — Commander.js fully adopted across 25 files"}
{"id":"overstory-90d7","title":"Adopt chalk for output formatting","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T03:30:05.409Z","updatedAt":"2026-02-24T22:40:01.562Z","description":"Replace the custom ANSI color system in src/logging/color.ts with chalk. Currently uses manual escape codes with NO_COLOR/FORCE_COLOR/TERM=dumb detection. Chalk handles all of this natively. Approach: (1) Replace src/logging/color.ts internals with chalk while keeping the same API surface initially, (2) Then gradually migrate direct color usage in commands to chalk calls. Can be done in parallel with Commander migration.","closedAt":"2026-02-24T22:40:01.562Z","closeReason":"Superseded by completed epic overstory-541f — chalk@5.6.2 fully adopted via src/logging/color.ts"}
{"id":"overstory-426c","title":"Use process.exitCode instead of process.exit()","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-24T03:30:08.024Z","updatedAt":"2026-02-24T22:40:02.278Z","description":"Overstory uses process.exit(1) in the main catch block and various error paths. Switch to process.exitCode = 1 for testability. Keep the OverstoryError hierarchy (ConfigError, AgentError, HierarchyError, MailError, ValidationError, MergeError, WorktreeError) — it's the most mature error system in the ecosystem. Just change the exit mechanism.","closedAt":"2026-02-24T22:40:02.278Z","closeReason":"Duplicate of overstory-8d46 (same work: process.exit→process.exitCode migration)"}
{"id":"overstory-1dca","title":"Add overstory update command for refreshing managed files","status":"open","type":"feature","priority":2,"createdAt":"2026-02-24T03:52:58.586Z","updatedAt":"2026-02-24T03:52:58.586Z"}
{"id":"overstory-3522","title":"Lead overlay claims Write/Edit available but hooks block them","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T04:27:43.122Z","updatedAt":"2026-02-24T14:07:14.940Z","description":"## Problem\n\nThe lead agent base definition (`agents/lead.md`, lines 69-73) lists Write and Edit as available tools:\n\n```markdown\n### Tools Available\n- **Read** -- read any file in the codebase\n- **Write** -- create spec files for sub-workers\n- **Edit** -- modify spec files and coordination documents\n- **Glob** -- find files by name pattern\n```\n\nBut `src/agents/hooks-deployer.ts` line 10 includes \"lead\" in `NON_IMPLEMENTATION_CAPABILITIES`, which generates PreToolUse hooks that unconditionally block Write, Edit, and NotebookEdit for lead agents. The lead trusts its overlay (system prompt) over dispatch mail, so it repeatedly attempts Write/Edit and gets blocked, never discovering the alternative path.\n\n## Root Cause\n\nThe agent definition documents capabilities that the hook system blocks. The hooks are correct (leads should NOT write arbitrary files), but the documentation is wrong.\n\n## Fix\n\nUpdate `agents/lead.md`:\n\n1. **Remove Write and Edit from \"Tools Available\" section** (lines 71-72). Delete these two lines entirely.\n\n2. **Add `overstory spec write` to the Bash commands list** (line 75). Add as the first Bash entry:\n   ```\n   - `overstory spec write <id> --body \"...\" --agent $OVERSTORY_AGENT_NAME` (write spec files)\n   ```\n   This command already passes through hooks because `\"overstory \"` is in the SAFE_BASH_PREFIXES whitelist (hooks-deployer.ts:102).\n\n3. **Update Phase 2 Build workflow** (line 194). Replace the current spec-writing instruction:\n   ```\n   6. **Write spec files** for each subtask based on scout findings. Each spec goes to `.overstory/specs/<bead-id>.md`\n   ```\n   With explicit `overstory spec write` usage:\n   ```\n   6. **Write spec files** for each subtask using `overstory spec write`:\n      ```bash\n      overstory spec write <subtask-id> --body \"# Spec Title\n      \n      ## Objective\n      <what to build>\n      \n      ## Acceptance Criteria\n      <how to know it is done>\n      \n      ## File Scope\n      <which files the builder owns>\n      \n      ## Context\n      <relevant types, interfaces, existing patterns from scout findings>\n      \n      ## Dependencies\n      <what must be true before this work starts>\" --agent $OVERSTORY_AGENT_NAME\n      ```\n      Each spec is written to `.overstory/specs/<subtask-id>.md` at the canonical project root (even when run from a worktree). Specs should include:\n   ```\n   Keep the existing sub-bullets (Objective, Acceptance criteria, File scope, Context, Dependencies).\n\n## Files to Modify\n\n- `agents/lead.md` — ONLY file that needs changes\n\n## Files NOT to Modify\n\n- `src/agents/hooks-deployer.ts` — Lead being in NON_IMPLEMENTATION_CAPABILITIES is correct by design\n- `templates/overlay.md.tmpl` — Template is fine\n- `src/agents/overlay.ts` — Overlay generator is fine\n\n## Verification\n\n1. Read the updated `agents/lead.md` and confirm Write/Edit are not listed as available tools\n2. Confirm `overstory spec write` is documented as the canonical spec-writing path\n3. Confirm Phase 2 Build workflow references `overstory spec write` not Write/Edit\n4. Run `bun test && bun run lint && bun run typecheck` (no code changes, but validate nothing broke)\n\n## Related Issues\n\nThis is the highest-impact single fix. Combined with the --skip-task-check and bead-lock-bypass fixes, it fully unblocks the lead->builder pipeline.","closedAt":"2026-02-24T14:07:14.940Z","closeReason":"Removed false Write/Edit tool claims from agents/lead.md, added overstory spec write as canonical spec-writing path"}
{"id":"overstory-81fc","title":"sling can't find issues created in agent worktrees","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T04:28:15.983Z","updatedAt":"2026-02-24T14:07:16.013Z","description":"## Problem\n\nWhen a lead agent runs \\`sd create\\` inside its worktree, the new issue is written to \\`<worktree>/.seeds/issues.jsonl\\`. But \\`overstory sling <task-id>\\` validates the task ID by calling \\`tracker.show(taskId)\\` with \\`cwd\\` set to \\`config.project.root\\` (the canonical repo root). The issue doesn't exist there, so sling throws:\n\n\\`\\`\\`\nError [AGENT_ERROR]: Task \"seeds-7cac\" not found or inaccessible\n\\`\\`\\`\n\nThis prevents leads from creating subtask issues and spawning builders for them.\n\n## Root Cause\n\nIn \\`src/commands/sling.ts\\`, step 6 (lines 446-466):\n\n\\`\\`\\`typescript\nconst tracker = createTrackerClient(resolvedBackend, config.project.root);\nif (config.taskTracker.enabled) {\n    let issue: TrackerIssue;\n    try {\n        issue = await tracker.show(taskId);\n    } catch (err) {\n        throw new AgentError(\\`Task \"\\${taskId}\" not found or inaccessible\\`, { ... });\n    }\n    // ...status validation...\n}\n\\`\\`\\`\n\nThe tracker client uses \\`config.project.root\\` as the working directory for \\`sd show\\`, which only searches the canonical repo's \\`.seeds/\\`, not the worktree's.\n\n## Fix\n\nAdd a \\`--skip-task-check\\` flag to \\`overstory sling\\` that bypasses task existence validation.\n\n### Implementation Details\n\n**File:** \\`src/commands/sling.ts\\`\n\n1. **Parse the flag** (after line 277, alongside existing flag parsing):\n   \\`\\`\\`typescript\n   const skipTaskCheck = args.includes(\"--skip-task-check\");\n   \\`\\`\\`\n\n2. **Update SLING_HELP** (line 237-254): Add new option line after \\`--skip-scout\\`:\n   \\`\\`\\`\n     --skip-task-check              Skip task existence validation (for worktree-created issues)\n   \\`\\`\\`\n\n3. **Update JSDoc** (line 226-236): Add \\`--skip-task-check\\` to the Flags list.\n\n4. **Guard step 6** (line 448): Change the condition from:\n   \\`\\`\\`typescript\n   if (config.taskTracker.enabled) {\n   \\`\\`\\`\n   To:\n   \\`\\`\\`typescript\n   if (config.taskTracker.enabled && !skipTaskCheck) {\n   \\`\\`\\`\n   Add a comment explaining why:\n   \\`\\`\\`typescript\n   // --skip-task-check bypasses this when the issue was created in a worktree\n   // (e.g., lead creates subtask via \\`sd create\\`, which writes to worktree's\n   // .seeds/, not the canonical root's .seeds/).\n   \\`\\`\\`\n\n5. **Guard step 10** (line 539): Same condition change for the claim call:\n   \\`\\`\\`typescript\n   if (config.taskTracker.enabled && !skipTaskCheck) {\n   \\`\\`\\`\n   Reasoning: \\`tracker.claim()\\` calls \\`sd update <id> --status in_progress\\` at the canonical root, which will fail if the issue doesn't exist there.\n\n6. **Optional warning** when \\`--skip-task-check\\` used without \\`--parent\\` (edge case, mildly suspicious):\n   \\`\\`\\`typescript\n   if (skipTaskCheck && !parentAgent) {\n       process.stderr.write(\n           \\`⚠️  Warning: --skip-task-check used without --parent. Task ID \"\\${taskId}\" will not be validated.\\n\\`,\n       );\n   }\n   \\`\\`\\`\n\n### Also update \\`agents/lead.md\\`\n\nUpdate the \"Spawning Sub-Workers\" section (lines 88-97) to include \\`--skip-task-check\\` in the sling example:\n\n\\`\\`\\`markdown\n### Spawning Sub-Workers\n\\\\\\`\\\\\\`\\\\\\`bash\noverstory sling <subtask-id> \\\\\n  --capability <scout|builder|reviewer|merger> \\\\\n  --name <unique-agent-name> \\\\\n  --spec <path-to-spec-file> \\\\\n  --files <file1,file2,...> \\\\\n  --parent \\$OVERSTORY_AGENT_NAME \\\\\n  --depth <current-depth+1> \\\\\n  --skip-task-check\n\\\\\\`\\\\\\`\\\\\\`\n\nThe \\`--skip-task-check\\` flag is needed because issues you create via \\`sd create\\` in your worktree live in \\`<worktree>/.seeds/\\`, but sling validates against the canonical repo root.\n\\`\\`\\`\n\n## Files to Modify\n\n- \\`src/commands/sling.ts\\` — Flag parsing, help text, step 6 and step 10 conditions\n- \\`agents/lead.md\\` — Add --skip-task-check to sling examples (can be combined with seeds-3522)\n\n## Verification\n\n1. \\`bun test src/commands/sling.test.ts\\` — existing tests still pass (no behavior change for default case)\n2. \\`bun test && bun run lint && bun run typecheck\\` — full quality gates\n3. Manual test: spawn a lead, have it create a subtask with \\`sd create\\`, then \\`overstory sling <subtask-id> --skip-task-check --parent <lead> --depth 2 --capability builder --name test-builder\\`\n\n## Design Decision: Why --skip-task-check instead of worktree-aware tracker\n\nAlternative considered: Make the tracker search worktree \\`.seeds/\\` as well as canonical root. Rejected because:\n- Requires cross-tool coupling between overstory and seeds internals\n- Seeds is a separate project with its own git repo\n- The flag is opt-in, transparent, and doesn't require changes to seeds\n- Leads know they just created the issue, so skipping validation is safe","closedAt":"2026-02-24T14:07:16.013Z","closeReason":"Added --skip-task-check flag to overstory sling for worktree-created issues"}
{"id":"overstory-b878","title":"sling bead lock prevents parent delegating own task to child","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T04:28:46.778Z","updatedAt":"2026-02-24T14:07:19.227Z","description":"## Problem\n\nWhen a lead agent holds bead \\`seeds-afd6\\` and tries to spawn a builder for the same bead via \\`overstory sling seeds-afd6 --capability builder --parent <lead-name>\\`, sling rejects it:\n\n\\`\\`\\`\nError [AGENT_ERROR]: Bead \"seeds-afd6\" is already being worked by agent \"commander-lead\".\nConcurrent work on the same bead causes duplicate issues and wasted tokens.\n\\`\\`\\`\n\nCombined with seeds-81fc (can't use worktree-created subtask IDs), this creates a deadlock: the lead has no valid task ID to give to sling.\n\n## Root Cause\n\nIn \\`src/commands/sling.ts\\`, step 5d (lines 418-426):\n\n\\`\\`\\`typescript\n// 5d. Bead-level locking: prevent concurrent agents on the same bead ID.\nconst lockHolder = checkBeadLock(activeSessions, taskId);\nif (lockHolder !== null) {\n    throw new AgentError(\n        \\`Bead \"\\${taskId}\" is already being worked by agent \"\\${lockHolder}\". \\` +\n            \\`Concurrent work on the same bead causes duplicate issues and wasted tokens.\\`,\n        { agentName: name },\n    );\n}\n\\`\\`\\`\n\nThe check is unconditional — it doesn't consider whether the lock holder is the parent agent performing a legitimate delegation.\n\n## Fix\n\nAdd a parent-bypass to the bead lock check. When the lock holder is the same agent as \\`--parent\\`, allow the spawn.\n\n### Implementation Details\n\n**File:** \\`src/commands/sling.ts\\`\n\n1. **Modify step 5d condition** (line 420). Change from:\n   \\`\\`\\`typescript\n   if (lockHolder !== null) {\n   \\`\\`\\`\n   To:\n   \\`\\`\\`typescript\n   if (lockHolder !== null && lockHolder !== parentAgent) {\n   \\`\\`\\`\n\n2. **Update the comment** to explain the exception:\n   \\`\\`\\`typescript\n   // 5d. Bead-level locking: prevent concurrent agents on the same bead ID.\n   // Exception: if the lock holder is the parent agent, this is legitimate\n   // delegation (parent assigns their own task to a child worker).\n   const lockHolder = checkBeadLock(activeSessions, taskId);\n   if (lockHolder !== null && lockHolder !== parentAgent) {\n   \\`\\`\\`\n\n3. **Do NOT modify \\`checkBeadLock()\\` itself** — it remains a pure query function that returns who holds the lock. The delegation logic belongs in the caller.\n\n### Add Tests\n\n**File:** \\`src/commands/sling.test.ts\\`\n\nAdd a new describe block after the existing \\`checkBeadLock\\` tests (line 597):\n\n\\`\\`\\`typescript\n/**\n * Tests for bead lock parent bypass pattern.\n *\n * When a parent agent delegates its own task to a child worker via\n * \\`overstory sling <bead-id> --parent <parent-name>\\`, the bead lock\n * should allow it if the lock holder matches the parent agent.\n * This tests the condition used in slingCommand (lockHolder !== parentAgent),\n * not checkBeadLock itself.\n */\ndescribe(\"bead lock parent bypass\", () => {\n    test(\"parent matching lock holder should be allowed\", () => {\n        const lockHolder = checkBeadLock(\n            [makeBeadSession(\"lead-alpha\", \"seeds-afd6\")],\n            \"seeds-afd6\",\n        );\n        const parentAgent = \"lead-alpha\";\n        // sling condition: lockHolder !== null && lockHolder !== parentAgent\n        expect(lockHolder !== null && lockHolder !== parentAgent).toBe(false);\n    });\n\n    test(\"parent NOT matching lock holder should be blocked\", () => {\n        const lockHolder = checkBeadLock(\n            [makeBeadSession(\"other-lead\", \"seeds-afd6\")],\n            \"seeds-afd6\",\n        );\n        const parentAgent = \"lead-alpha\";\n        expect(lockHolder !== null && lockHolder !== parentAgent).toBe(true);\n    });\n\n    test(\"null parent with lock holder should be blocked\", () => {\n        const lockHolder = checkBeadLock(\n            [makeBeadSession(\"lead-alpha\", \"seeds-afd6\")],\n            \"seeds-afd6\",\n        );\n        const parentAgent: string | null = null;\n        expect(lockHolder !== null && lockHolder !== parentAgent).toBe(true);\n    });\n});\n\\`\\`\\`\n\n## Edge Cases\n\n1. **Multiple children spawned with same parent task ID**: First child takes the bead lock. Second child sees the first child (not the parent) as the lock holder, so it's blocked. This is correct — one builder per bead. If the lead needs multiple builders, it should create subtask issues with distinct IDs.\n\n2. **Parent agent name is substring of lock holder**: Not an issue — comparison is strict equality (\\`!==\\`), not substring match.\n\n3. **Race condition**: Two sling calls checking the lock simultaneously. Mitigated by existing stagger delay (step 5b) and SQLite WAL mode with busy timeout.\n\n## Files to Modify\n\n- \\`src/commands/sling.ts\\` — One-line condition change at step 5d\n- \\`src/commands/sling.test.ts\\` — Add bead lock parent bypass tests\n\n## Verification\n\n1. \\`bun test src/commands/sling.test.ts\\` — new and existing tests pass\n2. \\`bun test && bun run lint && bun run typecheck\\` — full quality gates\n3. Manual: spawn a lead for \\`seeds-X\\`, then from coordinator run \\`overstory sling seeds-X --parent <lead-name> --capability builder --name test-builder --depth 2\\` — should succeed instead of erroring","closedAt":"2026-02-24T14:07:19.227Z","closeReason":"Bead lock now allows parent agent to delegate its own task to child worker"}
{"id":"overstory-32a8","title":"Dashboard coordinator state stuck on 'booting' (GH #22)","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T13:31:08.866Z","updatedAt":"2026-02-24T14:07:20.298Z","description":"Dashboard shows coordinator as 'booting' indefinitely even though it is actively working. overstory inspect shows 'working' correctly but dashboard reads from SessionStore which never transitions past booting. The booting->working transition happens in log.ts tool-start hook and watchdog health.ts, but dashboard sees stale state. Investigate the disconnect between inspect (which computes live state via health checks) and dashboard (which reads raw SessionStore). Fix: either dashboard should apply the same health-check logic, or the state must be persisted to SessionStore so dashboard reads it correctly. See GH #22 for reproduction steps.","closedAt":"2026-02-24T14:07:20.298Z","closeReason":"Dashboard now uses evaluateHealth() for live state computation, fixing coordinator stuck on booting"}
{"id":"overstory-fb50","title":"Builder: fix orchestrator mail recipient","status":"in_progress","type":"task","priority":1,"createdAt":"2026-02-24T13:34:35.724Z","updatedAt":"2026-02-24T13:34:39.910Z"}
{"id":"overstory-d6af","title":"Dashboard still shows 'bead_id' instead of task_id","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-24T13:45:11.720Z","updatedAt":"2026-02-24T21:56:03.393Z","description":"The dashboard column header on line 476 of src/commands/dashboard.ts still reads 'Bead ID' and the local variable is named beadId (line 506). The help text on line 766 also says 'bead ID'. Similarly, status.ts:290 and inspect.ts:276 display beadId without relabeling.\n\nDeeper issue: the TypeScript property name across all types in src/types.ts is still beadId (14+ occurrences), even though the SQLite column was already migrated from bead_id to task_id (src/sessions/store.ts:141-148). The DB layer maps task_id back to beadId at read time (store.ts:114).\n\nScope of the rename:\n- src/types.ts: rename beadId → taskId on ~14 interfaces/types\n- src/commands/dashboard.ts: column header 'Bead ID' → 'Task ID', local var, help text\n- src/commands/status.ts:290: display label\n- src/commands/inspect.ts:276: display label\n- src/sessions/store.ts: update row mapping (line 114) and insert binding (line 273)\n- All call sites referencing .beadId across the codebase (agents/, commands/, watchdog/, merge/, tracker/, etc.)\n- Test files referencing beadId\n\nThis is a straightforward but wide rename — touches ~30+ files.","closedAt":"2026-02-24T21:56:03.393Z","closeReason":"Renamed beadId→taskId across 68 TypeScript files. Dashboard now shows Task ID instead of Bead ID. Display labels updated in dashboard.ts, status.ts, inspect.ts. SQL migration bead_id references preserved. Follow-up issue seeds-648d filed for remaining cosmetic renames in agent .md files and trace.ts function name."}
{"id":"overstory-01ee","title":"Add PreToolUse hook to block AskUserQuestion for non-interactive agents","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T13:48:58.628Z","updatedAt":"2026-02-24T15:12:11.438Z","description":"When agents run in tmux (non-interactive), AskUserQuestion blocks indefinitely with no human to respond. The delegation-lead hit this exact failure: it couldn't resolve context, called AskUserQuestion, and stalled until session timeout. Add a PreToolUse hook in hooks-deployer.ts that rejects AskUserQuestion for all agent capabilities. Agents should escalate via mail (--type question) instead of prompting a non-existent user.","closedAt":"2026-02-24T15:12:11.438Z","closeReason":"AskUserQuestion, EnterPlanMode, EnterWorktree blocked for all agent capabilities via PreToolUse hooks in hooks-deployer.ts"}
{"id":"overstory-96c8","title":"Fix lead.md: remove Write/Edit claims, add spec write, add --skip-task-check","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T13:53:20.266Z","updatedAt":"2026-02-24T13:57:13.888Z","closedAt":"2026-02-24T13:57:13.888Z","closeReason":"Fixed agents/lead.md: removed false Write/Edit tool claims, added overstory spec write, added --skip-task-check to sling example, updated Phase 2 Build"}
{"id":"overstory-57ca","title":"Fix sling.ts: add --skip-task-check and bead lock parent bypass","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T13:53:20.940Z","updatedAt":"2026-02-24T13:57:14.750Z","closedAt":"2026-02-24T13:57:14.750Z","closeReason":"Fixed sling.ts: added --skip-task-check flag, bead lock parent bypass, 3 new tests. All 71 tests pass."}
{"id":"overstory-e2e0","title":"Update overstory CLAUDE.md CLI references to use 'ov' alias","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T14:29:16.926Z","updatedAt":"2026-02-24T23:19:10.948Z","closedAt":"2026-02-24T23:19:10.948Z","closeReason":"Updated all overstory CLAUDE.md CLI references to use ov alias. 2 builders: (1) alias-docs-core-builder updated CLAUDE.md, README.md, templates/CLAUDE.md.tmpl, templates/overlay.md.tmpl, src/agents/overlay.ts + tests — 175 lines. (2) alias-docs-agents-builder updated 16 agent definition files (agents/*.md + .overstory/agent-defs/*.md). All 2145 tests pass."}
{"id":"overstory-34f3","title":"Update overstory agent definitions to use 'ov' and 'ml' aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T14:29:22.444Z","updatedAt":"2026-02-25T00:19:30.294Z","closedAt":"2026-02-25T00:19:30.294Z","closeReason":"All agent definition files, templates, and overlay code updated to use ov/ml CLI aliases. 7 builder branches ready to merge: canopy-alias-builder (leaf prompts), canopy-coord-builder (coordinator prompts), monitor-alias-builder (monitor prompt), tmpl-alias-builder (templates + overlay code), hooks-alias-builder (hooks template + tests), e2e-fix-builder (e2e test fix), bead-fix-builder (beadId->taskId cleanup). All subtask issues closed."}
{"id":"overstory-f0f9","title":"Update overstory templates to use 'ov' and 'ml' aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T14:29:27.225Z","updatedAt":"2026-02-25T02:17:41.449Z","closedAt":"2026-02-25T02:17:41.449Z"}
{"id":"overstory-bd16","title":"Update overstory source code CLI references and help text to use 'ov' alias","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T14:29:32.544Z","updatedAt":"2026-02-24T23:53:55.269Z","closedAt":"2026-02-24T23:53:55.269Z","closeReason":"Completed: Updated overstory source code CLI references to use ov alias. Two builders changed 60 files total across src/commands/, src/agents/, src/doctor/, templates/. All .name() calls, Bun.spawn refs, beacon text, help text, error messages, shell completions, JSDoc, dashboard title, and test assertions updated. Quality gates pass (2145 tests, typecheck, lint)."}
{"id":"overstory-431e","title":"Update mulch client wrapper to use 'ml' CLI alias","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T14:29:36.844Z","updatedAt":"2026-02-24T14:29:36.844Z"}
{"id":"overstory-d00c","title":"Update overstory test files for 'ov' and 'ml' alias changes","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T14:29:41.861Z","updatedAt":"2026-02-24T14:29:41.861Z"}
{"id":"overstory-ce20","title":"Update overstory README.md and CHANGELOG.md for 'ov' alias","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T14:29:46.110Z","updatedAt":"2026-02-25T02:17:42.402Z","closedAt":"2026-02-25T02:17:42.402Z"}
{"id":"overstory-e879","title":"Update root os-eco CLAUDE.md for 'ov' and 'ml' aliases","status":"open","type":"task","priority":1,"createdAt":"2026-02-24T14:29:52.008Z","updatedAt":"2026-02-24T14:29:52.008Z"}
{"id":"overstory-fed9","title":"Update mulch sub-repo docs to use 'ml' alias","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T14:29:57.265Z","updatedAt":"2026-02-24T14:29:57.265Z"}
{"id":"overstory-6ff8","title":"Update overstory doctor checks and diagnostics for 'ov' alias","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T14:30:01.261Z","updatedAt":"2026-02-25T03:01:15.131Z","closedAt":"2026-02-25T03:01:15.131Z","closeReason":"Already done — doctor checks use 'ov' as primary with 'overstory' as alias"}
{"id":"overstory-00a4","title":"Update overstory .mulch expertise records for 'ov' and 'ml' aliases","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T14:30:04.963Z","updatedAt":"2026-02-25T03:01:18.886Z","closedAt":"2026-02-25T03:01:18.886Z","closeReason":"Wontfix — mulch expertise records are prose descriptions, not binary invocations; no alias updates needed"}
{"id":"overstory-18d5","title":"Update canopy prompts referencing overstory/mulch to use short aliases","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T14:30:09.588Z","updatedAt":"2026-02-25T03:33:28.849Z","closedAt":"2026-02-25T03:33:28.849Z","closeReason":"Standardized CLI aliases in agent definition files and overlay template: replaced all 'mulch <cmd>' invocations with 'ml <cmd>' across 8 agent .md files (builder, scout, reviewer, lead, coordinator, supervisor, merger, monitor) and src/agents/overlay.ts. 27 line changes across 9 files. Noun phrases and TS identifiers preserved."}
{"id":"overstory-cfd3","title":"Verify backwards compatibility of 'ov' and 'ml' aliases","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T14:30:13.818Z","updatedAt":"2026-02-25T03:01:16.560Z","closedAt":"2026-02-25T03:01:16.560Z","closeReason":"Verified — both binaries in PATH, tmux.ts has ov→overstory fallback loop, doctor checkAlias validates at runtime"}
{"id":"overstory-93a8","title":"Doctor: check ecosystem CLI availability (mulch/ml, sd, cn, ov)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T14:42:32.153Z","updatedAt":"2026-02-24T15:22:31.959Z","description":"Add doctor dependency checks for all ecosystem CLIs, including short aliases.\n\n## Context\nos-eco-2b32 (mulch not found in agent PATH) is fixed, but `ov doctor` should proactively verify that all ecosystem tools are reachable. Currently it checks `mulch` and the tracker CLI (bd/sd), but misses `cn` (canopy) entirely and doesn't check short aliases.\n\n## What to do\nUpdate `src/doctor/dependencies.ts` to check for:\n\n1. **canopy** (`cn`) — currently not checked at all. Mark as optional (warn, not fail) since canopy is not required for core orchestration.\n2. **Short aliases** (`ov`, `ml`, `sd`) — check that the short alias resolves alongside the long-form name. If only the long form works, emit a warning suggesting the alias.\n3. **npm install hints** — when a tool is missing, the fix message should reference the npm package:\n   - `npm i -g @os-eco/mulch-cli` (provides `mulch` and `ml`)\n   - `npm i -g @os-eco/seeds-cli` (provides `sd`)\n   - `npm i -g @os-eco/canopy-cli` (provides `cn`)\n   - `npm i -g @os-eco/overstory-cli` (provides `overstory` and `ov`)\n\n## Implementation notes\n- Follow existing `checkTool()` pattern in `src/doctor/dependencies.ts`\n- canopy should be `required: false` (warn on missing, not fail)\n- Short alias checks can be grouped under the same tool (e.g., check `mulch` first, then `ml` — if both exist, pass; if only long form, warn; if neither, fail)\n- Keep the existing checks for git, bun, tmux unchanged\n\n## Files\n- `src/doctor/dependencies.ts` — main changes\n- `src/doctor/dependencies.test.ts` — add test cases for canopy and alias checks","closedAt":"2026-02-24T15:22:31.959Z","closeReason":"Doctor now checks canopy (cn), short aliases (ov, ml, sd), and shows npm install hints for all ecosystem CLIs"}
{"id":"overstory-aff5","title":"Fix coordinator start error + SessionStore migration perf","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T14:45:12.993Z","updatedAt":"2026-02-24T15:12:12.486Z","closedAt":"2026-02-24T15:12:12.486Z","closeReason":"GH#26 fixed: waitForTuiReady detects dead sessions, ensureTmuxAvailable preflight check, startCoordinator handles session death"}
{"id":"overstory-43b1","title":"Block AskUserQuestion for agents + doctor ecosystem CLI checks","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T14:45:15.424Z","updatedAt":"2026-02-24T15:22:34.268Z","closedAt":"2026-02-24T15:22:34.268Z","closeReason":"Both subtasks complete: AskUserQuestion/EnterPlanMode/EnterWorktree blocked for agents (seeds-01ee), doctor ecosystem CLI checks added (seeds-93a8)"}
{"id":"overstory-33b0","title":"Provider test coverage: config/manifest + sling env injection","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T14:45:18.222Z","updatedAt":"2026-02-24T15:12:13.814Z","closedAt":"2026-02-24T15:12:13.814Z","closeReason":"Provider test coverage complete: 10 config/manifest tests + 7 sling env injection tests"}
{"id":"overstory-541f","title":"Epic: CLI Framework Migration (Commander + Chalk)","status":"closed","type":"epic","priority":1,"createdAt":"2026-02-24T15:48:09.337Z","updatedAt":"2026-02-24T17:39:23.047Z","description":"Migrate Overstory's CLI from custom manual arg parsing to Commander.js (~30 commands) and replace the custom color.ts ANSI system with Chalk, implementing the os-eco brand palette. This is the foundation for all other branding work — standardized help screens, per-command help, and visual identity depend on this.","blocks":["overstory-c6d6","overstory-9c7b","overstory-606c","overstory-4516","overstory-2243","overstory-9629"],"closedAt":"2026-02-24T17:39:23.047Z","closeReason":"Epic complete. All 6 sub-tasks merged: Commander.js entry point (seeds-c6d6), core workflow commands (seeds-9c7b), messaging commands (seeds-606c), observability commands (seeds-4516), infrastructure commands (seeds-2243), Chalk migration (seeds-9629). ~30 commands migrated from manual arg parsing to Commander.js. Chalk v5 replaces custom ANSI system with brand palette. Two runtime deps added: commander ^14.0.3, chalk ^5.6.2."}
{"id":"overstory-b0f1","title":"Epic: Standardize CLI Output","status":"open","type":"epic","priority":1,"createdAt":"2026-02-24T15:48:10.585Z","updatedAt":"2026-02-24T15:49:20.815Z","description":"Apply the branding spec's output conventions consistently across all Overstory commands: JSON envelope format, version output, error handling, help screen Style A, status icons Set D (minimal), standardized message formats, and accent color highlighting for IDs/references.","blocks":["overstory-a222","overstory-4752","overstory-8d46","overstory-197c","overstory-9ab0","overstory-596c","overstory-eab8"]}
{"id":"overstory-790c","title":"Epic: New Commands & Features","status":"open","type":"epic","priority":2,"createdAt":"2026-02-24T15:48:12.009Z","updatedAt":"2026-02-24T15:49:21.864Z","description":"Add new commands and flags specified by the branding spec: --fix flag for doctor, upgrade command for self-update, ecosystem dashboard, and --timing/--debug flag for execution timing.","blocks":["overstory-c0cf","overstory-bcc5","overstory-5c51","overstory-8d3f"]}
{"id":"overstory-c6d6","title":"Migrate CLI entry point and global flags to Commander.js","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:18.553Z","updatedAt":"2026-02-24T16:18:03.721Z","description":"Replace the manual arg parsing in src/index.ts with Commander.js (v14+). Set up the program with global flags: -h/--help, -v/--version, --json, --quiet/-q, --verbose. Preserve the existing Levenshtein fuzzy-match command suggestion feature. Current state: ~130 lines of manual switch-case routing in index.ts with getFlag()/hasFlag() helpers. Commander gives us per-command --help for free.","blockedBy":["overstory-541f"],"blocks":["overstory-197c"],"closedAt":"2026-02-24T16:18:03.721Z","closeReason":"Commander.js entry point migration complete. src/index.ts rewritten with Commander program, global flags, fuzzy-match preserved. commander ^14.0.3 added as first runtime dep. Commit 073e522, merged clean."}
{"id":"overstory-9c7b","title":"Migrate core workflow commands to Commander","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:20.492Z","updatedAt":"2026-02-24T17:06:35.740Z","description":"Migrate 7 core workflow commands to Commander subcommands: init, sling, stop, prime, spec, merge, clean. Each currently uses manual getFlag()/hasFlag() parsing. Convert to Commander .command()/.option()/.action() pattern. Preserve all existing flags and behavior.","blockedBy":["overstory-541f"],"closedAt":"2026-02-24T17:06:35.740Z","closeReason":"7 core workflow commands migrated to Commander.js. init, sling, stop, prime, spec, merge, clean converted from manual arg parsing to typed Options interfaces. 2125 tests pass. Merged clean."}
{"id":"overstory-606c","title":"Migrate messaging commands to Commander","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:21.914Z","updatedAt":"2026-02-24T16:51:02.682Z","description":"Migrate messaging commands to Commander: mail (send/check/list/read/reply/purge subcommands) and nudge. Currently 7 subcommands with manual arg parsing. Convert to Commander nested subcommands.","blockedBy":["overstory-541f"],"closedAt":"2026-02-24T16:51:02.682Z","closeReason":"Messaging commands migrated to Commander. mail.ts (6 subcommands) and nudge.ts converted from manual arg parsing to Commander .command()/.option()/.action(). All tests pass. Both branches merged clean."}
{"id":"overstory-4516","title":"Migrate observability commands to Commander","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:23.722Z","updatedAt":"2026-02-24T17:35:58.540Z","description":"Migrate 11 observability commands to Commander: status, dashboard, inspect, trace, errors, replay, feed, logs, run (list/show/complete subcommands), costs, metrics. These are the most flag-heavy commands (--json, --agent, --run, --since, --until, --limit, --follow, --interval, etc.).","blockedBy":["overstory-541f"],"closedAt":"2026-02-24T17:35:58.540Z","closeReason":"11 observability commands migrated to Commander.js. status, dashboard, inspect, trace, errors, replay, feed, logs, run, costs, metrics all converted to Commander .command()/.option()/.action(). Merged with auto-resolve."}
{"id":"overstory-2243","title":"Migrate infrastructure commands to Commander","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:25.670Z","updatedAt":"2026-02-24T17:36:00.066Z","description":"Migrate 11 infrastructure commands to Commander: hooks (install/uninstall/status), worktree (list/clean), log, watch, monitor (start/stop/status), doctor, coordinator (start/stop/status), supervisor (start/stop/status), group (create/status/add/remove/list), agents, completions.","blockedBy":["overstory-541f"],"closedAt":"2026-02-24T17:36:00.066Z","closeReason":"11 infrastructure commands migrated to Commander.js. hooks, worktree, log, watch, monitor, doctor, coordinator, supervisor, group, agents, completions all converted. 2129 tests pass. Merged with auto-resolve."}
{"id":"overstory-9629","title":"Replace color.ts with Chalk and implement brand palette","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T15:48:30.312Z","updatedAt":"2026-02-24T16:37:32.659Z","description":"Replace the custom src/logging/color.ts ANSI code system with Chalk (v5+). Implement the branding palette: Overstory forest green rgb(27,94,32) as brand color, amber rgb(255,183,77) as accent, stone gray rgb(120,120,110) as muted, plus ANSI green/yellow/red/cyan for semantic colors. Update src/logging/reporter.ts to use Chalk. Preserve NO_COLOR/FORCE_COLOR/TERM=dumb support (Chalk handles this natively). Note: Chalk is a dev dependency only for types — at runtime it's an npm import, which is fine since overstory already requires npm install.","blockedBy":["overstory-541f"],"blocks":["overstory-197c","overstory-9ab0","overstory-596c","overstory-eab8"],"closedAt":"2026-02-24T16:37:32.659Z","closeReason":"Chalk v5 migration complete. color.ts and reporter.ts rewritten with Chalk internals, brand palette implemented (forest green, amber, stone gray). 9 command files updated for direct chalk usage. 2144 tests pass. Merged with auto-resolved conflicts in bun.lock and package.json."}
{"id":"overstory-a222","title":"Implement JSON envelope format across all commands","status":"open","type":"task","priority":1,"createdAt":"2026-02-24T15:48:36.707Z","updatedAt":"2026-02-24T15:49:20.639Z","description":"Wrap all --json output in the standard envelope: { success: true, command: '<name>', ...data } for success, { success: false, command: '<name>', error: '<message>' } for errors. Currently each command outputs different raw JSON shapes (e.g. mail send returns { id }, status returns { agents, worktrees, ... }). With --json, errors go to stdout inside the envelope; without --json, errors go to stderr as colored text.","blockedBy":["overstory-b0f1"]}
{"id":"overstory-4752","title":"Standardize version output","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T15:48:39.743Z","updatedAt":"2026-02-24T15:49:20.669Z","description":"Change version output from 'overstory v0.6.3' to bare semver '0.6.3'. Add --version --json support returning { name: '@os-eco/overstory-cli', version: '0.6.3', runtime: 'bun', platform: 'darwin-arm64' }. Ensure VERSION constant in src/index.ts stays synced with package.json version.","blockedBy":["overstory-b0f1"]}
{"id":"overstory-8d46","title":"Migrate error exits from process.exit(1) to process.exitCode = 1","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T15:48:42.374Z","updatedAt":"2026-02-25T03:01:17.788Z","description":"Replace all process.exit(1) calls with process.exitCode = 1 + return. Currently ~5 process.exit(1) calls in index.ts (lines 292, 301, 305, 312, 315). The doctor command already uses process.exitCode correctly. Rationale: process.exitCode is testable and allows cleanup/finally blocks to run.","blockedBy":["overstory-b0f1"],"closedAt":"2026-02-25T03:01:17.788Z","closeReason":"Already completed — all process.exit(1) calls replaced with process.exitCode = 1 in src/index.ts"}
{"id":"overstory-197c","title":"Apply Help Screen Style A format","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T15:48:46.337Z","updatedAt":"2026-02-24T15:49:27.603Z","description":"Reformat all help screens (global + per-command) to match Style A: Line 1 has tool name in brand color + bold, version in dim, tagline in default. Command names in ANSI green. Args like <id> in dim. Option flags in dim. Two-space indent. Descriptions aligned at column 20. Footer: 'Run overstory <command> --help' with alias in dim. Depends on Commander + Chalk migrations.","blockedBy":["overstory-b0f1","overstory-c6d6","overstory-9629"]}
{"id":"overstory-9ab0","title":"Replace status icons with Set D (minimal)","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T15:48:50.762Z","updatedAt":"2026-02-25T03:42:30.470Z","description":"Replace all status icons with the terminal-safe Set D: open/pending = green '-', in_progress/active = cyan '>', closed/done = dim 'x', blocked/warning = yellow '\\!'. Currently uses Unicode circles (● ○ ◌) and emoji section headers (📊 🤖 🌳 📬 🔀 📈). Remove all emoji from CLI output. Affected files: src/commands/agents.ts, status.ts, dashboard.ts, doctor.ts, inspect.ts.","blockedBy":["overstory-b0f1","overstory-9629"],"closedAt":"2026-02-25T03:42:30.470Z","closeReason":"Replaced status icons with Set D minimal across CLI output (13 files changed). Quality-fix-builder fixed biome format + test expectations + mulch binary. Icon-replace-builder handled all icon/emoji replacements. Remaining gap (status.ts + mail.test.ts) filed as overstory-f1db."}
{"id":"overstory-596c","title":"Implement standardized message formats","status":"in_progress","type":"task","priority":2,"createdAt":"2026-02-24T15:48:53.639Z","updatedAt":"2026-02-25T03:20:08.263Z","description":"Apply consistent message formatting across all commands per branding spec. Success: brand-colored bold checkmark + brand-colored message + accent-colored IDs. Warning: yellow bold '\\!' + yellow message + dim hint. Error: red bold '✗' + red message + dim hint. Info/hints: dim text, no prefix, indented. Currently inconsistent across commands.","blockedBy":["overstory-b0f1","overstory-9629"]}
{"id":"overstory-eab8","title":"Add accent color highlighting for IDs and references","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T15:48:57.145Z","updatedAt":"2026-02-24T15:49:27.693Z","description":"Ensure all IDs and cross-references use the amber accent color rgb(255,183,77): agent names, issue/bead IDs, branch names, spec paths, run IDs. Context words (like 'Issue', 'Agent', 'on branch') use dim. Example: 'Agent builder-01 on branch ov/builder-01' where builder-01 and ov/builder-01 are amber, rest is dim.","blockedBy":["overstory-b0f1","overstory-9629"]}
{"id":"overstory-c0cf","title":"Add --fix flag to doctor command","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T15:49:03.340Z","updatedAt":"2026-02-24T15:49:21.774Z","description":"Add a --fix flag to overstory doctor that auto-remediates fixable issues. Currently doctor has 9 check categories (dependencies, config, structure, databases, consistency, agents, merge, logs, version) but is read-only. Fixable things include: missing directories (structure), stale lock files, missing config fields. Mulch and Seeds both already have doctor --fix implemented as reference.","blockedBy":["overstory-790c"]}
{"id":"overstory-bcc5","title":"Add upgrade command for self-update","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T15:49:07.023Z","updatedAt":"2026-02-24T15:49:21.805Z","description":"Implement 'overstory upgrade' command: check npm registry for latest @os-eco/overstory-cli, compare with local VERSION, install via 'bun install -g @os-eco/overstory-cli@latest'. Flags: --check (compare only, exit 0 if current, exit 1 if outdated), --all (update all four ecosystem tools), --json (returns { current, latest, upToDate }). Use 'upgrade' not 'update' to avoid collision with other update commands.","blockedBy":["overstory-790c"]}
{"id":"overstory-5c51","title":"Add ecosystem dashboard command","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T15:49:10.240Z","updatedAt":"2026-02-24T15:49:21.834Z","description":"Implement 'overstory ecosystem' command showing health of all 4 tools: tool name, alias, installed version, update status (latest vs outdated), doctor health summary. Table format with brand colors per tool row. Also shows aggregate stats: last sync time, active agents, open issues, prompt count. References: branding/standards.md ecosystem dashboard mockup.","blockedBy":["overstory-790c"]}
{"id":"overstory-8d3f","title":"Add --timing / --debug flag","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T15:49:12.797Z","updatedAt":"2026-02-24T15:49:21.864Z","description":"Add a global --timing (or --debug) flag that shows execution time on any command. Output format: '[debug] completed in <N>ms' in dim text to stderr (so it doesn't interfere with --json piping). Only prints when the flag is passed. Measure wall-clock time from command start to completion.","blockedBy":["overstory-790c"]}
{"id":"overstory-de10","title":"Cherry-pick .seeds/ changes from lead worktrees before cleanup","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T16:16:40.649Z","updatedAt":"2026-02-24T21:50:04.255Z","description":"Lead agents (coordination-only) create seeds issues in their worktrees, but lead branches are never merged — only builder branches get merged. When overstory worktree clean runs, the lead branch and any .seeds/ commits get deleted. Fix: before cleaning a lead worktree, check for .seeds/ changes and cherry-pick them to main first.","closedAt":"2026-02-24T21:50:04.255Z","closeReason":"Cherry-pick .seeds/ changes from lead worktrees before cleanup. Added preserveSeedsChanges() to manager.ts using three-dot diff + git apply. Lead worktrees now bypass merge check and auto-preserve seeds changes. 4 new tests added."}
{"id":"overstory-db01","title":"Respect merge=union gitattribute for .jsonl files in auto-resolve","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-24T16:16:42.024Z","updatedAt":"2026-02-24T21:45:59.499Z","description":"The overstory merge auto-resolver does not respect merge=union gitattribute for JSONL files like .seeds/issues.jsonl. When a builder branch diverged before new issues were added to main, auto-resolve drops lines from main that are not in the builder branch. Fix: detect merge=union gitattribute on .jsonl files and keep all lines from both sides. Dedup-on-read in seeds handles duplicates. Evidence: cli-standards-builder two-dot diff showed .seeds/issues.jsonl | 4 --.","closedAt":"2026-02-24T21:45:59.499Z","closeReason":"Fixed: added resolveConflictsUnion() and checkMergeUnion() to resolver.ts, modified tryAutoResolve() to detect merge=union gitattribute and keep all lines from both sides. 43 tests pass including 5 new union-specific tests."}
{"id":"overstory-5652","title":"Convention: leads mail follow-up issues to coordinator for creation on main","status":"open","type":"task","priority":3,"createdAt":"2026-02-24T16:16:45.116Z","updatedAt":"2026-02-24T16:16:45.116Z","description":"Quick convention fix for lost-issues problem: lead agents should not run sd create in their worktrees. Instead, they should mail the coordinator with issue details, and the coordinator creates them on main (since it runs at root, not in a worktree). Update agents/lead.md and the overlay template. Quickest mitigation while structural fixes (cherry-pick on clean, merge=union) are implemented."}
{"id":"overstory-9024","title":"Fix: reconcile src/index.ts imports after multi-branch Commander merge","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T17:36:33.344Z","updatedAt":"2026-02-24T17:39:13.182Z","description":"Auto-resolve of src/index.ts after merging observability and infra Commander branches left broken imports. Missing: createDashboardCommand, createInspectCommand, createFeedCommand, createErrorsCommand, createCostsCommand, createMetricsCommand (from commands/*.ts). Also specWriteCommand not imported. Some commands (logs, trace) still use old passthrough pattern — need to check if their command files export createX factories and wire them up. Also remove old unused imports (dashboardCommand, costsCommand, etc).","closedAt":"2026-02-24T17:39:13.182Z","closeReason":"Fixed manually — index.ts imports reconciled after multi-branch merge."}
{"id":"overstory-6543","title":"bun test crashes: Commander.js parseAsync exits on process.argv during test discovery","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T17:51:25.106Z","updatedAt":"2026-02-24T20:03:34.705Z","description":"## Problem\n\nbun test (with no arguments) crashes immediately with: error: unknown command 'unknown'. No test results are produced. The test suite is completely broken for the default bun test invocation.\n\n## Root Cause\n\nThe Commander.js migration (073e522, 4a66089, 682a89c, dee7a38, 8ac9adb, f4cf0d3) moved CLI parsing from manual process.argv slicing to Commander.parseAsync(process.argv). The main() function at the bottom of src/index.ts is called unconditionally at module-load time, so when bun test discovers/loads modules and transitively hits src/index.ts, Commander parses process.argv (which contains bun test runner args), encounters an unknown command, and calls process.exit(1).\n\nIndividual test files work fine (bun test src/config.test.ts passes 64 tests). The issue only manifests with the bare bun test invocation.\n\n## Evidence\n\n- bun test → crashes with 'error: unknown command unknown'\n- bun test src/config.test.ts → 64 tests pass, 129 expect() calls\n- bun test --grep config → 30 tests pass across 76 files\n- No test file directly imports from src/index.ts (grep confirmed)\n\n## Impact\n\n- Quality gates broken: bun test is the first gate in the pipeline\n- CI broken: publish.yml runs bun test before publishing\n- Cannot determine current test count (last known: 2137 tests / 76 files / 5370 expect() at v0.6.3)\n\n## Suggested Fix\n\nGuard the main() call in src/index.ts with import.meta.main:\n\nif (import.meta.main) { main().catch(...) }\n\nimport.meta.main is a Bun built-in that returns true only when the file is the direct entry point, not when imported by the test runner.\n\n## Files\n\n- src/index.ts — add import.meta.main guard around main() call","closedAt":"2026-02-24T20:03:34.705Z","closeReason":"Resolved via seeds-1f0c. The import.meta.main guard was already in place; the actual problem was 12 command modules using a broken Commander wrapper pattern that caused bun test to exit silently."}
{"id":"overstory-1f0c","title":"Fix 12 Commander.js test files that silently exit under bun test","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T18:55:03.046Z","updatedAt":"2026-02-24T20:03:32.818Z","description":"## Problem\n\n12 test files silently exit (0 tests run, exit code 0) under bun test, both individually and as part of the full suite. When the full suite runs, the interaction produces 'error: unknown command unknown' and crashes the entire test runner.\n\n## Affected Files\n\nThese 12 test files all produce 0 test results:\n- src/commands/coordinator.test.ts\n- src/commands/costs.test.ts\n- src/commands/dashboard.test.ts\n- src/commands/errors.test.ts\n- src/commands/feed.test.ts\n- src/commands/inspect.test.ts\n- src/commands/logs.test.ts\n- src/commands/metrics.test.ts\n- src/commands/replay.test.ts\n- src/commands/status.test.ts\n- src/commands/supervisor.test.ts\n- src/commands/trace.test.ts\n\n## Root Cause\n\nAll 12 command modules follow the same Commander.js dual-export pattern:\n1. `createFooCommand(): Command` — returns a Command for composition into index.ts\n2. `fooCommand(args: string[]): Promise<void>` — standalone wrapper that creates a new Command(), adds the subcommand, and calls `parseAsync()`\n\nThe standalone wrapper pattern interacts badly with bun's test runner. When bun test loads the test file, something in the Commander setup causes process.exit(0) during module loading or test registration, killing the test process before any tests execute.\n\n## Evidence\n\n- `bun test src/commands/costs.test.ts` → exit 0, 0 tests (silent death)\n- `bun test src/commands/config.test.ts` → 64 pass (no Commander dual-export)\n- `bun test src/commands/mail.test.ts` → 47 pass (mail.ts has different pattern)\n- `bun test src/commands/sling.test.ts` → 78 pass (no Commander wrapper)\n- `bun test` (full suite) → crashes with 'error: unknown command unknown'\n\n## Acceptance Criteria\n\n1. All 12 test files run successfully under `bun test` individually\n2. `bun test` (full suite, no args) runs all tests without crashing\n3. All quality gates pass: bun test, biome check, tsc --noEmit\n4. No behavior change to the CLI commands themselves\n\n## Debugging Approach\n\nCompare working command test files (mail.test.ts, nudge.test.ts, sling.test.ts) against failing ones to identify the exact difference. The fix likely involves either:\n- Removing the standalone `fooCommand(args)` wrapper pattern entirely (if tests can call `createFooCommand()` directly)\n- Guarding the Commander setup to prevent process.exit during test loading\n- Adding `.exitOverride()` or `.configureOutput()` to prevent Commander from calling process.exit\n\n## Related\n\n- seeds-6543 (original diagnosis of the bun test crash — import.meta.main guard was applied but didn't fix these 12 files)","closedAt":"2026-02-24T20:03:32.818Z","closeReason":"Fixed all 12 Commander.js test files. Root cause: standalone wrapper functions using parent-Command parseAsync pattern caused bun test to exit silently. Fix: converted to direct cmd.parseAsync(args, {from:'user'}) pattern. 2128 tests now pass across 76 files."}
{"id":"overstory-96ed","title":"Hook guard quoting bug: Task tool not blocked for leads","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-24T19:11:10.631Z","updatedAt":"2026-02-24T21:45:58.371Z","description":"## Problem\n\nThe Task tool block guard deployed by hooks-deployer.ts to agent worktrees is not actually blocking the Task tool. A lead agent (test-fix-lead) successfully used the Task tool despite having the guard in settings.local.json.\n\n## Root Cause\n\nThe shell command in the Task (and all NATIVE_TEAM_TOOLS) block guards contains unescaped single quotes inside a single-quoted shell string:\n\n```shell\necho '{\"decision\":\"block\",\"reason\":\"Overstory agents must use 'overstory sling' for delegation — Task is not allowed\"}'\n```\n\nWhen the JSON is unescaped, the shell sees:\n```shell\necho '{\"decision\":\"block\",\"reason\":\"Overstory agents must use 'overstory sling' for delegation ...}'\n```\n\nThe `'overstory sling'` breaks the outer single-quoted string. The shell splits this into multiple arguments, and the resulting echo output may not be valid JSON that Claude Code's hook runner recognizes as a block decision.\n\nAlternatively, $OVERSTORY_AGENT_NAME may not be set in the agent's environment, causing the `[ -z \"$OVERSTORY_AGENT_NAME\" ] && exit 0` guard to passthrough.\n\n## Evidence\n\n- test-fix-lead agent has Task guard in .claude/settings.local.json lines 63-69\n- overstory inspect shows Task tool was used successfully (1 call, no block)\n- All NATIVE_TEAM_TOOLS guards have the same quoting pattern\n\n## Fix Options\n\n1. Escape the single quotes in the reason string: replace 'overstory sling' with overstory sling (no quotes) or use \\'\\''overstory sling'\\'\\''\n2. Use a different quoting approach for the echo command (e.g., double-quotes with escaped inner quotes)\n3. Also verify OVERSTORY_AGENT_NAME is being set via tmux environment in sling.ts\n\n## Files\n\n- src/agents/hooks-deployer.ts — blockGuard() function and NATIVE_TEAM_TOOLS loop\n- src/commands/sling.ts — environment variable setup for spawned agents","closedAt":"2026-02-24T21:45:58.371Z","closeReason":"Fixed hook guard quoting bug (seeds-96ed). blockGuard() now shell-escapes single quotes in JSON reason strings using POSIX technique, preventing NATIVE_TEAM_TOOLS guards from producing malformed JSON. Builder: guard-fix-builder. Branch: overstory/guard-fix-builder/seeds-cd85. All 2133 tests pass."}
{"id":"overstory-52e4","title":"Dashboard: coordinator state stuck on 'booting' despite actively working","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-24T21:31:58.170Z","updatedAt":"2026-02-24T22:10:31.096Z","description":"Dashboard shows coordinator as 'booting' indefinitely even though 'overstory inspect coordinator' correctly shows 'working'. Root cause: dashboard reads from SessionStore which is not being updated for coordinator state, while inspect uses a different data path (tmux capture-pane + process checks). Reported by external user (GH #22). Key files: src/commands/dashboard.ts, src/sessions/store.ts. Fix: ensure SessionStore is updated when coordinator transitions from booting to working state.","closedAt":"2026-02-24T22:10:31.096Z","closeReason":"Fixed coordinator state stuck on booting in overstory status. Root cause: gatherStatus() only reconciled tmux-dead→zombie, missing booting→working for persistent capabilities. Fix: replaced zombie-only loop with evaluateHealth()-based reconciliation matching the dashboard pattern. Branch: overstory/state-fix-builder/seeds-84b5. Files: src/commands/status.ts, src/commands/status.test.ts. 3 new tests, all 2142 tests pass."}
{"id":"overstory-ef20","title":"sling.ts missing ensureTmuxAvailable() preflight check","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-24T21:31:59.435Z","updatedAt":"2026-02-24T21:52:41.624Z","description":"coordinator.ts got ensureTmuxAvailable() preflight in commit 31b648e (fixing GH #26), but sling.ts still calls createSession() directly without checking tmux availability first. When tmux is not running, sling gives a cryptic error instead of the clear 'tmux is not installed or not on PATH' message. Fix: import ensureTmuxAvailable from worktree/tmux.ts and call it before createSession() in sling.ts around line 544.","closedAt":"2026-02-24T21:52:41.624Z","closeReason":"Added ensureTmuxAvailable() preflight check to sling.ts before createSession(), mirroring the existing coordinator.ts pattern. Builder tmux-preflight-builder implemented the fix, passing all 2138 tests, lint, and typecheck. Branch: overstory/tmux-preflight-builder/seeds-2885."}
{"id":"overstory-cd85","title":"Fix blockGuard shell quoting for single quotes in reason strings","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T21:37:13.568Z","updatedAt":"2026-02-24T21:45:56.508Z","closedAt":"2026-02-24T21:45:56.508Z","closeReason":"Fixed blockGuard shell quoting bug: added escapeForSingleQuotedShell helper that properly escapes single quotes for POSIX shell embedding, applied in blockGuard function. 5 new tests added including shell-execution validation."}
{"id":"overstory-3737","title":"Implement preserveSeedsChanges in worktree manager and integrate into clean","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T21:40:45.662Z","updatedAt":"2026-02-24T21:50:00.067Z","closedAt":"2026-02-24T21:50:00.067Z","closeReason":"Implemented preserveSeedsChanges() in manager.ts and integrated into worktree clean. 4 new tests, all 24 tests pass."}
{"id":"overstory-2885","title":"Implement ensureTmuxAvailable() preflight in sling.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T21:48:15.478Z","updatedAt":"2026-02-24T21:51:59.344Z","closedAt":"2026-02-24T21:51:59.344Z","closeReason":"Added ensureTmuxAvailable() preflight to sling.ts before createSession() call. Mirrors coordinator.ts fix. All tests pass."}
{"id":"overstory-648d","title":"Cleanup: remaining beadId references in docs, trace function name, spec JSDoc","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T21:55:21.461Z","updatedAt":"2026-02-25T02:17:41.924Z","description":"Follow-up to seeds-d6af. The main beadId→taskId rename is complete across all TypeScript source files. These secondary items remain:\n\n1. agents/supervisor.md — beadId → taskId in payload descriptions (~15 occurrences)\n2. agents/coordinator.md — beadId → taskId in payload descriptions (~5 occurrences)\n3. src/commands/trace.ts — rename function looksLikeBeadId → looksLikeTaskId (2 sites), update comment 'Bead IDs follow the pattern' → 'Task IDs follow the pattern'\n4. src/commands/trace.test.ts — 'bead pattern' → 'task pattern' in test descriptions (2 occurrences)\n5. src/commands/spec.ts — <bead-id> → <task-id> in JSDoc comments (4 occurrences)\n\nNOTE: Agent definitions (supervisor.md, coordinator.md) are managed prompts — use canopy (cn update) to make changes, not manual edits.","closedAt":"2026-02-25T02:17:41.924Z"}
{"id":"overstory-84b5","title":"Fix gatherStatus() reconciliation to use evaluateHealth","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T22:02:15.121Z","updatedAt":"2026-02-24T22:07:05.311Z","closedAt":"2026-02-24T22:07:05.311Z","closeReason":"Replaced zombie-only reconciliation in gatherStatus() with evaluateHealth()-based loop. Now handles booting→working for persistent capabilities, tmux-dead→zombie for all states, and time-based stale/zombie detection. Added 3 reconciliation tests. All quality gates pass."}
{"id":"overstory-727b","title":"Fix post-merge quality gate issues: beadId in worktree.test.ts + biome formatting in sling.ts","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T22:13:57.823Z","updatedAt":"2026-02-24T22:39:59.774Z","closedAt":"2026-02-24T22:39:59.774Z","closeReason":"Already fixed in commit 3a018b5 (beadId→taskId rename in worktree.test.ts + sling.ts import collapse)"}
{"id":"overstory-fb81","title":"Rename beadId→taskId in worktree.test.ts + fix biome formatting in sling.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T22:15:14.722Z","updatedAt":"2026-02-24T22:20:00.214Z","closedAt":"2026-02-24T22:20:00.214Z","closeReason":"Renamed 8 beadId→taskId references in worktree.test.ts and fixed biome formatting in sling.ts (collapsed multi-line import). All 24 worktree tests pass."}
{"id":"overstory-3f01","title":"Replace process.exit(1) with process.exitCode=1 in index.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T22:58:44.243Z","updatedAt":"2026-02-24T23:03:24.086Z","closedAt":"2026-02-24T23:03:24.086Z","closeReason":"Replaced all 5 process.exit(1) calls in src/index.ts with process.exitCode = 1 (+ return; in catch branches for early-exit semantics). All quality gates pass."}
{"id":"overstory-504b","title":"Rename beadId refs in trace.ts, trace.test.ts, spec.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T22:58:49.856Z","updatedAt":"2026-02-24T23:01:28.010Z","closedAt":"2026-02-24T23:01:28.010Z","closeReason":"Renamed beadId→taskId in trace.ts (function looksLikeBeadId→looksLikeTaskId + comment), trace.test.ts (2 test descriptions), spec.ts (4 JSDoc references). All 44 tests pass, lint/typecheck clean."}
{"id":"overstory-7bad","title":"Alias docs: CLAUDE.md + templates + README","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T22:59:45.188Z","updatedAt":"2026-02-24T23:18:42.806Z","closedAt":"2026-02-24T23:18:42.806Z","closeReason":"Replaced all CLI invocations in CLAUDE.md, README.md, templates/CLAUDE.md.tmpl, templates/overlay.md.tmpl, and src/agents/overlay.ts + overlay.test.ts with ov alias. 175 lines, 2145 tests pass."}
{"id":"overstory-0d8e","title":"Alias docs: agents/*.md + .overstory/agent-defs/*.md","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T22:59:45.802Z","updatedAt":"2026-02-24T23:18:44.200Z","closedAt":"2026-02-24T23:18:44.200Z","closeReason":"Replaced all CLI invocations in 16 agent definition files (agents/*.md + .overstory/agent-defs/*.md) with ov alias. Env vars, paths, branch prefixes preserved."}
{"id":"overstory-281d","title":"Update agents/*.md and templates/*.tmpl CLI references from overstory to ov","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T23:01:42.363Z","updatedAt":"2026-02-24T23:05:25.251Z","closedAt":"2026-02-24T23:05:25.251Z","closeReason":"Duplicate: agents/*.md already done by alias-docs-agents-builder (overstory-0d8e), templates being done by alias-docs-core-builder (overstory-7bad)"}
{"id":"overstory-3446","title":"Update src/**/*.ts CLI references and test assertions from overstory to ov","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T23:01:43.409Z","updatedAt":"2026-02-24T23:53:18.395Z","closedAt":"2026-02-24T23:53:18.395Z","closeReason":"Completed: renamed CLI refs in 27 core src files (index.ts, hooks-deployer, overlay, completions, coordinator, init, doctor, etc.). Tests pass."}
{"id":"overstory-167e","title":"Update CLI references from 'overstory' to 'ov' in index.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T23:05:13.655Z","updatedAt":"2026-02-24T23:07:59.365Z","closedAt":"2026-02-24T23:07:59.365Z","closeReason":"Updated CLI-facing text in src/index.ts: program name, version string, help/error messages all use 'ov' instead of 'overstory'. Product name and directory references unchanged."}
{"id":"overstory-41b8","title":"Update leaf agent defs (builder/scout/reviewer/merger) to use ov/ml aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:05:19.960Z","updatedAt":"2026-02-25T00:19:00.307Z","closedAt":"2026-02-25T00:19:00.307Z","closeReason":"Leaf canopy prompts updated to use ov/ml aliases (builder, scout, reviewer, merger, leaf-worker, read-only-worker)"}
{"id":"overstory-1962","title":"Update coordination agent defs (lead/coordinator/supervisor/monitor) to use ov/ml aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:05:20.501Z","updatedAt":"2026-02-25T00:19:09.950Z","closedAt":"2026-02-25T00:19:09.950Z","closeReason":"Superseded: merged into canopy-based approach (overstory-41b8, overstory-2528, overstory-882b)"}
{"id":"overstory-d90a","title":"Update templates and overlay code to use ov/ml aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:05:21.264Z","updatedAt":"2026-02-25T00:19:01.845Z","closedAt":"2026-02-25T00:19:01.845Z","closeReason":"Templates (CLAUDE.md.tmpl, overlay.md.tmpl) and overlay TypeScript (overlay.ts, overlay.test.ts) updated to use ov/ml aliases"}
{"id":"overstory-2528","title":"Update coordinator-level canopy prompts to use ov/ml aliases and run cn emit --all","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:22:06.062Z","updatedAt":"2026-02-25T00:19:02.874Z","closedAt":"2026-02-25T00:19:02.874Z","closeReason":"Coordinator-level canopy prompts (lead, supervisor, coordinator-agent, coordinator-base) updated to use ov/ml aliases"}
{"id":"overstory-882b","title":"Update monitor canopy prompt to use ov/ml aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:30:05.310Z","updatedAt":"2026-02-25T00:19:03.456Z","closedAt":"2026-02-25T00:19:03.456Z","closeReason":"Monitor canopy prompt updated to use ov/ml aliases"}
{"id":"overstory-5764","title":"Complete ov alias rename: remaining src files","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T23:30:39.910Z","updatedAt":"2026-02-24T23:53:19.673Z","description":"Fix remaining 'overstory <cmd>' CLI references in src files not fully covered by overstory-3446. Key areas: JSDoc comments, beacon text (monitor/supervisor/coordinator), init.ts README+hooks, dashboard title, doctor checks, and test assertions.","closedAt":"2026-02-24T23:53:19.673Z","closeReason":"Completed: renamed CLI refs in 33 remaining src files (beacon text, JSDoc, dashboard title, monitor/supervisor, test assertions). All quality gates pass."}
{"id":"overstory-391c","title":"Update hooks.json.tmpl + test files for ov/ml aliases","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:31:59.059Z","updatedAt":"2026-02-25T00:19:04.465Z","closedAt":"2026-02-25T00:19:04.465Z","closeReason":"hooks.json.tmpl and hooks-deployer.test.ts updated to use ov/ml aliases"}
{"id":"overstory-90af","title":"Fix e2e test: mulch prime -> ml prime on line 272","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T23:45:13.033Z","updatedAt":"2026-02-25T00:19:05.598Z","closedAt":"2026-02-25T00:19:05.598Z","closeReason":"e2e test assertion updated: mulch prime -> ml prime (line 272)"}
{"id":"overstory-0f32","title":"Fix beadId->taskId in supervisor and coordinator canopy prompts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T23:53:13.574Z","updatedAt":"2026-02-25T00:19:06.343Z","closedAt":"2026-02-25T00:19:06.343Z","closeReason":"beadId->taskId rename in supervisor and coordinator-agent canopy prompts"}
{"id":"overstory-2a2b","title":"Fix post-merge quality gate failures: 3 biome format + 2 test expectations","status":"in_progress","type":"task","priority":1,"createdAt":"2026-02-25T02:16:07.576Z","updatedAt":"2026-02-25T02:23:15.827Z"}
{"id":"overstory-6322","title":"Dashboard/status sessions count silently caps at 100","status":"open","type":"bug","priority":3,"createdAt":"2026-02-25T02:19:12.132Z","updatedAt":"2026-02-25T02:19:12.132Z","description":"ov dashboard and ov status display sessions count from getRecentSessions(100).length, so the count plateaus at 100 with no truncation indicator. Affected: dashboard.ts:300, dashboard.ts:360, status.ts:191. The 100 limit is intentional for performance but the UX should indicate truncation (show '100+'), add a COUNT(*) for true total, or make the limit configurable like ov costs --last <n>."}
{"id":"overstory-a705","title":"URGENT: Fix post-merge quality gates — 3 biome format, 2 test expectations, 1 mulch client binary","status":"in_progress","type":"bug","priority":1,"createdAt":"2026-02-25T02:27:50.593Z","updatedAt":"2026-02-25T03:12:13.712Z","description":"Post-merge from priority-sweep-5 batch. All 14 branches merged but quality gates fail.\n\n## Biome Formatting (3 files)\nStrings shortened by overstory→ov rename now fit on one line. Run bunx biome check --write on each:\n1. src/agents/hooks-deployer.test.ts lines 226-228 and 242-244: collapse multi-line expect().toContain()\n2. src/commands/completions.ts lines 806-808: collapse multi-line lines.push()  \n3. src/commands/status.ts lines 350-352: collapse multi-line process.stderr.write()\n\n## Test Failures (2 tests)\ncn emit --all now produces 12 .md files (8 core agents + 4 slash-command prompts). Tests expect exactly 8:\n1. src/commands/init.test.ts:56 — AGENT_DEF_FILES needs 4 new entries: issue-reviews.md, pr-reviews.md, prioritize.md, release.md\n2. src/e2e/init-sling-lifecycle.test.ts:83 — EXPECTED_AGENT_DEFS needs same 4 entries\n\n## Mulch Client Binary (1 file)\n3. src/mulch/client.ts line 119: change \"mulch\" to \"ml\" in runCommand call (ml binary exists at /Users/jayminwest/.bun/bin/ml). Covers overstory-431e.\n\n## Acceptance\n- bun test: 0 failures\n- bun run lint: clean\n- bun run typecheck: clean\n- Close overstory-2a2b and overstory-431e when done"}
{"id":"overstory-3271","title":"Bug: newly slung leads don't receive mail dispatch — require manual nudge","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-25T02:29:35.415Z","updatedAt":"2026-02-25T03:32:44.947Z","description":"Two consecutive fixup-lead agents (fixup-lead, fixup-lead-2) failed to receive their dispatch mail after being slung. Both showed the base Claude Code screen with no prompt, as if no mail was injected.\n\n## Reproduction\n1. overstory sling <task-id> --capability lead --name fixup-lead --depth 1\n2. overstory mail send --to fixup-lead --subject \"...\" --body \"...\" --type dispatch --priority urgent\n3. Agent boots into tmux but shows empty Claude Code prompt — mail never injected\n4. fixup-lead eventually became zombie with zero commits\n5. fixup-lead-2 had same behavior until manually nudged via: overstory nudge fixup-lead-2 \"...\" --force\n\n## Expected Behavior\nThe UserPromptSubmit hook should run ov mail check --inject on the agent session, picking up the dispatch mail and injecting it as a prompt.\n\n## Possible Causes\n- Hook not installed in the worktree .claude/settings.local.json\n- Race condition: mail sent before hooks are deployed\n- hooks-deployer failing silently\n- Mail check --inject not triggering on initial session start (no UserPromptSubmit event until user types something)\n- The agent has no initial prompt, so it sits at the empty CC screen waiting for input — and UserPromptSubmit never fires because nothing was submitted\n\n## Context\n- Previous leads in this same session (alias-docs-lead, agent-defs-lead, etc.) all received their dispatch mail successfully\n- The failing leads were spawned later in the session after worktree cleanup\n- Both previous leads and fixup leads used identical sling + mail send pattern\n\n## Workaround\noverstory nudge <agent> \"instructions\" --force — sends text directly via tmux","closedAt":"2026-02-25T03:32:44.947Z","closeReason":"Fixed mail dispatch race for newly slung agents. Two changes: (1) Added ov mail check --inject to SessionStart hook in hooks.json.tmpl so agents check mail on boot, (2) Added buildAutoDispatch() in sling.ts that sends auto-dispatch mail to the agent BEFORE creating the tmux session, ensuring mail exists in the DB when SessionStart fires. This eliminates the race where dispatch mail arrived after agent boot, leaving agents idle. 244 tests pass including 6 new tests for buildAutoDispatch."}
{"id":"overstory-7ff2","title":"Fix test constants and mulch binary name","status":"in_progress","type":"task","priority":1,"createdAt":"2026-02-25T02:29:39.112Z","updatedAt":"2026-02-25T02:30:08.420Z"}
{"id":"overstory-4197","title":"Fix: detectOverstoryBinDir only tries 'ov', breaks agents post-alias-migration","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-25T02:41:14.673Z","updatedAt":"2026-02-25T02:41:20.433Z","closedAt":"2026-02-25T02:41:20.433Z","closeReason":"Fixed detectOverstoryBinDir to try both 'ov' and 'overstory' in a loop, so tmux sessions get proper PATH regardless of which binary name is resolvable. Updated test to match."}
{"id":"overstory-6b86","title":"Replace mulch CLI commands with ml alias in agents/*.md and overlay.ts","status":"in_progress","type":"task","priority":2,"createdAt":"2026-02-25T03:05:43.648Z","updatedAt":"2026-02-25T03:06:17.107Z"}
{"id":"overstory-92e9","title":"Fix mail dispatch for newly slung leads","status":"in_progress","type":"task","priority":1,"createdAt":"2026-02-25T03:10:43.746Z","updatedAt":"2026-02-25T03:11:19.787Z","description":"Add SessionStart mail check hook, add dispatch/assign to AUTO_NUDGE_TYPES, add tmux nudge for dispatch type"}
{"id":"overstory-c59b","title":"Add tests for dispatch mail delivery and beacon verification (overstory-3271)","status":"open","type":"task","priority":2,"createdAt":"2026-02-25T03:16:37.974Z","updatedAt":"2026-02-25T03:16:37.974Z","description":"The fix for overstory-3271 (agents not receiving dispatch mail) introduced three changes that lack dedicated test coverage: (1) Beacon verification loop in sling.ts step 13d — the capturePaneContent polling loop that resends the beacon if the welcome screen is still showing. Involves tmux so needs integration tests or scoped tmux mocking. (2) Immediate tmux nudge for dispatch messages in mail.ts — needs tests verifying dispatch messages trigger nudgeAgent with force=true, non-dispatch messages do NOT trigger it, and nudgeAgent failure is non-fatal. (3) SessionStart mail check hook in hooks.json.tmpl — needs a hooks-deployer test verifying the SessionStart array contains both the prime hook AND the mail check hook with correct command and sleep delay. Acceptance: test for dispatch auto-nudge in mail.test.ts, test for SessionStart hook in hooks-deployer.test.ts, beacon verification documented or integration-tested."}
{"id":"overstory-d83f","title":"Fix test expectations and mulch client binary for overstory-a705","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T03:23:23.297Z","updatedAt":"2026-02-25T03:42:07.903Z","closedAt":"2026-02-25T03:42:07.903Z","closeReason":"Fixed test expectations (4 new agent def files), mulch client binary (mulch->ml), and biome formatting (3 files). All quality gates pass."}
{"id":"overstory-643e","title":"Replace status icons with Set D and remove all emoji from CLI output","status":"closed","type":"task","priority":2,"createdAt":"2026-02-25T03:23:23.902Z","updatedAt":"2026-02-25T03:43:29.216Z","closedAt":"2026-02-25T03:43:29.216Z","closeReason":"Replaced all Unicode status icons with Set D (color.cyan(>), color.green(-), color.yellow(!), color.dim(x)) and removed all emoji from CLI output across 14 files. Updated test assertions in metrics.test.ts, worktree.test.ts, and mail.test.ts. Quality gates pass (biome check clean, tsc clean, 2143/2145 tests pass with 2 pre-existing unrelated failures)."}
{"id":"overstory-2e62","title":"Replace 'mulch' CLI invocations with 'ml' in agent defs + overlay.ts","status":"closed","type":"task","priority":2,"createdAt":"2026-02-25T03:23:58.972Z","updatedAt":"2026-02-25T03:33:23.689Z","closedAt":"2026-02-25T03:33:23.689Z","closeReason":"Replaced all mulch CLI invocations with ml alias across 8 agent .md files and overlay.ts (27 lines, 9 files)"}
{"id":"overstory-8b3d","title":"Implement mail dispatch fix: SessionStart hook + sling auto-dispatch","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T03:24:11.114Z","updatedAt":"2026-02-25T03:32:29.240Z","closedAt":"2026-02-25T03:32:29.240Z","closeReason":"Implemented mail dispatch race fix: added mail check to SessionStart hook in hooks.json.tmpl, added buildAutoDispatch() and auto-dispatch mail in sling.ts before tmux session creation, added 6 new tests in sling.test.ts, updated hooks-deployer.test.ts occurrence count. 244 tests pass, typecheck clean, biome clean on changed files."}
{"id":"overstory-f1db","title":"Fix remaining icon/emoji gaps: status.ts + mail.test.ts","status":"open","type":"task","priority":1,"createdAt":"2026-02-25T03:41:57.074Z","updatedAt":"2026-02-25T03:42:03.338Z","description":"Post-merge follow-up from overstory-9ab0 icon replacement:\n\n1. src/commands/status.ts: Remove emoji section headers (📊 🏃 🤖 🌳 📬 🔀 📈 ⚠️) and replace tmux alive markers (● → color.green('>'), ○ → color.red('x')). Add import of color from ../logging/color.ts.\n\n2. src/commands/mail.test.ts: Update 2 test assertions:\n   - Line ~1178: toContain('WARNING') -> toContain('Warning')\n   - Line ~1211: toContain('NOTE') -> toContain('Note')\n\nThese were missed due to file scope restrictions on the icon-replace-builder."}
